(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=t(r);fetch(r.href,l)}})();function AS(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var lh={exports:{}},ya={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kp;function xS(){if(kp)return ya;kp=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,r,l){var o=null;if(l!==void 0&&(o=""+l),r.key!==void 0&&(o=""+r.key),"key"in r){l={};for(var c in r)c!=="key"&&(l[c]=r[c])}else l=r;return r=l.ref,{$$typeof:a,type:i,key:o,ref:r!==void 0?r:null,props:l}}return ya.Fragment=e,ya.jsx=t,ya.jsxs=t,ya}var Op;function LS(){return Op||(Op=1,lh.exports=xS()),lh.exports}var it=LS(),oh={exports:{}},_e={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mp;function RS(){if(Mp)return _e;Mp=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.iterator;function v(I){return I===null||typeof I!="object"?null:(I=p&&I[p]||I["@@iterator"],typeof I=="function"?I:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,A={};function b(I,Y,J){this.props=I,this.context=Y,this.refs=A,this.updater=J||T}b.prototype.isReactComponent={},b.prototype.setState=function(I,Y){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,Y,"setState")},b.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function L(){}L.prototype=b.prototype;function _(I,Y,J){this.props=I,this.context=Y,this.refs=A,this.updater=J||T}var D=_.prototype=new L;D.constructor=_,E(D,b.prototype),D.isPureReactComponent=!0;var w=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},$=Object.prototype.hasOwnProperty;function M(I,Y,J,ie,ae,pe){return J=pe.ref,{$$typeof:a,type:I,key:Y,ref:J!==void 0?J:null,props:pe}}function B(I,Y){return M(I.type,Y,void 0,void 0,void 0,I.props)}function V(I){return typeof I=="object"&&I!==null&&I.$$typeof===a}function U(I){var Y={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(J){return Y[J]})}var te=/\/+/g;function re(I,Y){return typeof I=="object"&&I!==null&&I.key!=null?U(""+I.key):Y.toString(36)}function de(){}function ue(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(de,de):(I.status="pending",I.then(function(Y){I.status==="pending"&&(I.status="fulfilled",I.value=Y)},function(Y){I.status==="pending"&&(I.status="rejected",I.reason=Y)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function le(I,Y,J,ie,ae){var pe=typeof I;(pe==="undefined"||pe==="boolean")&&(I=null);var fe=!1;if(I===null)fe=!0;else switch(pe){case"bigint":case"string":case"number":fe=!0;break;case"object":switch(I.$$typeof){case a:case e:fe=!0;break;case g:return fe=I._init,le(fe(I._payload),Y,J,ie,ae)}}if(fe)return ae=ae(I),fe=ie===""?"."+re(I,0):ie,w(ae)?(J="",fe!=null&&(J=fe.replace(te,"$&/")+"/"),le(ae,Y,J,"",function(Dt){return Dt})):ae!=null&&(V(ae)&&(ae=B(ae,J+(ae.key==null||I&&I.key===ae.key?"":(""+ae.key).replace(te,"$&/")+"/")+fe)),Y.push(ae)),1;fe=0;var Ke=ie===""?".":ie+":";if(w(I))for(var De=0;De<I.length;De++)ie=I[De],pe=Ke+re(ie,De),fe+=le(ie,Y,J,pe,ae);else if(De=v(I),typeof De=="function")for(I=De.call(I),De=0;!(ie=I.next()).done;)ie=ie.value,pe=Ke+re(ie,De++),fe+=le(ie,Y,J,pe,ae);else if(pe==="object"){if(typeof I.then=="function")return le(ue(I),Y,J,ie,ae);throw Y=String(I),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.")}return fe}function P(I,Y,J){if(I==null)return I;var ie=[],ae=0;return le(I,ie,"","",function(pe){return Y.call(J,pe,ae++)}),ie}function X(I){if(I._status===-1){var Y=I._result;Y=Y(),Y.then(function(J){(I._status===0||I._status===-1)&&(I._status=1,I._result=J)},function(J){(I._status===0||I._status===-1)&&(I._status=2,I._result=J)}),I._status===-1&&(I._status=0,I._result=Y)}if(I._status===1)return I._result.default;throw I._result}var ne=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(Y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)};function Q(){}return _e.Children={map:P,forEach:function(I,Y,J){P(I,function(){Y.apply(this,arguments)},J)},count:function(I){var Y=0;return P(I,function(){Y++}),Y},toArray:function(I){return P(I,function(Y){return Y})||[]},only:function(I){if(!V(I))throw Error("React.Children.only expected to receive a single React element child.");return I}},_e.Component=b,_e.Fragment=t,_e.Profiler=r,_e.PureComponent=_,_e.StrictMode=i,_e.Suspense=d,_e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,_e.__COMPILER_RUNTIME={__proto__:null,c:function(I){return k.H.useMemoCache(I)}},_e.cache=function(I){return function(){return I.apply(null,arguments)}},_e.cloneElement=function(I,Y,J){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var ie=E({},I.props),ae=I.key,pe=void 0;if(Y!=null)for(fe in Y.ref!==void 0&&(pe=void 0),Y.key!==void 0&&(ae=""+Y.key),Y)!$.call(Y,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&Y.ref===void 0||(ie[fe]=Y[fe]);var fe=arguments.length-2;if(fe===1)ie.children=J;else if(1<fe){for(var Ke=Array(fe),De=0;De<fe;De++)Ke[De]=arguments[De+2];ie.children=Ke}return M(I.type,ae,void 0,void 0,pe,ie)},_e.createContext=function(I){return I={$$typeof:o,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:l,_context:I},I},_e.createElement=function(I,Y,J){var ie,ae={},pe=null;if(Y!=null)for(ie in Y.key!==void 0&&(pe=""+Y.key),Y)$.call(Y,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(ae[ie]=Y[ie]);var fe=arguments.length-2;if(fe===1)ae.children=J;else if(1<fe){for(var Ke=Array(fe),De=0;De<fe;De++)Ke[De]=arguments[De+2];ae.children=Ke}if(I&&I.defaultProps)for(ie in fe=I.defaultProps,fe)ae[ie]===void 0&&(ae[ie]=fe[ie]);return M(I,pe,void 0,void 0,null,ae)},_e.createRef=function(){return{current:null}},_e.forwardRef=function(I){return{$$typeof:c,render:I}},_e.isValidElement=V,_e.lazy=function(I){return{$$typeof:g,_payload:{_status:-1,_result:I},_init:X}},_e.memo=function(I,Y){return{$$typeof:f,type:I,compare:Y===void 0?null:Y}},_e.startTransition=function(I){var Y=k.T,J={};k.T=J;try{var ie=I(),ae=k.S;ae!==null&&ae(J,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(Q,ne)}catch(pe){ne(pe)}finally{k.T=Y}},_e.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},_e.use=function(I){return k.H.use(I)},_e.useActionState=function(I,Y,J){return k.H.useActionState(I,Y,J)},_e.useCallback=function(I,Y){return k.H.useCallback(I,Y)},_e.useContext=function(I){return k.H.useContext(I)},_e.useDebugValue=function(){},_e.useDeferredValue=function(I,Y){return k.H.useDeferredValue(I,Y)},_e.useEffect=function(I,Y,J){var ie=k.H;if(typeof J=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ie.useEffect(I,Y)},_e.useId=function(){return k.H.useId()},_e.useImperativeHandle=function(I,Y,J){return k.H.useImperativeHandle(I,Y,J)},_e.useInsertionEffect=function(I,Y){return k.H.useInsertionEffect(I,Y)},_e.useLayoutEffect=function(I,Y){return k.H.useLayoutEffect(I,Y)},_e.useMemo=function(I,Y){return k.H.useMemo(I,Y)},_e.useOptimistic=function(I,Y){return k.H.useOptimistic(I,Y)},_e.useReducer=function(I,Y,J){return k.H.useReducer(I,Y,J)},_e.useRef=function(I){return k.H.useRef(I)},_e.useState=function(I){return k.H.useState(I)},_e.useSyncExternalStore=function(I,Y,J){return k.H.useSyncExternalStore(I,Y,J)},_e.useTransition=function(){return k.H.useTransition()},_e.version="19.1.0",_e}var Pp;function mf(){return Pp||(Pp=1,oh.exports=RS()),oh.exports}var si=mf(),uh={exports:{}},va={},ch={exports:{}},hh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Np;function _S(){return Np||(Np=1,function(a){function e(P,X){var ne=P.length;P.push(X);e:for(;0<ne;){var Q=ne-1>>>1,I=P[Q];if(0<r(I,X))P[Q]=X,P[ne]=I,ne=Q;else break e}}function t(P){return P.length===0?null:P[0]}function i(P){if(P.length===0)return null;var X=P[0],ne=P.pop();if(ne!==X){P[0]=ne;e:for(var Q=0,I=P.length,Y=I>>>1;Q<Y;){var J=2*(Q+1)-1,ie=P[J],ae=J+1,pe=P[ae];if(0>r(ie,ne))ae<I&&0>r(pe,ie)?(P[Q]=pe,P[ae]=ne,Q=ae):(P[Q]=ie,P[J]=ne,Q=J);else if(ae<I&&0>r(pe,ne))P[Q]=pe,P[ae]=ne,Q=ae;else break e}}return X}function r(P,X){var ne=P.sortIndex-X.sortIndex;return ne!==0?ne:P.id-X.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;a.unstable_now=function(){return l.now()}}else{var o=Date,c=o.now();a.unstable_now=function(){return o.now()-c}}var d=[],f=[],g=1,p=null,v=3,T=!1,E=!1,A=!1,b=!1,L=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function w(P){for(var X=t(f);X!==null;){if(X.callback===null)i(f);else if(X.startTime<=P)i(f),X.sortIndex=X.expirationTime,e(d,X);else break;X=t(f)}}function k(P){if(A=!1,w(P),!E)if(t(d)!==null)E=!0,$||($=!0,re());else{var X=t(f);X!==null&&le(k,X.startTime-P)}}var $=!1,M=-1,B=5,V=-1;function U(){return b?!0:!(a.unstable_now()-V<B)}function te(){if(b=!1,$){var P=a.unstable_now();V=P;var X=!0;try{e:{E=!1,A&&(A=!1,_(M),M=-1),T=!0;var ne=v;try{t:{for(w(P),p=t(d);p!==null&&!(p.expirationTime>P&&U());){var Q=p.callback;if(typeof Q=="function"){p.callback=null,v=p.priorityLevel;var I=Q(p.expirationTime<=P);if(P=a.unstable_now(),typeof I=="function"){p.callback=I,w(P),X=!0;break t}p===t(d)&&i(d),w(P)}else i(d);p=t(d)}if(p!==null)X=!0;else{var Y=t(f);Y!==null&&le(k,Y.startTime-P),X=!1}}break e}finally{p=null,v=ne,T=!1}X=void 0}}finally{X?re():$=!1}}}var re;if(typeof D=="function")re=function(){D(te)};else if(typeof MessageChannel<"u"){var de=new MessageChannel,ue=de.port2;de.port1.onmessage=te,re=function(){ue.postMessage(null)}}else re=function(){L(te,0)};function le(P,X){M=L(function(){P(a.unstable_now())},X)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(P){P.callback=null},a.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<P?Math.floor(1e3/P):5},a.unstable_getCurrentPriorityLevel=function(){return v},a.unstable_next=function(P){switch(v){case 1:case 2:case 3:var X=3;break;default:X=v}var ne=v;v=X;try{return P()}finally{v=ne}},a.unstable_requestPaint=function(){b=!0},a.unstable_runWithPriority=function(P,X){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var ne=v;v=P;try{return X()}finally{v=ne}},a.unstable_scheduleCallback=function(P,X,ne){var Q=a.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?Q+ne:Q):ne=Q,P){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=ne+I,P={id:g++,callback:X,priorityLevel:P,startTime:ne,expirationTime:I,sortIndex:-1},ne>Q?(P.sortIndex=ne,e(f,P),t(d)===null&&P===t(f)&&(A?(_(M),M=-1):A=!0,le(k,ne-Q))):(P.sortIndex=I,e(d,P),E||T||(E=!0,$||($=!0,re()))),P},a.unstable_shouldYield=U,a.unstable_wrapCallback=function(P){var X=v;return function(){var ne=v;v=X;try{return P.apply(this,arguments)}finally{v=ne}}}}(hh)),hh}var Up;function DS(){return Up||(Up=1,ch.exports=_S()),ch.exports}var fh={exports:{}},Nt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bp;function IS(){if(Bp)return Nt;Bp=1;var a=mf();function e(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function l(d,f,g){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:d,containerInfo:f,implementation:g}}var o=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Nt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Nt.createPortal=function(d,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return l(d,f,null,g)},Nt.flushSync=function(d){var f=o.T,g=i.p;try{if(o.T=null,i.p=2,d)return d()}finally{o.T=f,i.p=g,i.d.f()}},Nt.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,i.d.C(d,f))},Nt.prefetchDNS=function(d){typeof d=="string"&&i.d.D(d)},Nt.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var g=f.as,p=c(g,f.crossOrigin),v=typeof f.integrity=="string"?f.integrity:void 0,T=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;g==="style"?i.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:p,integrity:v,fetchPriority:T}):g==="script"&&i.d.X(d,{crossOrigin:p,integrity:v,fetchPriority:T,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Nt.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var g=c(f.as,f.crossOrigin);i.d.M(d,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&i.d.M(d)},Nt.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var g=f.as,p=c(g,f.crossOrigin);i.d.L(d,g,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Nt.preloadModule=function(d,f){if(typeof d=="string")if(f){var g=c(f.as,f.crossOrigin);i.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else i.d.m(d)},Nt.requestFormReset=function(d){i.d.r(d)},Nt.unstable_batchedUpdates=function(d,f){return d(f)},Nt.useFormState=function(d,f,g){return o.H.useFormState(d,f,g)},Nt.useFormStatus=function(){return o.H.useHostTransitionStatus()},Nt.version="19.1.0",Nt}var Fp;function CS(){if(Fp)return fh.exports;Fp=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),fh.exports=IS(),fh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $p;function wS(){if($p)return va;$p=1;var a=DS(),e=mf(),t=CS();function i(s){var n="https://react.dev/errors/"+s;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)n+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+s+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function l(s){var n=s,u=s;if(s.alternate)for(;n.return;)n=n.return;else{s=n;do n=s,(n.flags&4098)!==0&&(u=n.return),s=n.return;while(s)}return n.tag===3?u:null}function o(s){if(s.tag===13){var n=s.memoizedState;if(n===null&&(s=s.alternate,s!==null&&(n=s.memoizedState)),n!==null)return n.dehydrated}return null}function c(s){if(l(s)!==s)throw Error(i(188))}function d(s){var n=s.alternate;if(!n){if(n=l(s),n===null)throw Error(i(188));return n!==s?null:s}for(var u=s,h=n;;){var m=u.return;if(m===null)break;var y=m.alternate;if(y===null){if(h=m.return,h!==null){u=h;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===u)return c(m),s;if(y===h)return c(m),n;y=y.sibling}throw Error(i(188))}if(u.return!==h.return)u=m,h=y;else{for(var x=!1,R=m.child;R;){if(R===u){x=!0,u=m,h=y;break}if(R===h){x=!0,h=m,u=y;break}R=R.sibling}if(!x){for(R=y.child;R;){if(R===u){x=!0,u=y,h=m;break}if(R===h){x=!0,h=y,u=m;break}R=R.sibling}if(!x)throw Error(i(189))}}if(u.alternate!==h)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?s:n}function f(s){var n=s.tag;if(n===5||n===26||n===27||n===6)return s;for(s=s.child;s!==null;){if(n=f(s),n!==null)return n;s=s.sibling}return null}var g=Object.assign,p=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),_=Symbol.for("react.consumer"),D=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),te=Symbol.iterator;function re(s){return s===null||typeof s!="object"?null:(s=te&&s[te]||s["@@iterator"],typeof s=="function"?s:null)}var de=Symbol.for("react.client.reference");function ue(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===de?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case E:return"Fragment";case b:return"Profiler";case A:return"StrictMode";case k:return"Suspense";case $:return"SuspenseList";case V:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case T:return"Portal";case D:return(s.displayName||"Context")+".Provider";case _:return(s._context.displayName||"Context")+".Consumer";case w:var n=s.render;return s=s.displayName,s||(s=n.displayName||n.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case M:return n=s.displayName||null,n!==null?n:ue(s.type)||"Memo";case B:n=s._payload,s=s._init;try{return ue(s(n))}catch{}}return null}var le=Array.isArray,P=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne={pending:!1,data:null,method:null,action:null},Q=[],I=-1;function Y(s){return{current:s}}function J(s){0>I||(s.current=Q[I],Q[I]=null,I--)}function ie(s,n){I++,Q[I]=s.current,s.current=n}var ae=Y(null),pe=Y(null),fe=Y(null),Ke=Y(null);function De(s,n){switch(ie(fe,n),ie(pe,s),ie(ae,null),n.nodeType){case 9:case 11:s=(s=n.documentElement)&&(s=s.namespaceURI)?ap(s):0;break;default:if(s=n.tagName,n=n.namespaceURI)n=ap(n),s=lp(n,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}J(ae),ie(ae,s)}function Dt(){J(ae),J(pe),J(fe)}function vn(s){s.memoizedState!==null&&ie(Ke,s);var n=ae.current,u=lp(n,s.type);n!==u&&(ie(pe,s),ie(ae,u))}function Tn(s){pe.current===s&&(J(ae),J(pe)),Ke.current===s&&(J(Ke),fa._currentValue=ne)}var Tr=Object.prototype.hasOwnProperty,Ks=a.unstable_scheduleCallback,zs=a.unstable_cancelCallback,Hf=a.unstable_shouldYield,Me=a.unstable_requestPaint,Ze=a.unstable_now,$t=a.unstable_getCurrentPriorityLevel,_i=a.unstable_ImmediatePriority,Gt=a.unstable_UserBlockingPriority,Ti=a.unstable_NormalPriority,Ki=a.unstable_LowPriority,Er=a.unstable_IdlePriority,En=a.log,Ha=a.unstable_setDisableYieldValue,Ei=null,kt=null;function Di(s){if(typeof En=="function"&&Ha(s),kt&&typeof kt.setStrictMode=="function")try{kt.setStrictMode(Ei,s)}catch{}}var Ot=Math.clz32?Math.clz32:uT,Va=Math.log,qs=Math.LN2;function uT(s){return s>>>=0,s===0?32:31-(Va(s)/qs|0)|0}var Ka=256,za=4194304;function Ys(s){var n=s&42;if(n!==0)return n;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function qa(s,n,u){var h=s.pendingLanes;if(h===0)return 0;var m=0,y=s.suspendedLanes,x=s.pingedLanes;s=s.warmLanes;var R=h&134217727;return R!==0?(h=R&~y,h!==0?m=Ys(h):(x&=R,x!==0?m=Ys(x):u||(u=R&~s,u!==0&&(m=Ys(u))))):(R=h&~y,R!==0?m=Ys(R):x!==0?m=Ys(x):u||(u=h&~s,u!==0&&(m=Ys(u)))),m===0?0:n!==0&&n!==m&&(n&y)===0&&(y=m&-m,u=n&-n,y>=u||y===32&&(u&4194048)!==0)?n:m}function Sr(s,n){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&n)===0}function cT(s,n){switch(s){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vf(){var s=Ka;return Ka<<=1,(Ka&4194048)===0&&(Ka=256),s}function Kf(){var s=za;return za<<=1,(za&62914560)===0&&(za=4194304),s}function Qo(s){for(var n=[],u=0;31>u;u++)n.push(s);return n}function br(s,n){s.pendingLanes|=n,n!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function hT(s,n,u,h,m,y){var x=s.pendingLanes;s.pendingLanes=u,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=u,s.entangledLanes&=u,s.errorRecoveryDisabledLanes&=u,s.shellSuspendCounter=0;var R=s.entanglements,O=s.expirationTimes,z=s.hiddenUpdates;for(u=x&~u;0<u;){var W=31-Ot(u),se=1<<W;R[W]=0,O[W]=-1;var q=z[W];if(q!==null)for(z[W]=null,W=0;W<q.length;W++){var j=q[W];j!==null&&(j.lane&=-536870913)}u&=~se}h!==0&&zf(s,h,0),y!==0&&m===0&&s.tag!==0&&(s.suspendedLanes|=y&~(x&~n))}function zf(s,n,u){s.pendingLanes|=n,s.suspendedLanes&=~n;var h=31-Ot(n);s.entangledLanes|=n,s.entanglements[h]=s.entanglements[h]|1073741824|u&4194090}function qf(s,n){var u=s.entangledLanes|=n;for(s=s.entanglements;u;){var h=31-Ot(u),m=1<<h;m&n|s[h]&n&&(s[h]|=n),u&=~m}}function Wo(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Zo(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Yf(){var s=X.p;return s!==0?s:(s=window.event,s===void 0?32:Rp(s.type))}function fT(s,n){var u=X.p;try{return X.p=s,n()}finally{X.p=u}}var ds=Math.random().toString(36).slice(2),Mt="__reactFiber$"+ds,Ht="__reactProps$"+ds,Sn="__reactContainer$"+ds,Jo="__reactEvents$"+ds,dT="__reactListeners$"+ds,gT="__reactHandles$"+ds,jf="__reactResources$"+ds,Ar="__reactMarker$"+ds;function eu(s){delete s[Mt],delete s[Ht],delete s[Jo],delete s[dT],delete s[gT]}function bn(s){var n=s[Mt];if(n)return n;for(var u=s.parentNode;u;){if(n=u[Sn]||u[Mt]){if(u=n.alternate,n.child!==null||u!==null&&u.child!==null)for(s=hp(s);s!==null;){if(u=s[Mt])return u;s=hp(s)}return n}s=u,u=s.parentNode}return null}function An(s){if(s=s[Mt]||s[Sn]){var n=s.tag;if(n===5||n===6||n===13||n===26||n===27||n===3)return s}return null}function xr(s){var n=s.tag;if(n===5||n===26||n===27||n===6)return s.stateNode;throw Error(i(33))}function xn(s){var n=s[jf];return n||(n=s[jf]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Et(s){s[Ar]=!0}var Xf=new Set,Qf={};function js(s,n){Ln(s,n),Ln(s+"Capture",n)}function Ln(s,n){for(Qf[s]=n,s=0;s<n.length;s++)Xf.add(n[s])}var mT=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wf={},Zf={};function pT(s){return Tr.call(Zf,s)?!0:Tr.call(Wf,s)?!1:mT.test(s)?Zf[s]=!0:(Wf[s]=!0,!1)}function Ya(s,n,u){if(pT(n))if(u===null)s.removeAttribute(n);else{switch(typeof u){case"undefined":case"function":case"symbol":s.removeAttribute(n);return;case"boolean":var h=n.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){s.removeAttribute(n);return}}s.setAttribute(n,""+u)}}function ja(s,n,u){if(u===null)s.removeAttribute(n);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(n);return}s.setAttribute(n,""+u)}}function zi(s,n,u,h){if(h===null)s.removeAttribute(u);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(u);return}s.setAttributeNS(n,u,""+h)}}var tu,Jf;function Rn(s){if(tu===void 0)try{throw Error()}catch(u){var n=u.stack.trim().match(/\n( *(at )?)/);tu=n&&n[1]||"",Jf=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+tu+s+Jf}var iu=!1;function su(s,n){if(!s||iu)return"";iu=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(n){var se=function(){throw Error()};if(Object.defineProperty(se.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(se,[])}catch(j){var q=j}Reflect.construct(s,[],se)}else{try{se.call()}catch(j){q=j}s.call(se.prototype)}}else{try{throw Error()}catch(j){q=j}(se=s())&&typeof se.catch=="function"&&se.catch(function(){})}}catch(j){if(j&&q&&typeof j.stack=="string")return[j.stack,q.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=h.DetermineComponentFrameRoot(),x=y[0],R=y[1];if(x&&R){var O=x.split(`
`),z=R.split(`
`);for(m=h=0;h<O.length&&!O[h].includes("DetermineComponentFrameRoot");)h++;for(;m<z.length&&!z[m].includes("DetermineComponentFrameRoot");)m++;if(h===O.length||m===z.length)for(h=O.length-1,m=z.length-1;1<=h&&0<=m&&O[h]!==z[m];)m--;for(;1<=h&&0<=m;h--,m--)if(O[h]!==z[m]){if(h!==1||m!==1)do if(h--,m--,0>m||O[h]!==z[m]){var W=`
`+O[h].replace(" at new "," at ");return s.displayName&&W.includes("<anonymous>")&&(W=W.replace("<anonymous>",s.displayName)),W}while(1<=h&&0<=m);break}}}finally{iu=!1,Error.prepareStackTrace=u}return(u=s?s.displayName||s.name:"")?Rn(u):""}function yT(s){switch(s.tag){case 26:case 27:case 5:return Rn(s.type);case 16:return Rn("Lazy");case 13:return Rn("Suspense");case 19:return Rn("SuspenseList");case 0:case 15:return su(s.type,!1);case 11:return su(s.type.render,!1);case 1:return su(s.type,!0);case 31:return Rn("Activity");default:return""}}function ed(s){try{var n="";do n+=yT(s),s=s.return;while(s);return n}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function ai(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function td(s){var n=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function vT(s){var n=td(s)?"checked":"value",u=Object.getOwnPropertyDescriptor(s.constructor.prototype,n),h=""+s[n];if(!s.hasOwnProperty(n)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var m=u.get,y=u.set;return Object.defineProperty(s,n,{configurable:!0,get:function(){return m.call(this)},set:function(x){h=""+x,y.call(this,x)}}),Object.defineProperty(s,n,{enumerable:u.enumerable}),{getValue:function(){return h},setValue:function(x){h=""+x},stopTracking:function(){s._valueTracker=null,delete s[n]}}}}function Xa(s){s._valueTracker||(s._valueTracker=vT(s))}function id(s){if(!s)return!1;var n=s._valueTracker;if(!n)return!0;var u=n.getValue(),h="";return s&&(h=td(s)?s.checked?"true":"false":s.value),s=h,s!==u?(n.setValue(s),!0):!1}function Qa(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var TT=/[\n"\\]/g;function li(s){return s.replace(TT,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function nu(s,n,u,h,m,y,x,R){s.name="",x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?s.type=x:s.removeAttribute("type"),n!=null?x==="number"?(n===0&&s.value===""||s.value!=n)&&(s.value=""+ai(n)):s.value!==""+ai(n)&&(s.value=""+ai(n)):x!=="submit"&&x!=="reset"||s.removeAttribute("value"),n!=null?ru(s,x,ai(n)):u!=null?ru(s,x,ai(u)):h!=null&&s.removeAttribute("value"),m==null&&y!=null&&(s.defaultChecked=!!y),m!=null&&(s.checked=m&&typeof m!="function"&&typeof m!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?s.name=""+ai(R):s.removeAttribute("name")}function sd(s,n,u,h,m,y,x,R){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(s.type=y),n!=null||u!=null){if(!(y!=="submit"&&y!=="reset"||n!=null))return;u=u!=null?""+ai(u):"",n=n!=null?""+ai(n):u,R||n===s.value||(s.value=n),s.defaultValue=n}h=h??m,h=typeof h!="function"&&typeof h!="symbol"&&!!h,s.checked=R?s.checked:!!h,s.defaultChecked=!!h,x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(s.name=x)}function ru(s,n,u){n==="number"&&Qa(s.ownerDocument)===s||s.defaultValue===""+u||(s.defaultValue=""+u)}function _n(s,n,u,h){if(s=s.options,n){n={};for(var m=0;m<u.length;m++)n["$"+u[m]]=!0;for(u=0;u<s.length;u++)m=n.hasOwnProperty("$"+s[u].value),s[u].selected!==m&&(s[u].selected=m),m&&h&&(s[u].defaultSelected=!0)}else{for(u=""+ai(u),n=null,m=0;m<s.length;m++){if(s[m].value===u){s[m].selected=!0,h&&(s[m].defaultSelected=!0);return}n!==null||s[m].disabled||(n=s[m])}n!==null&&(n.selected=!0)}}function nd(s,n,u){if(n!=null&&(n=""+ai(n),n!==s.value&&(s.value=n),u==null)){s.defaultValue!==n&&(s.defaultValue=n);return}s.defaultValue=u!=null?""+ai(u):""}function rd(s,n,u,h){if(n==null){if(h!=null){if(u!=null)throw Error(i(92));if(le(h)){if(1<h.length)throw Error(i(93));h=h[0]}u=h}u==null&&(u=""),n=u}u=ai(n),s.defaultValue=u,h=s.textContent,h===u&&h!==""&&h!==null&&(s.value=h)}function Dn(s,n){if(n){var u=s.firstChild;if(u&&u===s.lastChild&&u.nodeType===3){u.nodeValue=n;return}}s.textContent=n}var ET=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ad(s,n,u){var h=n.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?h?s.setProperty(n,""):n==="float"?s.cssFloat="":s[n]="":h?s.setProperty(n,u):typeof u!="number"||u===0||ET.has(n)?n==="float"?s.cssFloat=u:s[n]=(""+u).trim():s[n]=u+"px"}function ld(s,n,u){if(n!=null&&typeof n!="object")throw Error(i(62));if(s=s.style,u!=null){for(var h in u)!u.hasOwnProperty(h)||n!=null&&n.hasOwnProperty(h)||(h.indexOf("--")===0?s.setProperty(h,""):h==="float"?s.cssFloat="":s[h]="");for(var m in n)h=n[m],n.hasOwnProperty(m)&&u[m]!==h&&ad(s,m,h)}else for(var y in n)n.hasOwnProperty(y)&&ad(s,y,n[y])}function au(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ST=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),bT=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wa(s){return bT.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var lu=null;function ou(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var In=null,Cn=null;function od(s){var n=An(s);if(n&&(s=n.stateNode)){var u=s[Ht]||null;e:switch(s=n.stateNode,n.type){case"input":if(nu(s,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),n=u.name,u.type==="radio"&&n!=null){for(u=s;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+li(""+n)+'"][type="radio"]'),n=0;n<u.length;n++){var h=u[n];if(h!==s&&h.form===s.form){var m=h[Ht]||null;if(!m)throw Error(i(90));nu(h,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(n=0;n<u.length;n++)h=u[n],h.form===s.form&&id(h)}break e;case"textarea":nd(s,u.value,u.defaultValue);break e;case"select":n=u.value,n!=null&&_n(s,!!u.multiple,n,!1)}}}var uu=!1;function ud(s,n,u){if(uu)return s(n,u);uu=!0;try{var h=s(n);return h}finally{if(uu=!1,(In!==null||Cn!==null)&&(Nl(),In&&(n=In,s=Cn,Cn=In=null,od(n),s)))for(n=0;n<s.length;n++)od(s[n])}}function Lr(s,n){var u=s.stateNode;if(u===null)return null;var h=u[Ht]||null;if(h===null)return null;u=h[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(s=s.type,h=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!h;break e;default:s=!1}if(s)return null;if(u&&typeof u!="function")throw Error(i(231,n,typeof u));return u}var qi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cu=!1;if(qi)try{var Rr={};Object.defineProperty(Rr,"passive",{get:function(){cu=!0}}),window.addEventListener("test",Rr,Rr),window.removeEventListener("test",Rr,Rr)}catch{cu=!1}var gs=null,hu=null,Za=null;function cd(){if(Za)return Za;var s,n=hu,u=n.length,h,m="value"in gs?gs.value:gs.textContent,y=m.length;for(s=0;s<u&&n[s]===m[s];s++);var x=u-s;for(h=1;h<=x&&n[u-h]===m[y-h];h++);return Za=m.slice(s,1<h?1-h:void 0)}function Ja(s){var n=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&n===13&&(s=13)):s=n,s===10&&(s=13),32<=s||s===13?s:0}function el(){return!0}function hd(){return!1}function Vt(s){function n(u,h,m,y,x){this._reactName=u,this._targetInst=m,this.type=h,this.nativeEvent=y,this.target=x,this.currentTarget=null;for(var R in s)s.hasOwnProperty(R)&&(u=s[R],this[R]=u?u(y):y[R]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?el:hd,this.isPropagationStopped=hd,this}return g(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=el)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=el)},persist:function(){},isPersistent:el}),n}var Xs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tl=Vt(Xs),_r=g({},Xs,{view:0,detail:0}),AT=Vt(_r),fu,du,Dr,il=g({},_r,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mu,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Dr&&(Dr&&s.type==="mousemove"?(fu=s.screenX-Dr.screenX,du=s.screenY-Dr.screenY):du=fu=0,Dr=s),fu)},movementY:function(s){return"movementY"in s?s.movementY:du}}),fd=Vt(il),xT=g({},il,{dataTransfer:0}),LT=Vt(xT),RT=g({},_r,{relatedTarget:0}),gu=Vt(RT),_T=g({},Xs,{animationName:0,elapsedTime:0,pseudoElement:0}),DT=Vt(_T),IT=g({},Xs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),CT=Vt(IT),wT=g({},Xs,{data:0}),dd=Vt(wT),kT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},OT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},MT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function PT(s){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(s):(s=MT[s])?!!n[s]:!1}function mu(){return PT}var NT=g({},_r,{key:function(s){if(s.key){var n=kT[s.key]||s.key;if(n!=="Unidentified")return n}return s.type==="keypress"?(s=Ja(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?OT[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mu,charCode:function(s){return s.type==="keypress"?Ja(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Ja(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),UT=Vt(NT),BT=g({},il,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gd=Vt(BT),FT=g({},_r,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mu}),$T=Vt(FT),GT=g({},Xs,{propertyName:0,elapsedTime:0,pseudoElement:0}),HT=Vt(GT),VT=g({},il,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),KT=Vt(VT),zT=g({},Xs,{newState:0,oldState:0}),qT=Vt(zT),YT=[9,13,27,32],pu=qi&&"CompositionEvent"in window,Ir=null;qi&&"documentMode"in document&&(Ir=document.documentMode);var jT=qi&&"TextEvent"in window&&!Ir,md=qi&&(!pu||Ir&&8<Ir&&11>=Ir),pd=" ",yd=!1;function vd(s,n){switch(s){case"keyup":return YT.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Td(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var wn=!1;function XT(s,n){switch(s){case"compositionend":return Td(n);case"keypress":return n.which!==32?null:(yd=!0,pd);case"textInput":return s=n.data,s===pd&&yd?null:s;default:return null}}function QT(s,n){if(wn)return s==="compositionend"||!pu&&vd(s,n)?(s=cd(),Za=hu=gs=null,wn=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return md&&n.locale!=="ko"?null:n.data;default:return null}}var WT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ed(s){var n=s&&s.nodeName&&s.nodeName.toLowerCase();return n==="input"?!!WT[s.type]:n==="textarea"}function Sd(s,n,u,h){In?Cn?Cn.push(h):Cn=[h]:In=h,n=Hl(n,"onChange"),0<n.length&&(u=new tl("onChange","change",null,u,h),s.push({event:u,listeners:n}))}var Cr=null,wr=null;function ZT(s){tp(s,0)}function sl(s){var n=xr(s);if(id(n))return s}function bd(s,n){if(s==="change")return n}var Ad=!1;if(qi){var yu;if(qi){var vu="oninput"in document;if(!vu){var xd=document.createElement("div");xd.setAttribute("oninput","return;"),vu=typeof xd.oninput=="function"}yu=vu}else yu=!1;Ad=yu&&(!document.documentMode||9<document.documentMode)}function Ld(){Cr&&(Cr.detachEvent("onpropertychange",Rd),wr=Cr=null)}function Rd(s){if(s.propertyName==="value"&&sl(wr)){var n=[];Sd(n,wr,s,ou(s)),ud(ZT,n)}}function JT(s,n,u){s==="focusin"?(Ld(),Cr=n,wr=u,Cr.attachEvent("onpropertychange",Rd)):s==="focusout"&&Ld()}function eE(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return sl(wr)}function tE(s,n){if(s==="click")return sl(n)}function iE(s,n){if(s==="input"||s==="change")return sl(n)}function sE(s,n){return s===n&&(s!==0||1/s===1/n)||s!==s&&n!==n}var Xt=typeof Object.is=="function"?Object.is:sE;function kr(s,n){if(Xt(s,n))return!0;if(typeof s!="object"||s===null||typeof n!="object"||n===null)return!1;var u=Object.keys(s),h=Object.keys(n);if(u.length!==h.length)return!1;for(h=0;h<u.length;h++){var m=u[h];if(!Tr.call(n,m)||!Xt(s[m],n[m]))return!1}return!0}function _d(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Dd(s,n){var u=_d(s);s=0;for(var h;u;){if(u.nodeType===3){if(h=s+u.textContent.length,s<=n&&h>=n)return{node:u,offset:n-s};s=h}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=_d(u)}}function Id(s,n){return s&&n?s===n?!0:s&&s.nodeType===3?!1:n&&n.nodeType===3?Id(s,n.parentNode):"contains"in s?s.contains(n):s.compareDocumentPosition?!!(s.compareDocumentPosition(n)&16):!1:!1}function Cd(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var n=Qa(s.document);n instanceof s.HTMLIFrameElement;){try{var u=typeof n.contentWindow.location.href=="string"}catch{u=!1}if(u)s=n.contentWindow;else break;n=Qa(s.document)}return n}function Tu(s){var n=s&&s.nodeName&&s.nodeName.toLowerCase();return n&&(n==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||n==="textarea"||s.contentEditable==="true")}var nE=qi&&"documentMode"in document&&11>=document.documentMode,kn=null,Eu=null,Or=null,Su=!1;function wd(s,n,u){var h=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Su||kn==null||kn!==Qa(h)||(h=kn,"selectionStart"in h&&Tu(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Or&&kr(Or,h)||(Or=h,h=Hl(Eu,"onSelect"),0<h.length&&(n=new tl("onSelect","select",null,n,u),s.push({event:n,listeners:h}),n.target=kn)))}function Qs(s,n){var u={};return u[s.toLowerCase()]=n.toLowerCase(),u["Webkit"+s]="webkit"+n,u["Moz"+s]="moz"+n,u}var On={animationend:Qs("Animation","AnimationEnd"),animationiteration:Qs("Animation","AnimationIteration"),animationstart:Qs("Animation","AnimationStart"),transitionrun:Qs("Transition","TransitionRun"),transitionstart:Qs("Transition","TransitionStart"),transitioncancel:Qs("Transition","TransitionCancel"),transitionend:Qs("Transition","TransitionEnd")},bu={},kd={};qi&&(kd=document.createElement("div").style,"AnimationEvent"in window||(delete On.animationend.animation,delete On.animationiteration.animation,delete On.animationstart.animation),"TransitionEvent"in window||delete On.transitionend.transition);function Ws(s){if(bu[s])return bu[s];if(!On[s])return s;var n=On[s],u;for(u in n)if(n.hasOwnProperty(u)&&u in kd)return bu[s]=n[u];return s}var Od=Ws("animationend"),Md=Ws("animationiteration"),Pd=Ws("animationstart"),rE=Ws("transitionrun"),aE=Ws("transitionstart"),lE=Ws("transitioncancel"),Nd=Ws("transitionend"),Ud=new Map,Au="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Au.push("scrollEnd");function Si(s,n){Ud.set(s,n),js(n,[s])}var Bd=new WeakMap;function oi(s,n){if(typeof s=="object"&&s!==null){var u=Bd.get(s);return u!==void 0?u:(n={value:s,source:n,stack:ed(n)},Bd.set(s,n),n)}return{value:s,source:n,stack:ed(n)}}var ui=[],Mn=0,xu=0;function nl(){for(var s=Mn,n=xu=Mn=0;n<s;){var u=ui[n];ui[n++]=null;var h=ui[n];ui[n++]=null;var m=ui[n];ui[n++]=null;var y=ui[n];if(ui[n++]=null,h!==null&&m!==null){var x=h.pending;x===null?m.next=m:(m.next=x.next,x.next=m),h.pending=m}y!==0&&Fd(u,m,y)}}function rl(s,n,u,h){ui[Mn++]=s,ui[Mn++]=n,ui[Mn++]=u,ui[Mn++]=h,xu|=h,s.lanes|=h,s=s.alternate,s!==null&&(s.lanes|=h)}function Lu(s,n,u,h){return rl(s,n,u,h),al(s)}function Pn(s,n){return rl(s,null,null,n),al(s)}function Fd(s,n,u){s.lanes|=u;var h=s.alternate;h!==null&&(h.lanes|=u);for(var m=!1,y=s.return;y!==null;)y.childLanes|=u,h=y.alternate,h!==null&&(h.childLanes|=u),y.tag===22&&(s=y.stateNode,s===null||s._visibility&1||(m=!0)),s=y,y=y.return;return s.tag===3?(y=s.stateNode,m&&n!==null&&(m=31-Ot(u),s=y.hiddenUpdates,h=s[m],h===null?s[m]=[n]:h.push(n),n.lane=u|536870912),y):null}function al(s){if(50<na)throw na=0,wc=null,Error(i(185));for(var n=s.return;n!==null;)s=n,n=s.return;return s.tag===3?s.stateNode:null}var Nn={};function oE(s,n,u,h){this.tag=s,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qt(s,n,u,h){return new oE(s,n,u,h)}function Ru(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Yi(s,n){var u=s.alternate;return u===null?(u=Qt(s.tag,n,s.key,s.mode),u.elementType=s.elementType,u.type=s.type,u.stateNode=s.stateNode,u.alternate=s,s.alternate=u):(u.pendingProps=n,u.type=s.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=s.flags&65011712,u.childLanes=s.childLanes,u.lanes=s.lanes,u.child=s.child,u.memoizedProps=s.memoizedProps,u.memoizedState=s.memoizedState,u.updateQueue=s.updateQueue,n=s.dependencies,u.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},u.sibling=s.sibling,u.index=s.index,u.ref=s.ref,u.refCleanup=s.refCleanup,u}function $d(s,n){s.flags&=65011714;var u=s.alternate;return u===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,n=u.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),s}function ll(s,n,u,h,m,y){var x=0;if(h=s,typeof s=="function")Ru(s)&&(x=1);else if(typeof s=="string")x=cS(s,u,ae.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case V:return s=Qt(31,u,n,m),s.elementType=V,s.lanes=y,s;case E:return Zs(u.children,m,y,n);case A:x=8,m|=24;break;case b:return s=Qt(12,u,n,m|2),s.elementType=b,s.lanes=y,s;case k:return s=Qt(13,u,n,m),s.elementType=k,s.lanes=y,s;case $:return s=Qt(19,u,n,m),s.elementType=$,s.lanes=y,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case L:case D:x=10;break e;case _:x=9;break e;case w:x=11;break e;case M:x=14;break e;case B:x=16,h=null;break e}x=29,u=Error(i(130,s===null?"null":typeof s,"")),h=null}return n=Qt(x,u,n,m),n.elementType=s,n.type=h,n.lanes=y,n}function Zs(s,n,u,h){return s=Qt(7,s,h,n),s.lanes=u,s}function _u(s,n,u){return s=Qt(6,s,null,n),s.lanes=u,s}function Du(s,n,u){return n=Qt(4,s.children!==null?s.children:[],s.key,n),n.lanes=u,n.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},n}var Un=[],Bn=0,ol=null,ul=0,ci=[],hi=0,Js=null,ji=1,Xi="";function en(s,n){Un[Bn++]=ul,Un[Bn++]=ol,ol=s,ul=n}function Gd(s,n,u){ci[hi++]=ji,ci[hi++]=Xi,ci[hi++]=Js,Js=s;var h=ji;s=Xi;var m=32-Ot(h)-1;h&=~(1<<m),u+=1;var y=32-Ot(n)+m;if(30<y){var x=m-m%5;y=(h&(1<<x)-1).toString(32),h>>=x,m-=x,ji=1<<32-Ot(n)+m|u<<m|h,Xi=y+s}else ji=1<<y|u<<m|h,Xi=s}function Iu(s){s.return!==null&&(en(s,1),Gd(s,1,0))}function Cu(s){for(;s===ol;)ol=Un[--Bn],Un[Bn]=null,ul=Un[--Bn],Un[Bn]=null;for(;s===Js;)Js=ci[--hi],ci[hi]=null,Xi=ci[--hi],ci[hi]=null,ji=ci[--hi],ci[hi]=null}var Ft=null,lt=null,$e=!1,tn=null,Ii=!1,wu=Error(i(519));function sn(s){var n=Error(i(418,""));throw Nr(oi(n,s)),wu}function Hd(s){var n=s.stateNode,u=s.type,h=s.memoizedProps;switch(n[Mt]=s,n[Ht]=h,u){case"dialog":Oe("cancel",n),Oe("close",n);break;case"iframe":case"object":case"embed":Oe("load",n);break;case"video":case"audio":for(u=0;u<aa.length;u++)Oe(aa[u],n);break;case"source":Oe("error",n);break;case"img":case"image":case"link":Oe("error",n),Oe("load",n);break;case"details":Oe("toggle",n);break;case"input":Oe("invalid",n),sd(n,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0),Xa(n);break;case"select":Oe("invalid",n);break;case"textarea":Oe("invalid",n),rd(n,h.value,h.defaultValue,h.children),Xa(n)}u=h.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||n.textContent===""+u||h.suppressHydrationWarning===!0||rp(n.textContent,u)?(h.popover!=null&&(Oe("beforetoggle",n),Oe("toggle",n)),h.onScroll!=null&&Oe("scroll",n),h.onScrollEnd!=null&&Oe("scrollend",n),h.onClick!=null&&(n.onclick=Vl),n=!0):n=!1,n||sn(s)}function Vd(s){for(Ft=s.return;Ft;)switch(Ft.tag){case 5:case 13:Ii=!1;return;case 27:case 3:Ii=!0;return;default:Ft=Ft.return}}function Mr(s){if(s!==Ft)return!1;if(!$e)return Vd(s),$e=!0,!1;var n=s.tag,u;if((u=n!==3&&n!==27)&&((u=n===5)&&(u=s.type,u=!(u!=="form"&&u!=="button")||Yc(s.type,s.memoizedProps)),u=!u),u&&lt&&sn(s),Vd(s),n===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));e:{for(s=s.nextSibling,n=0;s;){if(s.nodeType===8)if(u=s.data,u==="/$"){if(n===0){lt=Ai(s.nextSibling);break e}n--}else u!=="$"&&u!=="$!"&&u!=="$?"||n++;s=s.nextSibling}lt=null}}else n===27?(n=lt,Cs(s.type)?(s=Wc,Wc=null,lt=s):lt=n):lt=Ft?Ai(s.stateNode.nextSibling):null;return!0}function Pr(){lt=Ft=null,$e=!1}function Kd(){var s=tn;return s!==null&&(qt===null?qt=s:qt.push.apply(qt,s),tn=null),s}function Nr(s){tn===null?tn=[s]:tn.push(s)}var ku=Y(null),nn=null,Qi=null;function ms(s,n,u){ie(ku,n._currentValue),n._currentValue=u}function Wi(s){s._currentValue=ku.current,J(ku)}function Ou(s,n,u){for(;s!==null;){var h=s.alternate;if((s.childLanes&n)!==n?(s.childLanes|=n,h!==null&&(h.childLanes|=n)):h!==null&&(h.childLanes&n)!==n&&(h.childLanes|=n),s===u)break;s=s.return}}function Mu(s,n,u,h){var m=s.child;for(m!==null&&(m.return=s);m!==null;){var y=m.dependencies;if(y!==null){var x=m.child;y=y.firstContext;e:for(;y!==null;){var R=y;y=m;for(var O=0;O<n.length;O++)if(R.context===n[O]){y.lanes|=u,R=y.alternate,R!==null&&(R.lanes|=u),Ou(y.return,u,s),h||(x=null);break e}y=R.next}}else if(m.tag===18){if(x=m.return,x===null)throw Error(i(341));x.lanes|=u,y=x.alternate,y!==null&&(y.lanes|=u),Ou(x,u,s),x=null}else x=m.child;if(x!==null)x.return=m;else for(x=m;x!==null;){if(x===s){x=null;break}if(m=x.sibling,m!==null){m.return=x.return,x=m;break}x=x.return}m=x}}function Ur(s,n,u,h){s=null;for(var m=n,y=!1;m!==null;){if(!y){if((m.flags&524288)!==0)y=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var x=m.alternate;if(x===null)throw Error(i(387));if(x=x.memoizedProps,x!==null){var R=m.type;Xt(m.pendingProps.value,x.value)||(s!==null?s.push(R):s=[R])}}else if(m===Ke.current){if(x=m.alternate,x===null)throw Error(i(387));x.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(s!==null?s.push(fa):s=[fa])}m=m.return}s!==null&&Mu(n,s,u,h),n.flags|=262144}function cl(s){for(s=s.firstContext;s!==null;){if(!Xt(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function rn(s){nn=s,Qi=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Pt(s){return zd(nn,s)}function hl(s,n){return nn===null&&rn(s),zd(s,n)}function zd(s,n){var u=n._currentValue;if(n={context:n,memoizedValue:u,next:null},Qi===null){if(s===null)throw Error(i(308));Qi=n,s.dependencies={lanes:0,firstContext:n},s.flags|=524288}else Qi=Qi.next=n;return u}var uE=typeof AbortController<"u"?AbortController:function(){var s=[],n=this.signal={aborted:!1,addEventListener:function(u,h){s.push(h)}};this.abort=function(){n.aborted=!0,s.forEach(function(u){return u()})}},cE=a.unstable_scheduleCallback,hE=a.unstable_NormalPriority,mt={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Pu(){return{controller:new uE,data:new Map,refCount:0}}function Br(s){s.refCount--,s.refCount===0&&cE(hE,function(){s.controller.abort()})}var Fr=null,Nu=0,Fn=0,$n=null;function fE(s,n){if(Fr===null){var u=Fr=[];Nu=0,Fn=Bc(),$n={status:"pending",value:void 0,then:function(h){u.push(h)}}}return Nu++,n.then(qd,qd),n}function qd(){if(--Nu===0&&Fr!==null){$n!==null&&($n.status="fulfilled");var s=Fr;Fr=null,Fn=0,$n=null;for(var n=0;n<s.length;n++)(0,s[n])()}}function dE(s,n){var u=[],h={status:"pending",value:null,reason:null,then:function(m){u.push(m)}};return s.then(function(){h.status="fulfilled",h.value=n;for(var m=0;m<u.length;m++)(0,u[m])(n)},function(m){for(h.status="rejected",h.reason=m,m=0;m<u.length;m++)(0,u[m])(void 0)}),h}var Yd=P.S;P.S=function(s,n){typeof n=="object"&&n!==null&&typeof n.then=="function"&&fE(s,n),Yd!==null&&Yd(s,n)};var an=Y(null);function Uu(){var s=an.current;return s!==null?s:tt.pooledCache}function fl(s,n){n===null?ie(an,an.current):ie(an,n.pool)}function jd(){var s=Uu();return s===null?null:{parent:mt._currentValue,pool:s}}var $r=Error(i(460)),Xd=Error(i(474)),dl=Error(i(542)),Bu={then:function(){}};function Qd(s){return s=s.status,s==="fulfilled"||s==="rejected"}function gl(){}function Wd(s,n,u){switch(u=s[u],u===void 0?s.push(n):u!==n&&(n.then(gl,gl),n=u),n.status){case"fulfilled":return n.value;case"rejected":throw s=n.reason,Jd(s),s;default:if(typeof n.status=="string")n.then(gl,gl);else{if(s=tt,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=n,s.status="pending",s.then(function(h){if(n.status==="pending"){var m=n;m.status="fulfilled",m.value=h}},function(h){if(n.status==="pending"){var m=n;m.status="rejected",m.reason=h}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw s=n.reason,Jd(s),s}throw Gr=n,$r}}var Gr=null;function Zd(){if(Gr===null)throw Error(i(459));var s=Gr;return Gr=null,s}function Jd(s){if(s===$r||s===dl)throw Error(i(483))}var ps=!1;function Fu(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function $u(s,n){s=s.updateQueue,n.updateQueue===s&&(n.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function ys(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function vs(s,n,u){var h=s.updateQueue;if(h===null)return null;if(h=h.shared,(ze&2)!==0){var m=h.pending;return m===null?n.next=n:(n.next=m.next,m.next=n),h.pending=n,n=al(s),Fd(s,null,u),n}return rl(s,h,n,u),al(s)}function Hr(s,n,u){if(n=n.updateQueue,n!==null&&(n=n.shared,(u&4194048)!==0)){var h=n.lanes;h&=s.pendingLanes,u|=h,n.lanes=u,qf(s,u)}}function Gu(s,n){var u=s.updateQueue,h=s.alternate;if(h!==null&&(h=h.updateQueue,u===h)){var m=null,y=null;if(u=u.firstBaseUpdate,u!==null){do{var x={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};y===null?m=y=x:y=y.next=x,u=u.next}while(u!==null);y===null?m=y=n:y=y.next=n}else m=y=n;u={baseState:h.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:h.shared,callbacks:h.callbacks},s.updateQueue=u;return}s=u.lastBaseUpdate,s===null?u.firstBaseUpdate=n:s.next=n,u.lastBaseUpdate=n}var Hu=!1;function Vr(){if(Hu){var s=$n;if(s!==null)throw s}}function Kr(s,n,u,h){Hu=!1;var m=s.updateQueue;ps=!1;var y=m.firstBaseUpdate,x=m.lastBaseUpdate,R=m.shared.pending;if(R!==null){m.shared.pending=null;var O=R,z=O.next;O.next=null,x===null?y=z:x.next=z,x=O;var W=s.alternate;W!==null&&(W=W.updateQueue,R=W.lastBaseUpdate,R!==x&&(R===null?W.firstBaseUpdate=z:R.next=z,W.lastBaseUpdate=O))}if(y!==null){var se=m.baseState;x=0,W=z=O=null,R=y;do{var q=R.lane&-536870913,j=q!==R.lane;if(j?(Pe&q)===q:(h&q)===q){q!==0&&q===Fn&&(Hu=!0),W!==null&&(W=W.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});e:{var Ae=s,Te=R;q=n;var Qe=u;switch(Te.tag){case 1:if(Ae=Te.payload,typeof Ae=="function"){se=Ae.call(Qe,se,q);break e}se=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=Te.payload,q=typeof Ae=="function"?Ae.call(Qe,se,q):Ae,q==null)break e;se=g({},se,q);break e;case 2:ps=!0}}q=R.callback,q!==null&&(s.flags|=64,j&&(s.flags|=8192),j=m.callbacks,j===null?m.callbacks=[q]:j.push(q))}else j={lane:q,tag:R.tag,payload:R.payload,callback:R.callback,next:null},W===null?(z=W=j,O=se):W=W.next=j,x|=q;if(R=R.next,R===null){if(R=m.shared.pending,R===null)break;j=R,R=j.next,j.next=null,m.lastBaseUpdate=j,m.shared.pending=null}}while(!0);W===null&&(O=se),m.baseState=O,m.firstBaseUpdate=z,m.lastBaseUpdate=W,y===null&&(m.shared.lanes=0),Rs|=x,s.lanes=x,s.memoizedState=se}}function eg(s,n){if(typeof s!="function")throw Error(i(191,s));s.call(n)}function tg(s,n){var u=s.callbacks;if(u!==null)for(s.callbacks=null,s=0;s<u.length;s++)eg(u[s],n)}var Gn=Y(null),ml=Y(0);function ig(s,n){s=ns,ie(ml,s),ie(Gn,n),ns=s|n.baseLanes}function Vu(){ie(ml,ns),ie(Gn,Gn.current)}function Ku(){ns=ml.current,J(Gn),J(ml)}var Ts=0,Ie=null,je=null,dt=null,pl=!1,Hn=!1,ln=!1,yl=0,zr=0,Vn=null,gE=0;function ut(){throw Error(i(321))}function zu(s,n){if(n===null)return!1;for(var u=0;u<n.length&&u<s.length;u++)if(!Xt(s[u],n[u]))return!1;return!0}function qu(s,n,u,h,m,y){return Ts=y,Ie=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,P.H=s===null||s.memoizedState===null?Fg:$g,ln=!1,y=u(h,m),ln=!1,Hn&&(y=ng(n,u,h,m)),sg(s),y}function sg(s){P.H=Al;var n=je!==null&&je.next!==null;if(Ts=0,dt=je=Ie=null,pl=!1,zr=0,Vn=null,n)throw Error(i(300));s===null||St||(s=s.dependencies,s!==null&&cl(s)&&(St=!0))}function ng(s,n,u,h){Ie=s;var m=0;do{if(Hn&&(Vn=null),zr=0,Hn=!1,25<=m)throw Error(i(301));if(m+=1,dt=je=null,s.updateQueue!=null){var y=s.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}P.H=SE,y=n(u,h)}while(Hn);return y}function mE(){var s=P.H,n=s.useState()[0];return n=typeof n.then=="function"?qr(n):n,s=s.useState()[0],(je!==null?je.memoizedState:null)!==s&&(Ie.flags|=1024),n}function Yu(){var s=yl!==0;return yl=0,s}function ju(s,n,u){n.updateQueue=s.updateQueue,n.flags&=-2053,s.lanes&=~u}function Xu(s){if(pl){for(s=s.memoizedState;s!==null;){var n=s.queue;n!==null&&(n.pending=null),s=s.next}pl=!1}Ts=0,dt=je=Ie=null,Hn=!1,zr=yl=0,Vn=null}function Kt(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dt===null?Ie.memoizedState=dt=s:dt=dt.next=s,dt}function gt(){if(je===null){var s=Ie.alternate;s=s!==null?s.memoizedState:null}else s=je.next;var n=dt===null?Ie.memoizedState:dt.next;if(n!==null)dt=n,je=s;else{if(s===null)throw Ie.alternate===null?Error(i(467)):Error(i(310));je=s,s={memoizedState:je.memoizedState,baseState:je.baseState,baseQueue:je.baseQueue,queue:je.queue,next:null},dt===null?Ie.memoizedState=dt=s:dt=dt.next=s}return dt}function Qu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function qr(s){var n=zr;return zr+=1,Vn===null&&(Vn=[]),s=Wd(Vn,s,n),n=Ie,(dt===null?n.memoizedState:dt.next)===null&&(n=n.alternate,P.H=n===null||n.memoizedState===null?Fg:$g),s}function vl(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return qr(s);if(s.$$typeof===D)return Pt(s)}throw Error(i(438,String(s)))}function Wu(s){var n=null,u=Ie.updateQueue;if(u!==null&&(n=u.memoCache),n==null){var h=Ie.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(n={data:h.data.map(function(m){return m.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),u===null&&(u=Qu(),Ie.updateQueue=u),u.memoCache=n,u=n.data[n.index],u===void 0)for(u=n.data[n.index]=Array(s),h=0;h<s;h++)u[h]=U;return n.index++,u}function Zi(s,n){return typeof n=="function"?n(s):n}function Tl(s){var n=gt();return Zu(n,je,s)}function Zu(s,n,u){var h=s.queue;if(h===null)throw Error(i(311));h.lastRenderedReducer=u;var m=s.baseQueue,y=h.pending;if(y!==null){if(m!==null){var x=m.next;m.next=y.next,y.next=x}n.baseQueue=m=y,h.pending=null}if(y=s.baseState,m===null)s.memoizedState=y;else{n=m.next;var R=x=null,O=null,z=n,W=!1;do{var se=z.lane&-536870913;if(se!==z.lane?(Pe&se)===se:(Ts&se)===se){var q=z.revertLane;if(q===0)O!==null&&(O=O.next={lane:0,revertLane:0,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),se===Fn&&(W=!0);else if((Ts&q)===q){z=z.next,q===Fn&&(W=!0);continue}else se={lane:0,revertLane:z.revertLane,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},O===null?(R=O=se,x=y):O=O.next=se,Ie.lanes|=q,Rs|=q;se=z.action,ln&&u(y,se),y=z.hasEagerState?z.eagerState:u(y,se)}else q={lane:se,revertLane:z.revertLane,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},O===null?(R=O=q,x=y):O=O.next=q,Ie.lanes|=se,Rs|=se;z=z.next}while(z!==null&&z!==n);if(O===null?x=y:O.next=R,!Xt(y,s.memoizedState)&&(St=!0,W&&(u=$n,u!==null)))throw u;s.memoizedState=y,s.baseState=x,s.baseQueue=O,h.lastRenderedState=y}return m===null&&(h.lanes=0),[s.memoizedState,h.dispatch]}function Ju(s){var n=gt(),u=n.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=s;var h=u.dispatch,m=u.pending,y=n.memoizedState;if(m!==null){u.pending=null;var x=m=m.next;do y=s(y,x.action),x=x.next;while(x!==m);Xt(y,n.memoizedState)||(St=!0),n.memoizedState=y,n.baseQueue===null&&(n.baseState=y),u.lastRenderedState=y}return[y,h]}function rg(s,n,u){var h=Ie,m=gt(),y=$e;if(y){if(u===void 0)throw Error(i(407));u=u()}else u=n();var x=!Xt((je||m).memoizedState,u);x&&(m.memoizedState=u,St=!0),m=m.queue;var R=og.bind(null,h,m,s);if(Yr(2048,8,R,[s]),m.getSnapshot!==n||x||dt!==null&&dt.memoizedState.tag&1){if(h.flags|=2048,Kn(9,El(),lg.bind(null,h,m,u,n),null),tt===null)throw Error(i(349));y||(Ts&124)!==0||ag(h,n,u)}return u}function ag(s,n,u){s.flags|=16384,s={getSnapshot:n,value:u},n=Ie.updateQueue,n===null?(n=Qu(),Ie.updateQueue=n,n.stores=[s]):(u=n.stores,u===null?n.stores=[s]:u.push(s))}function lg(s,n,u,h){n.value=u,n.getSnapshot=h,ug(n)&&cg(s)}function og(s,n,u){return u(function(){ug(n)&&cg(s)})}function ug(s){var n=s.getSnapshot;s=s.value;try{var u=n();return!Xt(s,u)}catch{return!0}}function cg(s){var n=Pn(s,2);n!==null&&ti(n,s,2)}function ec(s){var n=Kt();if(typeof s=="function"){var u=s;if(s=u(),ln){Di(!0);try{u()}finally{Di(!1)}}}return n.memoizedState=n.baseState=s,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zi,lastRenderedState:s},n}function hg(s,n,u,h){return s.baseState=u,Zu(s,je,typeof h=="function"?h:Zi)}function pE(s,n,u,h,m){if(bl(s))throw Error(i(485));if(s=n.action,s!==null){var y={payload:m,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(x){y.listeners.push(x)}};P.T!==null?u(!0):y.isTransition=!1,h(y),u=n.pending,u===null?(y.next=n.pending=y,fg(n,y)):(y.next=u.next,n.pending=u.next=y)}}function fg(s,n){var u=n.action,h=n.payload,m=s.state;if(n.isTransition){var y=P.T,x={};P.T=x;try{var R=u(m,h),O=P.S;O!==null&&O(x,R),dg(s,n,R)}catch(z){tc(s,n,z)}finally{P.T=y}}else try{y=u(m,h),dg(s,n,y)}catch(z){tc(s,n,z)}}function dg(s,n,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(h){gg(s,n,h)},function(h){return tc(s,n,h)}):gg(s,n,u)}function gg(s,n,u){n.status="fulfilled",n.value=u,mg(n),s.state=u,n=s.pending,n!==null&&(u=n.next,u===n?s.pending=null:(u=u.next,n.next=u,fg(s,u)))}function tc(s,n,u){var h=s.pending;if(s.pending=null,h!==null){h=h.next;do n.status="rejected",n.reason=u,mg(n),n=n.next;while(n!==h)}s.action=null}function mg(s){s=s.listeners;for(var n=0;n<s.length;n++)(0,s[n])()}function pg(s,n){return n}function yg(s,n){if($e){var u=tt.formState;if(u!==null){e:{var h=Ie;if($e){if(lt){t:{for(var m=lt,y=Ii;m.nodeType!==8;){if(!y){m=null;break t}if(m=Ai(m.nextSibling),m===null){m=null;break t}}y=m.data,m=y==="F!"||y==="F"?m:null}if(m){lt=Ai(m.nextSibling),h=m.data==="F!";break e}}sn(h)}h=!1}h&&(n=u[0])}}return u=Kt(),u.memoizedState=u.baseState=n,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pg,lastRenderedState:n},u.queue=h,u=Ng.bind(null,Ie,h),h.dispatch=u,h=ec(!1),y=ac.bind(null,Ie,!1,h.queue),h=Kt(),m={state:n,dispatch:null,action:s,pending:null},h.queue=m,u=pE.bind(null,Ie,m,y,u),m.dispatch=u,h.memoizedState=s,[n,u,!1]}function vg(s){var n=gt();return Tg(n,je,s)}function Tg(s,n,u){if(n=Zu(s,n,pg)[0],s=Tl(Zi)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var h=qr(n)}catch(x){throw x===$r?dl:x}else h=n;n=gt();var m=n.queue,y=m.dispatch;return u!==n.memoizedState&&(Ie.flags|=2048,Kn(9,El(),yE.bind(null,m,u),null)),[h,y,s]}function yE(s,n){s.action=n}function Eg(s){var n=gt(),u=je;if(u!==null)return Tg(n,u,s);gt(),n=n.memoizedState,u=gt();var h=u.queue.dispatch;return u.memoizedState=s,[n,h,!1]}function Kn(s,n,u,h){return s={tag:s,create:u,deps:h,inst:n,next:null},n=Ie.updateQueue,n===null&&(n=Qu(),Ie.updateQueue=n),u=n.lastEffect,u===null?n.lastEffect=s.next=s:(h=u.next,u.next=s,s.next=h,n.lastEffect=s),s}function El(){return{destroy:void 0,resource:void 0}}function Sg(){return gt().memoizedState}function Sl(s,n,u,h){var m=Kt();h=h===void 0?null:h,Ie.flags|=s,m.memoizedState=Kn(1|n,El(),u,h)}function Yr(s,n,u,h){var m=gt();h=h===void 0?null:h;var y=m.memoizedState.inst;je!==null&&h!==null&&zu(h,je.memoizedState.deps)?m.memoizedState=Kn(n,y,u,h):(Ie.flags|=s,m.memoizedState=Kn(1|n,y,u,h))}function bg(s,n){Sl(8390656,8,s,n)}function Ag(s,n){Yr(2048,8,s,n)}function xg(s,n){return Yr(4,2,s,n)}function Lg(s,n){return Yr(4,4,s,n)}function Rg(s,n){if(typeof n=="function"){s=s();var u=n(s);return function(){typeof u=="function"?u():n(null)}}if(n!=null)return s=s(),n.current=s,function(){n.current=null}}function _g(s,n,u){u=u!=null?u.concat([s]):null,Yr(4,4,Rg.bind(null,n,s),u)}function ic(){}function Dg(s,n){var u=gt();n=n===void 0?null:n;var h=u.memoizedState;return n!==null&&zu(n,h[1])?h[0]:(u.memoizedState=[s,n],s)}function Ig(s,n){var u=gt();n=n===void 0?null:n;var h=u.memoizedState;if(n!==null&&zu(n,h[1]))return h[0];if(h=s(),ln){Di(!0);try{s()}finally{Di(!1)}}return u.memoizedState=[h,n],h}function sc(s,n,u){return u===void 0||(Ts&1073741824)!==0?s.memoizedState=n:(s.memoizedState=u,s=km(),Ie.lanes|=s,Rs|=s,u)}function Cg(s,n,u,h){return Xt(u,n)?u:Gn.current!==null?(s=sc(s,u,h),Xt(s,n)||(St=!0),s):(Ts&42)===0?(St=!0,s.memoizedState=u):(s=km(),Ie.lanes|=s,Rs|=s,n)}function wg(s,n,u,h,m){var y=X.p;X.p=y!==0&&8>y?y:8;var x=P.T,R={};P.T=R,ac(s,!1,n,u);try{var O=m(),z=P.S;if(z!==null&&z(R,O),O!==null&&typeof O=="object"&&typeof O.then=="function"){var W=dE(O,h);jr(s,n,W,ei(s))}else jr(s,n,h,ei(s))}catch(se){jr(s,n,{then:function(){},status:"rejected",reason:se},ei())}finally{X.p=y,P.T=x}}function vE(){}function nc(s,n,u,h){if(s.tag!==5)throw Error(i(476));var m=kg(s).queue;wg(s,m,n,ne,u===null?vE:function(){return Og(s),u(h)})}function kg(s){var n=s.memoizedState;if(n!==null)return n;n={memoizedState:ne,baseState:ne,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zi,lastRenderedState:ne},next:null};var u={};return n.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zi,lastRenderedState:u},next:null},s.memoizedState=n,s=s.alternate,s!==null&&(s.memoizedState=n),n}function Og(s){var n=kg(s).next.queue;jr(s,n,{},ei())}function rc(){return Pt(fa)}function Mg(){return gt().memoizedState}function Pg(){return gt().memoizedState}function TE(s){for(var n=s.return;n!==null;){switch(n.tag){case 24:case 3:var u=ei();s=ys(u);var h=vs(n,s,u);h!==null&&(ti(h,n,u),Hr(h,n,u)),n={cache:Pu()},s.payload=n;return}n=n.return}}function EE(s,n,u){var h=ei();u={lane:h,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},bl(s)?Ug(n,u):(u=Lu(s,n,u,h),u!==null&&(ti(u,s,h),Bg(u,n,h)))}function Ng(s,n,u){var h=ei();jr(s,n,u,h)}function jr(s,n,u,h){var m={lane:h,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(bl(s))Ug(n,m);else{var y=s.alternate;if(s.lanes===0&&(y===null||y.lanes===0)&&(y=n.lastRenderedReducer,y!==null))try{var x=n.lastRenderedState,R=y(x,u);if(m.hasEagerState=!0,m.eagerState=R,Xt(R,x))return rl(s,n,m,0),tt===null&&nl(),!1}catch{}finally{}if(u=Lu(s,n,m,h),u!==null)return ti(u,s,h),Bg(u,n,h),!0}return!1}function ac(s,n,u,h){if(h={lane:2,revertLane:Bc(),action:h,hasEagerState:!1,eagerState:null,next:null},bl(s)){if(n)throw Error(i(479))}else n=Lu(s,u,h,2),n!==null&&ti(n,s,2)}function bl(s){var n=s.alternate;return s===Ie||n!==null&&n===Ie}function Ug(s,n){Hn=pl=!0;var u=s.pending;u===null?n.next=n:(n.next=u.next,u.next=n),s.pending=n}function Bg(s,n,u){if((u&4194048)!==0){var h=n.lanes;h&=s.pendingLanes,u|=h,n.lanes=u,qf(s,u)}}var Al={readContext:Pt,use:vl,useCallback:ut,useContext:ut,useEffect:ut,useImperativeHandle:ut,useLayoutEffect:ut,useInsertionEffect:ut,useMemo:ut,useReducer:ut,useRef:ut,useState:ut,useDebugValue:ut,useDeferredValue:ut,useTransition:ut,useSyncExternalStore:ut,useId:ut,useHostTransitionStatus:ut,useFormState:ut,useActionState:ut,useOptimistic:ut,useMemoCache:ut,useCacheRefresh:ut},Fg={readContext:Pt,use:vl,useCallback:function(s,n){return Kt().memoizedState=[s,n===void 0?null:n],s},useContext:Pt,useEffect:bg,useImperativeHandle:function(s,n,u){u=u!=null?u.concat([s]):null,Sl(4194308,4,Rg.bind(null,n,s),u)},useLayoutEffect:function(s,n){return Sl(4194308,4,s,n)},useInsertionEffect:function(s,n){Sl(4,2,s,n)},useMemo:function(s,n){var u=Kt();n=n===void 0?null:n;var h=s();if(ln){Di(!0);try{s()}finally{Di(!1)}}return u.memoizedState=[h,n],h},useReducer:function(s,n,u){var h=Kt();if(u!==void 0){var m=u(n);if(ln){Di(!0);try{u(n)}finally{Di(!1)}}}else m=n;return h.memoizedState=h.baseState=m,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:m},h.queue=s,s=s.dispatch=EE.bind(null,Ie,s),[h.memoizedState,s]},useRef:function(s){var n=Kt();return s={current:s},n.memoizedState=s},useState:function(s){s=ec(s);var n=s.queue,u=Ng.bind(null,Ie,n);return n.dispatch=u,[s.memoizedState,u]},useDebugValue:ic,useDeferredValue:function(s,n){var u=Kt();return sc(u,s,n)},useTransition:function(){var s=ec(!1);return s=wg.bind(null,Ie,s.queue,!0,!1),Kt().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,n,u){var h=Ie,m=Kt();if($e){if(u===void 0)throw Error(i(407));u=u()}else{if(u=n(),tt===null)throw Error(i(349));(Pe&124)!==0||ag(h,n,u)}m.memoizedState=u;var y={value:u,getSnapshot:n};return m.queue=y,bg(og.bind(null,h,y,s),[s]),h.flags|=2048,Kn(9,El(),lg.bind(null,h,y,u,n),null),u},useId:function(){var s=Kt(),n=tt.identifierPrefix;if($e){var u=Xi,h=ji;u=(h&~(1<<32-Ot(h)-1)).toString(32)+u,n=""+n+"R"+u,u=yl++,0<u&&(n+="H"+u.toString(32)),n+=""}else u=gE++,n=""+n+"r"+u.toString(32)+"";return s.memoizedState=n},useHostTransitionStatus:rc,useFormState:yg,useActionState:yg,useOptimistic:function(s){var n=Kt();n.memoizedState=n.baseState=s;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=u,n=ac.bind(null,Ie,!0,u),u.dispatch=n,[s,n]},useMemoCache:Wu,useCacheRefresh:function(){return Kt().memoizedState=TE.bind(null,Ie)}},$g={readContext:Pt,use:vl,useCallback:Dg,useContext:Pt,useEffect:Ag,useImperativeHandle:_g,useInsertionEffect:xg,useLayoutEffect:Lg,useMemo:Ig,useReducer:Tl,useRef:Sg,useState:function(){return Tl(Zi)},useDebugValue:ic,useDeferredValue:function(s,n){var u=gt();return Cg(u,je.memoizedState,s,n)},useTransition:function(){var s=Tl(Zi)[0],n=gt().memoizedState;return[typeof s=="boolean"?s:qr(s),n]},useSyncExternalStore:rg,useId:Mg,useHostTransitionStatus:rc,useFormState:vg,useActionState:vg,useOptimistic:function(s,n){var u=gt();return hg(u,je,s,n)},useMemoCache:Wu,useCacheRefresh:Pg},SE={readContext:Pt,use:vl,useCallback:Dg,useContext:Pt,useEffect:Ag,useImperativeHandle:_g,useInsertionEffect:xg,useLayoutEffect:Lg,useMemo:Ig,useReducer:Ju,useRef:Sg,useState:function(){return Ju(Zi)},useDebugValue:ic,useDeferredValue:function(s,n){var u=gt();return je===null?sc(u,s,n):Cg(u,je.memoizedState,s,n)},useTransition:function(){var s=Ju(Zi)[0],n=gt().memoizedState;return[typeof s=="boolean"?s:qr(s),n]},useSyncExternalStore:rg,useId:Mg,useHostTransitionStatus:rc,useFormState:Eg,useActionState:Eg,useOptimistic:function(s,n){var u=gt();return je!==null?hg(u,je,s,n):(u.baseState=s,[s,u.queue.dispatch])},useMemoCache:Wu,useCacheRefresh:Pg},zn=null,Xr=0;function xl(s){var n=Xr;return Xr+=1,zn===null&&(zn=[]),Wd(zn,s,n)}function Qr(s,n){n=n.props.ref,s.ref=n!==void 0?n:null}function Ll(s,n){throw n.$$typeof===p?Error(i(525)):(s=Object.prototype.toString.call(n),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":s)))}function Gg(s){var n=s._init;return n(s._payload)}function Hg(s){function n(F,N){if(s){var H=F.deletions;H===null?(F.deletions=[N],F.flags|=16):H.push(N)}}function u(F,N){if(!s)return null;for(;N!==null;)n(F,N),N=N.sibling;return null}function h(F){for(var N=new Map;F!==null;)F.key!==null?N.set(F.key,F):N.set(F.index,F),F=F.sibling;return N}function m(F,N){return F=Yi(F,N),F.index=0,F.sibling=null,F}function y(F,N,H){return F.index=H,s?(H=F.alternate,H!==null?(H=H.index,H<N?(F.flags|=67108866,N):H):(F.flags|=67108866,N)):(F.flags|=1048576,N)}function x(F){return s&&F.alternate===null&&(F.flags|=67108866),F}function R(F,N,H,ee){return N===null||N.tag!==6?(N=_u(H,F.mode,ee),N.return=F,N):(N=m(N,H),N.return=F,N)}function O(F,N,H,ee){var ge=H.type;return ge===E?W(F,N,H.props.children,ee,H.key):N!==null&&(N.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===B&&Gg(ge)===N.type)?(N=m(N,H.props),Qr(N,H),N.return=F,N):(N=ll(H.type,H.key,H.props,null,F.mode,ee),Qr(N,H),N.return=F,N)}function z(F,N,H,ee){return N===null||N.tag!==4||N.stateNode.containerInfo!==H.containerInfo||N.stateNode.implementation!==H.implementation?(N=Du(H,F.mode,ee),N.return=F,N):(N=m(N,H.children||[]),N.return=F,N)}function W(F,N,H,ee,ge){return N===null||N.tag!==7?(N=Zs(H,F.mode,ee,ge),N.return=F,N):(N=m(N,H),N.return=F,N)}function se(F,N,H){if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return N=_u(""+N,F.mode,H),N.return=F,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case v:return H=ll(N.type,N.key,N.props,null,F.mode,H),Qr(H,N),H.return=F,H;case T:return N=Du(N,F.mode,H),N.return=F,N;case B:var ee=N._init;return N=ee(N._payload),se(F,N,H)}if(le(N)||re(N))return N=Zs(N,F.mode,H,null),N.return=F,N;if(typeof N.then=="function")return se(F,xl(N),H);if(N.$$typeof===D)return se(F,hl(F,N),H);Ll(F,N)}return null}function q(F,N,H,ee){var ge=N!==null?N.key:null;if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return ge!==null?null:R(F,N,""+H,ee);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case v:return H.key===ge?O(F,N,H,ee):null;case T:return H.key===ge?z(F,N,H,ee):null;case B:return ge=H._init,H=ge(H._payload),q(F,N,H,ee)}if(le(H)||re(H))return ge!==null?null:W(F,N,H,ee,null);if(typeof H.then=="function")return q(F,N,xl(H),ee);if(H.$$typeof===D)return q(F,N,hl(F,H),ee);Ll(F,H)}return null}function j(F,N,H,ee,ge){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return F=F.get(H)||null,R(N,F,""+ee,ge);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case v:return F=F.get(ee.key===null?H:ee.key)||null,O(N,F,ee,ge);case T:return F=F.get(ee.key===null?H:ee.key)||null,z(N,F,ee,ge);case B:var Ce=ee._init;return ee=Ce(ee._payload),j(F,N,H,ee,ge)}if(le(ee)||re(ee))return F=F.get(H)||null,W(N,F,ee,ge,null);if(typeof ee.then=="function")return j(F,N,H,xl(ee),ge);if(ee.$$typeof===D)return j(F,N,H,hl(N,ee),ge);Ll(N,ee)}return null}function Ae(F,N,H,ee){for(var ge=null,Ce=null,ve=N,Ee=N=0,At=null;ve!==null&&Ee<H.length;Ee++){ve.index>Ee?(At=ve,ve=null):At=ve.sibling;var Ue=q(F,ve,H[Ee],ee);if(Ue===null){ve===null&&(ve=At);break}s&&ve&&Ue.alternate===null&&n(F,ve),N=y(Ue,N,Ee),Ce===null?ge=Ue:Ce.sibling=Ue,Ce=Ue,ve=At}if(Ee===H.length)return u(F,ve),$e&&en(F,Ee),ge;if(ve===null){for(;Ee<H.length;Ee++)ve=se(F,H[Ee],ee),ve!==null&&(N=y(ve,N,Ee),Ce===null?ge=ve:Ce.sibling=ve,Ce=ve);return $e&&en(F,Ee),ge}for(ve=h(ve);Ee<H.length;Ee++)At=j(ve,F,Ee,H[Ee],ee),At!==null&&(s&&At.alternate!==null&&ve.delete(At.key===null?Ee:At.key),N=y(At,N,Ee),Ce===null?ge=At:Ce.sibling=At,Ce=At);return s&&ve.forEach(function(Ps){return n(F,Ps)}),$e&&en(F,Ee),ge}function Te(F,N,H,ee){if(H==null)throw Error(i(151));for(var ge=null,Ce=null,ve=N,Ee=N=0,At=null,Ue=H.next();ve!==null&&!Ue.done;Ee++,Ue=H.next()){ve.index>Ee?(At=ve,ve=null):At=ve.sibling;var Ps=q(F,ve,Ue.value,ee);if(Ps===null){ve===null&&(ve=At);break}s&&ve&&Ps.alternate===null&&n(F,ve),N=y(Ps,N,Ee),Ce===null?ge=Ps:Ce.sibling=Ps,Ce=Ps,ve=At}if(Ue.done)return u(F,ve),$e&&en(F,Ee),ge;if(ve===null){for(;!Ue.done;Ee++,Ue=H.next())Ue=se(F,Ue.value,ee),Ue!==null&&(N=y(Ue,N,Ee),Ce===null?ge=Ue:Ce.sibling=Ue,Ce=Ue);return $e&&en(F,Ee),ge}for(ve=h(ve);!Ue.done;Ee++,Ue=H.next())Ue=j(ve,F,Ee,Ue.value,ee),Ue!==null&&(s&&Ue.alternate!==null&&ve.delete(Ue.key===null?Ee:Ue.key),N=y(Ue,N,Ee),Ce===null?ge=Ue:Ce.sibling=Ue,Ce=Ue);return s&&ve.forEach(function(bS){return n(F,bS)}),$e&&en(F,Ee),ge}function Qe(F,N,H,ee){if(typeof H=="object"&&H!==null&&H.type===E&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case v:e:{for(var ge=H.key;N!==null;){if(N.key===ge){if(ge=H.type,ge===E){if(N.tag===7){u(F,N.sibling),ee=m(N,H.props.children),ee.return=F,F=ee;break e}}else if(N.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===B&&Gg(ge)===N.type){u(F,N.sibling),ee=m(N,H.props),Qr(ee,H),ee.return=F,F=ee;break e}u(F,N);break}else n(F,N);N=N.sibling}H.type===E?(ee=Zs(H.props.children,F.mode,ee,H.key),ee.return=F,F=ee):(ee=ll(H.type,H.key,H.props,null,F.mode,ee),Qr(ee,H),ee.return=F,F=ee)}return x(F);case T:e:{for(ge=H.key;N!==null;){if(N.key===ge)if(N.tag===4&&N.stateNode.containerInfo===H.containerInfo&&N.stateNode.implementation===H.implementation){u(F,N.sibling),ee=m(N,H.children||[]),ee.return=F,F=ee;break e}else{u(F,N);break}else n(F,N);N=N.sibling}ee=Du(H,F.mode,ee),ee.return=F,F=ee}return x(F);case B:return ge=H._init,H=ge(H._payload),Qe(F,N,H,ee)}if(le(H))return Ae(F,N,H,ee);if(re(H)){if(ge=re(H),typeof ge!="function")throw Error(i(150));return H=ge.call(H),Te(F,N,H,ee)}if(typeof H.then=="function")return Qe(F,N,xl(H),ee);if(H.$$typeof===D)return Qe(F,N,hl(F,H),ee);Ll(F,H)}return typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint"?(H=""+H,N!==null&&N.tag===6?(u(F,N.sibling),ee=m(N,H),ee.return=F,F=ee):(u(F,N),ee=_u(H,F.mode,ee),ee.return=F,F=ee),x(F)):u(F,N)}return function(F,N,H,ee){try{Xr=0;var ge=Qe(F,N,H,ee);return zn=null,ge}catch(ve){if(ve===$r||ve===dl)throw ve;var Ce=Qt(29,ve,null,F.mode);return Ce.lanes=ee,Ce.return=F,Ce}finally{}}}var qn=Hg(!0),Vg=Hg(!1),fi=Y(null),Ci=null;function Es(s){var n=s.alternate;ie(pt,pt.current&1),ie(fi,s),Ci===null&&(n===null||Gn.current!==null||n.memoizedState!==null)&&(Ci=s)}function Kg(s){if(s.tag===22){if(ie(pt,pt.current),ie(fi,s),Ci===null){var n=s.alternate;n!==null&&n.memoizedState!==null&&(Ci=s)}}else Ss()}function Ss(){ie(pt,pt.current),ie(fi,fi.current)}function Ji(s){J(fi),Ci===s&&(Ci=null),J(pt)}var pt=Y(0);function Rl(s){for(var n=s;n!==null;){if(n.tag===13){var u=n.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||Qc(u)))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}function lc(s,n,u,h){n=s.memoizedState,u=u(h,n),u=u==null?n:g({},n,u),s.memoizedState=u,s.lanes===0&&(s.updateQueue.baseState=u)}var oc={enqueueSetState:function(s,n,u){s=s._reactInternals;var h=ei(),m=ys(h);m.payload=n,u!=null&&(m.callback=u),n=vs(s,m,h),n!==null&&(ti(n,s,h),Hr(n,s,h))},enqueueReplaceState:function(s,n,u){s=s._reactInternals;var h=ei(),m=ys(h);m.tag=1,m.payload=n,u!=null&&(m.callback=u),n=vs(s,m,h),n!==null&&(ti(n,s,h),Hr(n,s,h))},enqueueForceUpdate:function(s,n){s=s._reactInternals;var u=ei(),h=ys(u);h.tag=2,n!=null&&(h.callback=n),n=vs(s,h,u),n!==null&&(ti(n,s,u),Hr(n,s,u))}};function zg(s,n,u,h,m,y,x){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(h,y,x):n.prototype&&n.prototype.isPureReactComponent?!kr(u,h)||!kr(m,y):!0}function qg(s,n,u,h){s=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(u,h),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(u,h),n.state!==s&&oc.enqueueReplaceState(n,n.state,null)}function on(s,n){var u=n;if("ref"in n){u={};for(var h in n)h!=="ref"&&(u[h]=n[h])}if(s=s.defaultProps){u===n&&(u=g({},u));for(var m in s)u[m]===void 0&&(u[m]=s[m])}return u}var _l=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function Yg(s){_l(s)}function jg(s){console.error(s)}function Xg(s){_l(s)}function Dl(s,n){try{var u=s.onUncaughtError;u(n.value,{componentStack:n.stack})}catch(h){setTimeout(function(){throw h})}}function Qg(s,n,u){try{var h=s.onCaughtError;h(u.value,{componentStack:u.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function uc(s,n,u){return u=ys(u),u.tag=3,u.payload={element:null},u.callback=function(){Dl(s,n)},u}function Wg(s){return s=ys(s),s.tag=3,s}function Zg(s,n,u,h){var m=u.type.getDerivedStateFromError;if(typeof m=="function"){var y=h.value;s.payload=function(){return m(y)},s.callback=function(){Qg(n,u,h)}}var x=u.stateNode;x!==null&&typeof x.componentDidCatch=="function"&&(s.callback=function(){Qg(n,u,h),typeof m!="function"&&(_s===null?_s=new Set([this]):_s.add(this));var R=h.stack;this.componentDidCatch(h.value,{componentStack:R!==null?R:""})})}function bE(s,n,u,h,m){if(u.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(n=u.alternate,n!==null&&Ur(n,u,m,!0),u=fi.current,u!==null){switch(u.tag){case 13:return Ci===null?Oc():u.alternate===null&&ot===0&&(ot=3),u.flags&=-257,u.flags|=65536,u.lanes=m,h===Bu?u.flags|=16384:(n=u.updateQueue,n===null?u.updateQueue=new Set([h]):n.add(h),Pc(s,h,m)),!1;case 22:return u.flags|=65536,h===Bu?u.flags|=16384:(n=u.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([h])},u.updateQueue=n):(u=n.retryQueue,u===null?n.retryQueue=new Set([h]):u.add(h)),Pc(s,h,m)),!1}throw Error(i(435,u.tag))}return Pc(s,h,m),Oc(),!1}if($e)return n=fi.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=m,h!==wu&&(s=Error(i(422),{cause:h}),Nr(oi(s,u)))):(h!==wu&&(n=Error(i(423),{cause:h}),Nr(oi(n,u))),s=s.current.alternate,s.flags|=65536,m&=-m,s.lanes|=m,h=oi(h,u),m=uc(s.stateNode,h,m),Gu(s,m),ot!==4&&(ot=2)),!1;var y=Error(i(520),{cause:h});if(y=oi(y,u),sa===null?sa=[y]:sa.push(y),ot!==4&&(ot=2),n===null)return!0;h=oi(h,u),u=n;do{switch(u.tag){case 3:return u.flags|=65536,s=m&-m,u.lanes|=s,s=uc(u.stateNode,h,s),Gu(u,s),!1;case 1:if(n=u.type,y=u.stateNode,(u.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(_s===null||!_s.has(y))))return u.flags|=65536,m&=-m,u.lanes|=m,m=Wg(m),Zg(m,s,u,h),Gu(u,m),!1}u=u.return}while(u!==null);return!1}var Jg=Error(i(461)),St=!1;function It(s,n,u,h){n.child=s===null?Vg(n,null,u,h):qn(n,s.child,u,h)}function em(s,n,u,h,m){u=u.render;var y=n.ref;if("ref"in h){var x={};for(var R in h)R!=="ref"&&(x[R]=h[R])}else x=h;return rn(n),h=qu(s,n,u,x,y,m),R=Yu(),s!==null&&!St?(ju(s,n,m),es(s,n,m)):($e&&R&&Iu(n),n.flags|=1,It(s,n,h,m),n.child)}function tm(s,n,u,h,m){if(s===null){var y=u.type;return typeof y=="function"&&!Ru(y)&&y.defaultProps===void 0&&u.compare===null?(n.tag=15,n.type=y,im(s,n,y,h,m)):(s=ll(u.type,null,h,n,n.mode,m),s.ref=n.ref,s.return=n,n.child=s)}if(y=s.child,!yc(s,m)){var x=y.memoizedProps;if(u=u.compare,u=u!==null?u:kr,u(x,h)&&s.ref===n.ref)return es(s,n,m)}return n.flags|=1,s=Yi(y,h),s.ref=n.ref,s.return=n,n.child=s}function im(s,n,u,h,m){if(s!==null){var y=s.memoizedProps;if(kr(y,h)&&s.ref===n.ref)if(St=!1,n.pendingProps=h=y,yc(s,m))(s.flags&131072)!==0&&(St=!0);else return n.lanes=s.lanes,es(s,n,m)}return cc(s,n,u,h,m)}function sm(s,n,u){var h=n.pendingProps,m=h.children,y=s!==null?s.memoizedState:null;if(h.mode==="hidden"){if((n.flags&128)!==0){if(h=y!==null?y.baseLanes|u:u,s!==null){for(m=n.child=s.child,y=0;m!==null;)y=y|m.lanes|m.childLanes,m=m.sibling;n.childLanes=y&~h}else n.childLanes=0,n.child=null;return nm(s,n,h,u)}if((u&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},s!==null&&fl(n,y!==null?y.cachePool:null),y!==null?ig(n,y):Vu(),Kg(n);else return n.lanes=n.childLanes=536870912,nm(s,n,y!==null?y.baseLanes|u:u,u)}else y!==null?(fl(n,y.cachePool),ig(n,y),Ss(),n.memoizedState=null):(s!==null&&fl(n,null),Vu(),Ss());return It(s,n,m,u),n.child}function nm(s,n,u,h){var m=Uu();return m=m===null?null:{parent:mt._currentValue,pool:m},n.memoizedState={baseLanes:u,cachePool:m},s!==null&&fl(n,null),Vu(),Kg(n),s!==null&&Ur(s,n,h,!0),null}function Il(s,n){var u=n.ref;if(u===null)s!==null&&s.ref!==null&&(n.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(s===null||s.ref!==u)&&(n.flags|=4194816)}}function cc(s,n,u,h,m){return rn(n),u=qu(s,n,u,h,void 0,m),h=Yu(),s!==null&&!St?(ju(s,n,m),es(s,n,m)):($e&&h&&Iu(n),n.flags|=1,It(s,n,u,m),n.child)}function rm(s,n,u,h,m,y){return rn(n),n.updateQueue=null,u=ng(n,h,u,m),sg(s),h=Yu(),s!==null&&!St?(ju(s,n,y),es(s,n,y)):($e&&h&&Iu(n),n.flags|=1,It(s,n,u,y),n.child)}function am(s,n,u,h,m){if(rn(n),n.stateNode===null){var y=Nn,x=u.contextType;typeof x=="object"&&x!==null&&(y=Pt(x)),y=new u(h,y),n.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=oc,n.stateNode=y,y._reactInternals=n,y=n.stateNode,y.props=h,y.state=n.memoizedState,y.refs={},Fu(n),x=u.contextType,y.context=typeof x=="object"&&x!==null?Pt(x):Nn,y.state=n.memoizedState,x=u.getDerivedStateFromProps,typeof x=="function"&&(lc(n,u,x,h),y.state=n.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(x=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),x!==y.state&&oc.enqueueReplaceState(y,y.state,null),Kr(n,h,y,m),Vr(),y.state=n.memoizedState),typeof y.componentDidMount=="function"&&(n.flags|=4194308),h=!0}else if(s===null){y=n.stateNode;var R=n.memoizedProps,O=on(u,R);y.props=O;var z=y.context,W=u.contextType;x=Nn,typeof W=="object"&&W!==null&&(x=Pt(W));var se=u.getDerivedStateFromProps;W=typeof se=="function"||typeof y.getSnapshotBeforeUpdate=="function",R=n.pendingProps!==R,W||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(R||z!==x)&&qg(n,y,h,x),ps=!1;var q=n.memoizedState;y.state=q,Kr(n,h,y,m),Vr(),z=n.memoizedState,R||q!==z||ps?(typeof se=="function"&&(lc(n,u,se,h),z=n.memoizedState),(O=ps||zg(n,u,O,h,q,z,x))?(W||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(n.flags|=4194308)):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=h,n.memoizedState=z),y.props=h,y.state=z,y.context=x,h=O):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),h=!1)}else{y=n.stateNode,$u(s,n),x=n.memoizedProps,W=on(u,x),y.props=W,se=n.pendingProps,q=y.context,z=u.contextType,O=Nn,typeof z=="object"&&z!==null&&(O=Pt(z)),R=u.getDerivedStateFromProps,(z=typeof R=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(x!==se||q!==O)&&qg(n,y,h,O),ps=!1,q=n.memoizedState,y.state=q,Kr(n,h,y,m),Vr();var j=n.memoizedState;x!==se||q!==j||ps||s!==null&&s.dependencies!==null&&cl(s.dependencies)?(typeof R=="function"&&(lc(n,u,R,h),j=n.memoizedState),(W=ps||zg(n,u,W,h,q,j,O)||s!==null&&s.dependencies!==null&&cl(s.dependencies))?(z||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(h,j,O),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(h,j,O)),typeof y.componentDidUpdate=="function"&&(n.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof y.componentDidUpdate!="function"||x===s.memoizedProps&&q===s.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||x===s.memoizedProps&&q===s.memoizedState||(n.flags|=1024),n.memoizedProps=h,n.memoizedState=j),y.props=h,y.state=j,y.context=O,h=W):(typeof y.componentDidUpdate!="function"||x===s.memoizedProps&&q===s.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||x===s.memoizedProps&&q===s.memoizedState||(n.flags|=1024),h=!1)}return y=h,Il(s,n),h=(n.flags&128)!==0,y||h?(y=n.stateNode,u=h&&typeof u.getDerivedStateFromError!="function"?null:y.render(),n.flags|=1,s!==null&&h?(n.child=qn(n,s.child,null,m),n.child=qn(n,null,u,m)):It(s,n,u,m),n.memoizedState=y.state,s=n.child):s=es(s,n,m),s}function lm(s,n,u,h){return Pr(),n.flags|=256,It(s,n,u,h),n.child}var hc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function fc(s){return{baseLanes:s,cachePool:jd()}}function dc(s,n,u){return s=s!==null?s.childLanes&~u:0,n&&(s|=di),s}function om(s,n,u){var h=n.pendingProps,m=!1,y=(n.flags&128)!==0,x;if((x=y)||(x=s!==null&&s.memoizedState===null?!1:(pt.current&2)!==0),x&&(m=!0,n.flags&=-129),x=(n.flags&32)!==0,n.flags&=-33,s===null){if($e){if(m?Es(n):Ss(),$e){var R=lt,O;if(O=R){e:{for(O=R,R=Ii;O.nodeType!==8;){if(!R){R=null;break e}if(O=Ai(O.nextSibling),O===null){R=null;break e}}R=O}R!==null?(n.memoizedState={dehydrated:R,treeContext:Js!==null?{id:ji,overflow:Xi}:null,retryLane:536870912,hydrationErrors:null},O=Qt(18,null,null,0),O.stateNode=R,O.return=n,n.child=O,Ft=n,lt=null,O=!0):O=!1}O||sn(n)}if(R=n.memoizedState,R!==null&&(R=R.dehydrated,R!==null))return Qc(R)?n.lanes=32:n.lanes=536870912,null;Ji(n)}return R=h.children,h=h.fallback,m?(Ss(),m=n.mode,R=Cl({mode:"hidden",children:R},m),h=Zs(h,m,u,null),R.return=n,h.return=n,R.sibling=h,n.child=R,m=n.child,m.memoizedState=fc(u),m.childLanes=dc(s,x,u),n.memoizedState=hc,h):(Es(n),gc(n,R))}if(O=s.memoizedState,O!==null&&(R=O.dehydrated,R!==null)){if(y)n.flags&256?(Es(n),n.flags&=-257,n=mc(s,n,u)):n.memoizedState!==null?(Ss(),n.child=s.child,n.flags|=128,n=null):(Ss(),m=h.fallback,R=n.mode,h=Cl({mode:"visible",children:h.children},R),m=Zs(m,R,u,null),m.flags|=2,h.return=n,m.return=n,h.sibling=m,n.child=h,qn(n,s.child,null,u),h=n.child,h.memoizedState=fc(u),h.childLanes=dc(s,x,u),n.memoizedState=hc,n=m);else if(Es(n),Qc(R)){if(x=R.nextSibling&&R.nextSibling.dataset,x)var z=x.dgst;x=z,h=Error(i(419)),h.stack="",h.digest=x,Nr({value:h,source:null,stack:null}),n=mc(s,n,u)}else if(St||Ur(s,n,u,!1),x=(u&s.childLanes)!==0,St||x){if(x=tt,x!==null&&(h=u&-u,h=(h&42)!==0?1:Wo(h),h=(h&(x.suspendedLanes|u))!==0?0:h,h!==0&&h!==O.retryLane))throw O.retryLane=h,Pn(s,h),ti(x,s,h),Jg;R.data==="$?"||Oc(),n=mc(s,n,u)}else R.data==="$?"?(n.flags|=192,n.child=s.child,n=null):(s=O.treeContext,lt=Ai(R.nextSibling),Ft=n,$e=!0,tn=null,Ii=!1,s!==null&&(ci[hi++]=ji,ci[hi++]=Xi,ci[hi++]=Js,ji=s.id,Xi=s.overflow,Js=n),n=gc(n,h.children),n.flags|=4096);return n}return m?(Ss(),m=h.fallback,R=n.mode,O=s.child,z=O.sibling,h=Yi(O,{mode:"hidden",children:h.children}),h.subtreeFlags=O.subtreeFlags&65011712,z!==null?m=Yi(z,m):(m=Zs(m,R,u,null),m.flags|=2),m.return=n,h.return=n,h.sibling=m,n.child=h,h=m,m=n.child,R=s.child.memoizedState,R===null?R=fc(u):(O=R.cachePool,O!==null?(z=mt._currentValue,O=O.parent!==z?{parent:z,pool:z}:O):O=jd(),R={baseLanes:R.baseLanes|u,cachePool:O}),m.memoizedState=R,m.childLanes=dc(s,x,u),n.memoizedState=hc,h):(Es(n),u=s.child,s=u.sibling,u=Yi(u,{mode:"visible",children:h.children}),u.return=n,u.sibling=null,s!==null&&(x=n.deletions,x===null?(n.deletions=[s],n.flags|=16):x.push(s)),n.child=u,n.memoizedState=null,u)}function gc(s,n){return n=Cl({mode:"visible",children:n},s.mode),n.return=s,s.child=n}function Cl(s,n){return s=Qt(22,s,null,n),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function mc(s,n,u){return qn(n,s.child,null,u),s=gc(n,n.pendingProps.children),s.flags|=2,n.memoizedState=null,s}function um(s,n,u){s.lanes|=n;var h=s.alternate;h!==null&&(h.lanes|=n),Ou(s.return,n,u)}function pc(s,n,u,h,m){var y=s.memoizedState;y===null?s.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:h,tail:u,tailMode:m}:(y.isBackwards=n,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=u,y.tailMode=m)}function cm(s,n,u){var h=n.pendingProps,m=h.revealOrder,y=h.tail;if(It(s,n,h.children,u),h=pt.current,(h&2)!==0)h=h&1|2,n.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=n.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&um(s,u,n);else if(s.tag===19)um(s,u,n);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}h&=1}switch(ie(pt,h),m){case"forwards":for(u=n.child,m=null;u!==null;)s=u.alternate,s!==null&&Rl(s)===null&&(m=u),u=u.sibling;u=m,u===null?(m=n.child,n.child=null):(m=u.sibling,u.sibling=null),pc(n,!1,m,u,y);break;case"backwards":for(u=null,m=n.child,n.child=null;m!==null;){if(s=m.alternate,s!==null&&Rl(s)===null){n.child=m;break}s=m.sibling,m.sibling=u,u=m,m=s}pc(n,!0,u,null,y);break;case"together":pc(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function es(s,n,u){if(s!==null&&(n.dependencies=s.dependencies),Rs|=n.lanes,(u&n.childLanes)===0)if(s!==null){if(Ur(s,n,u,!1),(u&n.childLanes)===0)return null}else return null;if(s!==null&&n.child!==s.child)throw Error(i(153));if(n.child!==null){for(s=n.child,u=Yi(s,s.pendingProps),n.child=u,u.return=n;s.sibling!==null;)s=s.sibling,u=u.sibling=Yi(s,s.pendingProps),u.return=n;u.sibling=null}return n.child}function yc(s,n){return(s.lanes&n)!==0?!0:(s=s.dependencies,!!(s!==null&&cl(s)))}function AE(s,n,u){switch(n.tag){case 3:De(n,n.stateNode.containerInfo),ms(n,mt,s.memoizedState.cache),Pr();break;case 27:case 5:vn(n);break;case 4:De(n,n.stateNode.containerInfo);break;case 10:ms(n,n.type,n.memoizedProps.value);break;case 13:var h=n.memoizedState;if(h!==null)return h.dehydrated!==null?(Es(n),n.flags|=128,null):(u&n.child.childLanes)!==0?om(s,n,u):(Es(n),s=es(s,n,u),s!==null?s.sibling:null);Es(n);break;case 19:var m=(s.flags&128)!==0;if(h=(u&n.childLanes)!==0,h||(Ur(s,n,u,!1),h=(u&n.childLanes)!==0),m){if(h)return cm(s,n,u);n.flags|=128}if(m=n.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),ie(pt,pt.current),h)break;return null;case 22:case 23:return n.lanes=0,sm(s,n,u);case 24:ms(n,mt,s.memoizedState.cache)}return es(s,n,u)}function hm(s,n,u){if(s!==null)if(s.memoizedProps!==n.pendingProps)St=!0;else{if(!yc(s,u)&&(n.flags&128)===0)return St=!1,AE(s,n,u);St=(s.flags&131072)!==0}else St=!1,$e&&(n.flags&1048576)!==0&&Gd(n,ul,n.index);switch(n.lanes=0,n.tag){case 16:e:{s=n.pendingProps;var h=n.elementType,m=h._init;if(h=m(h._payload),n.type=h,typeof h=="function")Ru(h)?(s=on(h,s),n.tag=1,n=am(null,n,h,s,u)):(n.tag=0,n=cc(null,n,h,s,u));else{if(h!=null){if(m=h.$$typeof,m===w){n.tag=11,n=em(null,n,h,s,u);break e}else if(m===M){n.tag=14,n=tm(null,n,h,s,u);break e}}throw n=ue(h)||h,Error(i(306,n,""))}}return n;case 0:return cc(s,n,n.type,n.pendingProps,u);case 1:return h=n.type,m=on(h,n.pendingProps),am(s,n,h,m,u);case 3:e:{if(De(n,n.stateNode.containerInfo),s===null)throw Error(i(387));h=n.pendingProps;var y=n.memoizedState;m=y.element,$u(s,n),Kr(n,h,null,u);var x=n.memoizedState;if(h=x.cache,ms(n,mt,h),h!==y.cache&&Mu(n,[mt],u,!0),Vr(),h=x.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:x.cache},n.updateQueue.baseState=y,n.memoizedState=y,n.flags&256){n=lm(s,n,h,u);break e}else if(h!==m){m=oi(Error(i(424)),n),Nr(m),n=lm(s,n,h,u);break e}else{switch(s=n.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(lt=Ai(s.firstChild),Ft=n,$e=!0,tn=null,Ii=!0,u=Vg(n,null,h,u),n.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Pr(),h===m){n=es(s,n,u);break e}It(s,n,h,u)}n=n.child}return n;case 26:return Il(s,n),s===null?(u=mp(n.type,null,n.pendingProps,null))?n.memoizedState=u:$e||(u=n.type,s=n.pendingProps,h=Kl(fe.current).createElement(u),h[Mt]=n,h[Ht]=s,wt(h,u,s),Et(h),n.stateNode=h):n.memoizedState=mp(n.type,s.memoizedProps,n.pendingProps,s.memoizedState),null;case 27:return vn(n),s===null&&$e&&(h=n.stateNode=fp(n.type,n.pendingProps,fe.current),Ft=n,Ii=!0,m=lt,Cs(n.type)?(Wc=m,lt=Ai(h.firstChild)):lt=m),It(s,n,n.pendingProps.children,u),Il(s,n),s===null&&(n.flags|=4194304),n.child;case 5:return s===null&&$e&&((m=h=lt)&&(h=WE(h,n.type,n.pendingProps,Ii),h!==null?(n.stateNode=h,Ft=n,lt=Ai(h.firstChild),Ii=!1,m=!0):m=!1),m||sn(n)),vn(n),m=n.type,y=n.pendingProps,x=s!==null?s.memoizedProps:null,h=y.children,Yc(m,y)?h=null:x!==null&&Yc(m,x)&&(n.flags|=32),n.memoizedState!==null&&(m=qu(s,n,mE,null,null,u),fa._currentValue=m),Il(s,n),It(s,n,h,u),n.child;case 6:return s===null&&$e&&((s=u=lt)&&(u=ZE(u,n.pendingProps,Ii),u!==null?(n.stateNode=u,Ft=n,lt=null,s=!0):s=!1),s||sn(n)),null;case 13:return om(s,n,u);case 4:return De(n,n.stateNode.containerInfo),h=n.pendingProps,s===null?n.child=qn(n,null,h,u):It(s,n,h,u),n.child;case 11:return em(s,n,n.type,n.pendingProps,u);case 7:return It(s,n,n.pendingProps,u),n.child;case 8:return It(s,n,n.pendingProps.children,u),n.child;case 12:return It(s,n,n.pendingProps.children,u),n.child;case 10:return h=n.pendingProps,ms(n,n.type,h.value),It(s,n,h.children,u),n.child;case 9:return m=n.type._context,h=n.pendingProps.children,rn(n),m=Pt(m),h=h(m),n.flags|=1,It(s,n,h,u),n.child;case 14:return tm(s,n,n.type,n.pendingProps,u);case 15:return im(s,n,n.type,n.pendingProps,u);case 19:return cm(s,n,u);case 31:return h=n.pendingProps,u=n.mode,h={mode:h.mode,children:h.children},s===null?(u=Cl(h,u),u.ref=n.ref,n.child=u,u.return=n,n=u):(u=Yi(s.child,h),u.ref=n.ref,n.child=u,u.return=n,n=u),n;case 22:return sm(s,n,u);case 24:return rn(n),h=Pt(mt),s===null?(m=Uu(),m===null&&(m=tt,y=Pu(),m.pooledCache=y,y.refCount++,y!==null&&(m.pooledCacheLanes|=u),m=y),n.memoizedState={parent:h,cache:m},Fu(n),ms(n,mt,m)):((s.lanes&u)!==0&&($u(s,n),Kr(n,null,null,u),Vr()),m=s.memoizedState,y=n.memoizedState,m.parent!==h?(m={parent:h,cache:h},n.memoizedState=m,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=m),ms(n,mt,h)):(h=y.cache,ms(n,mt,h),h!==m.cache&&Mu(n,[mt],u,!0))),It(s,n,n.pendingProps.children,u),n.child;case 29:throw n.pendingProps}throw Error(i(156,n.tag))}function ts(s){s.flags|=4}function fm(s,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!Ep(n)){if(n=fi.current,n!==null&&((Pe&4194048)===Pe?Ci!==null:(Pe&62914560)!==Pe&&(Pe&536870912)===0||n!==Ci))throw Gr=Bu,Xd;s.flags|=8192}}function wl(s,n){n!==null&&(s.flags|=4),s.flags&16384&&(n=s.tag!==22?Kf():536870912,s.lanes|=n,Qn|=n)}function Wr(s,n){if(!$e)switch(s.tailMode){case"hidden":n=s.tail;for(var u=null;n!==null;)n.alternate!==null&&(u=n),n=n.sibling;u===null?s.tail=null:u.sibling=null;break;case"collapsed":u=s.tail;for(var h=null;u!==null;)u.alternate!==null&&(h=u),u=u.sibling;h===null?n||s.tail===null?s.tail=null:s.tail.sibling=null:h.sibling=null}}function rt(s){var n=s.alternate!==null&&s.alternate.child===s.child,u=0,h=0;if(n)for(var m=s.child;m!==null;)u|=m.lanes|m.childLanes,h|=m.subtreeFlags&65011712,h|=m.flags&65011712,m.return=s,m=m.sibling;else for(m=s.child;m!==null;)u|=m.lanes|m.childLanes,h|=m.subtreeFlags,h|=m.flags,m.return=s,m=m.sibling;return s.subtreeFlags|=h,s.childLanes=u,n}function xE(s,n,u){var h=n.pendingProps;switch(Cu(n),n.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rt(n),null;case 1:return rt(n),null;case 3:return u=n.stateNode,h=null,s!==null&&(h=s.memoizedState.cache),n.memoizedState.cache!==h&&(n.flags|=2048),Wi(mt),Dt(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(s===null||s.child===null)&&(Mr(n)?ts(n):s===null||s.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Kd())),rt(n),null;case 26:return u=n.memoizedState,s===null?(ts(n),u!==null?(rt(n),fm(n,u)):(rt(n),n.flags&=-16777217)):u?u!==s.memoizedState?(ts(n),rt(n),fm(n,u)):(rt(n),n.flags&=-16777217):(s.memoizedProps!==h&&ts(n),rt(n),n.flags&=-16777217),null;case 27:Tn(n),u=fe.current;var m=n.type;if(s!==null&&n.stateNode!=null)s.memoizedProps!==h&&ts(n);else{if(!h){if(n.stateNode===null)throw Error(i(166));return rt(n),null}s=ae.current,Mr(n)?Hd(n):(s=fp(m,h,u),n.stateNode=s,ts(n))}return rt(n),null;case 5:if(Tn(n),u=n.type,s!==null&&n.stateNode!=null)s.memoizedProps!==h&&ts(n);else{if(!h){if(n.stateNode===null)throw Error(i(166));return rt(n),null}if(s=ae.current,Mr(n))Hd(n);else{switch(m=Kl(fe.current),s){case 1:s=m.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:s=m.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":s=m.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":s=m.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":s=m.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof h.is=="string"?m.createElement("select",{is:h.is}):m.createElement("select"),h.multiple?s.multiple=!0:h.size&&(s.size=h.size);break;default:s=typeof h.is=="string"?m.createElement(u,{is:h.is}):m.createElement(u)}}s[Mt]=n,s[Ht]=h;e:for(m=n.child;m!==null;){if(m.tag===5||m.tag===6)s.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===n)break e;for(;m.sibling===null;){if(m.return===null||m.return===n)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}n.stateNode=s;e:switch(wt(s,u,h),u){case"button":case"input":case"select":case"textarea":s=!!h.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&ts(n)}}return rt(n),n.flags&=-16777217,null;case 6:if(s&&n.stateNode!=null)s.memoizedProps!==h&&ts(n);else{if(typeof h!="string"&&n.stateNode===null)throw Error(i(166));if(s=fe.current,Mr(n)){if(s=n.stateNode,u=n.memoizedProps,h=null,m=Ft,m!==null)switch(m.tag){case 27:case 5:h=m.memoizedProps}s[Mt]=n,s=!!(s.nodeValue===u||h!==null&&h.suppressHydrationWarning===!0||rp(s.nodeValue,u)),s||sn(n)}else s=Kl(s).createTextNode(h),s[Mt]=n,n.stateNode=s}return rt(n),null;case 13:if(h=n.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(m=Mr(n),h!==null&&h.dehydrated!==null){if(s===null){if(!m)throw Error(i(318));if(m=n.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));m[Mt]=n}else Pr(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;rt(n),m=!1}else m=Kd(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=m),m=!0;if(!m)return n.flags&256?(Ji(n),n):(Ji(n),null)}if(Ji(n),(n.flags&128)!==0)return n.lanes=u,n;if(u=h!==null,s=s!==null&&s.memoizedState!==null,u){h=n.child,m=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(m=h.alternate.memoizedState.cachePool.pool);var y=null;h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(y=h.memoizedState.cachePool.pool),y!==m&&(h.flags|=2048)}return u!==s&&u&&(n.child.flags|=8192),wl(n,n.updateQueue),rt(n),null;case 4:return Dt(),s===null&&Hc(n.stateNode.containerInfo),rt(n),null;case 10:return Wi(n.type),rt(n),null;case 19:if(J(pt),m=n.memoizedState,m===null)return rt(n),null;if(h=(n.flags&128)!==0,y=m.rendering,y===null)if(h)Wr(m,!1);else{if(ot!==0||s!==null&&(s.flags&128)!==0)for(s=n.child;s!==null;){if(y=Rl(s),y!==null){for(n.flags|=128,Wr(m,!1),s=y.updateQueue,n.updateQueue=s,wl(n,s),n.subtreeFlags=0,s=u,u=n.child;u!==null;)$d(u,s),u=u.sibling;return ie(pt,pt.current&1|2),n.child}s=s.sibling}m.tail!==null&&Ze()>Ml&&(n.flags|=128,h=!0,Wr(m,!1),n.lanes=4194304)}else{if(!h)if(s=Rl(y),s!==null){if(n.flags|=128,h=!0,s=s.updateQueue,n.updateQueue=s,wl(n,s),Wr(m,!0),m.tail===null&&m.tailMode==="hidden"&&!y.alternate&&!$e)return rt(n),null}else 2*Ze()-m.renderingStartTime>Ml&&u!==536870912&&(n.flags|=128,h=!0,Wr(m,!1),n.lanes=4194304);m.isBackwards?(y.sibling=n.child,n.child=y):(s=m.last,s!==null?s.sibling=y:n.child=y,m.last=y)}return m.tail!==null?(n=m.tail,m.rendering=n,m.tail=n.sibling,m.renderingStartTime=Ze(),n.sibling=null,s=pt.current,ie(pt,h?s&1|2:s&1),n):(rt(n),null);case 22:case 23:return Ji(n),Ku(),h=n.memoizedState!==null,s!==null?s.memoizedState!==null!==h&&(n.flags|=8192):h&&(n.flags|=8192),h?(u&536870912)!==0&&(n.flags&128)===0&&(rt(n),n.subtreeFlags&6&&(n.flags|=8192)):rt(n),u=n.updateQueue,u!==null&&wl(n,u.retryQueue),u=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),h=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(h=n.memoizedState.cachePool.pool),h!==u&&(n.flags|=2048),s!==null&&J(an),null;case 24:return u=null,s!==null&&(u=s.memoizedState.cache),n.memoizedState.cache!==u&&(n.flags|=2048),Wi(mt),rt(n),null;case 25:return null;case 30:return null}throw Error(i(156,n.tag))}function LE(s,n){switch(Cu(n),n.tag){case 1:return s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 3:return Wi(mt),Dt(),s=n.flags,(s&65536)!==0&&(s&128)===0?(n.flags=s&-65537|128,n):null;case 26:case 27:case 5:return Tn(n),null;case 13:if(Ji(n),s=n.memoizedState,s!==null&&s.dehydrated!==null){if(n.alternate===null)throw Error(i(340));Pr()}return s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 19:return J(pt),null;case 4:return Dt(),null;case 10:return Wi(n.type),null;case 22:case 23:return Ji(n),Ku(),s!==null&&J(an),s=n.flags,s&65536?(n.flags=s&-65537|128,n):null;case 24:return Wi(mt),null;case 25:return null;default:return null}}function dm(s,n){switch(Cu(n),n.tag){case 3:Wi(mt),Dt();break;case 26:case 27:case 5:Tn(n);break;case 4:Dt();break;case 13:Ji(n);break;case 19:J(pt);break;case 10:Wi(n.type);break;case 22:case 23:Ji(n),Ku(),s!==null&&J(an);break;case 24:Wi(mt)}}function Zr(s,n){try{var u=n.updateQueue,h=u!==null?u.lastEffect:null;if(h!==null){var m=h.next;u=m;do{if((u.tag&s)===s){h=void 0;var y=u.create,x=u.inst;h=y(),x.destroy=h}u=u.next}while(u!==m)}}catch(R){Je(n,n.return,R)}}function bs(s,n,u){try{var h=n.updateQueue,m=h!==null?h.lastEffect:null;if(m!==null){var y=m.next;h=y;do{if((h.tag&s)===s){var x=h.inst,R=x.destroy;if(R!==void 0){x.destroy=void 0,m=n;var O=u,z=R;try{z()}catch(W){Je(m,O,W)}}}h=h.next}while(h!==y)}}catch(W){Je(n,n.return,W)}}function gm(s){var n=s.updateQueue;if(n!==null){var u=s.stateNode;try{tg(n,u)}catch(h){Je(s,s.return,h)}}}function mm(s,n,u){u.props=on(s.type,s.memoizedProps),u.state=s.memoizedState;try{u.componentWillUnmount()}catch(h){Je(s,n,h)}}function Jr(s,n){try{var u=s.ref;if(u!==null){switch(s.tag){case 26:case 27:case 5:var h=s.stateNode;break;case 30:h=s.stateNode;break;default:h=s.stateNode}typeof u=="function"?s.refCleanup=u(h):u.current=h}}catch(m){Je(s,n,m)}}function wi(s,n){var u=s.ref,h=s.refCleanup;if(u!==null)if(typeof h=="function")try{h()}catch(m){Je(s,n,m)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(m){Je(s,n,m)}else u.current=null}function pm(s){var n=s.type,u=s.memoizedProps,h=s.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":u.autoFocus&&h.focus();break e;case"img":u.src?h.src=u.src:u.srcSet&&(h.srcset=u.srcSet)}}catch(m){Je(s,s.return,m)}}function vc(s,n,u){try{var h=s.stateNode;qE(h,s.type,u,n),h[Ht]=n}catch(m){Je(s,s.return,m)}}function ym(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Cs(s.type)||s.tag===4}function Tc(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||ym(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Cs(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Ec(s,n,u){var h=s.tag;if(h===5||h===6)s=s.stateNode,n?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(s,n):(n=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,n.appendChild(s),u=u._reactRootContainer,u!=null||n.onclick!==null||(n.onclick=Vl));else if(h!==4&&(h===27&&Cs(s.type)&&(u=s.stateNode,n=null),s=s.child,s!==null))for(Ec(s,n,u),s=s.sibling;s!==null;)Ec(s,n,u),s=s.sibling}function kl(s,n,u){var h=s.tag;if(h===5||h===6)s=s.stateNode,n?u.insertBefore(s,n):u.appendChild(s);else if(h!==4&&(h===27&&Cs(s.type)&&(u=s.stateNode),s=s.child,s!==null))for(kl(s,n,u),s=s.sibling;s!==null;)kl(s,n,u),s=s.sibling}function vm(s){var n=s.stateNode,u=s.memoizedProps;try{for(var h=s.type,m=n.attributes;m.length;)n.removeAttributeNode(m[0]);wt(n,h,u),n[Mt]=s,n[Ht]=u}catch(y){Je(s,s.return,y)}}var is=!1,ct=!1,Sc=!1,Tm=typeof WeakSet=="function"?WeakSet:Set,bt=null;function RE(s,n){if(s=s.containerInfo,zc=Ql,s=Cd(s),Tu(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else e:{u=(u=s.ownerDocument)&&u.defaultView||window;var h=u.getSelection&&u.getSelection();if(h&&h.rangeCount!==0){u=h.anchorNode;var m=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{u.nodeType,y.nodeType}catch{u=null;break e}var x=0,R=-1,O=-1,z=0,W=0,se=s,q=null;t:for(;;){for(var j;se!==u||m!==0&&se.nodeType!==3||(R=x+m),se!==y||h!==0&&se.nodeType!==3||(O=x+h),se.nodeType===3&&(x+=se.nodeValue.length),(j=se.firstChild)!==null;)q=se,se=j;for(;;){if(se===s)break t;if(q===u&&++z===m&&(R=x),q===y&&++W===h&&(O=x),(j=se.nextSibling)!==null)break;se=q,q=se.parentNode}se=j}u=R===-1||O===-1?null:{start:R,end:O}}else u=null}u=u||{start:0,end:0}}else u=null;for(qc={focusedElem:s,selectionRange:u},Ql=!1,bt=n;bt!==null;)if(n=bt,s=n.child,(n.subtreeFlags&1024)!==0&&s!==null)s.return=n,bt=s;else for(;bt!==null;){switch(n=bt,y=n.alternate,s=n.flags,n.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&y!==null){s=void 0,u=n,m=y.memoizedProps,y=y.memoizedState,h=u.stateNode;try{var Ae=on(u.type,m,u.elementType===u.type);s=h.getSnapshotBeforeUpdate(Ae,y),h.__reactInternalSnapshotBeforeUpdate=s}catch(Te){Je(u,u.return,Te)}}break;case 3:if((s&1024)!==0){if(s=n.stateNode.containerInfo,u=s.nodeType,u===9)Xc(s);else if(u===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Xc(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=n.sibling,s!==null){s.return=n.return,bt=s;break}bt=n.return}}function Em(s,n,u){var h=u.flags;switch(u.tag){case 0:case 11:case 15:As(s,u),h&4&&Zr(5,u);break;case 1:if(As(s,u),h&4)if(s=u.stateNode,n===null)try{s.componentDidMount()}catch(x){Je(u,u.return,x)}else{var m=on(u.type,n.memoizedProps);n=n.memoizedState;try{s.componentDidUpdate(m,n,s.__reactInternalSnapshotBeforeUpdate)}catch(x){Je(u,u.return,x)}}h&64&&gm(u),h&512&&Jr(u,u.return);break;case 3:if(As(s,u),h&64&&(s=u.updateQueue,s!==null)){if(n=null,u.child!==null)switch(u.child.tag){case 27:case 5:n=u.child.stateNode;break;case 1:n=u.child.stateNode}try{tg(s,n)}catch(x){Je(u,u.return,x)}}break;case 27:n===null&&h&4&&vm(u);case 26:case 5:As(s,u),n===null&&h&4&&pm(u),h&512&&Jr(u,u.return);break;case 12:As(s,u);break;case 13:As(s,u),h&4&&Am(s,u),h&64&&(s=u.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(u=PE.bind(null,u),JE(s,u))));break;case 22:if(h=u.memoizedState!==null||is,!h){n=n!==null&&n.memoizedState!==null||ct,m=is;var y=ct;is=h,(ct=n)&&!y?xs(s,u,(u.subtreeFlags&8772)!==0):As(s,u),is=m,ct=y}break;case 30:break;default:As(s,u)}}function Sm(s){var n=s.alternate;n!==null&&(s.alternate=null,Sm(n)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(n=s.stateNode,n!==null&&eu(n)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var st=null,zt=!1;function ss(s,n,u){for(u=u.child;u!==null;)bm(s,n,u),u=u.sibling}function bm(s,n,u){if(kt&&typeof kt.onCommitFiberUnmount=="function")try{kt.onCommitFiberUnmount(Ei,u)}catch{}switch(u.tag){case 26:ct||wi(u,n),ss(s,n,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:ct||wi(u,n);var h=st,m=zt;Cs(u.type)&&(st=u.stateNode,zt=!1),ss(s,n,u),oa(u.stateNode),st=h,zt=m;break;case 5:ct||wi(u,n);case 6:if(h=st,m=zt,st=null,ss(s,n,u),st=h,zt=m,st!==null)if(zt)try{(st.nodeType===9?st.body:st.nodeName==="HTML"?st.ownerDocument.body:st).removeChild(u.stateNode)}catch(y){Je(u,n,y)}else try{st.removeChild(u.stateNode)}catch(y){Je(u,n,y)}break;case 18:st!==null&&(zt?(s=st,cp(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,u.stateNode),pa(s)):cp(st,u.stateNode));break;case 4:h=st,m=zt,st=u.stateNode.containerInfo,zt=!0,ss(s,n,u),st=h,zt=m;break;case 0:case 11:case 14:case 15:ct||bs(2,u,n),ct||bs(4,u,n),ss(s,n,u);break;case 1:ct||(wi(u,n),h=u.stateNode,typeof h.componentWillUnmount=="function"&&mm(u,n,h)),ss(s,n,u);break;case 21:ss(s,n,u);break;case 22:ct=(h=ct)||u.memoizedState!==null,ss(s,n,u),ct=h;break;default:ss(s,n,u)}}function Am(s,n){if(n.memoizedState===null&&(s=n.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{pa(s)}catch(u){Je(n,n.return,u)}}function _E(s){switch(s.tag){case 13:case 19:var n=s.stateNode;return n===null&&(n=s.stateNode=new Tm),n;case 22:return s=s.stateNode,n=s._retryCache,n===null&&(n=s._retryCache=new Tm),n;default:throw Error(i(435,s.tag))}}function bc(s,n){var u=_E(s);n.forEach(function(h){var m=NE.bind(null,s,h);u.has(h)||(u.add(h),h.then(m,m))})}function Wt(s,n){var u=n.deletions;if(u!==null)for(var h=0;h<u.length;h++){var m=u[h],y=s,x=n,R=x;e:for(;R!==null;){switch(R.tag){case 27:if(Cs(R.type)){st=R.stateNode,zt=!1;break e}break;case 5:st=R.stateNode,zt=!1;break e;case 3:case 4:st=R.stateNode.containerInfo,zt=!0;break e}R=R.return}if(st===null)throw Error(i(160));bm(y,x,m),st=null,zt=!1,y=m.alternate,y!==null&&(y.return=null),m.return=null}if(n.subtreeFlags&13878)for(n=n.child;n!==null;)xm(n,s),n=n.sibling}var bi=null;function xm(s,n){var u=s.alternate,h=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Wt(n,s),Zt(s),h&4&&(bs(3,s,s.return),Zr(3,s),bs(5,s,s.return));break;case 1:Wt(n,s),Zt(s),h&512&&(ct||u===null||wi(u,u.return)),h&64&&is&&(s=s.updateQueue,s!==null&&(h=s.callbacks,h!==null&&(u=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=u===null?h:u.concat(h))));break;case 26:var m=bi;if(Wt(n,s),Zt(s),h&512&&(ct||u===null||wi(u,u.return)),h&4){var y=u!==null?u.memoizedState:null;if(h=s.memoizedState,u===null)if(h===null)if(s.stateNode===null){e:{h=s.type,u=s.memoizedProps,m=m.ownerDocument||m;t:switch(h){case"title":y=m.getElementsByTagName("title")[0],(!y||y[Ar]||y[Mt]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=m.createElement(h),m.head.insertBefore(y,m.querySelector("head > title"))),wt(y,h,u),y[Mt]=s,Et(y),h=y;break e;case"link":var x=vp("link","href",m).get(h+(u.href||""));if(x){for(var R=0;R<x.length;R++)if(y=x[R],y.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&y.getAttribute("rel")===(u.rel==null?null:u.rel)&&y.getAttribute("title")===(u.title==null?null:u.title)&&y.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){x.splice(R,1);break t}}y=m.createElement(h),wt(y,h,u),m.head.appendChild(y);break;case"meta":if(x=vp("meta","content",m).get(h+(u.content||""))){for(R=0;R<x.length;R++)if(y=x[R],y.getAttribute("content")===(u.content==null?null:""+u.content)&&y.getAttribute("name")===(u.name==null?null:u.name)&&y.getAttribute("property")===(u.property==null?null:u.property)&&y.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&y.getAttribute("charset")===(u.charSet==null?null:u.charSet)){x.splice(R,1);break t}}y=m.createElement(h),wt(y,h,u),m.head.appendChild(y);break;default:throw Error(i(468,h))}y[Mt]=s,Et(y),h=y}s.stateNode=h}else Tp(m,s.type,s.stateNode);else s.stateNode=yp(m,h,s.memoizedProps);else y!==h?(y===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):y.count--,h===null?Tp(m,s.type,s.stateNode):yp(m,h,s.memoizedProps)):h===null&&s.stateNode!==null&&vc(s,s.memoizedProps,u.memoizedProps)}break;case 27:Wt(n,s),Zt(s),h&512&&(ct||u===null||wi(u,u.return)),u!==null&&h&4&&vc(s,s.memoizedProps,u.memoizedProps);break;case 5:if(Wt(n,s),Zt(s),h&512&&(ct||u===null||wi(u,u.return)),s.flags&32){m=s.stateNode;try{Dn(m,"")}catch(j){Je(s,s.return,j)}}h&4&&s.stateNode!=null&&(m=s.memoizedProps,vc(s,m,u!==null?u.memoizedProps:m)),h&1024&&(Sc=!0);break;case 6:if(Wt(n,s),Zt(s),h&4){if(s.stateNode===null)throw Error(i(162));h=s.memoizedProps,u=s.stateNode;try{u.nodeValue=h}catch(j){Je(s,s.return,j)}}break;case 3:if(Yl=null,m=bi,bi=zl(n.containerInfo),Wt(n,s),bi=m,Zt(s),h&4&&u!==null&&u.memoizedState.isDehydrated)try{pa(n.containerInfo)}catch(j){Je(s,s.return,j)}Sc&&(Sc=!1,Lm(s));break;case 4:h=bi,bi=zl(s.stateNode.containerInfo),Wt(n,s),Zt(s),bi=h;break;case 12:Wt(n,s),Zt(s);break;case 13:Wt(n,s),Zt(s),s.child.flags&8192&&s.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Dc=Ze()),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,bc(s,h)));break;case 22:m=s.memoizedState!==null;var O=u!==null&&u.memoizedState!==null,z=is,W=ct;if(is=z||m,ct=W||O,Wt(n,s),ct=W,is=z,Zt(s),h&8192)e:for(n=s.stateNode,n._visibility=m?n._visibility&-2:n._visibility|1,m&&(u===null||O||is||ct||un(s)),u=null,n=s;;){if(n.tag===5||n.tag===26){if(u===null){O=u=n;try{if(y=O.stateNode,m)x=y.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none";else{R=O.stateNode;var se=O.memoizedProps.style,q=se!=null&&se.hasOwnProperty("display")?se.display:null;R.style.display=q==null||typeof q=="boolean"?"":(""+q).trim()}}catch(j){Je(O,O.return,j)}}}else if(n.tag===6){if(u===null){O=n;try{O.stateNode.nodeValue=m?"":O.memoizedProps}catch(j){Je(O,O.return,j)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===s)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;u===n&&(u=null),n=n.return}u===n&&(u=null),n.sibling.return=n.return,n=n.sibling}h&4&&(h=s.updateQueue,h!==null&&(u=h.retryQueue,u!==null&&(h.retryQueue=null,bc(s,u))));break;case 19:Wt(n,s),Zt(s),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,bc(s,h)));break;case 30:break;case 21:break;default:Wt(n,s),Zt(s)}}function Zt(s){var n=s.flags;if(n&2){try{for(var u,h=s.return;h!==null;){if(ym(h)){u=h;break}h=h.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var m=u.stateNode,y=Tc(s);kl(s,y,m);break;case 5:var x=u.stateNode;u.flags&32&&(Dn(x,""),u.flags&=-33);var R=Tc(s);kl(s,R,x);break;case 3:case 4:var O=u.stateNode.containerInfo,z=Tc(s);Ec(s,z,O);break;default:throw Error(i(161))}}catch(W){Je(s,s.return,W)}s.flags&=-3}n&4096&&(s.flags&=-4097)}function Lm(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var n=s;Lm(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),s=s.sibling}}function As(s,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)Em(s,n.alternate,n),n=n.sibling}function un(s){for(s=s.child;s!==null;){var n=s;switch(n.tag){case 0:case 11:case 14:case 15:bs(4,n,n.return),un(n);break;case 1:wi(n,n.return);var u=n.stateNode;typeof u.componentWillUnmount=="function"&&mm(n,n.return,u),un(n);break;case 27:oa(n.stateNode);case 26:case 5:wi(n,n.return),un(n);break;case 22:n.memoizedState===null&&un(n);break;case 30:un(n);break;default:un(n)}s=s.sibling}}function xs(s,n,u){for(u=u&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var h=n.alternate,m=s,y=n,x=y.flags;switch(y.tag){case 0:case 11:case 15:xs(m,y,u),Zr(4,y);break;case 1:if(xs(m,y,u),h=y,m=h.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(z){Je(h,h.return,z)}if(h=y,m=h.updateQueue,m!==null){var R=h.stateNode;try{var O=m.shared.hiddenCallbacks;if(O!==null)for(m.shared.hiddenCallbacks=null,m=0;m<O.length;m++)eg(O[m],R)}catch(z){Je(h,h.return,z)}}u&&x&64&&gm(y),Jr(y,y.return);break;case 27:vm(y);case 26:case 5:xs(m,y,u),u&&h===null&&x&4&&pm(y),Jr(y,y.return);break;case 12:xs(m,y,u);break;case 13:xs(m,y,u),u&&x&4&&Am(m,y);break;case 22:y.memoizedState===null&&xs(m,y,u),Jr(y,y.return);break;case 30:break;default:xs(m,y,u)}n=n.sibling}}function Ac(s,n){var u=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),s=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(s=n.memoizedState.cachePool.pool),s!==u&&(s!=null&&s.refCount++,u!=null&&Br(u))}function xc(s,n){s=null,n.alternate!==null&&(s=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==s&&(n.refCount++,s!=null&&Br(s))}function ki(s,n,u,h){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Rm(s,n,u,h),n=n.sibling}function Rm(s,n,u,h){var m=n.flags;switch(n.tag){case 0:case 11:case 15:ki(s,n,u,h),m&2048&&Zr(9,n);break;case 1:ki(s,n,u,h);break;case 3:ki(s,n,u,h),m&2048&&(s=null,n.alternate!==null&&(s=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==s&&(n.refCount++,s!=null&&Br(s)));break;case 12:if(m&2048){ki(s,n,u,h),s=n.stateNode;try{var y=n.memoizedProps,x=y.id,R=y.onPostCommit;typeof R=="function"&&R(x,n.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(O){Je(n,n.return,O)}}else ki(s,n,u,h);break;case 13:ki(s,n,u,h);break;case 23:break;case 22:y=n.stateNode,x=n.alternate,n.memoizedState!==null?y._visibility&2?ki(s,n,u,h):ea(s,n):y._visibility&2?ki(s,n,u,h):(y._visibility|=2,Yn(s,n,u,h,(n.subtreeFlags&10256)!==0)),m&2048&&Ac(x,n);break;case 24:ki(s,n,u,h),m&2048&&xc(n.alternate,n);break;default:ki(s,n,u,h)}}function Yn(s,n,u,h,m){for(m=m&&(n.subtreeFlags&10256)!==0,n=n.child;n!==null;){var y=s,x=n,R=u,O=h,z=x.flags;switch(x.tag){case 0:case 11:case 15:Yn(y,x,R,O,m),Zr(8,x);break;case 23:break;case 22:var W=x.stateNode;x.memoizedState!==null?W._visibility&2?Yn(y,x,R,O,m):ea(y,x):(W._visibility|=2,Yn(y,x,R,O,m)),m&&z&2048&&Ac(x.alternate,x);break;case 24:Yn(y,x,R,O,m),m&&z&2048&&xc(x.alternate,x);break;default:Yn(y,x,R,O,m)}n=n.sibling}}function ea(s,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var u=s,h=n,m=h.flags;switch(h.tag){case 22:ea(u,h),m&2048&&Ac(h.alternate,h);break;case 24:ea(u,h),m&2048&&xc(h.alternate,h);break;default:ea(u,h)}n=n.sibling}}var ta=8192;function jn(s){if(s.subtreeFlags&ta)for(s=s.child;s!==null;)_m(s),s=s.sibling}function _m(s){switch(s.tag){case 26:jn(s),s.flags&ta&&s.memoizedState!==null&&fS(bi,s.memoizedState,s.memoizedProps);break;case 5:jn(s);break;case 3:case 4:var n=bi;bi=zl(s.stateNode.containerInfo),jn(s),bi=n;break;case 22:s.memoizedState===null&&(n=s.alternate,n!==null&&n.memoizedState!==null?(n=ta,ta=16777216,jn(s),ta=n):jn(s));break;default:jn(s)}}function Dm(s){var n=s.alternate;if(n!==null&&(s=n.child,s!==null)){n.child=null;do n=s.sibling,s.sibling=null,s=n;while(s!==null)}}function ia(s){var n=s.deletions;if((s.flags&16)!==0){if(n!==null)for(var u=0;u<n.length;u++){var h=n[u];bt=h,Cm(h,s)}Dm(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Im(s),s=s.sibling}function Im(s){switch(s.tag){case 0:case 11:case 15:ia(s),s.flags&2048&&bs(9,s,s.return);break;case 3:ia(s);break;case 12:ia(s);break;case 22:var n=s.stateNode;s.memoizedState!==null&&n._visibility&2&&(s.return===null||s.return.tag!==13)?(n._visibility&=-3,Ol(s)):ia(s);break;default:ia(s)}}function Ol(s){var n=s.deletions;if((s.flags&16)!==0){if(n!==null)for(var u=0;u<n.length;u++){var h=n[u];bt=h,Cm(h,s)}Dm(s)}for(s=s.child;s!==null;){switch(n=s,n.tag){case 0:case 11:case 15:bs(8,n,n.return),Ol(n);break;case 22:u=n.stateNode,u._visibility&2&&(u._visibility&=-3,Ol(n));break;default:Ol(n)}s=s.sibling}}function Cm(s,n){for(;bt!==null;){var u=bt;switch(u.tag){case 0:case 11:case 15:bs(8,u,n);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var h=u.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Br(u.memoizedState.cache)}if(h=u.child,h!==null)h.return=u,bt=h;else e:for(u=s;bt!==null;){h=bt;var m=h.sibling,y=h.return;if(Sm(h),h===u){bt=null;break e}if(m!==null){m.return=y,bt=m;break e}bt=y}}}var DE={getCacheForType:function(s){var n=Pt(mt),u=n.data.get(s);return u===void 0&&(u=s(),n.data.set(s,u)),u}},IE=typeof WeakMap=="function"?WeakMap:Map,ze=0,tt=null,ke=null,Pe=0,qe=0,Jt=null,Ls=!1,Xn=!1,Lc=!1,ns=0,ot=0,Rs=0,cn=0,Rc=0,di=0,Qn=0,sa=null,qt=null,_c=!1,Dc=0,Ml=1/0,Pl=null,_s=null,Ct=0,Ds=null,Wn=null,Zn=0,Ic=0,Cc=null,wm=null,na=0,wc=null;function ei(){if((ze&2)!==0&&Pe!==0)return Pe&-Pe;if(P.T!==null){var s=Fn;return s!==0?s:Bc()}return Yf()}function km(){di===0&&(di=(Pe&536870912)===0||$e?Vf():536870912);var s=fi.current;return s!==null&&(s.flags|=32),di}function ti(s,n,u){(s===tt&&(qe===2||qe===9)||s.cancelPendingCommit!==null)&&(Jn(s,0),Is(s,Pe,di,!1)),br(s,u),((ze&2)===0||s!==tt)&&(s===tt&&((ze&2)===0&&(cn|=u),ot===4&&Is(s,Pe,di,!1)),Oi(s))}function Om(s,n,u){if((ze&6)!==0)throw Error(i(327));var h=!u&&(n&124)===0&&(n&s.expiredLanes)===0||Sr(s,n),m=h?kE(s,n):Mc(s,n,!0),y=h;do{if(m===0){Xn&&!h&&Is(s,n,0,!1);break}else{if(u=s.current.alternate,y&&!CE(u)){m=Mc(s,n,!1),y=!1;continue}if(m===2){if(y=n,s.errorRecoveryDisabledLanes&y)var x=0;else x=s.pendingLanes&-536870913,x=x!==0?x:x&536870912?536870912:0;if(x!==0){n=x;e:{var R=s;m=sa;var O=R.current.memoizedState.isDehydrated;if(O&&(Jn(R,x).flags|=256),x=Mc(R,x,!1),x!==2){if(Lc&&!O){R.errorRecoveryDisabledLanes|=y,cn|=y,m=4;break e}y=qt,qt=m,y!==null&&(qt===null?qt=y:qt.push.apply(qt,y))}m=x}if(y=!1,m!==2)continue}}if(m===1){Jn(s,0),Is(s,n,0,!0);break}e:{switch(h=s,y=m,y){case 0:case 1:throw Error(i(345));case 4:if((n&4194048)!==n)break;case 6:Is(h,n,di,!Ls);break e;case 2:qt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((n&62914560)===n&&(m=Dc+300-Ze(),10<m)){if(Is(h,n,di,!Ls),qa(h,0,!0)!==0)break e;h.timeoutHandle=op(Mm.bind(null,h,u,qt,Pl,_c,n,di,cn,Qn,Ls,y,2,-0,0),m);break e}Mm(h,u,qt,Pl,_c,n,di,cn,Qn,Ls,y,0,-0,0)}}break}while(!0);Oi(s)}function Mm(s,n,u,h,m,y,x,R,O,z,W,se,q,j){if(s.timeoutHandle=-1,se=n.subtreeFlags,(se&8192||(se&16785408)===16785408)&&(ha={stylesheets:null,count:0,unsuspend:hS},_m(n),se=dS(),se!==null)){s.cancelPendingCommit=se(Gm.bind(null,s,n,y,u,h,m,x,R,O,W,1,q,j)),Is(s,y,x,!z);return}Gm(s,n,y,u,h,m,x,R,O)}function CE(s){for(var n=s;;){var u=n.tag;if((u===0||u===11||u===15)&&n.flags&16384&&(u=n.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var h=0;h<u.length;h++){var m=u[h],y=m.getSnapshot;m=m.value;try{if(!Xt(y(),m))return!1}catch{return!1}}if(u=n.child,n.subtreeFlags&16384&&u!==null)u.return=n,n=u;else{if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Is(s,n,u,h){n&=~Rc,n&=~cn,s.suspendedLanes|=n,s.pingedLanes&=~n,h&&(s.warmLanes|=n),h=s.expirationTimes;for(var m=n;0<m;){var y=31-Ot(m),x=1<<y;h[y]=-1,m&=~x}u!==0&&zf(s,u,n)}function Nl(){return(ze&6)===0?(ra(0),!1):!0}function kc(){if(ke!==null){if(qe===0)var s=ke.return;else s=ke,Qi=nn=null,Xu(s),zn=null,Xr=0,s=ke;for(;s!==null;)dm(s.alternate,s),s=s.return;ke=null}}function Jn(s,n){var u=s.timeoutHandle;u!==-1&&(s.timeoutHandle=-1,jE(u)),u=s.cancelPendingCommit,u!==null&&(s.cancelPendingCommit=null,u()),kc(),tt=s,ke=u=Yi(s.current,null),Pe=n,qe=0,Jt=null,Ls=!1,Xn=Sr(s,n),Lc=!1,Qn=di=Rc=cn=Rs=ot=0,qt=sa=null,_c=!1,(n&8)!==0&&(n|=n&32);var h=s.entangledLanes;if(h!==0)for(s=s.entanglements,h&=n;0<h;){var m=31-Ot(h),y=1<<m;n|=s[m],h&=~y}return ns=n,nl(),u}function Pm(s,n){Ie=null,P.H=Al,n===$r||n===dl?(n=Zd(),qe=3):n===Xd?(n=Zd(),qe=4):qe=n===Jg?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Jt=n,ke===null&&(ot=1,Dl(s,oi(n,s.current)))}function Nm(){var s=P.H;return P.H=Al,s===null?Al:s}function Um(){var s=P.A;return P.A=DE,s}function Oc(){ot=4,Ls||(Pe&4194048)!==Pe&&fi.current!==null||(Xn=!0),(Rs&134217727)===0&&(cn&134217727)===0||tt===null||Is(tt,Pe,di,!1)}function Mc(s,n,u){var h=ze;ze|=2;var m=Nm(),y=Um();(tt!==s||Pe!==n)&&(Pl=null,Jn(s,n)),n=!1;var x=ot;e:do try{if(qe!==0&&ke!==null){var R=ke,O=Jt;switch(qe){case 8:kc(),x=6;break e;case 3:case 2:case 9:case 6:fi.current===null&&(n=!0);var z=qe;if(qe=0,Jt=null,er(s,R,O,z),u&&Xn){x=0;break e}break;default:z=qe,qe=0,Jt=null,er(s,R,O,z)}}wE(),x=ot;break}catch(W){Pm(s,W)}while(!0);return n&&s.shellSuspendCounter++,Qi=nn=null,ze=h,P.H=m,P.A=y,ke===null&&(tt=null,Pe=0,nl()),x}function wE(){for(;ke!==null;)Bm(ke)}function kE(s,n){var u=ze;ze|=2;var h=Nm(),m=Um();tt!==s||Pe!==n?(Pl=null,Ml=Ze()+500,Jn(s,n)):Xn=Sr(s,n);e:do try{if(qe!==0&&ke!==null){n=ke;var y=Jt;t:switch(qe){case 1:qe=0,Jt=null,er(s,n,y,1);break;case 2:case 9:if(Qd(y)){qe=0,Jt=null,Fm(n);break}n=function(){qe!==2&&qe!==9||tt!==s||(qe=7),Oi(s)},y.then(n,n);break e;case 3:qe=7;break e;case 4:qe=5;break e;case 7:Qd(y)?(qe=0,Jt=null,Fm(n)):(qe=0,Jt=null,er(s,n,y,7));break;case 5:var x=null;switch(ke.tag){case 26:x=ke.memoizedState;case 5:case 27:var R=ke;if(!x||Ep(x)){qe=0,Jt=null;var O=R.sibling;if(O!==null)ke=O;else{var z=R.return;z!==null?(ke=z,Ul(z)):ke=null}break t}}qe=0,Jt=null,er(s,n,y,5);break;case 6:qe=0,Jt=null,er(s,n,y,6);break;case 8:kc(),ot=6;break e;default:throw Error(i(462))}}OE();break}catch(W){Pm(s,W)}while(!0);return Qi=nn=null,P.H=h,P.A=m,ze=u,ke!==null?0:(tt=null,Pe=0,nl(),ot)}function OE(){for(;ke!==null&&!Hf();)Bm(ke)}function Bm(s){var n=hm(s.alternate,s,ns);s.memoizedProps=s.pendingProps,n===null?Ul(s):ke=n}function Fm(s){var n=s,u=n.alternate;switch(n.tag){case 15:case 0:n=rm(u,n,n.pendingProps,n.type,void 0,Pe);break;case 11:n=rm(u,n,n.pendingProps,n.type.render,n.ref,Pe);break;case 5:Xu(n);default:dm(u,n),n=ke=$d(n,ns),n=hm(u,n,ns)}s.memoizedProps=s.pendingProps,n===null?Ul(s):ke=n}function er(s,n,u,h){Qi=nn=null,Xu(n),zn=null,Xr=0;var m=n.return;try{if(bE(s,m,n,u,Pe)){ot=1,Dl(s,oi(u,s.current)),ke=null;return}}catch(y){if(m!==null)throw ke=m,y;ot=1,Dl(s,oi(u,s.current)),ke=null;return}n.flags&32768?($e||h===1?s=!0:Xn||(Pe&536870912)!==0?s=!1:(Ls=s=!0,(h===2||h===9||h===3||h===6)&&(h=fi.current,h!==null&&h.tag===13&&(h.flags|=16384))),$m(n,s)):Ul(n)}function Ul(s){var n=s;do{if((n.flags&32768)!==0){$m(n,Ls);return}s=n.return;var u=xE(n.alternate,n,ns);if(u!==null){ke=u;return}if(n=n.sibling,n!==null){ke=n;return}ke=n=s}while(n!==null);ot===0&&(ot=5)}function $m(s,n){do{var u=LE(s.alternate,s);if(u!==null){u.flags&=32767,ke=u;return}if(u=s.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!n&&(s=s.sibling,s!==null)){ke=s;return}ke=s=u}while(s!==null);ot=6,ke=null}function Gm(s,n,u,h,m,y,x,R,O){s.cancelPendingCommit=null;do Bl();while(Ct!==0);if((ze&6)!==0)throw Error(i(327));if(n!==null){if(n===s.current)throw Error(i(177));if(y=n.lanes|n.childLanes,y|=xu,hT(s,u,y,x,R,O),s===tt&&(ke=tt=null,Pe=0),Wn=n,Ds=s,Zn=u,Ic=y,Cc=m,wm=h,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,UE(Ti,function(){return qm(),null})):(s.callbackNode=null,s.callbackPriority=0),h=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||h){h=P.T,P.T=null,m=X.p,X.p=2,x=ze,ze|=4;try{RE(s,n,u)}finally{ze=x,X.p=m,P.T=h}}Ct=1,Hm(),Vm(),Km()}}function Hm(){if(Ct===1){Ct=0;var s=Ds,n=Wn,u=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||u){u=P.T,P.T=null;var h=X.p;X.p=2;var m=ze;ze|=4;try{xm(n,s);var y=qc,x=Cd(s.containerInfo),R=y.focusedElem,O=y.selectionRange;if(x!==R&&R&&R.ownerDocument&&Id(R.ownerDocument.documentElement,R)){if(O!==null&&Tu(R)){var z=O.start,W=O.end;if(W===void 0&&(W=z),"selectionStart"in R)R.selectionStart=z,R.selectionEnd=Math.min(W,R.value.length);else{var se=R.ownerDocument||document,q=se&&se.defaultView||window;if(q.getSelection){var j=q.getSelection(),Ae=R.textContent.length,Te=Math.min(O.start,Ae),Qe=O.end===void 0?Te:Math.min(O.end,Ae);!j.extend&&Te>Qe&&(x=Qe,Qe=Te,Te=x);var F=Dd(R,Te),N=Dd(R,Qe);if(F&&N&&(j.rangeCount!==1||j.anchorNode!==F.node||j.anchorOffset!==F.offset||j.focusNode!==N.node||j.focusOffset!==N.offset)){var H=se.createRange();H.setStart(F.node,F.offset),j.removeAllRanges(),Te>Qe?(j.addRange(H),j.extend(N.node,N.offset)):(H.setEnd(N.node,N.offset),j.addRange(H))}}}}for(se=[],j=R;j=j.parentNode;)j.nodeType===1&&se.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<se.length;R++){var ee=se[R];ee.element.scrollLeft=ee.left,ee.element.scrollTop=ee.top}}Ql=!!zc,qc=zc=null}finally{ze=m,X.p=h,P.T=u}}s.current=n,Ct=2}}function Vm(){if(Ct===2){Ct=0;var s=Ds,n=Wn,u=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||u){u=P.T,P.T=null;var h=X.p;X.p=2;var m=ze;ze|=4;try{Em(s,n.alternate,n)}finally{ze=m,X.p=h,P.T=u}}Ct=3}}function Km(){if(Ct===4||Ct===3){Ct=0,Me();var s=Ds,n=Wn,u=Zn,h=wm;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Ct=5:(Ct=0,Wn=Ds=null,zm(s,s.pendingLanes));var m=s.pendingLanes;if(m===0&&(_s=null),Zo(u),n=n.stateNode,kt&&typeof kt.onCommitFiberRoot=="function")try{kt.onCommitFiberRoot(Ei,n,void 0,(n.current.flags&128)===128)}catch{}if(h!==null){n=P.T,m=X.p,X.p=2,P.T=null;try{for(var y=s.onRecoverableError,x=0;x<h.length;x++){var R=h[x];y(R.value,{componentStack:R.stack})}}finally{P.T=n,X.p=m}}(Zn&3)!==0&&Bl(),Oi(s),m=s.pendingLanes,(u&4194090)!==0&&(m&42)!==0?s===wc?na++:(na=0,wc=s):na=0,ra(0)}}function zm(s,n){(s.pooledCacheLanes&=n)===0&&(n=s.pooledCache,n!=null&&(s.pooledCache=null,Br(n)))}function Bl(s){return Hm(),Vm(),Km(),qm()}function qm(){if(Ct!==5)return!1;var s=Ds,n=Ic;Ic=0;var u=Zo(Zn),h=P.T,m=X.p;try{X.p=32>u?32:u,P.T=null,u=Cc,Cc=null;var y=Ds,x=Zn;if(Ct=0,Wn=Ds=null,Zn=0,(ze&6)!==0)throw Error(i(331));var R=ze;if(ze|=4,Im(y.current),Rm(y,y.current,x,u),ze=R,ra(0,!1),kt&&typeof kt.onPostCommitFiberRoot=="function")try{kt.onPostCommitFiberRoot(Ei,y)}catch{}return!0}finally{X.p=m,P.T=h,zm(s,n)}}function Ym(s,n,u){n=oi(u,n),n=uc(s.stateNode,n,2),s=vs(s,n,2),s!==null&&(br(s,2),Oi(s))}function Je(s,n,u){if(s.tag===3)Ym(s,s,u);else for(;n!==null;){if(n.tag===3){Ym(n,s,u);break}else if(n.tag===1){var h=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(_s===null||!_s.has(h))){s=oi(u,s),u=Wg(2),h=vs(n,u,2),h!==null&&(Zg(u,h,n,s),br(h,2),Oi(h));break}}n=n.return}}function Pc(s,n,u){var h=s.pingCache;if(h===null){h=s.pingCache=new IE;var m=new Set;h.set(n,m)}else m=h.get(n),m===void 0&&(m=new Set,h.set(n,m));m.has(u)||(Lc=!0,m.add(u),s=ME.bind(null,s,n,u),n.then(s,s))}function ME(s,n,u){var h=s.pingCache;h!==null&&h.delete(n),s.pingedLanes|=s.suspendedLanes&u,s.warmLanes&=~u,tt===s&&(Pe&u)===u&&(ot===4||ot===3&&(Pe&62914560)===Pe&&300>Ze()-Dc?(ze&2)===0&&Jn(s,0):Rc|=u,Qn===Pe&&(Qn=0)),Oi(s)}function jm(s,n){n===0&&(n=Kf()),s=Pn(s,n),s!==null&&(br(s,n),Oi(s))}function PE(s){var n=s.memoizedState,u=0;n!==null&&(u=n.retryLane),jm(s,u)}function NE(s,n){var u=0;switch(s.tag){case 13:var h=s.stateNode,m=s.memoizedState;m!==null&&(u=m.retryLane);break;case 19:h=s.stateNode;break;case 22:h=s.stateNode._retryCache;break;default:throw Error(i(314))}h!==null&&h.delete(n),jm(s,u)}function UE(s,n){return Ks(s,n)}var Fl=null,tr=null,Nc=!1,$l=!1,Uc=!1,hn=0;function Oi(s){s!==tr&&s.next===null&&(tr===null?Fl=tr=s:tr=tr.next=s),$l=!0,Nc||(Nc=!0,FE())}function ra(s,n){if(!Uc&&$l){Uc=!0;do for(var u=!1,h=Fl;h!==null;){if(s!==0){var m=h.pendingLanes;if(m===0)var y=0;else{var x=h.suspendedLanes,R=h.pingedLanes;y=(1<<31-Ot(42|s)+1)-1,y&=m&~(x&~R),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(u=!0,Zm(h,y))}else y=Pe,y=qa(h,h===tt?y:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(y&3)===0||Sr(h,y)||(u=!0,Zm(h,y));h=h.next}while(u);Uc=!1}}function BE(){Xm()}function Xm(){$l=Nc=!1;var s=0;hn!==0&&(YE()&&(s=hn),hn=0);for(var n=Ze(),u=null,h=Fl;h!==null;){var m=h.next,y=Qm(h,n);y===0?(h.next=null,u===null?Fl=m:u.next=m,m===null&&(tr=u)):(u=h,(s!==0||(y&3)!==0)&&($l=!0)),h=m}ra(s)}function Qm(s,n){for(var u=s.suspendedLanes,h=s.pingedLanes,m=s.expirationTimes,y=s.pendingLanes&-62914561;0<y;){var x=31-Ot(y),R=1<<x,O=m[x];O===-1?((R&u)===0||(R&h)!==0)&&(m[x]=cT(R,n)):O<=n&&(s.expiredLanes|=R),y&=~R}if(n=tt,u=Pe,u=qa(s,s===n?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),h=s.callbackNode,u===0||s===n&&(qe===2||qe===9)||s.cancelPendingCommit!==null)return h!==null&&h!==null&&zs(h),s.callbackNode=null,s.callbackPriority=0;if((u&3)===0||Sr(s,u)){if(n=u&-u,n===s.callbackPriority)return n;switch(h!==null&&zs(h),Zo(u)){case 2:case 8:u=Gt;break;case 32:u=Ti;break;case 268435456:u=Er;break;default:u=Ti}return h=Wm.bind(null,s),u=Ks(u,h),s.callbackPriority=n,s.callbackNode=u,n}return h!==null&&h!==null&&zs(h),s.callbackPriority=2,s.callbackNode=null,2}function Wm(s,n){if(Ct!==0&&Ct!==5)return s.callbackNode=null,s.callbackPriority=0,null;var u=s.callbackNode;if(Bl()&&s.callbackNode!==u)return null;var h=Pe;return h=qa(s,s===tt?h:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),h===0?null:(Om(s,h,n),Qm(s,Ze()),s.callbackNode!=null&&s.callbackNode===u?Wm.bind(null,s):null)}function Zm(s,n){if(Bl())return null;Om(s,n,!0)}function FE(){XE(function(){(ze&6)!==0?Ks(_i,BE):Xm()})}function Bc(){return hn===0&&(hn=Vf()),hn}function Jm(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Wa(""+s)}function ep(s,n){var u=n.ownerDocument.createElement("input");return u.name=n.name,u.value=n.value,s.id&&u.setAttribute("form",s.id),n.parentNode.insertBefore(u,n),s=new FormData(s),u.parentNode.removeChild(u),s}function $E(s,n,u,h,m){if(n==="submit"&&u&&u.stateNode===m){var y=Jm((m[Ht]||null).action),x=h.submitter;x&&(n=(n=x[Ht]||null)?Jm(n.formAction):x.getAttribute("formAction"),n!==null&&(y=n,x=null));var R=new tl("action","action",null,h,m);s.push({event:R,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(hn!==0){var O=x?ep(m,x):new FormData(m);nc(u,{pending:!0,data:O,method:m.method,action:y},null,O)}}else typeof y=="function"&&(R.preventDefault(),O=x?ep(m,x):new FormData(m),nc(u,{pending:!0,data:O,method:m.method,action:y},y,O))},currentTarget:m}]})}}for(var Fc=0;Fc<Au.length;Fc++){var $c=Au[Fc],GE=$c.toLowerCase(),HE=$c[0].toUpperCase()+$c.slice(1);Si(GE,"on"+HE)}Si(Od,"onAnimationEnd"),Si(Md,"onAnimationIteration"),Si(Pd,"onAnimationStart"),Si("dblclick","onDoubleClick"),Si("focusin","onFocus"),Si("focusout","onBlur"),Si(rE,"onTransitionRun"),Si(aE,"onTransitionStart"),Si(lE,"onTransitionCancel"),Si(Nd,"onTransitionEnd"),Ln("onMouseEnter",["mouseout","mouseover"]),Ln("onMouseLeave",["mouseout","mouseover"]),Ln("onPointerEnter",["pointerout","pointerover"]),Ln("onPointerLeave",["pointerout","pointerover"]),js("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),js("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),js("onBeforeInput",["compositionend","keypress","textInput","paste"]),js("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),js("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),js("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var aa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),VE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(aa));function tp(s,n){n=(n&4)!==0;for(var u=0;u<s.length;u++){var h=s[u],m=h.event;h=h.listeners;e:{var y=void 0;if(n)for(var x=h.length-1;0<=x;x--){var R=h[x],O=R.instance,z=R.currentTarget;if(R=R.listener,O!==y&&m.isPropagationStopped())break e;y=R,m.currentTarget=z;try{y(m)}catch(W){_l(W)}m.currentTarget=null,y=O}else for(x=0;x<h.length;x++){if(R=h[x],O=R.instance,z=R.currentTarget,R=R.listener,O!==y&&m.isPropagationStopped())break e;y=R,m.currentTarget=z;try{y(m)}catch(W){_l(W)}m.currentTarget=null,y=O}}}}function Oe(s,n){var u=n[Jo];u===void 0&&(u=n[Jo]=new Set);var h=s+"__bubble";u.has(h)||(ip(n,s,2,!1),u.add(h))}function Gc(s,n,u){var h=0;n&&(h|=4),ip(u,s,h,n)}var Gl="_reactListening"+Math.random().toString(36).slice(2);function Hc(s){if(!s[Gl]){s[Gl]=!0,Xf.forEach(function(u){u!=="selectionchange"&&(VE.has(u)||Gc(u,!1,s),Gc(u,!0,s))});var n=s.nodeType===9?s:s.ownerDocument;n===null||n[Gl]||(n[Gl]=!0,Gc("selectionchange",!1,n))}}function ip(s,n,u,h){switch(Rp(n)){case 2:var m=pS;break;case 8:m=yS;break;default:m=ih}u=m.bind(null,n,u,s),m=void 0,!cu||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(m=!0),h?m!==void 0?s.addEventListener(n,u,{capture:!0,passive:m}):s.addEventListener(n,u,!0):m!==void 0?s.addEventListener(n,u,{passive:m}):s.addEventListener(n,u,!1)}function Vc(s,n,u,h,m){var y=h;if((n&1)===0&&(n&2)===0&&h!==null)e:for(;;){if(h===null)return;var x=h.tag;if(x===3||x===4){var R=h.stateNode.containerInfo;if(R===m)break;if(x===4)for(x=h.return;x!==null;){var O=x.tag;if((O===3||O===4)&&x.stateNode.containerInfo===m)return;x=x.return}for(;R!==null;){if(x=bn(R),x===null)return;if(O=x.tag,O===5||O===6||O===26||O===27){h=y=x;continue e}R=R.parentNode}}h=h.return}ud(function(){var z=y,W=ou(u),se=[];e:{var q=Ud.get(s);if(q!==void 0){var j=tl,Ae=s;switch(s){case"keypress":if(Ja(u)===0)break e;case"keydown":case"keyup":j=UT;break;case"focusin":Ae="focus",j=gu;break;case"focusout":Ae="blur",j=gu;break;case"beforeblur":case"afterblur":j=gu;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=fd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=LT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=$T;break;case Od:case Md:case Pd:j=DT;break;case Nd:j=HT;break;case"scroll":case"scrollend":j=AT;break;case"wheel":j=KT;break;case"copy":case"cut":case"paste":j=CT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=gd;break;case"toggle":case"beforetoggle":j=qT}var Te=(n&4)!==0,Qe=!Te&&(s==="scroll"||s==="scrollend"),F=Te?q!==null?q+"Capture":null:q;Te=[];for(var N=z,H;N!==null;){var ee=N;if(H=ee.stateNode,ee=ee.tag,ee!==5&&ee!==26&&ee!==27||H===null||F===null||(ee=Lr(N,F),ee!=null&&Te.push(la(N,ee,H))),Qe)break;N=N.return}0<Te.length&&(q=new j(q,Ae,null,u,W),se.push({event:q,listeners:Te}))}}if((n&7)===0){e:{if(q=s==="mouseover"||s==="pointerover",j=s==="mouseout"||s==="pointerout",q&&u!==lu&&(Ae=u.relatedTarget||u.fromElement)&&(bn(Ae)||Ae[Sn]))break e;if((j||q)&&(q=W.window===W?W:(q=W.ownerDocument)?q.defaultView||q.parentWindow:window,j?(Ae=u.relatedTarget||u.toElement,j=z,Ae=Ae?bn(Ae):null,Ae!==null&&(Qe=l(Ae),Te=Ae.tag,Ae!==Qe||Te!==5&&Te!==27&&Te!==6)&&(Ae=null)):(j=null,Ae=z),j!==Ae)){if(Te=fd,ee="onMouseLeave",F="onMouseEnter",N="mouse",(s==="pointerout"||s==="pointerover")&&(Te=gd,ee="onPointerLeave",F="onPointerEnter",N="pointer"),Qe=j==null?q:xr(j),H=Ae==null?q:xr(Ae),q=new Te(ee,N+"leave",j,u,W),q.target=Qe,q.relatedTarget=H,ee=null,bn(W)===z&&(Te=new Te(F,N+"enter",Ae,u,W),Te.target=H,Te.relatedTarget=Qe,ee=Te),Qe=ee,j&&Ae)t:{for(Te=j,F=Ae,N=0,H=Te;H;H=ir(H))N++;for(H=0,ee=F;ee;ee=ir(ee))H++;for(;0<N-H;)Te=ir(Te),N--;for(;0<H-N;)F=ir(F),H--;for(;N--;){if(Te===F||F!==null&&Te===F.alternate)break t;Te=ir(Te),F=ir(F)}Te=null}else Te=null;j!==null&&sp(se,q,j,Te,!1),Ae!==null&&Qe!==null&&sp(se,Qe,Ae,Te,!0)}}e:{if(q=z?xr(z):window,j=q.nodeName&&q.nodeName.toLowerCase(),j==="select"||j==="input"&&q.type==="file")var ge=bd;else if(Ed(q))if(Ad)ge=iE;else{ge=eE;var Ce=JT}else j=q.nodeName,!j||j.toLowerCase()!=="input"||q.type!=="checkbox"&&q.type!=="radio"?z&&au(z.elementType)&&(ge=bd):ge=tE;if(ge&&(ge=ge(s,z))){Sd(se,ge,u,W);break e}Ce&&Ce(s,q,z),s==="focusout"&&z&&q.type==="number"&&z.memoizedProps.value!=null&&ru(q,"number",q.value)}switch(Ce=z?xr(z):window,s){case"focusin":(Ed(Ce)||Ce.contentEditable==="true")&&(kn=Ce,Eu=z,Or=null);break;case"focusout":Or=Eu=kn=null;break;case"mousedown":Su=!0;break;case"contextmenu":case"mouseup":case"dragend":Su=!1,wd(se,u,W);break;case"selectionchange":if(nE)break;case"keydown":case"keyup":wd(se,u,W)}var ve;if(pu)e:{switch(s){case"compositionstart":var Ee="onCompositionStart";break e;case"compositionend":Ee="onCompositionEnd";break e;case"compositionupdate":Ee="onCompositionUpdate";break e}Ee=void 0}else wn?vd(s,u)&&(Ee="onCompositionEnd"):s==="keydown"&&u.keyCode===229&&(Ee="onCompositionStart");Ee&&(md&&u.locale!=="ko"&&(wn||Ee!=="onCompositionStart"?Ee==="onCompositionEnd"&&wn&&(ve=cd()):(gs=W,hu="value"in gs?gs.value:gs.textContent,wn=!0)),Ce=Hl(z,Ee),0<Ce.length&&(Ee=new dd(Ee,s,null,u,W),se.push({event:Ee,listeners:Ce}),ve?Ee.data=ve:(ve=Td(u),ve!==null&&(Ee.data=ve)))),(ve=jT?XT(s,u):QT(s,u))&&(Ee=Hl(z,"onBeforeInput"),0<Ee.length&&(Ce=new dd("onBeforeInput","beforeinput",null,u,W),se.push({event:Ce,listeners:Ee}),Ce.data=ve)),$E(se,s,z,u,W)}tp(se,n)})}function la(s,n,u){return{instance:s,listener:n,currentTarget:u}}function Hl(s,n){for(var u=n+"Capture",h=[];s!==null;){var m=s,y=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||y===null||(m=Lr(s,u),m!=null&&h.unshift(la(s,m,y)),m=Lr(s,n),m!=null&&h.push(la(s,m,y))),s.tag===3)return h;s=s.return}return[]}function ir(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function sp(s,n,u,h,m){for(var y=n._reactName,x=[];u!==null&&u!==h;){var R=u,O=R.alternate,z=R.stateNode;if(R=R.tag,O!==null&&O===h)break;R!==5&&R!==26&&R!==27||z===null||(O=z,m?(z=Lr(u,y),z!=null&&x.unshift(la(u,z,O))):m||(z=Lr(u,y),z!=null&&x.push(la(u,z,O)))),u=u.return}x.length!==0&&s.push({event:n,listeners:x})}var KE=/\r\n?/g,zE=/\u0000|\uFFFD/g;function np(s){return(typeof s=="string"?s:""+s).replace(KE,`
`).replace(zE,"")}function rp(s,n){return n=np(n),np(s)===n}function Vl(){}function Xe(s,n,u,h,m,y){switch(u){case"children":typeof h=="string"?n==="body"||n==="textarea"&&h===""||Dn(s,h):(typeof h=="number"||typeof h=="bigint")&&n!=="body"&&Dn(s,""+h);break;case"className":ja(s,"class",h);break;case"tabIndex":ja(s,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":ja(s,u,h);break;case"style":ld(s,h,y);break;case"data":if(n!=="object"){ja(s,"data",h);break}case"src":case"href":if(h===""&&(n!=="a"||u!=="href")){s.removeAttribute(u);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){s.removeAttribute(u);break}h=Wa(""+h),s.setAttribute(u,h);break;case"action":case"formAction":if(typeof h=="function"){s.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(u==="formAction"?(n!=="input"&&Xe(s,n,"name",m.name,m,null),Xe(s,n,"formEncType",m.formEncType,m,null),Xe(s,n,"formMethod",m.formMethod,m,null),Xe(s,n,"formTarget",m.formTarget,m,null)):(Xe(s,n,"encType",m.encType,m,null),Xe(s,n,"method",m.method,m,null),Xe(s,n,"target",m.target,m,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){s.removeAttribute(u);break}h=Wa(""+h),s.setAttribute(u,h);break;case"onClick":h!=null&&(s.onclick=Vl);break;case"onScroll":h!=null&&Oe("scroll",s);break;case"onScrollEnd":h!=null&&Oe("scrollend",s);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(u=h.__html,u!=null){if(m.children!=null)throw Error(i(60));s.innerHTML=u}}break;case"multiple":s.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":s.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){s.removeAttribute("xlink:href");break}u=Wa(""+h),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(u,""+h):s.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(u,""):s.removeAttribute(u);break;case"capture":case"download":h===!0?s.setAttribute(u,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(u,h):s.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?s.setAttribute(u,h):s.removeAttribute(u);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?s.removeAttribute(u):s.setAttribute(u,h);break;case"popover":Oe("beforetoggle",s),Oe("toggle",s),Ya(s,"popover",h);break;case"xlinkActuate":zi(s,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":zi(s,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":zi(s,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":zi(s,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":zi(s,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":zi(s,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":zi(s,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":zi(s,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":zi(s,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":Ya(s,"is",h);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=ST.get(u)||u,Ya(s,u,h))}}function Kc(s,n,u,h,m,y){switch(u){case"style":ld(s,h,y);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(u=h.__html,u!=null){if(m.children!=null)throw Error(i(60));s.innerHTML=u}}break;case"children":typeof h=="string"?Dn(s,h):(typeof h=="number"||typeof h=="bigint")&&Dn(s,""+h);break;case"onScroll":h!=null&&Oe("scroll",s);break;case"onScrollEnd":h!=null&&Oe("scrollend",s);break;case"onClick":h!=null&&(s.onclick=Vl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Qf.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(m=u.endsWith("Capture"),n=u.slice(2,m?u.length-7:void 0),y=s[Ht]||null,y=y!=null?y[u]:null,typeof y=="function"&&s.removeEventListener(n,y,m),typeof h=="function")){typeof y!="function"&&y!==null&&(u in s?s[u]=null:s.hasAttribute(u)&&s.removeAttribute(u)),s.addEventListener(n,h,m);break e}u in s?s[u]=h:h===!0?s.setAttribute(u,""):Ya(s,u,h)}}}function wt(s,n,u){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Oe("error",s),Oe("load",s);var h=!1,m=!1,y;for(y in u)if(u.hasOwnProperty(y)){var x=u[y];if(x!=null)switch(y){case"src":h=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:Xe(s,n,y,x,u,null)}}m&&Xe(s,n,"srcSet",u.srcSet,u,null),h&&Xe(s,n,"src",u.src,u,null);return;case"input":Oe("invalid",s);var R=y=x=m=null,O=null,z=null;for(h in u)if(u.hasOwnProperty(h)){var W=u[h];if(W!=null)switch(h){case"name":m=W;break;case"type":x=W;break;case"checked":O=W;break;case"defaultChecked":z=W;break;case"value":y=W;break;case"defaultValue":R=W;break;case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(i(137,n));break;default:Xe(s,n,h,W,u,null)}}sd(s,y,R,O,z,x,m,!1),Xa(s);return;case"select":Oe("invalid",s),h=x=y=null;for(m in u)if(u.hasOwnProperty(m)&&(R=u[m],R!=null))switch(m){case"value":y=R;break;case"defaultValue":x=R;break;case"multiple":h=R;default:Xe(s,n,m,R,u,null)}n=y,u=x,s.multiple=!!h,n!=null?_n(s,!!h,n,!1):u!=null&&_n(s,!!h,u,!0);return;case"textarea":Oe("invalid",s),y=m=h=null;for(x in u)if(u.hasOwnProperty(x)&&(R=u[x],R!=null))switch(x){case"value":h=R;break;case"defaultValue":m=R;break;case"children":y=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(i(91));break;default:Xe(s,n,x,R,u,null)}rd(s,h,m,y),Xa(s);return;case"option":for(O in u)if(u.hasOwnProperty(O)&&(h=u[O],h!=null))switch(O){case"selected":s.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:Xe(s,n,O,h,u,null)}return;case"dialog":Oe("beforetoggle",s),Oe("toggle",s),Oe("cancel",s),Oe("close",s);break;case"iframe":case"object":Oe("load",s);break;case"video":case"audio":for(h=0;h<aa.length;h++)Oe(aa[h],s);break;case"image":Oe("error",s),Oe("load",s);break;case"details":Oe("toggle",s);break;case"embed":case"source":case"link":Oe("error",s),Oe("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(z in u)if(u.hasOwnProperty(z)&&(h=u[z],h!=null))switch(z){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,n));default:Xe(s,n,z,h,u,null)}return;default:if(au(n)){for(W in u)u.hasOwnProperty(W)&&(h=u[W],h!==void 0&&Kc(s,n,W,h,u,void 0));return}}for(R in u)u.hasOwnProperty(R)&&(h=u[R],h!=null&&Xe(s,n,R,h,u,null))}function qE(s,n,u,h){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,y=null,x=null,R=null,O=null,z=null,W=null;for(j in u){var se=u[j];if(u.hasOwnProperty(j)&&se!=null)switch(j){case"checked":break;case"value":break;case"defaultValue":O=se;default:h.hasOwnProperty(j)||Xe(s,n,j,null,h,se)}}for(var q in h){var j=h[q];if(se=u[q],h.hasOwnProperty(q)&&(j!=null||se!=null))switch(q){case"type":y=j;break;case"name":m=j;break;case"checked":z=j;break;case"defaultChecked":W=j;break;case"value":x=j;break;case"defaultValue":R=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(i(137,n));break;default:j!==se&&Xe(s,n,q,j,h,se)}}nu(s,x,R,O,z,W,y,m);return;case"select":j=x=R=q=null;for(y in u)if(O=u[y],u.hasOwnProperty(y)&&O!=null)switch(y){case"value":break;case"multiple":j=O;default:h.hasOwnProperty(y)||Xe(s,n,y,null,h,O)}for(m in h)if(y=h[m],O=u[m],h.hasOwnProperty(m)&&(y!=null||O!=null))switch(m){case"value":q=y;break;case"defaultValue":R=y;break;case"multiple":x=y;default:y!==O&&Xe(s,n,m,y,h,O)}n=R,u=x,h=j,q!=null?_n(s,!!u,q,!1):!!h!=!!u&&(n!=null?_n(s,!!u,n,!0):_n(s,!!u,u?[]:"",!1));return;case"textarea":j=q=null;for(R in u)if(m=u[R],u.hasOwnProperty(R)&&m!=null&&!h.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:Xe(s,n,R,null,h,m)}for(x in h)if(m=h[x],y=u[x],h.hasOwnProperty(x)&&(m!=null||y!=null))switch(x){case"value":q=m;break;case"defaultValue":j=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(i(91));break;default:m!==y&&Xe(s,n,x,m,h,y)}nd(s,q,j);return;case"option":for(var Ae in u)if(q=u[Ae],u.hasOwnProperty(Ae)&&q!=null&&!h.hasOwnProperty(Ae))switch(Ae){case"selected":s.selected=!1;break;default:Xe(s,n,Ae,null,h,q)}for(O in h)if(q=h[O],j=u[O],h.hasOwnProperty(O)&&q!==j&&(q!=null||j!=null))switch(O){case"selected":s.selected=q&&typeof q!="function"&&typeof q!="symbol";break;default:Xe(s,n,O,q,h,j)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Te in u)q=u[Te],u.hasOwnProperty(Te)&&q!=null&&!h.hasOwnProperty(Te)&&Xe(s,n,Te,null,h,q);for(z in h)if(q=h[z],j=u[z],h.hasOwnProperty(z)&&q!==j&&(q!=null||j!=null))switch(z){case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(i(137,n));break;default:Xe(s,n,z,q,h,j)}return;default:if(au(n)){for(var Qe in u)q=u[Qe],u.hasOwnProperty(Qe)&&q!==void 0&&!h.hasOwnProperty(Qe)&&Kc(s,n,Qe,void 0,h,q);for(W in h)q=h[W],j=u[W],!h.hasOwnProperty(W)||q===j||q===void 0&&j===void 0||Kc(s,n,W,q,h,j);return}}for(var F in u)q=u[F],u.hasOwnProperty(F)&&q!=null&&!h.hasOwnProperty(F)&&Xe(s,n,F,null,h,q);for(se in h)q=h[se],j=u[se],!h.hasOwnProperty(se)||q===j||q==null&&j==null||Xe(s,n,se,q,h,j)}var zc=null,qc=null;function Kl(s){return s.nodeType===9?s:s.ownerDocument}function ap(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function lp(s,n){if(s===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&n==="foreignObject"?0:s}function Yc(s,n){return s==="textarea"||s==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var jc=null;function YE(){var s=window.event;return s&&s.type==="popstate"?s===jc?!1:(jc=s,!0):(jc=null,!1)}var op=typeof setTimeout=="function"?setTimeout:void 0,jE=typeof clearTimeout=="function"?clearTimeout:void 0,up=typeof Promise=="function"?Promise:void 0,XE=typeof queueMicrotask=="function"?queueMicrotask:typeof up<"u"?function(s){return up.resolve(null).then(s).catch(QE)}:op;function QE(s){setTimeout(function(){throw s})}function Cs(s){return s==="head"}function cp(s,n){var u=n,h=0,m=0;do{var y=u.nextSibling;if(s.removeChild(u),y&&y.nodeType===8)if(u=y.data,u==="/$"){if(0<h&&8>h){u=h;var x=s.ownerDocument;if(u&1&&oa(x.documentElement),u&2&&oa(x.body),u&4)for(u=x.head,oa(u),x=u.firstChild;x;){var R=x.nextSibling,O=x.nodeName;x[Ar]||O==="SCRIPT"||O==="STYLE"||O==="LINK"&&x.rel.toLowerCase()==="stylesheet"||u.removeChild(x),x=R}}if(m===0){s.removeChild(y),pa(n);return}m--}else u==="$"||u==="$?"||u==="$!"?m++:h=u.charCodeAt(0)-48;else h=0;u=y}while(u);pa(n)}function Xc(s){var n=s.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var u=n;switch(n=n.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Xc(u),eu(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}s.removeChild(u)}}function WE(s,n,u,h){for(;s.nodeType===1;){var m=u;if(s.nodeName.toLowerCase()!==n.toLowerCase()){if(!h&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(h){if(!s[Ar])switch(n){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(y=s.getAttribute("rel"),y==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(y!==m.rel||s.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||s.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||s.getAttribute("title")!==(m.title==null?null:m.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(y=s.getAttribute("src"),(y!==(m.src==null?null:m.src)||s.getAttribute("type")!==(m.type==null?null:m.type)||s.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&y&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(n==="input"&&s.type==="hidden"){var y=m.name==null?null:""+m.name;if(m.type==="hidden"&&s.getAttribute("name")===y)return s}else return s;if(s=Ai(s.nextSibling),s===null)break}return null}function ZE(s,n,u){if(n==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!u||(s=Ai(s.nextSibling),s===null))return null;return s}function Qc(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function JE(s,n){var u=s.ownerDocument;if(s.data!=="$?"||u.readyState==="complete")n();else{var h=function(){n(),u.removeEventListener("DOMContentLoaded",h)};u.addEventListener("DOMContentLoaded",h),s._reactRetry=h}}function Ai(s){for(;s!=null;s=s.nextSibling){var n=s.nodeType;if(n===1||n===3)break;if(n===8){if(n=s.data,n==="$"||n==="$!"||n==="$?"||n==="F!"||n==="F")break;if(n==="/$")return null}}return s}var Wc=null;function hp(s){s=s.previousSibling;for(var n=0;s;){if(s.nodeType===8){var u=s.data;if(u==="$"||u==="$!"||u==="$?"){if(n===0)return s;n--}else u==="/$"&&n++}s=s.previousSibling}return null}function fp(s,n,u){switch(n=Kl(u),s){case"html":if(s=n.documentElement,!s)throw Error(i(452));return s;case"head":if(s=n.head,!s)throw Error(i(453));return s;case"body":if(s=n.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function oa(s){for(var n=s.attributes;n.length;)s.removeAttributeNode(n[0]);eu(s)}var gi=new Map,dp=new Set;function zl(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var rs=X.d;X.d={f:eS,r:tS,D:iS,C:sS,L:nS,m:rS,X:lS,S:aS,M:oS};function eS(){var s=rs.f(),n=Nl();return s||n}function tS(s){var n=An(s);n!==null&&n.tag===5&&n.type==="form"?Og(n):rs.r(s)}var sr=typeof document>"u"?null:document;function gp(s,n,u){var h=sr;if(h&&typeof n=="string"&&n){var m=li(n);m='link[rel="'+s+'"][href="'+m+'"]',typeof u=="string"&&(m+='[crossorigin="'+u+'"]'),dp.has(m)||(dp.add(m),s={rel:s,crossOrigin:u,href:n},h.querySelector(m)===null&&(n=h.createElement("link"),wt(n,"link",s),Et(n),h.head.appendChild(n)))}}function iS(s){rs.D(s),gp("dns-prefetch",s,null)}function sS(s,n){rs.C(s,n),gp("preconnect",s,n)}function nS(s,n,u){rs.L(s,n,u);var h=sr;if(h&&s&&n){var m='link[rel="preload"][as="'+li(n)+'"]';n==="image"&&u&&u.imageSrcSet?(m+='[imagesrcset="'+li(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(m+='[imagesizes="'+li(u.imageSizes)+'"]')):m+='[href="'+li(s)+'"]';var y=m;switch(n){case"style":y=nr(s);break;case"script":y=rr(s)}gi.has(y)||(s=g({rel:"preload",href:n==="image"&&u&&u.imageSrcSet?void 0:s,as:n},u),gi.set(y,s),h.querySelector(m)!==null||n==="style"&&h.querySelector(ua(y))||n==="script"&&h.querySelector(ca(y))||(n=h.createElement("link"),wt(n,"link",s),Et(n),h.head.appendChild(n)))}}function rS(s,n){rs.m(s,n);var u=sr;if(u&&s){var h=n&&typeof n.as=="string"?n.as:"script",m='link[rel="modulepreload"][as="'+li(h)+'"][href="'+li(s)+'"]',y=m;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=rr(s)}if(!gi.has(y)&&(s=g({rel:"modulepreload",href:s},n),gi.set(y,s),u.querySelector(m)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(ca(y)))return}h=u.createElement("link"),wt(h,"link",s),Et(h),u.head.appendChild(h)}}}function aS(s,n,u){rs.S(s,n,u);var h=sr;if(h&&s){var m=xn(h).hoistableStyles,y=nr(s);n=n||"default";var x=m.get(y);if(!x){var R={loading:0,preload:null};if(x=h.querySelector(ua(y)))R.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":n},u),(u=gi.get(y))&&Zc(s,u);var O=x=h.createElement("link");Et(O),wt(O,"link",s),O._p=new Promise(function(z,W){O.onload=z,O.onerror=W}),O.addEventListener("load",function(){R.loading|=1}),O.addEventListener("error",function(){R.loading|=2}),R.loading|=4,ql(x,n,h)}x={type:"stylesheet",instance:x,count:1,state:R},m.set(y,x)}}}function lS(s,n){rs.X(s,n);var u=sr;if(u&&s){var h=xn(u).hoistableScripts,m=rr(s),y=h.get(m);y||(y=u.querySelector(ca(m)),y||(s=g({src:s,async:!0},n),(n=gi.get(m))&&Jc(s,n),y=u.createElement("script"),Et(y),wt(y,"link",s),u.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(m,y))}}function oS(s,n){rs.M(s,n);var u=sr;if(u&&s){var h=xn(u).hoistableScripts,m=rr(s),y=h.get(m);y||(y=u.querySelector(ca(m)),y||(s=g({src:s,async:!0,type:"module"},n),(n=gi.get(m))&&Jc(s,n),y=u.createElement("script"),Et(y),wt(y,"link",s),u.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(m,y))}}function mp(s,n,u,h){var m=(m=fe.current)?zl(m):null;if(!m)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(n=nr(u.href),u=xn(m).hoistableStyles,h=u.get(n),h||(h={type:"style",instance:null,count:0,state:null},u.set(n,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){s=nr(u.href);var y=xn(m).hoistableStyles,x=y.get(s);if(x||(m=m.ownerDocument||m,x={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(s,x),(y=m.querySelector(ua(s)))&&!y._p&&(x.instance=y,x.state.loading=5),gi.has(s)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},gi.set(s,u),y||uS(m,s,u,x.state))),n&&h===null)throw Error(i(528,""));return x}if(n&&h!==null)throw Error(i(529,""));return null;case"script":return n=u.async,u=u.src,typeof u=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=rr(u),u=xn(m).hoistableScripts,h=u.get(n),h||(h={type:"script",instance:null,count:0,state:null},u.set(n,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function nr(s){return'href="'+li(s)+'"'}function ua(s){return'link[rel="stylesheet"]['+s+"]"}function pp(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function uS(s,n,u,h){s.querySelector('link[rel="preload"][as="style"]['+n+"]")?h.loading=1:(n=s.createElement("link"),h.preload=n,n.addEventListener("load",function(){return h.loading|=1}),n.addEventListener("error",function(){return h.loading|=2}),wt(n,"link",u),Et(n),s.head.appendChild(n))}function rr(s){return'[src="'+li(s)+'"]'}function ca(s){return"script[async]"+s}function yp(s,n,u){if(n.count++,n.instance===null)switch(n.type){case"style":var h=s.querySelector('style[data-href~="'+li(u.href)+'"]');if(h)return n.instance=h,Et(h),h;var m=g({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return h=(s.ownerDocument||s).createElement("style"),Et(h),wt(h,"style",m),ql(h,u.precedence,s),n.instance=h;case"stylesheet":m=nr(u.href);var y=s.querySelector(ua(m));if(y)return n.state.loading|=4,n.instance=y,Et(y),y;h=pp(u),(m=gi.get(m))&&Zc(h,m),y=(s.ownerDocument||s).createElement("link"),Et(y);var x=y;return x._p=new Promise(function(R,O){x.onload=R,x.onerror=O}),wt(y,"link",h),n.state.loading|=4,ql(y,u.precedence,s),n.instance=y;case"script":return y=rr(u.src),(m=s.querySelector(ca(y)))?(n.instance=m,Et(m),m):(h=u,(m=gi.get(y))&&(h=g({},u),Jc(h,m)),s=s.ownerDocument||s,m=s.createElement("script"),Et(m),wt(m,"link",h),s.head.appendChild(m),n.instance=m);case"void":return null;default:throw Error(i(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(h=n.instance,n.state.loading|=4,ql(h,u.precedence,s));return n.instance}function ql(s,n,u){for(var h=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=h.length?h[h.length-1]:null,y=m,x=0;x<h.length;x++){var R=h[x];if(R.dataset.precedence===n)y=R;else if(y!==m)break}y?y.parentNode.insertBefore(s,y.nextSibling):(n=u.nodeType===9?u.head:u,n.insertBefore(s,n.firstChild))}function Zc(s,n){s.crossOrigin==null&&(s.crossOrigin=n.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=n.referrerPolicy),s.title==null&&(s.title=n.title)}function Jc(s,n){s.crossOrigin==null&&(s.crossOrigin=n.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=n.referrerPolicy),s.integrity==null&&(s.integrity=n.integrity)}var Yl=null;function vp(s,n,u){if(Yl===null){var h=new Map,m=Yl=new Map;m.set(u,h)}else m=Yl,h=m.get(u),h||(h=new Map,m.set(u,h));if(h.has(s))return h;for(h.set(s,null),u=u.getElementsByTagName(s),m=0;m<u.length;m++){var y=u[m];if(!(y[Ar]||y[Mt]||s==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var x=y.getAttribute(n)||"";x=s+x;var R=h.get(x);R?R.push(y):h.set(x,[y])}}return h}function Tp(s,n,u){s=s.ownerDocument||s,s.head.insertBefore(u,n==="title"?s.querySelector("head > title"):null)}function cS(s,n,u){if(u===1||n.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return s=n.disabled,typeof n.precedence=="string"&&s==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function Ep(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var ha=null;function hS(){}function fS(s,n,u){if(ha===null)throw Error(i(475));var h=ha;if(n.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(n.state.loading&4)===0){if(n.instance===null){var m=nr(u.href),y=s.querySelector(ua(m));if(y){s=y._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(h.count++,h=jl.bind(h),s.then(h,h)),n.state.loading|=4,n.instance=y,Et(y);return}y=s.ownerDocument||s,u=pp(u),(m=gi.get(m))&&Zc(u,m),y=y.createElement("link"),Et(y);var x=y;x._p=new Promise(function(R,O){x.onload=R,x.onerror=O}),wt(y,"link",u),n.instance=y}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(n,s),(s=n.state.preload)&&(n.state.loading&3)===0&&(h.count++,n=jl.bind(h),s.addEventListener("load",n),s.addEventListener("error",n))}}function dS(){if(ha===null)throw Error(i(475));var s=ha;return s.stylesheets&&s.count===0&&eh(s,s.stylesheets),0<s.count?function(n){var u=setTimeout(function(){if(s.stylesheets&&eh(s,s.stylesheets),s.unsuspend){var h=s.unsuspend;s.unsuspend=null,h()}},6e4);return s.unsuspend=n,function(){s.unsuspend=null,clearTimeout(u)}}:null}function jl(){if(this.count--,this.count===0){if(this.stylesheets)eh(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Xl=null;function eh(s,n){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Xl=new Map,n.forEach(gS,s),Xl=null,jl.call(s))}function gS(s,n){if(!(n.state.loading&4)){var u=Xl.get(s);if(u)var h=u.get(null);else{u=new Map,Xl.set(s,u);for(var m=s.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<m.length;y++){var x=m[y];(x.nodeName==="LINK"||x.getAttribute("media")!=="not all")&&(u.set(x.dataset.precedence,x),h=x)}h&&u.set(null,h)}m=n.instance,x=m.getAttribute("data-precedence"),y=u.get(x)||h,y===h&&u.set(null,m),u.set(x,m),this.count++,h=jl.bind(this),m.addEventListener("load",h),m.addEventListener("error",h),y?y.parentNode.insertBefore(m,y.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(m,s.firstChild)),n.state.loading|=4}}var fa={$$typeof:D,Provider:null,Consumer:null,_currentValue:ne,_currentValue2:ne,_threadCount:0};function mS(s,n,u,h,m,y,x,R){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qo(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qo(0),this.hiddenUpdates=Qo(null),this.identifierPrefix=h,this.onUncaughtError=m,this.onCaughtError=y,this.onRecoverableError=x,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=R,this.incompleteTransitions=new Map}function Sp(s,n,u,h,m,y,x,R,O,z,W,se){return s=new mS(s,n,u,x,R,O,z,se),n=1,y===!0&&(n|=24),y=Qt(3,null,null,n),s.current=y,y.stateNode=s,n=Pu(),n.refCount++,s.pooledCache=n,n.refCount++,y.memoizedState={element:h,isDehydrated:u,cache:n},Fu(y),s}function bp(s){return s?(s=Nn,s):Nn}function Ap(s,n,u,h,m,y){m=bp(m),h.context===null?h.context=m:h.pendingContext=m,h=ys(n),h.payload={element:u},y=y===void 0?null:y,y!==null&&(h.callback=y),u=vs(s,h,n),u!==null&&(ti(u,s,n),Hr(u,s,n))}function xp(s,n){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var u=s.retryLane;s.retryLane=u!==0&&u<n?u:n}}function th(s,n){xp(s,n),(s=s.alternate)&&xp(s,n)}function Lp(s){if(s.tag===13){var n=Pn(s,67108864);n!==null&&ti(n,s,67108864),th(s,67108864)}}var Ql=!0;function pS(s,n,u,h){var m=P.T;P.T=null;var y=X.p;try{X.p=2,ih(s,n,u,h)}finally{X.p=y,P.T=m}}function yS(s,n,u,h){var m=P.T;P.T=null;var y=X.p;try{X.p=8,ih(s,n,u,h)}finally{X.p=y,P.T=m}}function ih(s,n,u,h){if(Ql){var m=sh(h);if(m===null)Vc(s,n,h,Wl,u),_p(s,h);else if(TS(m,s,n,u,h))h.stopPropagation();else if(_p(s,h),n&4&&-1<vS.indexOf(s)){for(;m!==null;){var y=An(m);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var x=Ys(y.pendingLanes);if(x!==0){var R=y;for(R.pendingLanes|=2,R.entangledLanes|=2;x;){var O=1<<31-Ot(x);R.entanglements[1]|=O,x&=~O}Oi(y),(ze&6)===0&&(Ml=Ze()+500,ra(0))}}break;case 13:R=Pn(y,2),R!==null&&ti(R,y,2),Nl(),th(y,2)}if(y=sh(h),y===null&&Vc(s,n,h,Wl,u),y===m)break;m=y}m!==null&&h.stopPropagation()}else Vc(s,n,h,null,u)}}function sh(s){return s=ou(s),nh(s)}var Wl=null;function nh(s){if(Wl=null,s=bn(s),s!==null){var n=l(s);if(n===null)s=null;else{var u=n.tag;if(u===13){if(s=o(n),s!==null)return s;s=null}else if(u===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;s=null}else n!==s&&(s=null)}}return Wl=s,null}function Rp(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch($t()){case _i:return 2;case Gt:return 8;case Ti:case Ki:return 32;case Er:return 268435456;default:return 32}default:return 32}}var rh=!1,ws=null,ks=null,Os=null,da=new Map,ga=new Map,Ms=[],vS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _p(s,n){switch(s){case"focusin":case"focusout":ws=null;break;case"dragenter":case"dragleave":ks=null;break;case"mouseover":case"mouseout":Os=null;break;case"pointerover":case"pointerout":da.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":ga.delete(n.pointerId)}}function ma(s,n,u,h,m,y){return s===null||s.nativeEvent!==y?(s={blockedOn:n,domEventName:u,eventSystemFlags:h,nativeEvent:y,targetContainers:[m]},n!==null&&(n=An(n),n!==null&&Lp(n)),s):(s.eventSystemFlags|=h,n=s.targetContainers,m!==null&&n.indexOf(m)===-1&&n.push(m),s)}function TS(s,n,u,h,m){switch(n){case"focusin":return ws=ma(ws,s,n,u,h,m),!0;case"dragenter":return ks=ma(ks,s,n,u,h,m),!0;case"mouseover":return Os=ma(Os,s,n,u,h,m),!0;case"pointerover":var y=m.pointerId;return da.set(y,ma(da.get(y)||null,s,n,u,h,m)),!0;case"gotpointercapture":return y=m.pointerId,ga.set(y,ma(ga.get(y)||null,s,n,u,h,m)),!0}return!1}function Dp(s){var n=bn(s.target);if(n!==null){var u=l(n);if(u!==null){if(n=u.tag,n===13){if(n=o(u),n!==null){s.blockedOn=n,fT(s.priority,function(){if(u.tag===13){var h=ei();h=Wo(h);var m=Pn(u,h);m!==null&&ti(m,u,h),th(u,h)}});return}}else if(n===3&&u.stateNode.current.memoizedState.isDehydrated){s.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Zl(s){if(s.blockedOn!==null)return!1;for(var n=s.targetContainers;0<n.length;){var u=sh(s.nativeEvent);if(u===null){u=s.nativeEvent;var h=new u.constructor(u.type,u);lu=h,u.target.dispatchEvent(h),lu=null}else return n=An(u),n!==null&&Lp(n),s.blockedOn=u,!1;n.shift()}return!0}function Ip(s,n,u){Zl(s)&&u.delete(n)}function ES(){rh=!1,ws!==null&&Zl(ws)&&(ws=null),ks!==null&&Zl(ks)&&(ks=null),Os!==null&&Zl(Os)&&(Os=null),da.forEach(Ip),ga.forEach(Ip)}function Jl(s,n){s.blockedOn===n&&(s.blockedOn=null,rh||(rh=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,ES)))}var eo=null;function Cp(s){eo!==s&&(eo=s,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){eo===s&&(eo=null);for(var n=0;n<s.length;n+=3){var u=s[n],h=s[n+1],m=s[n+2];if(typeof h!="function"){if(nh(h||u)===null)continue;break}var y=An(u);y!==null&&(s.splice(n,3),n-=3,nc(y,{pending:!0,data:m,method:u.method,action:h},h,m))}}))}function pa(s){function n(O){return Jl(O,s)}ws!==null&&Jl(ws,s),ks!==null&&Jl(ks,s),Os!==null&&Jl(Os,s),da.forEach(n),ga.forEach(n);for(var u=0;u<Ms.length;u++){var h=Ms[u];h.blockedOn===s&&(h.blockedOn=null)}for(;0<Ms.length&&(u=Ms[0],u.blockedOn===null);)Dp(u),u.blockedOn===null&&Ms.shift();if(u=(s.ownerDocument||s).$$reactFormReplay,u!=null)for(h=0;h<u.length;h+=3){var m=u[h],y=u[h+1],x=m[Ht]||null;if(typeof y=="function")x||Cp(u);else if(x){var R=null;if(y&&y.hasAttribute("formAction")){if(m=y,x=y[Ht]||null)R=x.formAction;else if(nh(m)!==null)continue}else R=x.action;typeof R=="function"?u[h+1]=R:(u.splice(h,3),h-=3),Cp(u)}}}function ah(s){this._internalRoot=s}to.prototype.render=ah.prototype.render=function(s){var n=this._internalRoot;if(n===null)throw Error(i(409));var u=n.current,h=ei();Ap(u,h,s,n,null,null)},to.prototype.unmount=ah.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var n=s.containerInfo;Ap(s.current,2,null,s,null,null),Nl(),n[Sn]=null}};function to(s){this._internalRoot=s}to.prototype.unstable_scheduleHydration=function(s){if(s){var n=Yf();s={blockedOn:null,target:s,priority:n};for(var u=0;u<Ms.length&&n!==0&&n<Ms[u].priority;u++);Ms.splice(u,0,s),u===0&&Dp(s)}};var wp=e.version;if(wp!=="19.1.0")throw Error(i(527,wp,"19.1.0"));X.findDOMNode=function(s){var n=s._reactInternals;if(n===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=d(n),s=s!==null?f(s):null,s=s===null?null:s.stateNode,s};var SS={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var io=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!io.isDisabled&&io.supportsFiber)try{Ei=io.inject(SS),kt=io}catch{}}return va.createRoot=function(s,n){if(!r(s))throw Error(i(299));var u=!1,h="",m=Yg,y=jg,x=Xg,R=null;return n!=null&&(n.unstable_strictMode===!0&&(u=!0),n.identifierPrefix!==void 0&&(h=n.identifierPrefix),n.onUncaughtError!==void 0&&(m=n.onUncaughtError),n.onCaughtError!==void 0&&(y=n.onCaughtError),n.onRecoverableError!==void 0&&(x=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(R=n.unstable_transitionCallbacks)),n=Sp(s,1,!1,null,null,u,h,m,y,x,R,null),s[Sn]=n.current,Hc(s),new ah(n)},va.hydrateRoot=function(s,n,u){if(!r(s))throw Error(i(299));var h=!1,m="",y=Yg,x=jg,R=Xg,O=null,z=null;return u!=null&&(u.unstable_strictMode===!0&&(h=!0),u.identifierPrefix!==void 0&&(m=u.identifierPrefix),u.onUncaughtError!==void 0&&(y=u.onUncaughtError),u.onCaughtError!==void 0&&(x=u.onCaughtError),u.onRecoverableError!==void 0&&(R=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(O=u.unstable_transitionCallbacks),u.formState!==void 0&&(z=u.formState)),n=Sp(s,1,!0,n,u??null,h,m,y,x,R,O,z),n.context=bp(null),u=n.current,h=ei(),h=Wo(h),m=ys(h),m.callback=null,vs(u,m,h),u=h,n.current.lanes=u,br(n,u),Oi(n),s[Sn]=n.current,Hc(s),new to(n)},va.version="19.1.0",va}var Gp;function kS(){if(Gp)return uh.exports;Gp=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),uh.exports=wS(),uh.exports}var OS=kS();function ce(a,e,t){return(e=PS(e))in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function MS(a,e){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var i=t.call(a,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function PS(a){var e=MS(a,"string");return typeof e=="symbol"?e:String(e)}function NS(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function Hp(a,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(a,i.key,i)}}function US(a,e,t){return e&&Hp(a.prototype,e),t&&Hp(a,t),a}function BS(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function Vp(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable})),t.push.apply(t,i)}return t}function Kp(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vp(Object(t),!0).forEach(function(i){BS(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Vp(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}var zp={addCSS:!0,thumbWidth:15,watch:!0};function FS(a,e){return(function(){return Array.from(document.querySelectorAll(e)).includes(this)}).call(a,e)}function $S(a,e){if(a&&e){var t=new Event(e,{bubbles:!0});a.dispatchEvent(t)}}var Fa=function(a){return a!=null?a.constructor:null},pf=function(a,e){return!!(a&&e&&a instanceof e)},my=function(a){return a==null},py=function(a){return Fa(a)===Object},GS=function(a){return Fa(a)===Number&&!Number.isNaN(a)},yy=function(a){return Fa(a)===String},HS=function(a){return Fa(a)===Boolean},VS=function(a){return Fa(a)===Function},vy=function(a){return Array.isArray(a)},Ty=function(a){return pf(a,NodeList)},KS=function(a){return pf(a,Element)},zS=function(a){return pf(a,Event)},qS=function(a){return my(a)||(yy(a)||vy(a)||Ty(a))&&!a.length||py(a)&&!Object.keys(a).length},Ut={nullOrUndefined:my,object:py,number:GS,string:yy,boolean:HS,function:VS,array:vy,nodeList:Ty,element:KS,event:zS,empty:qS};function YS(a){var e="".concat(a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0}function jS(a,e){if(1>e){var t=YS(e);return parseFloat(a.toFixed(t))}return Math.round(a/e)*e}var XS=function(){function a(e,t){NS(this,a),Ut.element(e)?this.element=e:Ut.string(e)&&(this.element=document.querySelector(e)),Ut.element(this.element)&&Ut.empty(this.element.rangeTouch)&&(this.config=Kp({},zp,{},t),this.init())}return US(a,[{key:"init",value:function(){a.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){a.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(e){var t=this,i=e?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach(function(r){t.element[i](r,function(l){return t.set(l)},!1)})}},{key:"get",value:function(e){if(!a.enabled||!Ut.event(e))return null;var t,i=e.target,r=e.changedTouches[0],l=parseFloat(i.getAttribute("min"))||0,o=parseFloat(i.getAttribute("max"))||100,c=parseFloat(i.getAttribute("step"))||1,d=i.getBoundingClientRect(),f=100/d.width*(this.config.thumbWidth/2)/100;return 0>(t=100/d.width*(r.clientX-d.left))?t=0:100<t&&(t=100),50>t?t-=(100-2*t)*f:50<t&&(t+=2*(t-50)*f),l+jS(t/100*(o-l),c)}},{key:"set",value:function(e){a.enabled&&Ut.event(e)&&!e.target.disabled&&(e.preventDefault(),e.target.value=this.get(e),$S(e.target,e.type==="touchend"?"change":"input"))}}],[{key:"setup",value:function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},i=null;if(Ut.empty(e)||Ut.string(e)?i=Array.from(document.querySelectorAll(Ut.string(e)?e:'input[type="range"]')):Ut.element(e)?i=[e]:Ut.nodeList(e)?i=Array.from(e):Ut.array(e)&&(i=e.filter(Ut.element)),Ut.empty(i))return null;var r=Kp({},zp,{},t);if(Ut.string(e)&&r.watch){var l=new MutationObserver(function(o){Array.from(o).forEach(function(c){Array.from(c.addedNodes).forEach(function(d){Ut.element(d)&&FS(d,e)&&new a(d,r)})})});l.observe(document.body,{childList:!0,subtree:!0})}return i.map(function(o){return new a(o,t)})}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),a}();const $a=a=>a!=null?a.constructor:null,hs=(a,e)=>!!(a&&e&&a instanceof e),yf=a=>a==null,Ey=a=>$a(a)===Object,QS=a=>$a(a)===Number&&!Number.isNaN(a),zo=a=>$a(a)===String,WS=a=>$a(a)===Boolean,Sy=a=>typeof a=="function",by=a=>Array.isArray(a),ZS=a=>hs(a,WeakMap),Ay=a=>hs(a,NodeList),JS=a=>$a(a)===Text,eb=a=>hs(a,Event),tb=a=>hs(a,KeyboardEvent),ib=a=>hs(a,window.TextTrackCue)||hs(a,window.VTTCue),sb=a=>hs(a,TextTrack)||!yf(a)&&zo(a.kind),nb=a=>hs(a,Promise)&&Sy(a.then),rb=a=>a!==null&&typeof a=="object"&&a.nodeType===1&&typeof a.style=="object"&&typeof a.ownerDocument=="object",xy=a=>yf(a)||(zo(a)||by(a)||Ay(a))&&!a.length||Ey(a)&&!Object.keys(a).length,ab=a=>{if(hs(a,window.URL))return!0;if(!zo(a))return!1;let e=a;a.startsWith("http://")&&a.startsWith("https://")||(e=`http://${a}`);try{return!xy(new URL(e).hostname)}catch{return!1}};var C={nullOrUndefined:yf,object:Ey,number:QS,string:zo,boolean:WS,function:Sy,array:by,weakMap:ZS,nodeList:Ay,element:rb,textNode:JS,event:eb,keyboardEvent:tb,cue:ib,track:sb,promise:nb,url:ab,empty:xy};const Vh=(()=>{const a=document.createElement("span"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},t=Object.keys(e).find(i=>a.style[i]!==void 0);return!!C.string(t)&&e[t]})();function Ly(a,e){setTimeout(()=>{try{a.hidden=!0,a.offsetHeight,a.hidden=!1}catch{}},e)}const lb=!!window.document.documentMode,ob=/Edge/g.test(navigator.userAgent),ub="WebkitAppearance"in document.documentElement.style&&!/Edge/g.test(navigator.userAgent),cb=/iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1,hb=navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,fb=/iPad|iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1;var Rt={isIE:lb,isEdge:ob,isWebKit:ub,isIPhone:cb,isIPadOS:hb,isIos:fb};function db(a){return JSON.parse(JSON.stringify(a))}function Ry(a,e){return e.split(".").reduce((t,i)=>t&&t[i],a)}function ht(a={},...e){if(!e.length)return a;const t=e.shift();return C.object(t)?(Object.keys(t).forEach(i=>{C.object(t[i])?(Object.keys(a).includes(i)||Object.assign(a,{[i]:{}}),ht(a[i],t[i])):Object.assign(a,{[i]:t[i]})}),ht(a,...e)):a}function _y(a,e){const t=a.length?a:[a];Array.from(t).reverse().forEach((i,r)=>{const l=r>0?e.cloneNode(!0):e,o=i.parentNode,c=i.nextSibling;l.appendChild(i),c?o.insertBefore(l,c):o.appendChild(l)})}function Kh(a,e){C.element(a)&&!C.empty(e)&&Object.entries(e).filter(([,t])=>!C.nullOrUndefined(t)).forEach(([t,i])=>a.setAttribute(t,i))}function be(a,e,t){const i=document.createElement(a);return C.object(e)&&Kh(i,e),C.string(t)&&(i.innerText=t),i}function gb(a,e){C.element(a)&&C.element(e)&&e.parentNode.insertBefore(a,e.nextSibling)}function qp(a,e,t,i){C.element(e)&&e.appendChild(be(a,t,i))}function cs(a){C.nodeList(a)||C.array(a)?Array.from(a).forEach(cs):C.element(a)&&C.element(a.parentNode)&&a.parentNode.removeChild(a)}function To(a){if(!C.element(a))return;let{length:e}=a.childNodes;for(;e>0;)a.removeChild(a.lastChild),e-=1}function wo(a,e){return C.element(e)&&C.element(e.parentNode)&&C.element(a)?(e.parentNode.replaceChild(a,e),a):null}function Pi(a,e){if(!C.string(a)||C.empty(a))return{};const t={},i=ht({},e);return a.split(",").forEach(r=>{const l=r.trim(),o=l.replace(".",""),c=l.replace(/[[\]]/g,"").split("="),[d]=c,f=c.length>1?c[1].replace(/["']/g,""):"";switch(l.charAt(0)){case".":C.string(i.class)?t.class=`${i.class} ${o}`:t.class=o;break;case"#":t.id=l.replace("#","");break;case"[":t[d]=f}}),ht(i,t)}function fn(a,e){if(!C.element(a))return;let t=e;C.boolean(t)||(t=!a.hidden),a.hidden=t}function He(a,e,t){if(C.nodeList(a))return Array.from(a).map(i=>He(i,e,t));if(C.element(a)){let i="toggle";return t!==void 0&&(i=t?"add":"remove"),a.classList[i](e),a.classList.contains(e)}return!1}function ko(a,e){return C.element(a)&&a.classList.contains(e)}function mn(a,e){const{prototype:t}=Element;return(t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||function(){return Array.from(document.querySelectorAll(e)).includes(this)}).call(a,e)}function mb(a,e){const{prototype:t}=Element;return(t.closest||function(){let i=this;do{if(mn.matches(i,e))return i;i=i.parentElement||i.parentNode}while(i!==null&&i.nodeType===1);return null}).call(a,e)}function Da(a){return this.elements.container.querySelectorAll(a)}function yt(a){return this.elements.container.querySelector(a)}function dh(a=null,e=!1){C.element(a)&&a.focus({preventScroll:!0,focusVisible:e})}const Yp={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},ft={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(a,e){const t=ft[a]||e!=="html5";return{api:t,ui:t&&ft.rangeInput}},pip:!(Rt.isIPhone||!C.function(be("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||be("video").disablePictureInPicture)),airplay:C.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(a){if(C.empty(a))return!1;const[e]=a.split("/");let t=a;if(!this.isHTML5||e!==this.type)return!1;Object.keys(Yp).includes(t)&&(t+=`; codecs="${Yp[a]}"`);try{return!!(t&&this.media.canPlayType(t).replace(/no/,""))}catch{return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const a=document.createElement("input");return a.type="range",a.type==="range"})(),touch:"ontouchstart"in document.documentElement,transitions:Vh!==!1,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},pb=(()=>{let a=!1;try{const e=Object.defineProperty({},"passive",{get:()=>(a=!0,null)});window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch{}return a})();function Ia(a,e,t,i=!1,r=!0,l=!1){if(!a||!("addEventListener"in a)||C.empty(e)||!C.function(t))return;const o=e.split(" ");let c=l;pb&&(c={passive:r,capture:l}),o.forEach(d=>{this&&this.eventListeners&&i&&this.eventListeners.push({element:a,type:d,callback:t,options:c}),a[i?"addEventListener":"removeEventListener"](d,t,c)})}function Ne(a,e="",t,i=!0,r=!1){Ia.call(this,a,e,t,!0,i,r)}function qo(a,e="",t,i=!0,r=!1){Ia.call(this,a,e,t,!1,i,r)}function vf(a,e="",t,i=!0,r=!1){const l=(...o)=>{qo(a,e,l,i,r),t.apply(this,o)};Ia.call(this,a,e,l,!0,i,r)}function xe(a,e="",t=!1,i={}){if(!C.element(a)||C.empty(e))return;const r=new CustomEvent(e,{bubbles:t,detail:{...i,plyr:this}});a.dispatchEvent(r)}function yb(){this&&this.eventListeners&&(this.eventListeners.forEach(a=>{const{element:e,type:t,callback:i,options:r}=a;e.removeEventListener(t,i,r)}),this.eventListeners=[])}function vb(){return new Promise(a=>this.ready?setTimeout(a,0):Ne.call(this,this.elements.container,"ready",a)).then(()=>{})}function Fi(a){C.promise(a)&&a.then(null,()=>{})}function zh(a){return C.array(a)?a.filter((e,t)=>a.indexOf(e)===t):a}function Dy(a,e){return C.array(a)&&a.length?a.reduce((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t):null}function Iy(a){return!(!window||!window.CSS)&&window.CSS.supports(a)}const jp=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce((a,[e,t])=>({...a,[e/t]:[e,t]}),{});function Cy(a){return C.array(a)||C.string(a)&&a.includes(":")?(C.array(a)?a:a.split(":")).map(Number).every(C.number):!1}function Oo(a){if(!C.array(a)||!a.every(C.number))return null;const[e,t]=a,i=(l,o)=>o===0?l:i(o,l%o),r=i(e,t);return[e/r,t/r]}function Tf(a){const e=i=>Cy(i)?i.split(":").map(Number):null;let t=e(a);if(t===null&&(t=e(this.config.ratio)),t===null&&!C.empty(this.embed)&&C.array(this.embed.ratio)&&({ratio:t}=this.embed),t===null&&this.isHTML5){const{videoWidth:i,videoHeight:r}=this.media;t=[i,r]}return Oo(t)}function mr(a){if(!this.isVideo)return{};const{wrapper:e}=this.elements,t=Tf.call(this,a);if(!C.array(t))return{};const[i,r]=Oo(t),l=100/i*r;if(Iy(`aspect-ratio: ${i}/${r}`)?e.style.aspectRatio=`${i}/${r}`:e.style.paddingBottom=`${l}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const o=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10),c=(o-l)/(o/50);this.fullscreen.active?e.style.paddingBottom=null:this.media.style.transform=`translateY(-${c}%)`}else this.isHTML5&&e.classList.add(this.config.classNames.videoFixedRatio);return{padding:l,ratio:t}}function wy(a,e,t=.05){const i=a/e,r=Dy(Object.keys(jp),i);return Math.abs(r-i)<=t?jp[r]:[a,e]}function Tb(){return[Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)]}const Gs={getSources(){return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter(a=>{const e=a.getAttribute("type");return!!C.empty(e)||ft.mime.call(this,e)}):[]},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:Gs.getSources.call(this).map(a=>Number(a.getAttribute("size"))).filter(Boolean)},setup(){if(!this.isHTML5)return;const a=this;a.options.speed=a.config.speed.options,C.empty(this.config.ratio)||mr.call(a),Object.defineProperty(a.media,"quality",{get(){const e=Gs.getSources.call(a).find(t=>t.getAttribute("src")===a.source);return e&&Number(e.getAttribute("size"))},set(e){if(a.quality!==e){if(a.config.quality.forced&&C.function(a.config.quality.onChange))a.config.quality.onChange(e);else{const t=Gs.getSources.call(a).find(d=>Number(d.getAttribute("size"))===e);if(!t)return;const{currentTime:i,paused:r,preload:l,readyState:o,playbackRate:c}=a.media;a.media.src=t.getAttribute("src"),(l!=="none"||o)&&(a.once("loadedmetadata",()=>{a.speed=c,a.currentTime=i,r||Fi(a.play())}),a.media.load())}xe.call(a,a.media,"qualitychange",!1,{quality:e})}}})},cancelRequests(){this.isHTML5&&(cs(Gs.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function Eb(a){return`${a}-${Math.floor(1e4*Math.random())}`}function qh(a,...e){return C.empty(a)?a:a.toString().replace(/{(\d+)}/g,(t,i)=>e[i].toString())}function Sb(a,e){return a===0||e===0||Number.isNaN(a)||Number.isNaN(e)?0:(a/e*100).toFixed(2)}const xa=(a="",e="",t="")=>a.replace(new RegExp(e.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),t.toString()),ky=(a="")=>a.toString().replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());function bb(a=""){let e=a.toString();return e=xa(e,"-"," "),e=xa(e,"_"," "),e=ky(e),xa(e," ","")}function Ab(a=""){let e=a.toString();return e=bb(e),e.charAt(0).toLowerCase()+e.slice(1)}function xb(a){const e=document.createDocumentFragment(),t=document.createElement("div");return e.appendChild(t),t.innerHTML=a,e.firstChild.innerText}function Lb(a){const e=document.createElement("div");return e.appendChild(a),e.innerHTML}const Xp={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},Lt={get(a="",e={}){if(C.empty(a)||C.empty(e))return"";let t=Ry(e.i18n,a);if(C.empty(t))return Object.keys(Xp).includes(a)?Xp[a]:"";const i={"{seektime}":e.seekTime,"{title}":e.title};return Object.entries(i).forEach(([r,l])=>{t=xa(t,r,l)}),t}};class Ca{constructor(e){ce(this,"get",t=>{if(!Ca.supported||!this.enabled)return null;const i=window.localStorage.getItem(this.key);if(C.empty(i))return null;const r=JSON.parse(i);return C.string(t)&&t.length?r[t]:r}),ce(this,"set",t=>{if(!Ca.supported||!this.enabled||!C.object(t))return;let i=this.get();C.empty(i)&&(i={}),ht(i,t);try{window.localStorage.setItem(this.key,JSON.stringify(i))}catch{}}),this.enabled=e.config.storage.enabled,this.key=e.config.storage.key}static get supported(){try{if(!("localStorage"in window))return!1;const e="___test";return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}}function Ga(a,e="text"){return new Promise((t,i)=>{try{const r=new XMLHttpRequest;if(!("withCredentials"in r))return;r.addEventListener("load",()=>{if(e==="text")try{t(JSON.parse(r.responseText))}catch{t(r.responseText)}else t(r.response)}),r.addEventListener("error",()=>{throw new Error(r.status)}),r.open("GET",a,!0),r.responseType=e,r.send()}catch(r){i(r)}})}function Oy(a,e){if(!C.string(a))return;const t="cache",i=C.string(e);let r=!1;const l=()=>document.getElementById(e)!==null,o=(c,d)=>{c.innerHTML=d,i&&l()||document.body.insertAdjacentElement("afterbegin",c)};if(!i||!l()){const c=Ca.supported,d=document.createElement("div");if(d.setAttribute("hidden",""),i&&d.setAttribute("id",e),c){const f=window.localStorage.getItem(`${t}-${e}`);if(r=f!==null,r){const g=JSON.parse(f);o(d,g.content)}}Ga(a).then(f=>{if(!C.empty(f)){if(c)try{window.localStorage.setItem(`${t}-${e}`,JSON.stringify({content:f}))}catch{}o(d,f)}}).catch(()=>{})}}const My=a=>Math.trunc(a/60/60%60,10),Rb=a=>Math.trunc(a/60%60,10),_b=a=>Math.trunc(a%60,10);function Yo(a=0,e=!1,t=!1){if(!C.number(a))return Yo(void 0,e,t);const i=c=>`0${c}`.slice(-2);let r=My(a);const l=Rb(a),o=_b(a);return r=e||r>0?`${r}:`:"",`${t&&a>0?"-":""}${r}${i(l)}:${i(o)}`}const oe={getIconUrl(){const a=new URL(this.config.iconUrl,window.location),e=window.location.host?window.location.host:window.top.location.host,t=a.host!==e||Rt.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:t}},findElements(){try{return this.elements.controls=yt.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:Da.call(this,this.config.selectors.buttons.play),pause:yt.call(this,this.config.selectors.buttons.pause),restart:yt.call(this,this.config.selectors.buttons.restart),rewind:yt.call(this,this.config.selectors.buttons.rewind),fastForward:yt.call(this,this.config.selectors.buttons.fastForward),mute:yt.call(this,this.config.selectors.buttons.mute),pip:yt.call(this,this.config.selectors.buttons.pip),airplay:yt.call(this,this.config.selectors.buttons.airplay),settings:yt.call(this,this.config.selectors.buttons.settings),captions:yt.call(this,this.config.selectors.buttons.captions),fullscreen:yt.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=yt.call(this,this.config.selectors.progress),this.elements.inputs={seek:yt.call(this,this.config.selectors.inputs.seek),volume:yt.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:yt.call(this,this.config.selectors.display.buffer),currentTime:yt.call(this,this.config.selectors.display.currentTime),duration:yt.call(this,this.config.selectors.display.duration)},C.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(a){return this.debug.warn("It looks like there is a problem with your custom controls HTML",a),this.toggleNativeControls(!0),!1}},createIcon(a,e){const t="http://www.w3.org/2000/svg",i=oe.getIconUrl.call(this),r=`${i.cors?"":i.url}#${this.config.iconPrefix}`,l=document.createElementNS(t,"svg");Kh(l,ht(e,{"aria-hidden":"true",focusable:"false"}));const o=document.createElementNS(t,"use"),c=`${r}-${a}`;return"href"in o&&o.setAttributeNS("http://www.w3.org/1999/xlink","href",c),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c),l.appendChild(o),l},createLabel(a,e={}){const t=Lt.get(a,this.config);return be("span",{...e,class:[e.class,this.config.classNames.hidden].filter(Boolean).join(" ")},t)},createBadge(a){if(C.empty(a))return null;const e=be("span",{class:this.config.classNames.menu.value});return e.appendChild(be("span",{class:this.config.classNames.menu.badge},a)),e},createButton(a,e){const t=ht({},e);let i=Ab(a);const r={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach(o=>{Object.keys(t).includes(o)&&(r[o]=t[o],delete t[o])}),r.element!=="button"||Object.keys(t).includes("type")||(t.type="button"),Object.keys(t).includes("class")?t.class.split(" ").some(o=>o===this.config.classNames.control)||ht(t,{class:`${t.class} ${this.config.classNames.control}`}):t.class=this.config.classNames.control,a){case"play":r.toggle=!0,r.label="play",r.labelPressed="pause",r.icon="play",r.iconPressed="pause";break;case"mute":r.toggle=!0,r.label="mute",r.labelPressed="unmute",r.icon="volume",r.iconPressed="muted";break;case"captions":r.toggle=!0,r.label="enableCaptions",r.labelPressed="disableCaptions",r.icon="captions-off",r.iconPressed="captions-on";break;case"fullscreen":r.toggle=!0,r.label="enterFullscreen",r.labelPressed="exitFullscreen",r.icon="enter-fullscreen",r.iconPressed="exit-fullscreen";break;case"play-large":t.class+=` ${this.config.classNames.control}--overlaid`,i="play",r.label="play",r.icon="play";break;default:C.empty(r.label)&&(r.label=i),C.empty(r.icon)&&(r.icon=a)}const l=be(r.element);return r.toggle?(l.appendChild(oe.createIcon.call(this,r.iconPressed,{class:"icon--pressed"})),l.appendChild(oe.createIcon.call(this,r.icon,{class:"icon--not-pressed"})),l.appendChild(oe.createLabel.call(this,r.labelPressed,{class:"label--pressed"})),l.appendChild(oe.createLabel.call(this,r.label,{class:"label--not-pressed"}))):(l.appendChild(oe.createIcon.call(this,r.icon)),l.appendChild(oe.createLabel.call(this,r.label))),ht(t,Pi(this.config.selectors.buttons[i],t)),Kh(l,t),i==="play"?(C.array(this.elements.buttons[i])||(this.elements.buttons[i]=[]),this.elements.buttons[i].push(l)):this.elements.buttons[i]=l,l},createRange(a,e){const t=be("input",ht(Pi(this.config.selectors.inputs[a]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":Lt.get(a,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},e));return this.elements.inputs[a]=t,oe.updateRangeFill.call(this,t),XS.setup(t),t},createProgress(a,e){const t=be("progress",ht(Pi(this.config.selectors.display[a]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},e));if(a!=="volume"){t.appendChild(be("span",null,"0"));const i={played:"played",buffer:"buffered"}[a],r=i?Lt.get(i,this.config):"";t.innerText=`% ${r.toLowerCase()}`}return this.elements.display[a]=t,t},createTime(a,e){const t=Pi(this.config.selectors.display[a],e),i=be("div",ht(t,{class:`${t.class?t.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":Lt.get(a,this.config),role:"timer"}),"00:00");return this.elements.display[a]=i,i},bindMenuItemShortcuts(a,e){Ne.call(this,a,"keydown keyup",t=>{if(![" ","ArrowUp","ArrowDown","ArrowRight"].includes(t.key)||(t.preventDefault(),t.stopPropagation(),t.type==="keydown"))return;const i=mn(a,'[role="menuitemradio"]');if(!i&&[" ","ArrowRight"].includes(t.key))oe.showMenuPanel.call(this,e,!0);else{let r;t.key!==" "&&(t.key==="ArrowDown"||i&&t.key==="ArrowRight"?(r=a.nextElementSibling,C.element(r)||(r=a.parentNode.firstElementChild)):(r=a.previousElementSibling,C.element(r)||(r=a.parentNode.lastElementChild)),dh.call(this,r,!0))}},!1),Ne.call(this,a,"keyup",t=>{t.key==="Return"&&oe.focusFirstMenuItem.call(this,null,!0)})},createMenuItem({value:a,list:e,type:t,title:i,badge:r=null,checked:l=!1}){const o=Pi(this.config.selectors.inputs[t]),c=be("button",ht(o,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${o.class?o.class:""}`.trim(),"aria-checked":l,value:a})),d=be("span");d.innerHTML=i,C.element(r)&&d.appendChild(r),c.appendChild(d),Object.defineProperty(c,"checked",{enumerable:!0,get:()=>c.getAttribute("aria-checked")==="true",set(f){f&&Array.from(c.parentNode.children).filter(g=>mn(g,'[role="menuitemradio"]')).forEach(g=>g.setAttribute("aria-checked","false")),c.setAttribute("aria-checked",f?"true":"false")}}),this.listeners.bind(c,"click keyup",f=>{if(!C.keyboardEvent(f)||f.key===" "){switch(f.preventDefault(),f.stopPropagation(),c.checked=!0,t){case"language":this.currentTrack=Number(a);break;case"quality":this.quality=a;break;case"speed":this.speed=parseFloat(a)}oe.showMenuPanel.call(this,"home",C.keyboardEvent(f))}},t,!1),oe.bindMenuItemShortcuts.call(this,c,t),e.appendChild(c)},formatTime(a=0,e=!1){return C.number(a)?Yo(a,My(this.duration)>0,e):a},updateTimeDisplay(a=null,e=0,t=!1){C.element(a)&&C.number(e)&&(a.innerText=oe.formatTime(e,t))},updateVolume(){this.supported.ui&&(C.element(this.elements.inputs.volume)&&oe.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),C.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||this.volume===0))},setRange(a,e=0){C.element(a)&&(a.value=e,oe.updateRangeFill.call(this,a))},updateProgress(a){if(!this.supported.ui||!C.event(a))return;let e=0;const t=(i,r)=>{const l=C.number(r)?r:0,o=C.element(i)?i:this.elements.display.buffer;if(C.element(o)){o.value=l;const c=o.getElementsByTagName("span")[0];C.element(c)&&(c.childNodes[0].nodeValue=l)}};if(a)switch(a.type){case"timeupdate":case"seeking":case"seeked":e=Sb(this.currentTime,this.duration),a.type==="timeupdate"&&oe.setRange.call(this,this.elements.inputs.seek,e);break;case"playing":case"progress":t(this.elements.display.buffer,100*this.buffered)}},updateRangeFill(a){const e=C.event(a)?a.target:a;if(C.element(e)&&e.getAttribute("type")==="range"){if(mn(e,this.config.selectors.inputs.seek)){e.setAttribute("aria-valuenow",this.currentTime);const t=oe.formatTime(this.currentTime),i=oe.formatTime(this.duration),r=Lt.get("seekLabel",this.config);e.setAttribute("aria-valuetext",r.replace("{currentTime}",t).replace("{duration}",i))}else if(mn(e,this.config.selectors.inputs.volume)){const t=100*e.value;e.setAttribute("aria-valuenow",t),e.setAttribute("aria-valuetext",`${t.toFixed(1)}%`)}else e.setAttribute("aria-valuenow",e.value);(Rt.isWebKit||Rt.isIPadOS)&&e.style.setProperty("--value",e.value/e.max*100+"%")}},updateSeekTooltip(a){var e,t;if(!this.config.tooltips.seek||!C.element(this.elements.inputs.seek)||!C.element(this.elements.display.seekTooltip)||this.duration===0)return;const i=this.elements.display.seekTooltip,r=`${this.config.classNames.tooltip}--visible`,l=g=>He(i,r,g);if(this.touch)return void l(!1);let o=0;const c=this.elements.progress.getBoundingClientRect();if(C.event(a))o=100/c.width*(a.pageX-c.left);else{if(!ko(i,r))return;o=parseFloat(i.style.left,10)}o<0?o=0:o>100&&(o=100);const d=this.duration/100*o;i.innerText=oe.formatTime(d);const f=(e=this.config.markers)===null||e===void 0||(t=e.points)===null||t===void 0?void 0:t.find(({time:g})=>g===Math.round(d));f&&i.insertAdjacentHTML("afterbegin",`${f.label}<br>`),i.style.left=`${o}%`,C.event(a)&&["mouseenter","mouseleave"].includes(a.type)&&l(a.type==="mouseenter")},timeUpdate(a){const e=!C.element(this.elements.display.duration)&&this.config.invertTime;oe.updateTimeDisplay.call(this,this.elements.display.currentTime,e?this.duration-this.currentTime:this.currentTime,e),a&&a.type==="timeupdate"&&this.media.seeking||oe.updateProgress.call(this,a)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32)return fn(this.elements.display.currentTime,!0),void fn(this.elements.progress,!0);C.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);const a=C.element(this.elements.display.duration);!a&&this.config.displayDuration&&this.paused&&oe.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),a&&oe.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),this.config.markers.enabled&&oe.setMarkers.call(this),oe.updateSeekTooltip.call(this)},toggleMenuButton(a,e){fn(this.elements.settings.buttons[a],!e)},updateSetting(a,e,t){const i=this.elements.settings.panels[a];let r=null,l=e;if(a==="captions")r=this.currentTrack;else{if(r=C.empty(t)?this[a]:t,C.empty(r)&&(r=this.config[a].default),!C.empty(this.options[a])&&!this.options[a].includes(r))return void this.debug.warn(`Unsupported value of '${r}' for ${a}`);if(!this.config[a].options.includes(r))return void this.debug.warn(`Disabled value of '${r}' for ${a}`)}if(C.element(l)||(l=i&&i.querySelector('[role="menu"]')),!C.element(l))return;this.elements.settings.buttons[a].querySelector(`.${this.config.classNames.menu.value}`).innerHTML=oe.getLabel.call(this,a,r);const o=l&&l.querySelector(`[value="${r}"]`);C.element(o)&&(o.checked=!0)},getLabel(a,e){switch(a){case"speed":return e===1?Lt.get("normal",this.config):`${e}&times;`;case"quality":if(C.number(e)){const t=Lt.get(`qualityLabel.${e}`,this.config);return t.length?t:`${e}p`}return ky(e);case"captions":return Be.getLabel.call(this);default:return null}},setQualityMenu(a){if(!C.element(this.elements.settings.panels.quality))return;const e="quality",t=this.elements.settings.panels.quality.querySelector('[role="menu"]');C.array(a)&&(this.options.quality=zh(a).filter(l=>this.config.quality.options.includes(l)));const i=!C.empty(this.options.quality)&&this.options.quality.length>1;if(oe.toggleMenuButton.call(this,e,i),To(t),oe.checkMenu.call(this),!i)return;const r=l=>{const o=Lt.get(`qualityBadge.${l}`,this.config);return o.length?oe.createBadge.call(this,o):null};this.options.quality.sort((l,o)=>{const c=this.config.quality.options;return c.indexOf(l)>c.indexOf(o)?1:-1}).forEach(l=>{oe.createMenuItem.call(this,{value:l,list:t,type:e,title:oe.getLabel.call(this,"quality",l),badge:r(l)})}),oe.updateSetting.call(this,e,t)},setCaptionsMenu(){if(!C.element(this.elements.settings.panels.captions))return;const a="captions",e=this.elements.settings.panels.captions.querySelector('[role="menu"]'),t=Be.getTracks.call(this),i=!!t.length;if(oe.toggleMenuButton.call(this,a,i),To(e),oe.checkMenu.call(this),!i)return;const r=t.map((l,o)=>({value:o,checked:this.captions.toggled&&this.currentTrack===o,title:Be.getLabel.call(this,l),badge:l.language&&oe.createBadge.call(this,l.language.toUpperCase()),list:e,type:"language"}));r.unshift({value:-1,checked:!this.captions.toggled,title:Lt.get("disabled",this.config),list:e,type:"language"}),r.forEach(oe.createMenuItem.bind(this)),oe.updateSetting.call(this,a,e)},setSpeedMenu(){if(!C.element(this.elements.settings.panels.speed))return;const a="speed",e=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter(i=>i>=this.minimumSpeed&&i<=this.maximumSpeed);const t=!C.empty(this.options.speed)&&this.options.speed.length>1;oe.toggleMenuButton.call(this,a,t),To(e),oe.checkMenu.call(this),t&&(this.options.speed.forEach(i=>{oe.createMenuItem.call(this,{value:i,list:e,type:a,title:oe.getLabel.call(this,"speed",i)})}),oe.updateSetting.call(this,a,e))},checkMenu(){const{buttons:a}=this.elements.settings,e=!C.empty(a)&&Object.values(a).some(t=>!t.hidden);fn(this.elements.settings.menu,!e)},focusFirstMenuItem(a,e=!1){if(this.elements.settings.popup.hidden)return;let t=a;C.element(t)||(t=Object.values(this.elements.settings.panels).find(r=>!r.hidden));const i=t.querySelector('[role^="menuitem"]');dh.call(this,i,e)},toggleMenu(a){const{popup:e}=this.elements.settings,t=this.elements.buttons.settings;if(!C.element(e)||!C.element(t))return;const{hidden:i}=e;let r=i;if(C.boolean(a))r=a;else if(C.keyboardEvent(a)&&a.key==="Escape")r=!1;else if(C.event(a)){const l=C.function(a.composedPath)?a.composedPath()[0]:a.target,o=e.contains(l);if(o||!o&&a.target!==t&&r)return}t.setAttribute("aria-expanded",r),fn(e,!r),He(this.elements.container,this.config.classNames.menu.open,r),r&&C.keyboardEvent(a)?oe.focusFirstMenuItem.call(this,null,!0):r||i||dh.call(this,t,C.keyboardEvent(a))},getMenuSize(a){const e=a.cloneNode(!0);e.style.position="absolute",e.style.opacity=0,e.removeAttribute("hidden"),a.parentNode.appendChild(e);const t=e.scrollWidth,i=e.scrollHeight;return cs(e),{width:t,height:i}},showMenuPanel(a="",e=!1){const t=this.elements.container.querySelector(`#plyr-settings-${this.id}-${a}`);if(!C.element(t))return;const i=t.parentNode,r=Array.from(i.children).find(l=>!l.hidden);if(ft.transitions&&!ft.reducedMotion){i.style.width=`${r.scrollWidth}px`,i.style.height=`${r.scrollHeight}px`;const l=oe.getMenuSize.call(this,t),o=c=>{c.target===i&&["width","height"].includes(c.propertyName)&&(i.style.width="",i.style.height="",qo.call(this,i,Vh,o))};Ne.call(this,i,Vh,o),i.style.width=`${l.width}px`,i.style.height=`${l.height}px`}fn(r,!0),fn(t,!1),oe.focusFirstMenuItem.call(this,t,e)},setDownloadUrl(){const a=this.elements.buttons.download;C.element(a)&&a.setAttribute("href",this.download)},create(a){const{bindMenuItemShortcuts:e,createButton:t,createProgress:i,createRange:r,createTime:l,setQualityMenu:o,setSpeedMenu:c,showMenuPanel:d}=oe;this.elements.controls=null,C.array(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(t.call(this,"play-large"));const f=be("div",Pi(this.config.selectors.controls.wrapper));this.elements.controls=f;const g={class:"plyr__controls__item"};return zh(C.array(this.config.controls)?this.config.controls:[]).forEach(p=>{if(p==="restart"&&f.appendChild(t.call(this,"restart",g)),p==="rewind"&&f.appendChild(t.call(this,"rewind",g)),p==="play"&&f.appendChild(t.call(this,"play",g)),p==="fast-forward"&&f.appendChild(t.call(this,"fast-forward",g)),p==="progress"){const v=be("div",{class:`${g.class} plyr__progress__container`}),T=be("div",Pi(this.config.selectors.progress));if(T.appendChild(r.call(this,"seek",{id:`plyr-seek-${a.id}`})),T.appendChild(i.call(this,"buffer")),this.config.tooltips.seek){const E=be("span",{class:this.config.classNames.tooltip},"00:00");T.appendChild(E),this.elements.display.seekTooltip=E}this.elements.progress=T,v.appendChild(this.elements.progress),f.appendChild(v)}if(p==="current-time"&&f.appendChild(l.call(this,"currentTime",g)),p==="duration"&&f.appendChild(l.call(this,"duration",g)),p==="mute"||p==="volume"){let{volume:v}=this.elements;if(C.element(v)&&f.contains(v)||(v=be("div",ht({},g,{class:`${g.class} plyr__volume`.trim()})),this.elements.volume=v,f.appendChild(v)),p==="mute"&&v.appendChild(t.call(this,"mute")),p==="volume"&&!Rt.isIos&&!Rt.isIPadOS){const T={max:1,step:.05,value:this.config.volume};v.appendChild(r.call(this,"volume",ht(T,{id:`plyr-volume-${a.id}`})))}}if(p==="captions"&&f.appendChild(t.call(this,"captions",g)),p==="settings"&&!C.empty(this.config.settings)){const v=be("div",ht({},g,{class:`${g.class} plyr__menu`.trim(),hidden:""}));v.appendChild(t.call(this,"settings",{"aria-haspopup":!0,"aria-controls":`plyr-settings-${a.id}`,"aria-expanded":!1}));const T=be("div",{class:"plyr__menu__container",id:`plyr-settings-${a.id}`,hidden:""}),E=be("div"),A=be("div",{id:`plyr-settings-${a.id}-home`}),b=be("div",{role:"menu"});A.appendChild(b),E.appendChild(A),this.elements.settings.panels.home=A,this.config.settings.forEach(L=>{const _=be("button",ht(Pi(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":!0,hidden:""}));e.call(this,_,L),Ne.call(this,_,"click",()=>{d.call(this,L,!1)});const D=be("span",null,Lt.get(L,this.config)),w=be("span",{class:this.config.classNames.menu.value});w.innerHTML=a[L],D.appendChild(w),_.appendChild(D),b.appendChild(_);const k=be("div",{id:`plyr-settings-${a.id}-${L}`,hidden:""}),$=be("button",{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});$.appendChild(be("span",{"aria-hidden":!0},Lt.get(L,this.config))),$.appendChild(be("span",{class:this.config.classNames.hidden},Lt.get("menuBack",this.config))),Ne.call(this,k,"keydown",M=>{M.key==="ArrowLeft"&&(M.preventDefault(),M.stopPropagation(),d.call(this,"home",!0))},!1),Ne.call(this,$,"click",()=>{d.call(this,"home",!1)}),k.appendChild($),k.appendChild(be("div",{role:"menu"})),E.appendChild(k),this.elements.settings.buttons[L]=_,this.elements.settings.panels[L]=k}),T.appendChild(E),v.appendChild(T),f.appendChild(v),this.elements.settings.popup=T,this.elements.settings.menu=v}if(p==="pip"&&ft.pip&&f.appendChild(t.call(this,"pip",g)),p==="airplay"&&ft.airplay&&f.appendChild(t.call(this,"airplay",g)),p==="download"){const v=ht({},g,{element:"a",href:this.download,target:"_blank"});this.isHTML5&&(v.download="");const{download:T}=this.config.urls;!C.url(T)&&this.isEmbed&&ht(v,{icon:`logo-${this.provider}`,label:this.provider}),f.appendChild(t.call(this,"download",v))}p==="fullscreen"&&f.appendChild(t.call(this,"fullscreen",g))}),this.isHTML5&&o.call(this,Gs.getQualityOptions.call(this)),c.call(this),f},inject(){if(this.config.loadSprite){const r=oe.getIconUrl.call(this);r.cors&&Oy(r.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());let a=null;this.elements.controls=null;const e={id:this.id,seektime:this.config.seekTime,title:this.config.title};let t=!0;C.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this,e)),this.config.controls||(this.config.controls=[]),C.element(this.config.controls)||C.string(this.config.controls)?a=this.config.controls:(a=oe.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:Be.getLabel.call(this)}),t=!1);let i;if(t&&C.string(this.config.controls)&&(a=(r=>{let l=r;return Object.entries(e).forEach(([o,c])=>{l=xa(l,`{${o}}`,c)}),l})(a)),C.string(this.config.selectors.controls.container)&&(i=document.querySelector(this.config.selectors.controls.container)),C.element(i)||(i=this.elements.container),i[C.element(a)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",a),C.element(this.elements.controls)||oe.findElements.call(this),!C.empty(this.elements.buttons)){const r=l=>{const o=this.config.classNames.controlPressed;l.setAttribute("aria-pressed","false"),Object.defineProperty(l,"pressed",{configurable:!0,enumerable:!0,get:()=>ko(l,o),set(c=!1){He(l,o,c),l.setAttribute("aria-pressed",c?"true":"false")}})};Object.values(this.elements.buttons).filter(Boolean).forEach(l=>{C.array(l)||C.nodeList(l)?Array.from(l).filter(Boolean).forEach(r):r(l)})}if(Rt.isEdge&&Ly(i),this.config.tooltips.controls){const{classNames:r,selectors:l}=this.config,o=`${l.controls.wrapper} ${l.labels} .${r.hidden}`,c=Da.call(this,o);Array.from(c).forEach(d=>{He(d,this.config.classNames.hidden,!1),He(d,this.config.classNames.tooltip,!0)})}},setMediaMetadata(){try{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork}))}catch{}},setMarkers(){var a,e;if(!this.duration||this.elements.markers)return;const t=(a=this.config.markers)===null||a===void 0||(e=a.points)===null||e===void 0?void 0:e.filter(({time:d})=>d>0&&d<this.duration);if(t==null||!t.length)return;const i=document.createDocumentFragment(),r=document.createDocumentFragment();let l=null;const o=`${this.config.classNames.tooltip}--visible`,c=d=>He(l,o,d);t.forEach(d=>{const f=be("span",{class:this.config.classNames.marker},""),g=d.time/this.duration*100+"%";l&&(f.addEventListener("mouseenter",()=>{d.label||(l.style.left=g,l.innerHTML=d.label,c(!0))}),f.addEventListener("mouseleave",()=>{c(!1)})),f.addEventListener("click",()=>{this.currentTime=d.time}),f.style.left=g,r.appendChild(f)}),i.appendChild(r),this.config.tooltips.seek||(l=be("span",{class:this.config.classNames.tooltip},""),i.appendChild(l)),this.elements.markers={points:r,tip:l},this.elements.progress.appendChild(i)}};function Py(a,e=!0){let t=a;if(e){const i=document.createElement("a");i.href=t,t=i.href}try{return new URL(t)}catch{return null}}function Ny(a){const e=new URLSearchParams;return C.object(a)&&Object.entries(a).forEach(([t,i])=>{e.set(t,i)}),e}const Be={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!ft.textTracks)return void(C.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&oe.setCaptionsMenu.call(this));if(C.element(this.elements.captions)||(this.elements.captions=be("div",Pi(this.config.selectors.captions)),this.elements.captions.setAttribute("dir","auto"),gb(this.elements.captions,this.elements.wrapper)),Rt.isIE&&window.URL){const i=this.media.querySelectorAll("track");Array.from(i).forEach(r=>{const l=r.getAttribute("src"),o=Py(l);o!==null&&o.hostname!==window.location.href.hostname&&["http:","https:"].includes(o.protocol)&&Ga(l,"blob").then(c=>{r.setAttribute("src",window.URL.createObjectURL(c))}).catch(()=>{cs(r)})})}const a=zh((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map(i=>i.split("-")[0]));let e=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();e==="auto"&&([e]=a);let t=this.storage.get("captions");if(C.boolean(t)||({active:t}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:t,language:e,languages:a}),this.isHTML5){const i=this.config.captions.update?"addtrack removetrack":"removetrack";Ne.call(this,this.media.textTracks,i,Be.update.bind(this))}setTimeout(Be.update.bind(this),0)},update(){const a=Be.getTracks.call(this,!0),{active:e,language:t,meta:i,currentTrackNode:r}=this.captions,l=!!a.find(o=>o.language===t);this.isHTML5&&this.isVideo&&a.filter(o=>!i.get(o)).forEach(o=>{this.debug.log("Track added",o),i.set(o,{default:o.mode==="showing"}),o.mode==="showing"&&(o.mode="hidden"),Ne.call(this,o,"cuechange",()=>Be.updateCues.call(this))}),(l&&this.language!==t||!a.includes(r))&&(Be.setLanguage.call(this,t),Be.toggle.call(this,e&&l)),this.elements&&He(this.elements.container,this.config.classNames.captions.enabled,!C.empty(a)),C.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&oe.setCaptionsMenu.call(this)},toggle(a,e=!0){if(!this.supported.ui)return;const{toggled:t}=this.captions,i=this.config.classNames.captions.active,r=C.nullOrUndefined(a)?!t:a;if(r!==t){if(e||(this.captions.active=r,this.storage.set({captions:r})),!this.language&&r&&!e){const l=Be.getTracks.call(this),o=Be.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);return this.captions.language=o.language,void Be.set.call(this,l.indexOf(o))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=r),He(this.elements.container,i,r),this.captions.toggled=r,oe.updateSetting.call(this,"captions"),xe.call(this,this.media,r?"captionsenabled":"captionsdisabled")}setTimeout(()=>{r&&this.captions.toggled&&(this.captions.currentTrackNode.mode="hidden")})},set(a,e=!0){const t=Be.getTracks.call(this);if(a!==-1)if(C.number(a))if(a in t){if(this.captions.currentTrack!==a){this.captions.currentTrack=a;const i=t[a],{language:r}=i||{};this.captions.currentTrackNode=i,oe.updateSetting.call(this,"captions"),e||(this.captions.language=r,this.storage.set({language:r})),this.isVimeo&&this.embed.enableTextTrack(r),xe.call(this,this.media,"languagechange")}Be.toggle.call(this,!0,e),this.isHTML5&&this.isVideo&&Be.updateCues.call(this)}else this.debug.warn("Track not found",a);else this.debug.warn("Invalid caption argument",a);else Be.toggle.call(this,!1,e)},setLanguage(a,e=!0){if(!C.string(a))return void this.debug.warn("Invalid language argument",a);const t=a.toLowerCase();this.captions.language=t;const i=Be.getTracks.call(this),r=Be.findTrack.call(this,[t]);Be.set.call(this,i.indexOf(r),e)},getTracks(a=!1){return Array.from((this.media||{}).textTracks||[]).filter(e=>!this.isHTML5||a||this.captions.meta.has(e)).filter(e=>["captions","subtitles"].includes(e.kind))},findTrack(a,e=!1){const t=Be.getTracks.call(this),i=o=>Number((this.captions.meta.get(o)||{}).default),r=Array.from(t).sort((o,c)=>i(c)-i(o));let l;return a.every(o=>(l=r.find(c=>c.language===o),!l)),l||(e?r[0]:void 0)},getCurrentTrack(){return Be.getTracks.call(this)[this.currentTrack]},getLabel(a){let e=a;return!C.track(e)&&ft.textTracks&&this.captions.toggled&&(e=Be.getCurrentTrack.call(this)),C.track(e)?C.empty(e.label)?C.empty(e.language)?Lt.get("enabled",this.config):a.language.toUpperCase():e.label:Lt.get("disabled",this.config)},updateCues(a){if(!this.supported.ui)return;if(!C.element(this.elements.captions))return void this.debug.warn("No captions element to render to");if(!C.nullOrUndefined(a)&&!Array.isArray(a))return void this.debug.warn("updateCues: Invalid input",a);let e=a;if(!e){const i=Be.getCurrentTrack.call(this);e=Array.from((i||{}).activeCues||[]).map(r=>r.getCueAsHTML()).map(Lb)}const t=e.map(i=>i.trim()).join(`
`);if(t!==this.elements.captions.innerHTML){To(this.elements.captions);const i=be("span",Pi(this.config.selectors.caption));i.innerHTML=t,this.elements.captions.appendChild(i),xe.call(this,this.media,"cuechange")}}},Uy={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.7.8/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",marker:"plyr__progress__marker",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id",hash:"data-plyr-embed-hash"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:""},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1},mediaMetadata:{title:"",artist:"",album:"",artwork:[]},markers:{enabled:!1,points:[]}},gh={active:"picture-in-picture",inactive:"inline"},$s={html5:"html5",youtube:"youtube",vimeo:"vimeo"},mh={audio:"audio",video:"video"};function Db(a){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(a)?$s.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(a)?$s.vimeo:null}const ph=()=>{};class Ib{constructor(e=!1){this.enabled=window.console&&e,this.enabled&&this.log("Debugging enabled")}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):ph}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):ph}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):ph}}class xi{constructor(e){ce(this,"onChange",()=>{if(!this.supported)return;const t=this.player.elements.buttons.fullscreen;C.element(t)&&(t.pressed=this.active);const i=this.target===this.player.media?this.target:this.player.elements.container;xe.call(this.player,i,this.active?"enterfullscreen":"exitfullscreen",!0)}),ce(this,"toggleFallback",(t=!1)=>{if(t?this.scrollPosition={x:window.scrollX??0,y:window.scrollY??0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=t?"hidden":"",He(this.target,this.player.config.classNames.fullscreen.fallback,t),Rt.isIos){let i=document.head.querySelector('meta[name="viewport"]');const r="viewport-fit=cover";i||(i=document.createElement("meta"),i.setAttribute("name","viewport"));const l=C.string(i.content)&&i.content.includes(r);t?(this.cleanupViewport=!l,l||(i.content+=`,${r}`)):this.cleanupViewport&&(i.content=i.content.split(",").filter(o=>o.trim()!==r).join(","))}this.onChange()}),ce(this,"trapFocus",t=>{if(Rt.isIos||Rt.isIPadOS||!this.active||t.key!=="Tab")return;const i=document.activeElement,r=Da.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),[l]=r,o=r[r.length-1];i!==o||t.shiftKey?i===l&&t.shiftKey&&(o.focus(),t.preventDefault()):(l.focus(),t.preventDefault())}),ce(this,"update",()=>{if(this.supported){let t;t=this.forceFallback?"Fallback (forced)":xi.nativeSupported?"Native":"Fallback",this.player.debug.log(`${t} fullscreen enabled`)}else this.player.debug.log("Fullscreen not supported and fallback disabled");He(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.supported)}),ce(this,"enter",()=>{this.supported&&(Rt.isIos&&this.player.config.fullscreen.iosNative?this.player.isVimeo?this.player.embed.requestFullscreen():this.target.webkitEnterFullscreen():!xi.nativeSupported||this.forceFallback?this.toggleFallback(!0):this.prefix?C.empty(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:"hide"}))}),ce(this,"exit",()=>{if(this.supported)if(Rt.isIos&&this.player.config.fullscreen.iosNative)this.player.isVimeo?this.player.embed.exitFullscreen():this.target.webkitEnterFullscreen(),Fi(this.player.play());else if(!xi.nativeSupported||this.forceFallback)this.toggleFallback(!1);else if(this.prefix){if(!C.empty(this.prefix)){const t=this.prefix==="moz"?"Cancel":"Exit";document[`${this.prefix}${t}${this.property}`]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document)}),ce(this,"toggle",()=>{this.active?this.exit():this.enter()}),this.player=e,this.prefix=xi.prefix,this.property=xi.property,this.scrollPosition={x:0,y:0},this.forceFallback=e.config.fullscreen.fallback==="force",this.player.elements.fullscreen=e.config.fullscreen.container&&mb(this.player.elements.container,e.config.fullscreen.container),Ne.call(this.player,document,this.prefix==="ms"?"MSFullscreenChange":`${this.prefix}fullscreenchange`,()=>{this.onChange()}),Ne.call(this.player,this.player.elements.container,"dblclick",t=>{C.element(this.player.elements.controls)&&this.player.elements.controls.contains(t.target)||this.player.listeners.proxy(t,this.toggle,"fullscreen")}),Ne.call(this,this.player.elements.container,"keydown",t=>this.trapFocus(t)),this.update()}static get nativeSupported(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get useNative(){return xi.nativeSupported&&!this.forceFallback}static get prefix(){if(C.function(document.exitFullscreen))return"";let e="";return["webkit","moz","ms"].some(t=>!(!C.function(document[`${t}ExitFullscreen`])&&!C.function(document[`${t}CancelFullScreen`]))&&(e=t,!0)),e}static get property(){return this.prefix==="moz"?"FullScreen":"Fullscreen"}get supported(){return[this.player.config.fullscreen.enabled,this.player.isVideo,xi.nativeSupported||this.player.config.fullscreen.fallback,!this.player.isYouTube||xi.nativeSupported||!Rt.isIos||this.player.config.playsinline&&!this.player.config.fullscreen.iosNative].every(Boolean)}get active(){if(!this.supported)return!1;if(!xi.nativeSupported||this.forceFallback)return ko(this.target,this.player.config.classNames.fullscreen.fallback);const e=this.prefix?this.target.getRootNode()[`${this.prefix}${this.property}Element`]:this.target.getRootNode().fullscreenElement;return e&&e.shadowRoot?e===this.target.getRootNode().host:e===this.target}get target(){return Rt.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen??this.player.elements.container}}function Eo(a,e=1){return new Promise((t,i)=>{const r=new Image,l=()=>{delete r.onload,delete r.onerror,(r.naturalWidth>=e?t:i)(r)};Object.assign(r,{onload:l,onerror:l,src:a})})}const We={addStyleHook(){He(this.elements.container,this.config.selectors.container.replace(".",""),!0),He(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(a=!1){a&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build(){if(this.listeners.media(),!this.supported.ui)return this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),void We.toggleNativeControls.call(this,!0);C.element(this.elements.controls)||(oe.inject.call(this),this.listeners.controls()),We.toggleNativeControls.call(this),this.isHTML5&&Be.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,oe.updateVolume.call(this),oe.timeUpdate.call(this),oe.durationUpdate.call(this),We.checkPlaying.call(this),He(this.elements.container,this.config.classNames.pip.supported,ft.pip&&this.isHTML5&&this.isVideo),He(this.elements.container,this.config.classNames.airplay.supported,ft.airplay&&this.isHTML5),He(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(()=>{xe.call(this,this.media,"ready")},0),We.setTitle.call(this),this.poster&&We.setPoster.call(this,this.poster,!1).catch(()=>{}),this.config.duration&&oe.durationUpdate.call(this),this.config.mediaMetadata&&oe.setMediaMetadata.call(this)},setTitle(){let a=Lt.get("play",this.config);if(C.string(this.config.title)&&!C.empty(this.config.title)&&(a+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach(e=>{e.setAttribute("aria-label",a)}),this.isEmbed){const e=yt.call(this,"iframe");if(!C.element(e))return;const t=C.empty(this.config.title)?"video":this.config.title,i=Lt.get("frameTitle",this.config);e.setAttribute("title",i.replace("{title}",t))}},togglePoster(a){He(this.elements.container,this.config.classNames.posterEnabled,a)},setPoster(a,e=!0){return e&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",a),this.elements.poster.removeAttribute("hidden"),vb.call(this).then(()=>Eo(a)).catch(t=>{throw a===this.poster&&We.togglePoster.call(this,!1),t}).then(()=>{if(a!==this.poster)throw new Error("setPoster cancelled by later call to setPoster")}).then(()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${a}')`,backgroundSize:""}),We.togglePoster.call(this,!0),a)))},checkPlaying(a){He(this.elements.container,this.config.classNames.playing,this.playing),He(this.elements.container,this.config.classNames.paused,this.paused),He(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(e=>{Object.assign(e,{pressed:this.playing}),e.setAttribute("aria-label",Lt.get(this.playing?"pause":"play",this.config))}),C.event(a)&&a.type==="timeupdate"||We.toggleControls.call(this)},checkLoading(a){this.loading=["stalled","waiting"].includes(a.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(()=>{He(this.elements.container,this.config.classNames.loading,this.loading),We.toggleControls.call(this)},this.loading?250:0)},toggleControls(a){const{controls:e}=this.elements;if(e&&this.config.hideControls){const t=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(!!(a||this.loading||this.paused||e.pressed||e.hover||t))}},migrateStyles(){Object.values({...this.media.style}).filter(a=>!C.empty(a)&&C.string(a)&&a.startsWith("--plyr")).forEach(a=>{this.elements.container.style.setProperty(a,this.media.style.getPropertyValue(a)),this.media.style.removeProperty(a)}),C.empty(this.media.style)&&this.media.removeAttribute("style")}};class Cb{constructor(e){ce(this,"firstTouch",()=>{const{player:t}=this,{elements:i}=t;t.touch=!0,He(i.container,t.config.classNames.isTouch,!0)}),ce(this,"global",(t=!0)=>{const{player:i}=this;i.config.keyboard.global&&Ia.call(i,window,"keydown keyup",this.handleKey,t,!1),Ia.call(i,document.body,"click",this.toggleMenu,t),vf.call(i,document.body,"touchstart",this.firstTouch)}),ce(this,"container",()=>{const{player:t}=this,{config:i,elements:r,timers:l}=t;!i.keyboard.global&&i.keyboard.focused&&Ne.call(t,r.container,"keydown keyup",this.handleKey,!1),Ne.call(t,r.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",d=>{const{controls:f}=r;f&&d.type==="enterfullscreen"&&(f.pressed=!1,f.hover=!1);let g=0;["touchstart","touchmove","mousemove"].includes(d.type)&&(We.toggleControls.call(t,!0),g=t.touch?3e3:2e3),clearTimeout(l.controls),l.controls=setTimeout(()=>We.toggleControls.call(t,!1),g)});const o=()=>{if(!t.isVimeo||t.config.vimeo.premium)return;const d=r.wrapper,{active:f}=t.fullscreen,[g,p]=Tf.call(t),v=Iy(`aspect-ratio: ${g} / ${p}`);if(!f)return void(v?(d.style.width=null,d.style.height=null):(d.style.maxWidth=null,d.style.margin=null));const[T,E]=Tb(),A=T/E>g/p;v?(d.style.width=A?"auto":"100%",d.style.height=A?"100%":"auto"):(d.style.maxWidth=A?E/p*g+"px":null,d.style.margin=A?"0 auto":null)},c=()=>{clearTimeout(l.resized),l.resized=setTimeout(o,50)};Ne.call(t,r.container,"enterfullscreen exitfullscreen",d=>{const{target:f}=t.fullscreen;f===r.container&&(!t.isEmbed&&C.empty(t.config.ratio)||(o(),(d.type==="enterfullscreen"?Ne:qo).call(t,window,"resize",c)))})}),ce(this,"media",()=>{const{player:t}=this,{elements:i}=t;if(Ne.call(t,t.media,"timeupdate seeking seeked",l=>oe.timeUpdate.call(t,l)),Ne.call(t,t.media,"durationchange loadeddata loadedmetadata",l=>oe.durationUpdate.call(t,l)),Ne.call(t,t.media,"ended",()=>{t.isHTML5&&t.isVideo&&t.config.resetOnEnd&&(t.restart(),t.pause())}),Ne.call(t,t.media,"progress playing seeking seeked",l=>oe.updateProgress.call(t,l)),Ne.call(t,t.media,"volumechange",l=>oe.updateVolume.call(t,l)),Ne.call(t,t.media,"playing play pause ended emptied timeupdate",l=>We.checkPlaying.call(t,l)),Ne.call(t,t.media,"waiting canplay seeked playing",l=>We.checkLoading.call(t,l)),t.supported.ui&&t.config.clickToPlay&&!t.isAudio){const l=yt.call(t,`.${t.config.classNames.video}`);if(!C.element(l))return;Ne.call(t,i.container,"click",o=>{([i.container,l].includes(o.target)||l.contains(o.target))&&(t.touch&&t.config.hideControls||(t.ended?(this.proxy(o,t.restart,"restart"),this.proxy(o,()=>{Fi(t.play())},"play")):this.proxy(o,()=>{Fi(t.togglePlay())},"play")))})}t.supported.ui&&t.config.disableContextMenu&&Ne.call(t,i.wrapper,"contextmenu",l=>{l.preventDefault()},!1),Ne.call(t,t.media,"volumechange",()=>{t.storage.set({volume:t.volume,muted:t.muted})}),Ne.call(t,t.media,"ratechange",()=>{oe.updateSetting.call(t,"speed"),t.storage.set({speed:t.speed})}),Ne.call(t,t.media,"qualitychange",l=>{oe.updateSetting.call(t,"quality",null,l.detail.quality)}),Ne.call(t,t.media,"ready qualitychange",()=>{oe.setDownloadUrl.call(t)});const r=t.config.events.concat(["keyup","keydown"]).join(" ");Ne.call(t,t.media,r,l=>{let{detail:o={}}=l;l.type==="error"&&(o=t.media.error),xe.call(t,i.container,l.type,!0,o)})}),ce(this,"proxy",(t,i,r)=>{const{player:l}=this,o=l.config.listeners[r];let c=!0;C.function(o)&&(c=o.call(l,t)),c!==!1&&C.function(i)&&i.call(l,t)}),ce(this,"bind",(t,i,r,l,o=!0)=>{const{player:c}=this,d=c.config.listeners[l],f=C.function(d);Ne.call(c,t,i,g=>this.proxy(g,r,l),o&&!f)}),ce(this,"controls",()=>{const{player:t}=this,{elements:i}=t,r=Rt.isIE?"change":"input";if(i.buttons.play&&Array.from(i.buttons.play).forEach(l=>{this.bind(l,"click",()=>{Fi(t.togglePlay())},"play")}),this.bind(i.buttons.restart,"click",t.restart,"restart"),this.bind(i.buttons.rewind,"click",()=>{t.lastSeekTime=Date.now(),t.rewind()},"rewind"),this.bind(i.buttons.fastForward,"click",()=>{t.lastSeekTime=Date.now(),t.forward()},"fastForward"),this.bind(i.buttons.mute,"click",()=>{t.muted=!t.muted},"mute"),this.bind(i.buttons.captions,"click",()=>t.toggleCaptions()),this.bind(i.buttons.download,"click",()=>{xe.call(t,t.media,"download")},"download"),this.bind(i.buttons.fullscreen,"click",()=>{t.fullscreen.toggle()},"fullscreen"),this.bind(i.buttons.pip,"click",()=>{t.pip="toggle"},"pip"),this.bind(i.buttons.airplay,"click",t.airplay,"airplay"),this.bind(i.buttons.settings,"click",l=>{l.stopPropagation(),l.preventDefault(),oe.toggleMenu.call(t,l)},null,!1),this.bind(i.buttons.settings,"keyup",l=>{[" ","Enter"].includes(l.key)&&(l.key!=="Enter"?(l.preventDefault(),l.stopPropagation(),oe.toggleMenu.call(t,l)):oe.focusFirstMenuItem.call(t,null,!0))},null,!1),this.bind(i.settings.menu,"keydown",l=>{l.key==="Escape"&&oe.toggleMenu.call(t,l)}),this.bind(i.inputs.seek,"mousedown mousemove",l=>{const o=i.progress.getBoundingClientRect(),c=100/o.width*(l.pageX-o.left);l.currentTarget.setAttribute("seek-value",c)}),this.bind(i.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",l=>{const o=l.currentTarget,c="play-on-seeked";if(C.keyboardEvent(l)&&!["ArrowLeft","ArrowRight"].includes(l.key))return;t.lastSeekTime=Date.now();const d=o.hasAttribute(c),f=["mouseup","touchend","keyup"].includes(l.type);d&&f?(o.removeAttribute(c),Fi(t.play())):!f&&t.playing&&(o.setAttribute(c,""),t.pause())}),Rt.isIos){const l=Da.call(t,'input[type="range"]');Array.from(l).forEach(o=>this.bind(o,r,c=>Ly(c.target)))}this.bind(i.inputs.seek,r,l=>{const o=l.currentTarget;let c=o.getAttribute("seek-value");C.empty(c)&&(c=o.value),o.removeAttribute("seek-value"),t.currentTime=c/o.max*t.duration},"seek"),this.bind(i.progress,"mouseenter mouseleave mousemove",l=>oe.updateSeekTooltip.call(t,l)),this.bind(i.progress,"mousemove touchmove",l=>{const{previewThumbnails:o}=t;o&&o.loaded&&o.startMove(l)}),this.bind(i.progress,"mouseleave touchend click",()=>{const{previewThumbnails:l}=t;l&&l.loaded&&l.endMove(!1,!0)}),this.bind(i.progress,"mousedown touchstart",l=>{const{previewThumbnails:o}=t;o&&o.loaded&&o.startScrubbing(l)}),this.bind(i.progress,"mouseup touchend",l=>{const{previewThumbnails:o}=t;o&&o.loaded&&o.endScrubbing(l)}),Rt.isWebKit&&Array.from(Da.call(t,'input[type="range"]')).forEach(l=>{this.bind(l,"input",o=>oe.updateRangeFill.call(t,o.target))}),t.config.toggleInvert&&!C.element(i.display.duration)&&this.bind(i.display.currentTime,"click",()=>{t.currentTime!==0&&(t.config.invertTime=!t.config.invertTime,oe.timeUpdate.call(t))}),this.bind(i.inputs.volume,r,l=>{t.volume=l.target.value},"volume"),this.bind(i.controls,"mouseenter mouseleave",l=>{i.controls.hover=!t.touch&&l.type==="mouseenter"}),i.fullscreen&&Array.from(i.fullscreen.children).filter(l=>!l.contains(i.container)).forEach(l=>{this.bind(l,"mouseenter mouseleave",o=>{i.controls&&(i.controls.hover=!t.touch&&o.type==="mouseenter")})}),this.bind(i.controls,"mousedown mouseup touchstart touchend touchcancel",l=>{i.controls.pressed=["mousedown","touchstart"].includes(l.type)}),this.bind(i.controls,"focusin",()=>{const{config:l,timers:o}=t;He(i.controls,l.classNames.noTransition,!0),We.toggleControls.call(t,!0),setTimeout(()=>{He(i.controls,l.classNames.noTransition,!1)},0);const c=this.touch?3e3:4e3;clearTimeout(o.controls),o.controls=setTimeout(()=>We.toggleControls.call(t,!1),c)}),this.bind(i.inputs.volume,"wheel",l=>{const o=l.webkitDirectionInvertedFromDevice,[c,d]=[l.deltaX,-l.deltaY].map(p=>o?-p:p),f=Math.sign(Math.abs(c)>Math.abs(d)?c:d);t.increaseVolume(f/50);const{volume:g}=t.media;(f===1&&g<1||f===-1&&g>0)&&l.preventDefault()},"volume",!1)}),this.player=e,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(e){const{player:t}=this,{elements:i}=t,{key:r,type:l,altKey:o,ctrlKey:c,metaKey:d,shiftKey:f}=e,g=l==="keydown",p=g&&r===this.lastKey;if(!(o||c||d||f)&&r){if(g){const T=document.activeElement;if(C.element(T)){const{editable:E}=t.config.selectors,{seek:A}=i.inputs;if(T!==A&&mn(T,E)||e.key===" "&&mn(T,'button, [role^="menuitem"]'))return}switch([" ","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","0","1","2","3","4","5","6","7","8","9","c","f","k","l","m"].includes(r)&&(e.preventDefault(),e.stopPropagation()),r){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":p||(v=parseInt(r,10),t.currentTime=t.duration/10*v);break;case" ":case"k":p||Fi(t.togglePlay());break;case"ArrowUp":t.increaseVolume(.1);break;case"ArrowDown":t.decreaseVolume(.1);break;case"m":p||(t.muted=!t.muted);break;case"ArrowRight":t.forward();break;case"ArrowLeft":t.rewind();break;case"f":t.fullscreen.toggle();break;case"c":p||t.toggleCaptions();break;case"l":t.loop=!t.loop}r==="Escape"&&!t.fullscreen.usingNative&&t.fullscreen.active&&t.fullscreen.toggle(),this.lastKey=r}else this.lastKey=null;var v}}toggleMenu(e){oe.toggleMenu.call(this.player,e)}}function wb(a,e){return a(e={exports:{}},e.exports),e.exports}var kb=wb(function(a,e){a.exports=function(){var t=function(){},i={},r={},l={};function o(v,T){v=v.push?v:[v];var E,A,b,L=[],_=v.length,D=_;for(E=function(w,k){k.length&&L.push(w),--D||T(L)};_--;)A=v[_],(b=r[A])?E(A,b):(l[A]=l[A]||[]).push(E)}function c(v,T){if(v){var E=l[v];if(r[v]=T,E)for(;E.length;)E[0](v,T),E.splice(0,1)}}function d(v,T){v.call&&(v={success:v}),T.length?(v.error||t)(T):(v.success||t)(v)}function f(v,T,E,A){var b,L,_=document,D=E.async,w=(E.numRetries||0)+1,k=E.before||t,$=v.replace(/[\?|#].*$/,""),M=v.replace(/^(css|img)!/,"");A=A||0,/(^css!|\.css$)/.test($)?((L=_.createElement("link")).rel="stylesheet",L.href=M,(b="hideFocus"in L)&&L.relList&&(b=0,L.rel="preload",L.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test($)?(L=_.createElement("img")).src=M:((L=_.createElement("script")).src=v,L.async=D===void 0||D),L.onload=L.onerror=L.onbeforeload=function(B){var V=B.type[0];if(b)try{L.sheet.cssText.length||(V="e")}catch(U){U.code!=18&&(V="e")}if(V=="e"){if((A+=1)<w)return f(v,T,E,A)}else if(L.rel=="preload"&&L.as=="style")return L.rel="stylesheet";T(v,V,B.defaultPrevented)},k(v,L)!==!1&&_.head.appendChild(L)}function g(v,T,E){var A,b,L=(v=v.push?v:[v]).length,_=L,D=[];for(A=function(w,k,$){if(k=="e"&&D.push(w),k=="b"){if(!$)return;D.push(w)}--L||T(D)},b=0;b<_;b++)f(v[b],A,E)}function p(v,T,E){var A,b;if(T&&T.trim&&(A=T),b=(A?E:T)||{},A){if(A in i)throw"LoadJS";i[A]=!0}function L(_,D){g(v,function(w){d(b,w),_&&d({success:_,error:D},w),c(A,w)},b)}if(b.returnPromise)return new Promise(L);L()}return p.ready=function(v,T){return o(v,function(E){d(T,E)}),p},p.done=function(v){c(v,[])},p.reset=function(){i={},r={},l={}},p.isDefined=function(v){return v in i},p}()});function Ef(a){return new Promise((e,t)=>{kb(a,{success:e,error:t})})}function Ob(a){return C.empty(a)?null:C.number(Number(a))?a:a.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:a}function Mb(a){const e=a.match(/^.*(vimeo.com\/|video\/)(\d+)(\?.*&*h=|\/)+([\d,a-f]+)/);return e&&e.length===5?e[4]:null}function Ta(a){a&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===a&&(this.media.paused=!a,xe.call(this,this.media,a?"play":"pause"))}const Yh={setup(){const a=this;He(a.elements.wrapper,a.config.classNames.embed,!0),a.options.speed=a.config.speed.options,mr.call(a),C.object(window.Vimeo)?Yh.ready.call(a):Ef(a.config.urls.vimeo.sdk).then(()=>{Yh.ready.call(a)}).catch(e=>{a.debug.warn("Vimeo SDK (player.js) failed to load",e)})},ready(){const a=this,e=a.config.vimeo,{premium:t,referrerPolicy:i,...r}=e;let l=a.media.getAttribute("src"),o="";C.empty(l)?(l=a.media.getAttribute(a.config.attributes.embed.id),o=a.media.getAttribute(a.config.attributes.embed.hash)):o=Mb(l);const c=o?{h:o}:{};t&&Object.assign(r,{controls:!1,sidedock:!1});const d=Ny({loop:a.config.loop.active,autoplay:a.autoplay,muted:a.muted,gesture:"media",playsinline:a.config.playsinline,...c,...r}),f=Ob(l),g=be("iframe"),p=qh(a.config.urls.vimeo.iframe,f,d);if(g.setAttribute("src",p),g.setAttribute("allowfullscreen",""),g.setAttribute("allow",["autoplay","fullscreen","picture-in-picture","encrypted-media","accelerometer","gyroscope"].join("; ")),C.empty(i)||g.setAttribute("referrerPolicy",i),t||!e.customControls)g.setAttribute("data-poster",a.poster),a.media=wo(g,a.media);else{const _=be("div",{class:a.config.classNames.embedContainer,"data-poster":a.poster});_.appendChild(g),a.media=wo(_,a.media)}e.customControls||Ga(qh(a.config.urls.vimeo.api,p)).then(_=>{!C.empty(_)&&_.thumbnail_url&&We.setPoster.call(a,_.thumbnail_url).catch(()=>{})}),a.embed=new window.Vimeo.Player(g,{autopause:a.config.autopause,muted:a.muted}),a.media.paused=!0,a.media.currentTime=0,a.supported.ui&&a.embed.disableTextTrack(),a.media.play=()=>(Ta.call(a,!0),a.embed.play()),a.media.pause=()=>(Ta.call(a,!1),a.embed.pause()),a.media.stop=()=>{a.pause(),a.currentTime=0};let{currentTime:v}=a.media;Object.defineProperty(a.media,"currentTime",{get:()=>v,set(_){const{embed:D,media:w,paused:k,volume:$}=a,M=k&&!D.hasPlayed;w.seeking=!0,xe.call(a,w,"seeking"),Promise.resolve(M&&D.setVolume(0)).then(()=>D.setCurrentTime(_)).then(()=>M&&D.pause()).then(()=>M&&D.setVolume($)).catch(()=>{})}});let T=a.config.speed.selected;Object.defineProperty(a.media,"playbackRate",{get:()=>T,set(_){a.embed.setPlaybackRate(_).then(()=>{T=_,xe.call(a,a.media,"ratechange")}).catch(()=>{a.options.speed=[1]})}});let{volume:E}=a.config;Object.defineProperty(a.media,"volume",{get:()=>E,set(_){a.embed.setVolume(_).then(()=>{E=_,xe.call(a,a.media,"volumechange")})}});let{muted:A}=a.config;Object.defineProperty(a.media,"muted",{get:()=>A,set(_){const D=!!C.boolean(_)&&_;a.embed.setMuted(!!D||a.config.muted).then(()=>{A=D,xe.call(a,a.media,"volumechange")})}});let b,{loop:L}=a.config;Object.defineProperty(a.media,"loop",{get:()=>L,set(_){const D=C.boolean(_)?_:a.config.loop.active;a.embed.setLoop(D).then(()=>{L=D})}}),a.embed.getVideoUrl().then(_=>{b=_,oe.setDownloadUrl.call(a)}).catch(_=>{this.debug.warn(_)}),Object.defineProperty(a.media,"currentSrc",{get:()=>b}),Object.defineProperty(a.media,"ended",{get:()=>a.currentTime===a.duration}),Promise.all([a.embed.getVideoWidth(),a.embed.getVideoHeight()]).then(_=>{const[D,w]=_;a.embed.ratio=wy(D,w),mr.call(this)}),a.embed.setAutopause(a.config.autopause).then(_=>{a.config.autopause=_}),a.embed.getVideoTitle().then(_=>{a.config.title=_,We.setTitle.call(this)}),a.embed.getCurrentTime().then(_=>{v=_,xe.call(a,a.media,"timeupdate")}),a.embed.getDuration().then(_=>{a.media.duration=_,xe.call(a,a.media,"durationchange")}),a.embed.getTextTracks().then(_=>{a.media.textTracks=_,Be.setup.call(a)}),a.embed.on("cuechange",({cues:_=[]})=>{const D=_.map(w=>xb(w.text));Be.updateCues.call(a,D)}),a.embed.on("loaded",()=>{a.embed.getPaused().then(_=>{Ta.call(a,!_),_||xe.call(a,a.media,"playing")}),C.element(a.embed.element)&&a.supported.ui&&a.embed.element.setAttribute("tabindex",-1)}),a.embed.on("bufferstart",()=>{xe.call(a,a.media,"waiting")}),a.embed.on("bufferend",()=>{xe.call(a,a.media,"playing")}),a.embed.on("play",()=>{Ta.call(a,!0),xe.call(a,a.media,"playing")}),a.embed.on("pause",()=>{Ta.call(a,!1)}),a.embed.on("timeupdate",_=>{a.media.seeking=!1,v=_.seconds,xe.call(a,a.media,"timeupdate")}),a.embed.on("progress",_=>{a.media.buffered=_.percent,xe.call(a,a.media,"progress"),parseInt(_.percent,10)===1&&xe.call(a,a.media,"canplaythrough"),a.embed.getDuration().then(D=>{D!==a.media.duration&&(a.media.duration=D,xe.call(a,a.media,"durationchange"))})}),a.embed.on("seeked",()=>{a.media.seeking=!1,xe.call(a,a.media,"seeked")}),a.embed.on("ended",()=>{a.media.paused=!0,xe.call(a,a.media,"ended")}),a.embed.on("error",_=>{a.media.error=_,xe.call(a,a.media,"error")}),e.customControls&&setTimeout(()=>We.build.call(a),0)}};function Pb(a){return C.empty(a)?null:a.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:a}function Ea(a){a&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===a&&(this.media.paused=!a,xe.call(this,this.media,a?"play":"pause"))}function Nb(a){return a.noCookie?"https://www.youtube-nocookie.com":window.location.protocol==="http:"?"http://www.youtube.com":void 0}const So={setup(){if(He(this.elements.wrapper,this.config.classNames.embed,!0),C.object(window.YT)&&C.function(window.YT.Player))So.ready.call(this);else{const a=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{C.function(a)&&a(),So.ready.call(this)},Ef(this.config.urls.youtube.sdk).catch(e=>{this.debug.warn("YouTube API failed to load",e)})}},getTitle(a){Ga(qh(this.config.urls.youtube.api,a)).then(e=>{if(C.object(e)){const{title:t,height:i,width:r}=e;this.config.title=t,We.setTitle.call(this),this.embed.ratio=wy(r,i)}mr.call(this)}).catch(()=>{mr.call(this)})},ready(){const a=this,e=a.config.youtube,t=a.media&&a.media.getAttribute("id");if(!C.empty(t)&&t.startsWith("youtube-"))return;let i=a.media.getAttribute("src");C.empty(i)&&(i=a.media.getAttribute(this.config.attributes.embed.id));const r=Pb(i),l=be("div",{id:Eb(a.provider),"data-poster":e.customControls?a.poster:void 0});if(a.media=wo(l,a.media),e.customControls){const o=c=>`https://i.ytimg.com/vi/${r}/${c}default.jpg`;Eo(o("maxres"),121).catch(()=>Eo(o("sd"),121)).catch(()=>Eo(o("hq"))).then(c=>We.setPoster.call(a,c.src)).then(c=>{c.includes("maxres")||(a.elements.poster.style.backgroundSize="cover")}).catch(()=>{})}a.embed=new window.YT.Player(a.media,{videoId:r,host:Nb(e),playerVars:ht({},{autoplay:a.config.autoplay?1:0,hl:a.config.hl,controls:a.supported.ui&&e.customControls?0:1,disablekb:1,playsinline:a.config.playsinline&&!a.config.fullscreen.iosNative?1:0,cc_load_policy:a.captions.active?1:0,cc_lang_pref:a.config.captions.language,widget_referrer:window?window.location.href:null},e),events:{onError(o){if(!a.media.error){const c=o.data,d={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[c]||"An unknown error occurred";a.media.error={code:c,message:d},xe.call(a,a.media,"error")}},onPlaybackRateChange(o){const c=o.target;a.media.playbackRate=c.getPlaybackRate(),xe.call(a,a.media,"ratechange")},onReady(o){if(C.function(a.media.play))return;const c=o.target;So.getTitle.call(a,r),a.media.play=()=>{Ea.call(a,!0),c.playVideo()},a.media.pause=()=>{Ea.call(a,!1),c.pauseVideo()},a.media.stop=()=>{c.stopVideo()},a.media.duration=c.getDuration(),a.media.paused=!0,a.media.currentTime=0,Object.defineProperty(a.media,"currentTime",{get:()=>Number(c.getCurrentTime()),set(p){a.paused&&!a.embed.hasPlayed&&a.embed.mute(),a.media.seeking=!0,xe.call(a,a.media,"seeking"),c.seekTo(p)}}),Object.defineProperty(a.media,"playbackRate",{get:()=>c.getPlaybackRate(),set(p){c.setPlaybackRate(p)}});let{volume:d}=a.config;Object.defineProperty(a.media,"volume",{get:()=>d,set(p){d=p,c.setVolume(100*d),xe.call(a,a.media,"volumechange")}});let{muted:f}=a.config;Object.defineProperty(a.media,"muted",{get:()=>f,set(p){const v=C.boolean(p)?p:f;f=v,c[v?"mute":"unMute"](),c.setVolume(100*d),xe.call(a,a.media,"volumechange")}}),Object.defineProperty(a.media,"currentSrc",{get:()=>c.getVideoUrl()}),Object.defineProperty(a.media,"ended",{get:()=>a.currentTime===a.duration});const g=c.getAvailablePlaybackRates();a.options.speed=g.filter(p=>a.config.speed.options.includes(p)),a.supported.ui&&e.customControls&&a.media.setAttribute("tabindex",-1),xe.call(a,a.media,"timeupdate"),xe.call(a,a.media,"durationchange"),clearInterval(a.timers.buffering),a.timers.buffering=setInterval(()=>{a.media.buffered=c.getVideoLoadedFraction(),(a.media.lastBuffered===null||a.media.lastBuffered<a.media.buffered)&&xe.call(a,a.media,"progress"),a.media.lastBuffered=a.media.buffered,a.media.buffered===1&&(clearInterval(a.timers.buffering),xe.call(a,a.media,"canplaythrough"))},200),e.customControls&&setTimeout(()=>We.build.call(a),50)},onStateChange(o){const c=o.target;switch(clearInterval(a.timers.playing),a.media.seeking&&[1,2].includes(o.data)&&(a.media.seeking=!1,xe.call(a,a.media,"seeked")),o.data){case-1:xe.call(a,a.media,"timeupdate"),a.media.buffered=c.getVideoLoadedFraction(),xe.call(a,a.media,"progress");break;case 0:Ea.call(a,!1),a.media.loop?(c.stopVideo(),c.playVideo()):xe.call(a,a.media,"ended");break;case 1:e.customControls&&!a.config.autoplay&&a.media.paused&&!a.embed.hasPlayed?a.media.pause():(Ea.call(a,!0),xe.call(a,a.media,"playing"),a.timers.playing=setInterval(()=>{xe.call(a,a.media,"timeupdate")},50),a.media.duration!==c.getDuration()&&(a.media.duration=c.getDuration(),xe.call(a,a.media,"durationchange")));break;case 2:a.muted||a.embed.unMute(),Ea.call(a,!1);break;case 3:xe.call(a,a.media,"waiting")}xe.call(a,a.elements.container,"statechange",!1,{code:o.data})}}})}},By={setup(){this.media?(He(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),He(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&He(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=be("div",{class:this.config.classNames.video}),_y(this.media,this.elements.wrapper),this.elements.poster=be("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?Gs.setup.call(this):this.isYouTube?So.setup.call(this):this.isVimeo&&Yh.setup.call(this)):this.debug.warn("No media element found!")}};class Ub{constructor(e){ce(this,"load",()=>{this.enabled&&(C.object(window.google)&&C.object(window.google.ima)?this.ready():Ef(this.player.config.urls.googleIMA.sdk).then(()=>{this.ready()}).catch(()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))}))}),ce(this,"ready",()=>{var t;this.enabled||((t=this).manager&&t.manager.destroy(),t.elements.displayContainer&&t.elements.displayContainer.destroy(),t.elements.container.remove()),this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then(()=>{this.clearSafetyTimer("onAdsManagerLoaded()")}),this.listeners(),this.setupIMA()}),ce(this,"setupIMA",()=>{this.elements.container=be("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,t=>this.onAdsManagerLoaded(t),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,t=>this.onAdError(t),!1),this.requestAds()}),ce(this,"requestAds",()=>{const{container:t}=this.player.elements;try{const i=new google.ima.AdsRequest;i.adTagUrl=this.tagUrl,i.linearAdSlotWidth=t.offsetWidth,i.linearAdSlotHeight=t.offsetHeight,i.nonLinearAdSlotWidth=t.offsetWidth,i.nonLinearAdSlotHeight=t.offsetHeight,i.forceNonLinearFullSlot=!1,i.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(i)}catch(i){this.onAdError(i)}}),ce(this,"pollCountdown",(t=!1)=>{if(!t)return clearInterval(this.countdownTimer),void this.elements.container.removeAttribute("data-badge-text");this.countdownTimer=setInterval(()=>{const i=Yo(Math.max(this.manager.getRemainingTime(),0)),r=`${Lt.get("advertisement",this.player.config)} - ${i}`;this.elements.container.setAttribute("data-badge-text",r)},100)}),ce(this,"onAdsManagerLoaded",t=>{if(!this.enabled)return;const i=new google.ima.AdsRenderingSettings;i.restoreCustomPlaybackStateOnAdBreakComplete=!0,i.enablePreloading=!0,this.manager=t.getAdsManager(this.player,i),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,r=>this.onAdError(r)),Object.keys(google.ima.AdEvent.Type).forEach(r=>{this.manager.addEventListener(google.ima.AdEvent.Type[r],l=>this.onAdEvent(l))}),this.trigger("loaded")}),ce(this,"addCuePoints",()=>{C.empty(this.cuePoints)||this.cuePoints.forEach(t=>{if(t!==0&&t!==-1&&t<this.player.duration){const i=this.player.elements.progress;if(C.element(i)){const r=100/this.player.duration*t,l=be("span",{class:this.player.config.classNames.cues});l.style.left=`${r.toString()}%`,i.appendChild(l)}}})}),ce(this,"onAdEvent",t=>{const{container:i}=this.player.elements,r=t.getAd(),l=t.getAdData();switch((o=>{xe.call(this.player,this.player.media,`ads${o.replace(/_/g,"").toLowerCase()}`)})(t.type),t.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),this.pollCountdown(!0),r.isLinear()||(r.width=i.offsetWidth,r.height=i.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:l.adError&&this.player.debug.warn(`Non-fatal ad error: ${l.adError.getMessage()}`)}}),ce(this,"onAdError",t=>{this.cancel(),this.player.debug.warn("Ads error",t)}),ce(this,"listeners",()=>{const{container:t}=this.player.elements;let i;this.player.on("canplay",()=>{this.addCuePoints()}),this.player.on("ended",()=>{this.loader.contentComplete()}),this.player.on("timeupdate",()=>{i=this.player.currentTime}),this.player.on("seeked",()=>{const r=this.player.currentTime;C.empty(this.cuePoints)||this.cuePoints.forEach((l,o)=>{i<l&&l<r&&(this.manager.discardAdBreak(),this.cuePoints.splice(o,1))})}),window.addEventListener("resize",()=>{this.manager&&this.manager.resize(t.offsetWidth,t.offsetHeight,google.ima.ViewMode.NORMAL)})}),ce(this,"play",()=>{const{container:t}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then(()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(t.offsetWidth,t.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(i){this.onAdError(i)}}).catch(()=>{})}),ce(this,"resumeContent",()=>{this.elements.container.style.zIndex="",this.playing=!1,Fi(this.player.media.play())}),ce(this,"pauseContent",()=>{this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()}),ce(this,"cancel",()=>{this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()}),ce(this,"loadAds",()=>{this.managerPromise.then(()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise(t=>{this.on("loaded",t),this.player.debug.log(this.manager)}),this.initialized=!1,this.requestAds()}).catch(()=>{})}),ce(this,"trigger",(t,...i)=>{const r=this.events[t];C.array(r)&&r.forEach(l=>{C.function(l)&&l.apply(this,i)})}),ce(this,"on",(t,i)=>(C.array(this.events[t])||(this.events[t]=[]),this.events[t].push(i),this)),ce(this,"startSafetyTimer",(t,i)=>{this.player.debug.log(`Safety timer invoked from: ${i}`),this.safetyTimer=setTimeout(()=>{this.cancel(),this.clearSafetyTimer("startSafetyTimer()")},t)}),ce(this,"clearSafetyTimer",t=>{C.nullOrUndefined(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${t}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)}),this.player=e,this.config=e.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise((t,i)=>{this.on("loaded",t),this.on("error",i)}),this.load()}get enabled(){const{config:e}=this;return this.player.isHTML5&&this.player.isVideo&&e.enabled&&(!C.empty(e.publisherId)||C.url(e.tagUrl))}get tagUrl(){const{config:e}=this;return C.url(e.tagUrl)?e.tagUrl:`https://go.aniview.com/api/adserver6/vast/?${Ny({AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:e.publisherId})}`}}function Fy(a=0,e=0,t=255){return Math.min(Math.max(a,e),t)}const Bb=a=>{const e=[];return a.split(/\r\n\r\n|\n\n|\r\r/).forEach(t=>{const i={};t.split(/\r\n|\n|\r/).forEach(r=>{if(C.number(i.startTime)){if(!C.empty(r.trim())&&C.empty(i.text)){const l=r.trim().split("#xywh=");[i.text]=l,l[1]&&([i.x,i.y,i.w,i.h]=l[1].split(","))}}else{const l=r.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);l&&(i.startTime=60*Number(l[1]||0)*60+60*Number(l[2])+Number(l[3])+ +`0.${l[4]}`,i.endTime=60*Number(l[6]||0)*60+60*Number(l[7])+Number(l[8])+ +`0.${l[9]}`)}}),i.text&&e.push(i)}),e},Qp=(a,e)=>{const t={};return a>e.width/e.height?(t.width=e.width,t.height=1/a*e.width):(t.height=e.height,t.width=a*e.height),t};class jh{constructor(e){ce(this,"load",()=>{this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then(()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.listeners(),this.loaded=!0)})}),ce(this,"getThumbnails",()=>new Promise(t=>{const{src:i}=this.player.config.previewThumbnails;if(C.empty(i))throw new Error("Missing previewThumbnails.src config attribute");const r=()=>{this.thumbnails.sort((l,o)=>l.height-o.height),this.player.debug.log("Preview thumbnails",this.thumbnails),t()};if(C.function(i))i(l=>{this.thumbnails=l,r()});else{const l=(C.string(i)?[i]:i).map(o=>this.getThumbnail(o));Promise.all(l).then(r)}})),ce(this,"getThumbnail",t=>new Promise(i=>{Ga(t).then(r=>{const l={frames:Bb(r),height:null,urlPrefix:""};l.frames[0].text.startsWith("/")||l.frames[0].text.startsWith("http://")||l.frames[0].text.startsWith("https://")||(l.urlPrefix=t.substring(0,t.lastIndexOf("/")+1));const o=new Image;o.onload=()=>{l.height=o.naturalHeight,l.width=o.naturalWidth,this.thumbnails.push(l),i()},o.src=l.urlPrefix+l.frames[0].text})})),ce(this,"startMove",t=>{if(this.loaded&&C.event(t)&&["touchmove","mousemove"].includes(t.type)&&this.player.media.duration){if(t.type==="touchmove")this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{var i,r;const l=this.player.elements.progress.getBoundingClientRect(),o=100/l.width*(t.pageX-l.left);this.seekTime=this.player.media.duration*(o/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=t.pageX,this.elements.thumb.time.innerText=Yo(this.seekTime);const c=(i=this.player.config.markers)===null||i===void 0||(r=i.points)===null||r===void 0?void 0:r.find(({time:d})=>d===Math.round(this.seekTime));c&&this.elements.thumb.time.insertAdjacentHTML("afterbegin",`${c.label}<br>`)}this.showImageAtCurrentTime()}}),ce(this,"endMove",()=>{this.toggleThumbContainer(!1,!0)}),ce(this,"startScrubbing",t=>{(C.nullOrUndefined(t.button)||t.button===!1||t.button===0)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))}),ce(this,"endScrubbing",()=>{this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):vf.call(this.player,this.player.media,"timeupdate",()=>{this.mouseDown||this.toggleScrubbingContainer(!1)})}),ce(this,"listeners",()=>{this.player.on("play",()=>{this.toggleThumbContainer(!1,!0)}),this.player.on("seeked",()=>{this.toggleThumbContainer(!1)}),this.player.on("timeupdate",()=>{this.lastTime=this.player.media.currentTime})}),ce(this,"render",()=>{this.elements.thumb.container=be("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=be("div",{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const t=be("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=be("span",{},"00:00"),t.appendChild(this.elements.thumb.time),this.elements.thumb.imageContainer.appendChild(t),C.element(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=be("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)}),ce(this,"destroy",()=>{this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()}),ce(this,"showImageAtCurrentTime",()=>{this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();const t=this.thumbnails[0].frames.findIndex(l=>this.seekTime>=l.startTime&&this.seekTime<=l.endTime),i=t>=0;let r=0;this.mouseDown||this.toggleThumbContainer(i),i&&(this.thumbnails.forEach((l,o)=>{this.loadedImages.includes(l.frames[t].text)&&(r=o)}),t!==this.showingThumb&&(this.showingThumb=t,this.loadImage(r)))}),ce(this,"loadImage",(t=0)=>{const i=this.showingThumb,r=this.thumbnails[t],{urlPrefix:l}=r,o=r.frames[i],c=r.frames[i].text,d=l+c;if(this.currentImageElement&&this.currentImageElement.dataset.filename===c)this.showImage(this.currentImageElement,o,t,i,c,!1),this.currentImageElement.dataset.index=i,this.removeOldImages(this.currentImageElement);else{this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);const f=new Image;f.src=d,f.dataset.index=i,f.dataset.filename=c,this.showingThumbFilename=c,this.player.debug.log(`Loading image: ${d}`),f.onload=()=>this.showImage(f,o,t,i,c,!0),this.loadingImage=f,this.removeOldImages(f)}}),ce(this,"showImage",(t,i,r,l,o,c=!0)=>{this.player.debug.log(`Showing thumb: ${o}. num: ${l}. qual: ${r}. newimg: ${c}`),this.setImageSizeAndOffset(t,i),c&&(this.currentImageContainer.appendChild(t),this.currentImageElement=t,this.loadedImages.includes(o)||this.loadedImages.push(o)),this.preloadNearby(l,!0).then(this.preloadNearby(l,!1)).then(this.getHigherQuality(r,t,i,o))}),ce(this,"removeOldImages",t=>{Array.from(this.currentImageContainer.children).forEach(i=>{if(i.tagName.toLowerCase()!=="img")return;const r=this.usingSprites?500:1e3;if(i.dataset.index!==t.dataset.index&&!i.dataset.deleting){i.dataset.deleting=!0;const{currentImageContainer:l}=this;setTimeout(()=>{l.removeChild(i),this.player.debug.log(`Removing thumb: ${i.dataset.filename}`)},r)}})}),ce(this,"preloadNearby",(t,i=!0)=>new Promise(r=>{setTimeout(()=>{const l=this.thumbnails[0].frames[t].text;if(this.showingThumbFilename===l){let o;o=i?this.thumbnails[0].frames.slice(t):this.thumbnails[0].frames.slice(0,t).reverse();let c=!1;o.forEach(d=>{const f=d.text;if(f!==l&&!this.loadedImages.includes(f)){c=!0,this.player.debug.log(`Preloading thumb filename: ${f}`);const{urlPrefix:g}=this.thumbnails[0],p=g+f,v=new Image;v.src=p,v.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${f}`),this.loadedImages.includes(f)||this.loadedImages.push(f),r()}}}),c||r()}},300)})),ce(this,"getHigherQuality",(t,i,r,l)=>{if(t<this.thumbnails.length-1){let o=i.naturalHeight;this.usingSprites&&(o=r.h),o<this.thumbContainerHeight&&setTimeout(()=>{this.showingThumbFilename===l&&(this.player.debug.log(`Showing higher quality thumb for: ${l}`),this.loadImage(t+1))},300)}}),ce(this,"toggleThumbContainer",(t=!1,i=!1)=>{const r=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(r,t),!t&&i&&(this.showingThumb=null,this.showingThumbFilename=null)}),ce(this,"toggleScrubbingContainer",(t=!1)=>{const i=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(i,t),t||(this.showingThumb=null,this.showingThumbFilename=null)}),ce(this,"determineContainerAutoSizing",()=>{(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)}),ce(this,"setThumbContainerSizeAndPos",()=>{const{imageContainer:t}=this.elements.thumb;if(this.sizeSpecifiedInCSS){if(t.clientHeight>20&&t.clientWidth<20){const i=Math.floor(t.clientHeight*this.thumbAspectRatio);t.style.width=`${i}px`}else if(t.clientHeight<20&&t.clientWidth>20){const i=Math.floor(t.clientWidth/this.thumbAspectRatio);t.style.height=`${i}px`}}else{const i=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);t.style.height=`${this.thumbContainerHeight}px`,t.style.width=`${i}px`}this.setThumbContainerPos()}),ce(this,"setThumbContainerPos",()=>{const t=this.player.elements.progress.getBoundingClientRect(),i=this.player.elements.container.getBoundingClientRect(),{container:r}=this.elements.thumb,l=i.left-t.left+10,o=i.right-t.left-r.clientWidth-10,c=this.mousePosX-t.left-r.clientWidth/2,d=Fy(c,l,o);r.style.left=`${d}px`,r.style.setProperty("--preview-arrow-offset",c-d+"px")}),ce(this,"setScrubbingContainerSize",()=>{const{width:t,height:i}=Qp(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${t}px`,this.elements.scrubbing.container.style.height=`${i}px`}),ce(this,"setImageSizeAndOffset",(t,i)=>{if(!this.usingSprites)return;const r=this.thumbContainerHeight/i.h;t.style.height=t.naturalHeight*r+"px",t.style.width=t.naturalWidth*r+"px",t.style.left=`-${i.x*r}px`,t.style.top=`-${i.y*r}px`}),this.player=e,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:e}=Qp(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return e}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(e){this.mouseDown?this.currentScrubbingImageElement=e:this.currentThumbnailImageElement=e}}const Xh={insertElements(a,e){C.string(e)?qp(a,this.media,{src:e}):C.array(e)&&e.forEach(t=>{qp(a,this.media,t)})},change(a){Ry(a,"sources.length")?(Gs.cancelRequests.call(this),this.destroy.call(this,()=>{this.options.quality=[],cs(this.media),this.media=null,C.element(this.elements.container)&&this.elements.container.removeAttribute("class");const{sources:e,type:t}=a,[{provider:i=$s.html5,src:r}]=e,l=i==="html5"?t:"div",o=i==="html5"?{}:{src:r};Object.assign(this,{provider:i,type:t,supported:ft.check(t,i,this.config.playsinline),media:be(l,o)}),this.elements.container.appendChild(this.media),C.boolean(a.autoplay)&&(this.config.autoplay=a.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute("crossorigin",""),this.config.autoplay&&this.media.setAttribute("autoplay",""),C.empty(a.poster)||(this.poster=a.poster),this.config.loop.active&&this.media.setAttribute("loop",""),this.config.muted&&this.media.setAttribute("muted",""),this.config.playsinline&&this.media.setAttribute("playsinline","")),We.addStyleHook.call(this),this.isHTML5&&Xh.insertElements.call(this,"source",e),this.config.title=a.title,By.setup.call(this),this.isHTML5&&Object.keys(a).includes("tracks")&&Xh.insertElements.call(this,"track",a.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&We.build.call(this),this.isHTML5&&this.media.load(),C.empty(a.previewThumbnails)||(Object.assign(this.config.previewThumbnails,a.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new jh(this))),this.fullscreen.update()},!0)):this.debug.warn("Invalid source format")}};let $y=class Qh{constructor(e,t){if(ce(this,"play",()=>C.function(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then(()=>this.ads.play()).catch(()=>Fi(this.media.play())),this.media.play()):null),ce(this,"pause",()=>this.playing&&C.function(this.media.pause)?this.media.pause():null),ce(this,"togglePlay",c=>(C.boolean(c)?c:!this.playing)?this.play():this.pause()),ce(this,"stop",()=>{this.isHTML5?(this.pause(),this.restart()):C.function(this.media.stop)&&this.media.stop()}),ce(this,"restart",()=>{this.currentTime=0}),ce(this,"rewind",c=>{this.currentTime-=C.number(c)?c:this.config.seekTime}),ce(this,"forward",c=>{this.currentTime+=C.number(c)?c:this.config.seekTime}),ce(this,"increaseVolume",c=>{const d=this.media.muted?0:this.volume;this.volume=d+(C.number(c)?c:0)}),ce(this,"decreaseVolume",c=>{this.increaseVolume(-c)}),ce(this,"airplay",()=>{ft.airplay&&this.media.webkitShowPlaybackTargetPicker()}),ce(this,"toggleControls",c=>{if(this.supported.ui&&!this.isAudio){const d=ko(this.elements.container,this.config.classNames.hideControls),f=c===void 0?void 0:!c,g=He(this.elements.container,this.config.classNames.hideControls,f);if(g&&C.array(this.config.controls)&&this.config.controls.includes("settings")&&!C.empty(this.config.settings)&&oe.toggleMenu.call(this,!1),g!==d){const p=g?"controlshidden":"controlsshown";xe.call(this,this.media,p)}return!g}return!1}),ce(this,"on",(c,d)=>{Ne.call(this,this.elements.container,c,d)}),ce(this,"once",(c,d)=>{vf.call(this,this.elements.container,c,d)}),ce(this,"off",(c,d)=>{qo(this.elements.container,c,d)}),ce(this,"destroy",(c,d=!1)=>{if(!this.ready)return;const f=()=>{document.body.style.overflow="",this.embed=null,d?(Object.keys(this.elements).length&&(cs(this.elements.buttons.play),cs(this.elements.captions),cs(this.elements.controls),cs(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),C.function(c)&&c()):(yb.call(this),Gs.cancelRequests.call(this),wo(this.elements.original,this.elements.container),xe.call(this,this.elements.original,"destroyed",!0),C.function(c)&&c.call(this.elements.original),this.ready=!1,setTimeout(()=>{this.elements=null,this.media=null},200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(We.toggleNativeControls.call(this,!0),f()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),this.embed!==null&&C.function(this.embed.destroy)&&this.embed.destroy(),f()):this.isVimeo&&(this.embed!==null&&this.embed.unload().then(f),setTimeout(f,200))}),ce(this,"supports",c=>ft.mime.call(this,c)),this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=ft.touch,this.media=e,C.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||C.nodeList(this.media)||C.array(this.media))&&(this.media=this.media[0]),this.config=ht({},Uy,Qh.defaults,t||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch{return{}}})()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new Ib(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",ft),C.nullOrUndefined(this.media)||!C.element(this.media))return void this.debug.error("Setup failed: no suitable element passed");if(this.media.plyr)return void this.debug.warn("Target already setup");if(!this.config.enabled)return void this.debug.error("Setup failed: disabled by config");if(!ft.check().api)return void this.debug.error("Setup failed: no support");const i=this.media.cloneNode(!0);i.autoplay=!1,this.elements.original=i;const r=this.media.tagName.toLowerCase();let l=null,o=null;switch(r){case"div":if(l=this.media.querySelector("iframe"),C.element(l)){if(o=Py(l.getAttribute("src")),this.provider=Db(o.toString()),this.elements.container=this.media,this.media=l,this.elements.container.className="",o.search.length){const c=["1","true"];c.includes(o.searchParams.get("autoplay"))&&(this.config.autoplay=!0),c.includes(o.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=c.includes(o.searchParams.get("playsinline")),this.config.youtube.hl=o.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(C.empty(this.provider)||!Object.values($s).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=mh.video;break;case"video":case"audio":this.type=r,this.provider=$s.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=ft.check(this.type,this.provider),this.supported.api?(this.eventListeners=[],this.listeners=new Cb(this),this.storage=new Ca(this),this.media.plyr=this,C.element(this.elements.container)||(this.elements.container=be("div"),_y(this.media,this.elements.container)),We.migrateStyles.call(this),We.addStyleHook.call(this),By.setup.call(this),this.config.debug&&Ne.call(this,this.elements.container,this.config.events.join(" "),c=>{this.debug.log(`event: ${c.type}`)}),this.fullscreen=new xi(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&We.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new Ub(this)),this.isHTML5&&this.config.autoplay&&this.once("canplay",()=>Fi(this.play())),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new jh(this))):this.debug.error("Setup failed: no support")}get isHTML5(){return this.provider===$s.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===$s.youtube}get isVimeo(){return this.provider===$s.vimeo}get isVideo(){return this.type===mh.video}get isAudio(){return this.type===mh.audio}get playing(){return!!(this.ready&&!this.paused&&!this.ended)}get paused(){return!!this.media.paused}get stopped(){return!!(this.paused&&this.currentTime===0)}get ended(){return!!this.media.ended}set currentTime(e){if(!this.duration)return;const t=C.number(e)&&e>0;this.media.currentTime=t?Math.min(e,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:e}=this.media;return C.number(e)?e:e&&e.length&&this.duration>0?e.end(0)/this.duration:0}get seeking(){return!!this.media.seeking}get duration(){const e=parseFloat(this.config.duration),t=(this.media||{}).duration,i=C.number(t)&&t!==1/0?t:0;return e||i}set volume(e){let t=e;C.string(t)&&(t=Number(t)),C.number(t)||(t=this.storage.get("volume")),C.number(t)||({volume:t}=this.config),t>1&&(t=1),t<0&&(t=0),this.config.volume=t,this.media.volume=t,!C.empty(e)&&this.muted&&t>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}set muted(e){let t=e;C.boolean(t)||(t=this.storage.get("muted")),C.boolean(t)||(t=this.config.muted),this.config.muted=t,this.media.muted=t}get muted(){return!!this.media.muted}get hasAudio(){return!this.isHTML5||!!this.isAudio||!!this.media.mozHasAudio||!!this.media.webkitAudioDecodedByteCount||!!(this.media.audioTracks&&this.media.audioTracks.length)}set speed(e){let t=null;C.number(e)&&(t=e),C.number(t)||(t=this.storage.get("speed")),C.number(t)||(t=this.config.speed.selected);const{minimumSpeed:i,maximumSpeed:r}=this;t=Fy(t,i,r),this.config.speed.selected=t,setTimeout(()=>{this.media&&(this.media.playbackRate=t)},0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(e){const t=this.config.quality,i=this.options.quality;if(!i.length)return;let r=[!C.empty(e)&&Number(e),this.storage.get("quality"),t.selected,t.default].find(C.number),l=!0;if(!i.includes(r)){const o=Dy(i,r);this.debug.warn(`Unsupported quality option: ${r}, using ${o} instead`),r=o,l=!1}t.selected=r,this.media.quality=r,l&&this.storage.set({quality:r})}get quality(){return this.media.quality}set loop(e){const t=C.boolean(e)?e:this.config.loop.active;this.config.loop.active=t,this.media.loop=t}get loop(){return!!this.media.loop}set source(e){Xh.change.call(this,e)}get source(){return this.media.currentSrc}get download(){const{download:e}=this.config.urls;return C.url(e)?e:this.source}set download(e){C.url(e)&&(this.config.urls.download=e,oe.setDownloadUrl.call(this))}set poster(e){this.isVideo?We.setPoster.call(this,e,!1).catch(()=>{}):this.debug.warn("Poster can only be set for video")}get poster(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}get ratio(){if(!this.isVideo)return null;const e=Oo(Tf.call(this));return C.array(e)?e.join(":"):e}set ratio(e){this.isVideo?C.string(e)&&Cy(e)?(this.config.ratio=Oo(e),mr.call(this)):this.debug.error(`Invalid aspect ratio specified (${e})`):this.debug.warn("Aspect ratio can only be set for video")}set autoplay(e){this.config.autoplay=C.boolean(e)?e:this.config.autoplay}get autoplay(){return!!this.config.autoplay}toggleCaptions(e){Be.toggle.call(this,e,!1)}set currentTrack(e){Be.set.call(this,e,!1),Be.setup.call(this)}get currentTrack(){const{toggled:e,currentTrack:t}=this.captions;return e?t:-1}set language(e){Be.setLanguage.call(this,e,!1)}get language(){return(Be.getCurrentTrack.call(this)||{}).language}set pip(e){if(!ft.pip)return;const t=C.boolean(e)?e:!this.pip;C.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(t?gh.active:gh.inactive),C.function(this.media.requestPictureInPicture)&&(!this.pip&&t?this.media.requestPictureInPicture():this.pip&&!t&&document.exitPictureInPicture())}get pip(){return ft.pip?C.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===gh.active:null}setPreviewThumbnails(e){this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),Object.assign(this.config.previewThumbnails,e),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new jh(this))}static supported(e,t){return ft.check(e,t)}static loadSprite(e,t){return Oy(e,t)}static setup(e,t={}){let i=null;return C.string(e)?i=Array.from(document.querySelectorAll(e)):C.nodeList(e)?i=Array.from(e):C.array(e)&&(i=e.filter(C.element)),C.empty(i)?null:i.map(r=>new Qh(r,t))}};$y.defaults=db(Uy);var yh={exports:{}},vh,Wp;function Fb(){if(Wp)return vh;Wp=1;var a="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return vh=a,vh}var Th,Zp;function $b(){if(Zp)return Th;Zp=1;var a=Fb();function e(){}function t(){}return t.resetWarningCache=e,Th=function(){function i(o,c,d,f,g,p){if(p!==a){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}i.isRequired=i;function r(){return i}var l={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:r,element:i,elementType:i,instanceOf:r,node:i,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:t,resetWarningCache:e};return l.PropTypes=l,l},Th}var Jp;function Gb(){return Jp||(Jp=1,yh.exports=$b()()),yh.exports}var Hb=Gb();const e0=AS(Hb);function Vb(a,e,t=[]){const[i,r]=si.useState(null),l=si.useRef(null),{instantiate:o,destroy:c,getAPI:d,params:f}=e;si.useEffect(()=>{const p=o(l.current,f);return r(p),()=>{c&&c(p,f)}},t);const g=si.useMemo(()=>d(i,f),[i]);return si.useImperativeHandle(a,g,[g]),l}const Kb={},zb=(a,e)=>{const t=new $y(".plyr-react",e.options||{});return e.source&&(t.source=e.source),t},qb=a=>{a&&a.destroy()},Yb=()=>{},jb=a=>a?()=>({plyr:a}):()=>new Proxy({plyr:{source:null}},{get:(e,t)=>t==="plyr"?e[t]:Yb});function Xb(a,e,t=null){return Vb(a,{instantiate:zb,getAPI:jb,destroy:qb,params:e},t||[e.options,e.source])}const bo=si.forwardRef((a,e)=>{const{source:t,options:i=null,...r}=a,l=Xb(e,{source:t,options:i});return it.jsx("video",{ref:l,className:"plyr-react plyr",...r})});(Kb&&"production")!=="production"&&(bo.displayName="Plyr",bo.defaultProps={options:{controls:["rewind","play","fast-forward","progress","current-time","duration","mute","volume","settings","fullscreen"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop"}},source:{type:"video",sources:[{src:"https://cdn.plyr.io/static/blank.mp4",type:"video/mp4",size:720},{src:"https://cdn.plyr.io/static/blank.mp4",type:"video/mp4",size:1080}]}},bo.propTypes={options:e0.object,source:e0.any});const he=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},Qb=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=Wb},Wb=Number.MAX_SAFE_INTEGER||9007199254740991;let ye=function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a}({}),K=function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a}({}),S=function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a}({});var we={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},me={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ar{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Zb{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ar(e),this.fast_=new ar(t),this.defaultTTFB_=r,this.ttfb_=new ar(e)}update(e,t){const{slow_:i,fast_:r,ttfb_:l}=this;i.halfLife!==e&&(this.slow_=new ar(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new ar(t,r.getEstimate(),r.getTotalWeight())),l.halfLife!==e&&(this.ttfb_=new ar(e,l.getEstimate(),l.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,r=e/1e3,l=i/r;this.fast_.sample(r,l),this.slow_.sample(r,l)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Jb(a,e,t){return(e=tA(e))in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function Ye(){return Ye=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(a[i]=t[i])}return a},Ye.apply(null,arguments)}function t0(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable})),t.push.apply(t,i)}return t}function Ge(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?t0(Object(t),!0).forEach(function(i){Jb(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):t0(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}function eA(a,e){if(typeof a!="object"||!a)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var i=t.call(a,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function tA(a){var e=eA(a,"string");return typeof e=="symbol"?e:e+""}class fs{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=Bs,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const Bs=function(){},iA={trace:Bs,debug:Bs,log:Bs,warn:Bs,info:Bs,error:Bs};function Wh(){return Ye({},iA)}function sA(a,e){const t=self.console[a];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${a}] >`):Bs}function i0(a,e,t){return e[a]?e[a].bind(e):sA(a,t)}const Zh=Wh();function nA(a,e,t){const i=Wh();if(typeof console=="object"&&a===!0||typeof a=="object"){const r=["debug","log","info","warn","error"];r.forEach(l=>{i[l]=i0(l,a,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.5`)}catch{return Wh()}r.forEach(l=>{Zh[l]=i0(l,a)})}else Ye(Zh,i);return i}const Fe=Zh;function Hs(a=!0){return typeof self>"u"?void 0:(a||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function rA(a){return typeof self<"u"&&a===self.ManagedMediaSource}function Gy(a,e){const t=Object.keys(a),i=Object.keys(e),r=t.length,l=i.length;return!r||!l||r===l&&!t.some(o=>i.indexOf(o)===-1)}function ri(a,e=!1){if(typeof TextDecoder<"u"){const f=new TextDecoder("utf-8").decode(a);if(e){const g=f.indexOf("\0");return g!==-1?f.substring(0,g):f}return f.replace(/\0/g,"")}const t=a.length;let i,r,l,o="",c=0;for(;c<t;){if(i=a[c++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:r=a[c++],o+=String.fromCharCode((i&31)<<6|r&63);break;case 14:r=a[c++],l=a[c++],o+=String.fromCharCode((i&15)<<12|(r&63)<<6|(l&63)<<0);break}}return o}const Ui={hexDump:function(a){let e="";for(let t=0;t<a.length;t++){let i=a[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}};function aA(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Eh={exports:{}},s0;function lA(){return s0||(s0=1,function(a,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,l=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(d,f,g){if(g=g||{},d=d.trim(),f=f.trim(),!f){if(!g.alwaysNormalize)return d;var p=c.parseURL(d);if(!p)throw new Error("Error trying to parse base URL.");return p.path=c.normalizePath(p.path),c.buildURLFromParts(p)}var v=c.parseURL(f);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return g.alwaysNormalize?(v.path=c.normalizePath(v.path),c.buildURLFromParts(v)):f;var T=c.parseURL(d);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var E=r.exec(T.path);T.netLoc=E[1],T.path=E[2]}T.netLoc&&!T.path&&(T.path="/");var A={scheme:T.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(A.netLoc=T.netLoc,v.path[0]!=="/"))if(!v.path)A.path=T.path,v.params||(A.params=T.params,v.query||(A.query=T.query));else{var b=T.path,L=b.substring(0,b.lastIndexOf("/")+1)+v.path;A.path=c.normalizePath(L)}return A.path===null&&(A.path=g.alwaysNormalize?c.normalizePath(v.path):v.path),c.buildURLFromParts(A)},parseURL:function(d){var f=i.exec(d);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(l,"");d.length!==(d=d.replace(o,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};a.exports=c})()}(Eh)),Eh.exports}var Sf=lA();class bf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var et={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Hy{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,uA(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let r;i.length===1?r=t?.byteRangeEndOffset||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[et.AUDIO]:null,[et.VIDEO]:null,[et.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new bf),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Sf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[et.AUDIO]=null,e[et.VIDEO]=null,e[et.AUDIOVIDEO]=null}}function _t(a){return a.sn!=="initSegment"}class Sh extends Hy{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(he(e)&&he(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=he(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!he(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return _t(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,r,l,o=!1){const{elementaryStreams:c}=this,d=c[e];if(!d){c[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:l,partial:o};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,i),d.startDTS=Math.min(d.startDTS,r),d.endDTS=Math.max(d.endDTS,l)}}class oA extends Hy{constructor(e,t,i,r,l){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,l),l&&(this.fragOffset=l.fragOffset+l.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Vy(a,e){const t=Object.getPrototypeOf(a);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||Vy(t,e)}}function uA(a,e){const t=Vy(a,e);t&&(t.enumerable=!0,Object.defineProperty(a,e,t))}const Mo=Math.pow(2,32)-1,cA=[].push,Ky={video:1,audio:2,id3:3,text:4};function vt(a){return String.fromCharCode.apply(null,a)}function zy(a,e){const t=a[e]<<8|a[e+1];return t<0?65536+t:t}function Se(a,e){const t=qy(a,e);return t<0?4294967296+t:t}function n0(a,e){let t=Se(a,e);return t*=Math.pow(2,32),t+=Se(a,e+4),t}function qy(a,e){return a[e]<<24|a[e+1]<<16|a[e+2]<<8|a[e+3]}function bh(a,e,t){a[e]=t>>24,a[e+1]=t>>16&255,a[e+2]=t>>8&255,a[e+3]=t&255}function hA(a){const e=a.byteLength;for(let t=0;t<e;){const i=Se(a,t);if(i>8&&a[t+4]===109&&a[t+5]===111&&a[t+6]===111&&a[t+7]===102)return!0;t=i>1?t+i:e}return!1}function Re(a,e){const t=[];if(!e.length)return t;const i=a.byteLength;for(let r=0;r<i;){const l=Se(a,r),o=vt(a.subarray(r+4,r+8)),c=l>1?r+l:i;if(o===e[0])if(e.length===1)t.push(a.subarray(r+8,c));else{const d=Re(a.subarray(r+8,c),e.slice(1));d.length&&cA.apply(t,d)}r=c}return t}function fA(a){const e=[],t=a[0];let i=8;const r=Se(a,i);i+=4;let l=0,o=0;t===0?(l=Se(a,i),o=Se(a,i+4),i+=8):(l=n0(a,i),o=n0(a,i+8),i+=16),i+=2;let c=a.length+o;const d=zy(a,i);i+=2;for(let f=0;f<d;f++){let g=i;const p=Se(a,g);g+=4;const v=p&2147483647;if((p&2147483648)>>>31===1)return Fe.warn("SIDX has hierarchical references (not supported)"),null;const E=Se(a,g);g+=4,e.push({referenceSize:v,subsegmentDuration:E,info:{duration:E/r,start:c,end:c+v-1}}),c+=v,g+=4,i=g}return{earliestPresentationTime:l,timescale:r,version:t,referencesCount:d,references:e}}function Yy(a){const e=[],t=Re(a,["moov","trak"]);for(let r=0;r<t.length;r++){const l=t[r],o=Re(l,["tkhd"])[0];if(o){let c=o[0];const d=Se(o,c===0?12:20),f=Re(l,["mdia","mdhd"])[0];if(f){c=f[0];const g=Se(f,c===0?12:20),p=Re(l,["mdia","hdlr"])[0];if(p){const v=vt(p.subarray(8,12)),T={soun:et.AUDIO,vide:et.VIDEO}[v],E=Re(l,["mdia","minf","stbl","stsd"])[0],A=dA(E);T?(e[d]={timescale:g,type:T,stsd:A},e[T]=Ge({timescale:g,id:d},A)):e[d]={timescale:g,type:v,stsd:A}}}}}return Re(a,["moov","mvex","trex"]).forEach(r=>{const l=Se(r,4),o=e[l];o&&(o.default={duration:Se(r,12),flags:Se(r,20)})}),e}function dA(a){const e=a.subarray(8),t=e.subarray(86),i=vt(e.subarray(4,8));let r=i,l;const o=i==="enca"||i==="encv";if(o){const f=Re(e,[i])[0].subarray(i==="enca"?28:78);Re(f,["sinf"]).forEach(p=>{const v=Re(p,["schm"])[0];if(v){const T=vt(v.subarray(4,8));if(T==="cbcs"||T==="cenc"){const E=Re(p,["frma"])[0];E&&(r=vt(E))}}})}const c=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const d=Re(t,["avcC"])[0];d&&d.length>3&&(r+="."+no(d[1])+no(d[2])+no(d[3]),l=so(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const d=Re(e,[i])[0],f=Re(d.subarray(28),["esds"])[0];if(f&&f.length>7){let g=4;if(f[g++]!==3)break;g=Ah(f,g),g+=2;const p=f[g++];if(p&128&&(g+=2),p&64&&(g+=f[g++]),f[g++]!==4)break;g=Ah(f,g);const v=f[g++];if(v===64)r+="."+no(v);else break;if(g+=12,f[g++]!==5)break;g=Ah(f,g);const T=f[g++];let E=(T&248)>>3;E===31&&(E+=1+((T&7)<<3)+((f[g]&224)>>5)),r+="."+E}break}case"hvc1":case"hev1":{const d=Re(t,["hvcC"])[0];if(d&&d.length>12){const f=d[1],g=["","A","B","C"][f>>6],p=f&31,v=Se(d,2),T=(f&32)>>5?"H":"L",E=d[12],A=d.subarray(6,12);r+="."+g+p,r+="."+gA(v).toString(16).toUpperCase(),r+="."+T+E;let b="";for(let L=A.length;L--;){const _=A[L];(_||b)&&(b="."+_.toString(16).toUpperCase()+b)}r+=b}l=so(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=so(r,t)||r;break}case"vp09":{const d=Re(t,["vpcC"])[0];if(d&&d.length>6){const f=d[4],g=d[5],p=d[6]>>4&15;r+="."+Ni(f)+"."+Ni(g)+"."+Ni(p)}break}case"av01":{const d=Re(t,["av1C"])[0];if(d&&d.length>2){const f=d[1]>>>5,g=d[1]&31,p=d[2]>>>7?"H":"M",v=(d[2]&64)>>6,T=(d[2]&32)>>5,E=f===2&&v?T?12:10:v?10:8,A=(d[2]&16)>>4,b=(d[2]&8)>>3,L=(d[2]&4)>>2,_=d[2]&3;r+="."+f+"."+Ni(g)+p+"."+Ni(E)+"."+A+"."+b+L+_+"."+Ni(1)+"."+Ni(1)+"."+Ni(1)+"."+0,l=so("dav1",t)}break}}return{codec:r,encrypted:o,supplemental:l}}function so(a,e){const t=Re(e,["dvvC"]),i=t.length?t[0]:Re(e,["dvcC"])[0];if(i){const r=i[2]>>1&127,l=i[2]<<5&32|i[3]>>3&31;return a+"."+Ni(r)+"."+Ni(l)}}function gA(a){let e=0;for(let t=0;t<32;t++)e|=(a>>t&1)<<31-t;return e>>>0}function Ah(a,e){const t=e+5;for(;a[e++]&128&&e<t;);return e}function no(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function Ni(a){return(a<10?"0":"")+a}function mA(a,e){if(!a||!e)return a;const t=e.keyId;return t&&e.isCommonEncryption&&Re(a,["moov","trak"]).forEach(r=>{const o=Re(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=Re(o,["enca"]);const d=c.length>0;d||(c=Re(o,["encv"])),c.forEach(f=>{const g=d?f.subarray(28):f.subarray(78);Re(g,["sinf"]).forEach(v=>{const T=jy(v);if(T){const E=T.subarray(8,24);E.some(A=>A!==0)||(Fe.log(`[eme] Patching keyId in 'enc${d?"a":"v"}>sinf>>tenc' box: ${Ui.hexDump(E)} -> ${Ui.hexDump(t)}`),T.set(t,8))}})})}),a}function jy(a){const e=Re(a,["schm"])[0];if(e){const t=vt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Re(a,["schi","tenc"])[0]}return null}function pA(a,e,t){const i={},r=Re(a,["moof","traf"]);for(let l=0;l<r.length;l++){const o=r[l],c=Re(o,["tfhd"])[0],d=Se(c,4),f=e[d];if(!f)continue;const g=i[d]||(i[d]={start:NaN,duration:0,sampleCount:0,timescale:f.timescale,type:f.type}),p=Re(o,["tfdt"])[0];if(p){const D=p[0];let w=Se(p,4);D===1&&(w===Mo?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(w*=Mo+1,w+=Se(p,8))),he(w)&&(!he(g.start)||w<g.start)&&(g.start=w)}const v=f.default,T=Se(c,0)|v?.flags;let E=v?.duration||0;T&8&&(T&2?E=Se(c,12):E=Se(c,8));const A=Re(o,["trun"]);let b=g.start||0,L=0,_=E;for(let D=0;D<A.length;D++){const w=A[D],k=Se(w,4),$=g.sampleCount;g.sampleCount+=k;const M=w[3]&1,B=w[3]&4,V=w[2]&1,U=w[2]&2,te=w[2]&4,re=w[2]&8;let de=8,ue=k;for(M&&(de+=4),B&&k&&(!(w[de+1]&1)&&g.keyFrameIndex===void 0&&(g.keyFrameIndex=$),de+=4,V?(_=Se(w,de),de+=4):_=E,U&&(de+=4),re&&(de+=4),b+=_,L+=_,ue--);ue--;)V?(_=Se(w,de),de+=4):_=E,U&&(de+=4),te&&(w[de+1]&1||g.keyFrameIndex===void 0&&(g.keyFrameIndex=g.sampleCount-(ue+1),g.keyFrameStart=b),de+=4),re&&(de+=4),b+=_,L+=_;!L&&E&&(L+=E*k)}g.duration+=L}if(!Object.keys(i).some(l=>i[l].duration)){let l=1/0,o=0;const c=Re(a,["sidx"]);for(let d=0;d<c.length;d++){const f=fA(c[d]);if(f!=null&&f.references){l=Math.min(l,f.earliestPresentationTime/f.timescale);const g=f.references.reduce((p,v)=>p+v.info.duration||0,0);o=Math.max(o,g+f.earliestPresentationTime/f.timescale)}}o&&he(o)&&Object.keys(i).forEach(d=>{i[d].duration||(i[d].duration=o*i[d].timescale-i[d].start)})}return i}function yA(a,e,t){Re(e,["moof","traf"]).forEach(i=>{Re(i,["tfhd"]).forEach(r=>{const l=Se(r,4),o=a[l];if(!o)return;const c=o.timescale||9e4;Re(i,["tfdt"]).forEach(d=>{const f=d[0],g=t*c;if(g){let p=Se(d,4);if(f===0)p-=g,p=Math.max(p,0),bh(d,4,p);else{p*=Math.pow(2,32),p+=Se(d,8),p-=g,p=Math.max(p,0);const v=Math.floor(p/(Mo+1)),T=Math.floor(p%(Mo+1));bh(d,4,v),bh(d,8,T)}}})})})}function vA(a){const e={valid:null,remainder:null},t=Re(a,["moof"]);if(t.length<2)return e.remainder=a,e;const i=t[t.length-1];return e.valid=a.slice(0,i.byteOffset-8),e.remainder=a.slice(i.byteOffset-8),e}function vi(a,e){const t=new Uint8Array(a.length+e.length);return t.set(a),t.set(e,a.length),t}function r0(a,e){const t=[],i=e.samples,r=e.timescale,l=e.id;let o=!1;return Re(i,["moof"]).map(d=>{const f=d.byteOffset-8;Re(d,["traf"]).map(p=>{const v=Re(p,["tfdt"]).map(T=>{const E=T[0];let A=Se(T,4);return E===1&&(A*=Math.pow(2,32),A+=Se(T,8)),A/r})[0];return v!==void 0&&(a=v),Re(p,["tfhd"]).map(T=>{const E=Se(T,4),A=Se(T,0)&16777215,b=(A&1)!==0,L=(A&2)!==0,_=(A&8)!==0;let D=0;const w=(A&16)!==0;let k=0;const $=(A&32)!==0;let M=8;E===l&&(b&&(M+=8),L&&(M+=4),_&&(D=Se(T,M),M+=4),w&&(k=Se(T,M),M+=4),$&&(M+=4),e.type==="video"&&(o=jo(e.codec)),Re(p,["trun"]).map(B=>{const V=B[0],U=Se(B,0)&16777215,te=(U&1)!==0;let re=0;const de=(U&4)!==0,ue=(U&256)!==0;let le=0;const P=(U&512)!==0;let X=0;const ne=(U&1024)!==0,Q=(U&2048)!==0;let I=0;const Y=Se(B,4);let J=8;te&&(re=Se(B,J),J+=4),de&&(J+=4);let ie=re+f;for(let ae=0;ae<Y;ae++){if(ue?(le=Se(B,J),J+=4):le=D,P?(X=Se(B,J),J+=4):X=k,ne&&(J+=4),Q&&(V===0?I=Se(B,J):I=qy(B,J),J+=4),e.type===et.VIDEO){let pe=0;for(;pe<X;){const fe=Se(i,ie);if(ie+=4,TA(o,i[ie])){const Ke=i.subarray(ie,ie+fe);Af(Ke,o?2:1,a+I/r,t)}ie+=fe,pe+=fe+4}}a+=le/r}}))})})}),t}function jo(a){if(!a)return!1;const e=a.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function TA(a,e){if(a){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Af(a,e,t,i){const r=Xy(a);let l=0;l+=e;let o=0,c=0,d=0;for(;l<r.length;){o=0;do{if(l>=r.length)break;d=r[l++],o+=d}while(d===255);c=0;do{if(l>=r.length)break;d=r[l++],c+=d}while(d===255);const f=r.length-l;let g=l;if(c<f)l+=c;else if(c>f){Fe.error(`Malformed SEI payload. ${c} is too small, only ${f} bytes left to parse.`);break}if(o===4){if(r[g++]===181){const v=zy(r,g);if(g+=2,v===49){const T=Se(r,g);if(g+=4,T===1195456820){const E=r[g++];if(E===3){const A=r[g++],b=31&A,L=64&A,_=L?2+b*3:0,D=new Uint8Array(_);if(L){D[0]=A;for(let w=1;w<_;w++)D[w]=r[g++]}i.push({type:E,payloadType:o,pts:t,bytes:D})}}}}}else if(o===5&&c>16){const p=[];for(let E=0;E<16;E++){const A=r[g++].toString(16);p.push(A.length==1?"0"+A:A),(E===3||E===5||E===7||E===9)&&p.push("-")}const v=c-16,T=new Uint8Array(v);for(let E=0;E<v;E++)T[E]=r[g++];i.push({payloadType:o,pts:t,uuid:p.join(""),userData:ri(T),userDataBytes:T})}}}function Xy(a){const e=a.byteLength,t=[];let i=1;for(;i<e-2;)a[i]===0&&a[i+1]===0&&a[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return a;const r=e-t.length,l=new Uint8Array(r);let o=0;for(i=0;i<r;o++,i++)o===t[0]&&(o++,t.shift()),l[i]=a[o];return l}function EA(a){const e=a[0];let t="",i="",r=0,l=0,o=0,c=0,d=0,f=0;if(e===0){for(;vt(a.subarray(f,f+1))!=="\0";)t+=vt(a.subarray(f,f+1)),f+=1;for(t+=vt(a.subarray(f,f+1)),f+=1;vt(a.subarray(f,f+1))!=="\0";)i+=vt(a.subarray(f,f+1)),f+=1;i+=vt(a.subarray(f,f+1)),f+=1,r=Se(a,12),l=Se(a,16),c=Se(a,20),d=Se(a,24),f=28}else if(e===1){f+=4,r=Se(a,f),f+=4;const p=Se(a,f);f+=4;const v=Se(a,f);for(f+=4,o=2**32*p+v,Qb(o)||(o=Number.MAX_SAFE_INTEGER,Fe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Se(a,f),f+=4,d=Se(a,f),f+=4;vt(a.subarray(f,f+1))!=="\0";)t+=vt(a.subarray(f,f+1)),f+=1;for(t+=vt(a.subarray(f,f+1)),f+=1;vt(a.subarray(f,f+1))!=="\0";)i+=vt(a.subarray(f,f+1)),f+=1;i+=vt(a.subarray(f,f+1)),f+=1}const g=a.subarray(f,a.byteLength);return{schemeIdUri:t,value:i,timeScale:r,presentationTime:o,presentationTimeDelta:l,eventDuration:c,id:d,payload:g}}function SA(a,...e){const t=e.length;let i=8,r=t;for(;r--;)i+=e[r].byteLength;const l=new Uint8Array(i);for(l[0]=i>>24&255,l[1]=i>>16&255,l[2]=i>>8&255,l[3]=i&255,l.set(a,4),r=0,i=8;r<t;r++)l.set(e[r],i),i+=e[r].byteLength;return l}function bA(a,e,t){if(a.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let l;i>0?(l=new Uint8Array(4),e.length>0&&new DataView(l.buffer).setUint32(0,e.length,!1)):l=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),SA([112,115,115,104],new Uint8Array([i,0,0,0]),a,l,r,o,t||new Uint8Array)}function AA(a){const e=[];if(a instanceof ArrayBuffer){const t=a.byteLength;let i=0;for(;i+32<t;){const r=new DataView(a,i),l=xA(r);e.push(l),i+=l.size}}return e}function xA(a){const e=a.getUint32(0),t=a.byteOffset,i=a.byteLength;if(i<e)return{offset:t,size:i};if(a.getUint32(4)!==1886614376)return{offset:t,size:e};const l=a.getUint32(8)>>>24;if(l!==0&&l!==1)return{offset:t,size:e};const o=a.buffer,c=Ui.hexDump(new Uint8Array(o,t+12,16)),d=a.getUint32(28);let f=null,g=null;if(l===0){if(e-32<d||d<22)return{offset:t,size:e};g=new Uint8Array(o,t+32,d)}else if(l===1){if(!d||i<t+32+d*16+16)return{offset:t,size:e};f=[];for(let p=0;p<d;p++)f.push(new Uint8Array(o,t+32+p*16,16))}return{version:l,systemId:c,kids:f,data:g,offset:t,size:e}}const Qy=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),pr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Wy(a,e){const t=pr[e];return!!t&&!!t[a.slice(0,4)]}function Jh(a,e,t=!0){return!a.split(",").some(i=>!Zy(i,e,t))}function Zy(a,e,t=!0){var i;const r=Hs(t);return(i=r?.isTypeSupported(wa(a,e)))!=null?i:!1}function wa(a,e){return`${e}/mp4;codecs=${a}`}function a0(a){if(a){const e=a.substring(0,4);return pr.video[e]}return 2}function Po(a){const e=Qy();return a.split(",").reduce((t,i)=>{const l=e&&jo(i)?9:pr.video[i];return l?(l*2+t)/(t?3:2):(pr.audio[i]+t)/(t?2:1)},0)}const xh={};function LA(a,e=!0){if(xh[a])return xh[a];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[a];for(let r=0;r<t.length;r++){var i;if(Zy(t[r],"audio",e))return xh[a]=t[r],t[r];if(t[r]==="mp3"&&(i=Hs(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return a}const RA=/flac|opus|mp4a\.40\.34/i;function No(a,e=!0){return a.replace(RA,t=>LA(t.toLowerCase(),e))}function _A(a,e){const t=[];if(a){const i=a.split(",");for(let r=0;r<i.length;r++)Wy(i[r],"video")||t.push(i[r])}return e&&t.push(e),t.join(",")}function Ao(a,e){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1))return a;if(e){const t=e.split(",");if(t.length>1){if(a){for(let i=t.length;i--;)if(t[i].substring(0,4)===a.substring(0,4))return t[i]}return t[0]}}return e||a}function DA(a){const e=a.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function IA(a){if(a.startsWith("av01.")){const e=a.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return a}function l0(a){const e=Hs(a)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Jy(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const ev={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function tv(a,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:a}}const o0={};function CA(a,e,t,i,r,l){const o=a.audioCodec?a.audioGroups:null,c=l?.audioCodec,d=l?.channels,f=d?parseInt(d):c?1/0:2;let g=null;if(o!=null&&o.length)try{o.length===1&&o[0]?g=e.groups[o[0]].channels:g=o.reduce((p,v)=>{if(v){const T=e.groups[v];if(!T)throw new Error(`Audio track group ${v} not found`);Object.keys(T.channels).forEach(E=>{p[E]=(p[E]||0)+T.channels[E]})}return p},{2:0})}catch{return!0}return a.videoCodec!==void 0&&(a.width>1920&&a.height>1088||a.height>1920&&a.width>1088||a.frameRate>Math.max(i,30)||a.videoRange!=="SDR"&&a.videoRange!==t||a.bitrate>Math.max(r,8e6))||!!g&&he(f)&&Object.keys(g).some(p=>parseInt(p)>f)}function iv(a,e,t){const i=a.videoCodec,r=a.audioCodec;if(!i&&!r||!t)return Promise.resolve(ev);const l=[];if(i){const o={width:a.width,height:a.height,bitrate:Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)),framerate:a.frameRate||30},c=a.videoRange;c!=="SDR"&&(o.transferFunction=c.toLowerCase());const d=i.split(","),f=navigator.userAgent;if(d.some(g=>jo(g))&&Qy())return Promise.resolve(tv(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${f})`),l));l.push.apply(l,d.map(g=>({type:"media-source",video:Ge(Ge({},o),{},{contentType:wa(IA(g),"video")})})))}return r&&a.audioGroups&&a.audioGroups.forEach(o=>{var c;o&&((c=e.groups[o])==null||c.tracks.forEach(d=>{if(d.groupId===o){const f=d.channels||"",g=parseFloat(f);he(g)&&g>2&&l.push.apply(l,r.split(",").map(p=>({type:"media-source",audio:{contentType:wa(p,"audio"),channels:""+g}})))}}))}),Promise.all(l.map(o=>{const c=wA(o);return o0[c]||(o0[c]=t.decodingInfo(o))})).then(o=>({supported:!o.some(c=>!c.supported),configurations:l,decodingInfoResults:o})).catch(o=>({supported:!1,configurations:l,decodingInfoResults:[],error:o}))}function wA(a){const{audio:e,video:t}=a,i=t||e;if(i){const r=Jy(i.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${r}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${r}`}return""}const ef=["NONE","TYPE-0","TYPE-1",null];function kA(a){return ef.indexOf(a)>-1}const Uo=["SDR","PQ","HLG"];function OA(a){return!!a&&Uo.indexOf(a)>-1}var xo={No:"",Yes:"YES",v2:"v2"};function u0(a){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=a,r=i<e/2;return e&&r?t?xo.v2:xo.Yes:xo.No}class c0{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class ka{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return h0(this._audioGroups,e)}hasSubtitleGroup(e){return h0(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function h0(a,e){return!e||!a?!1:a.indexOf(e)!==-1}function MA(){if(typeof matchMedia=="function"){const a=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(a.media!==e.media)return a.matches===!0}return!1}function PA(a,e){let t=!1,i=[];if(a&&(t=a!=="SDR",i=[a]),e){i=e.allowedVideoRanges||Uo.slice(0);const r=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&MA(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const NA=a=>{const e=new WeakSet;return(t,i)=>{if(a&&(i=a(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},nt=(a,e)=>JSON.stringify(a,NA(e));function UA(a,e,t,i,r){const l=Object.keys(a),o=i?.channels,c=i?.audioCodec,d=r?.videoCodec,f=o&&parseInt(o)===2;let g=!1,p=!1,v=1/0,T=1/0,E=1/0,A=1/0,b=0,L=[];const{preferHDR:_,allowedVideoRanges:D}=PA(e,r);for(let B=l.length;B--;){const V=a[l[B]];g||(g=V.channels[2]>0),v=Math.min(v,V.minHeight),T=Math.min(T,V.minFramerate),E=Math.min(E,V.minBitrate),D.filter(te=>V.videoRanges[te]>0).length>0&&(p=!0)}v=he(v)?v:0,T=he(T)?T:0;const w=Math.max(1080,v),k=Math.max(30,T);E=he(E)?E:t,t=Math.max(E,t),p||(e=void 0);const $=l.length>1;return{codecSet:l.reduce((B,V)=>{const U=a[V];if(V===B)return B;if(L=p?D.filter(te=>U.videoRanges[te]>0):[],$){if(U.minBitrate>t)return Mi(V,`min bitrate of ${U.minBitrate} > current estimate of ${t}`),B;if(!U.hasDefaultAudio)return Mi(V,"no renditions with default or auto-select sound found"),B;if(c&&V.indexOf(c.substring(0,4))%5!==0)return Mi(V,`audio codec preference "${c}" not found`),B;if(o&&!f){if(!U.channels[o])return Mi(V,`no renditions with ${o} channel sound found (channels options: ${Object.keys(U.channels)})`),B}else if((!c||f)&&g&&U.channels[2]===0)return Mi(V,"no renditions with stereo sound found"),B;if(U.minHeight>w)return Mi(V,`min resolution of ${U.minHeight} > maximum of ${w}`),B;if(U.minFramerate>k)return Mi(V,`min framerate of ${U.minFramerate} > maximum of ${k}`),B;if(!L.some(te=>U.videoRanges[te]>0))return Mi(V,`no variants with VIDEO-RANGE of ${nt(L)} found`),B;if(d&&V.indexOf(d.substring(0,4))%5!==0)return Mi(V,`video codec preference "${d}" not found`),B;if(U.maxScore<b)return Mi(V,`max score of ${U.maxScore} < selected max of ${b}`),B}return B&&(Po(V)>=Po(B)||U.fragmentError>a[B].fragmentError)?B:(A=U.minIndex,b=U.maxScore,V)},void 0),videoRanges:L,preferHDR:_,minFramerate:T,minBitrate:E,minIndex:A}}function Mi(a,e){Fe.log(`[abr] start candidates with "${a}" ignored because ${e}`)}function sv(a){return a.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function BA(a,e,t,i){return a.slice(t,i+1).reduce((r,l,o)=>{if(!l.codecSet)return r;const c=l.audioGroups;let d=r[l.codecSet];d||(r[l.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,l.bitrate);const f=Math.min(l.height,l.width);return d.minHeight=Math.min(d.minHeight,f),d.minFramerate=Math.min(d.minFramerate,l.frameRate),d.minIndex=Math.min(d.minIndex,o),d.maxScore=Math.max(d.maxScore,l.score),d.fragmentError+=l.fragmentError,d.videoRanges[l.videoRange]=(d.videoRanges[l.videoRange]||0)+1,c&&c.forEach(g=>{if(!g)return;const p=e.groups[g];p&&(d.hasDefaultAudio=d.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(v=>{d.channels[v]=(d.channels[v]||0)+p.channels[v]}))}),r},{})}function f0(a){if(!a)return a;const{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:l}=a;return{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:l}}function Gi(a,e,t){if("attrs"in a){const i=e.indexOf(a);if(i!==-1)return i}for(let i=0;i<e.length;i++){const r=e[i];if(pn(a,r,t))return i}return-1}function pn(a,e,t){const{groupId:i,name:r,lang:l,assocLang:o,default:c}=a,d=a.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(l===void 0||FA(l,e.lang))&&(l===void 0||e.assocLang===o)&&(c===void 0||e.default===c)&&(d===void 0||e.forced===d)&&(!("characteristics"in a)||$A(a.characteristics||"",e.characteristics))&&(t===void 0||t(a,e))}function FA(a,e="--"){return a.length===e.length?a===e:a.startsWith(e)||e.startsWith(a)}function $A(a,e=""){const t=a.split(","),i=e.split(",");return t.length===i.length&&!t.some(r=>i.indexOf(r)===-1)}function gn(a,e){const{audioCodec:t,channels:i}=a;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function GA(a,e,t,i,r){const l=e[i],c=e.reduce((v,T,E)=>{const A=T.uri;return(v[A]||(v[A]=[])).push(E),v},{})[l.uri];c.length>1&&(i=Math.max.apply(Math,c));const d=l.videoRange,f=l.frameRate,g=l.codecSet.substring(0,4),p=d0(e,i,v=>{if(v.videoRange!==d||v.frameRate!==f||v.codecSet.substring(0,4)!==g)return!1;const T=v.audioGroups,E=t.filter(A=>!T||T.indexOf(A.groupId)!==-1);return Gi(a,E,r)>-1});return p>-1?p:d0(e,i,v=>{const T=v.audioGroups,E=t.filter(A=>!T||T.indexOf(A.groupId)!==-1);return Gi(a,E,r)>-1})}function d0(a,e,t){for(let i=e;i>-1;i--)if(t(a[i]))return i;for(let i=e+1;i<a.length;i++)if(t(a[i]))return i;return-1}function Bo(a,e){var t;return!!a&&a!==((t=e.loadLevelObj)==null?void 0:t.uri)}class HA extends fs{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:r,partCurrent:l,hls:o}=this,{autoLevelEnabled:c,media:d}=o;if(!r||!d)return;const f=performance.now(),g=l?l.stats:r.stats,p=l?l.duration:r.duration,v=f-g.loading.start,T=o.minAutoLevel,E=r.level,A=this._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||E<=T){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const b=A>-1&&A!==E,L=!!t||b;if(!L&&(d.paused||!d.playbackRate||!d.readyState))return;const _=o.mainForwardBufferInfo;if(!L&&_===null)return;const D=this.bwEstimator.getEstimateTTFB(),w=Math.abs(d.playbackRate);if(v<=Math.max(D,1e3*(p/(w*2))))return;const k=_?_.len/w:0,$=g.loading.first?g.loading.first-g.loading.start:-1,M=g.loaded&&$>-1,B=this.getBwEstimate(),V=o.levels,U=V[E],te=Math.max(g.loaded,Math.round(p*(r.bitrate||U.averageBitrate)/8));let re=M?v-$:v;re<1&&M&&(re=Math.min(v,g.loaded*8/B));const de=M?g.loaded*1e3/re:0,ue=D/1e3,le=de?(te-g.loaded)/de:te*8/B+ue;if(le<=k)return;const P=de?de*8:B,X=((i=t?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,ne=this.hls.config.abrBandWidthUpFactor;let Q=Number.POSITIVE_INFINITY,I;for(I=E-1;I>T;I--){const ae=V[I].maxBitrate,pe=!V[I].details||X;if(Q=this.getTimeToLoadFrag(ue,P,p*ae,pe),Q<Math.min(k,p+ue))break}if(Q>=le||Q>p*10)return;M?this.bwEstimator.sample(v-Math.min(D,$),g.loaded):this.bwEstimator.sampleTTFB(v);const Y=V[I].maxBitrate;this.getBwEstimate()*ne>Y&&this.resetEstimator(Y);const J=this.findBestLevel(Y,T,I,0,k,1,1);J>-1&&(I=J),this.warn(`Fragment ${r.sn}${l?" part "+l.index:""} of level ${E} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${le.toFixed(3)} s
      Estimated load time for down switch fragment: ${Q.toFixed(3)} s
      TTFB estimate: ${$|0} ms
      Current BW estimate: ${he(B)?B|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${I} @ ${Y|0} bps`),o.nextLoadLevel=o.nextAutoLevel=I,this.clearTimer();const ie=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===I&&I>0){const ae=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${I>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${ae.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,I>T){let pe=this.findBestLevel(this.hls.levels[T].bitrate,T,I,0,ae,1,1);pe===-1&&(pe=T),this.hls.nextLoadLevel=this.hls.nextAutoLevel=pe,this.resetEstimator(this.hls.levels[pe].bitrate)}}};b||le>Q*2?ie():this.timer=self.setInterval(ie,Q*1e3),o.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:l,stats:g})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Zb(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case K.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:r,partCurrent:l}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){const o=performance.now(),c=l?l.stats:i.stats,d=o-c.loading.start,f=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&f>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(p,f),c.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,i,r){const l=e+i/t,o=r?e+this.lastLevelLoadSec:0;return l+o}onLevelLoaded(e,t){const i=this.hls.config,{loading:r}=t.stats,l=r.end-r.first;he(l)&&(this.lastLevelLoadSec=l/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const r=i?i.stats:t.stats;if(t.type===me.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const l=i?i.duration:t.duration,o=this.hls.levels[t.level],c=(o.loaded?o.loaded.bytes:0)+r.loaded,d=(o.loaded?o.loaded.duration:0)+l;o.loaded={bytes:c,duration:d},o.realBitrate=Math.round(8*c/d)}if(t.bitrateTest){const l={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(S.FRAG_BUFFERED,l),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:r}=t,l=r!=null&&r.stats.loaded?r.stats:i.stats;if(l.aborted||this.ignoreFragment(i))return;const o=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,l.loaded),l.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==me.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,l=this.findBestLevel(i,t,e,0,r,1,1);if(l>-1)return l;const o=this.hls.firstLevel,c=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const l=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,l)&&o[e].loadError<=o[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:r,config:l,minAutoLevel:o}=i,c=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),f=this.getStarvationDelay();let g=l.abrBandWidthFactor,p=l.abrBandWidthUpFactor;if(f){const b=this.findBestLevel(d,o,r,f,0,g,p);if(b>=0)return this.rebufferNotice=-1,b}let v=c?Math.min(c,l.maxStarvationDelay):l.maxStarvationDelay;if(!f){const b=this.bitrateTestDelay;b&&(v=(c?Math.min(c,l.maxLoadingDelay):l.maxLoadingDelay)-b,this.info(`bitrate test took ${Math.round(1e3*b)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),g=p=1)}const T=this.findBestLevel(d,o,r,f,v,g,p);if(this.rebufferNotice!==T&&(this.rebufferNotice=T,this.info(`${f?"rebuffering expected":"buffer is empty"}, optimal quality level ${T}`)),T>-1)return T;const E=i.levels[o],A=i.loadLevelObj;return A&&E?.bitrate<A.bitrate?o:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,l,o,c){var d;const f=r+l,g=this.lastLoadedFragLevel,p=g===-1?this.hls.firstLevel:g,{fragCurrent:v,partCurrent:T}=this,{levels:E,allAudioTracks:A,loadLevel:b,config:L}=this.hls;if(E.length===1)return 0;const _=E[p],D=!!((d=this.hls.latestLevelDetails)!=null&&d.live),w=b===-1||g===-1;let k,$="SDR",M=_?.frameRate||0;const{audioPreference:B,videoPreference:V}=L,U=this.audioTracksByGroup||(this.audioTracksByGroup=sv(A));let te=-1;if(w){if(this.firstSelection!==-1)return this.firstSelection;const P=this.codecTiers||(this.codecTiers=BA(E,U,t,i)),X=UA(P,$,e,B,V),{codecSet:ne,videoRanges:Q,minFramerate:I,minBitrate:Y,minIndex:J,preferHDR:ie}=X;te=J,k=ne,$=ie?Q[Q.length-1]:Q[0],M=I,e=Math.max(e,Y),this.log(`picked start tier ${nt(X)}`)}else k=_?.codecSet,$=_?.videoRange;const re=T?T.duration:v?v.duration:0,de=this.bwEstimator.getEstimateTTFB()/1e3,ue=[];for(let P=i;P>=t;P--){var le;const X=E[P],ne=P>p;if(!X)continue;if(L.useMediaCapabilities&&!X.supportedResult&&!X.supportedPromise){const pe=navigator.mediaCapabilities;typeof pe?.decodingInfo=="function"&&(CA(X,U,$,M,e,B)||jo(X.videoCodec))?(X.supportedPromise=iv(X,U,pe),X.supportedPromise.then(fe=>{if(!this.hls)return;X.supportedResult=fe;const Ke=this.hls.levels,De=Ke.indexOf(X);fe.error?this.warn(`MediaCapabilities decodingInfo error: "${fe.error}" for level ${De} ${nt(fe)}`):fe.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${De} ${nt(fe)}`),De>-1&&Ke.length>1&&(this.log(`Removing unsupported level ${De}`),this.hls.removeLevel(De),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):X.supportedResult=ev}if((k&&X.codecSet!==k||$&&X.videoRange!==$||ne&&M>X.frameRate||!ne&&M>0&&M<X.frameRate||X.supportedResult&&!((le=X.supportedResult.decodingInfoResults)!=null&&le[0].smooth))&&(!w||P!==te)){ue.push(P);continue}const Q=X.details,I=(T?Q?.partTarget:Q?.averagetargetduration)||re;let Y;ne?Y=c*e:Y=o*e;const J=re&&r>=re*2&&l===0?X.averageBitrate:X.maxBitrate,ie=this.getTimeToLoadFrag(de,Y,J*I,Q===void 0);if(Y>=J&&(P===g||X.loadError===0&&X.fragmentError===0)&&(ie<=de||!he(ie)||D&&!this.bitrateTestDelay||ie<f)){const pe=this.forcedAutoLevel;return P!==b&&(pe===-1||pe!==b)&&(ue.length&&this.trace(`Skipped level(s) ${ue.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${E[ue[0]].codecs}" ${E[ue[0]].videoRange}; not compatible with "${k}" ${$}`),this.info(`switch candidate:${p}->${P} adjustedbw(${Math.round(Y)})-bitrate=${Math.round(Y-J)} ttfb:${de.toFixed(1)} avgDuration:${I.toFixed(1)} maxFetchDuration:${f.toFixed(1)} fetchDuration:${ie.toFixed(1)} firstSelection:${w} codecSet:${X.codecSet} videoRange:${X.videoRange} hls.loadLevel:${b}`)),w&&(this.firstSelection=P),P}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const nv={search:function(a,e){let t=0,i=a.length-1,r=null,l=null;for(;t<=i;){r=(t+i)/2|0,l=a[r];const o=e(l);if(o>0)t=r+1;else if(o<0)i=r-1;else return l}return null}};function VA(a,e,t){if(e===null||!Array.isArray(a)||!a.length||!he(e))return null;const i=a[0].programDateTime;if(e<(i||0))return null;const r=a[a.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let l=0;l<a.length;++l){const o=a[l];if(zA(e,t,o))return o}return null}function yn(a,e,t=0,i=0,r=.005){let l=null;if(a){l=e[1+a.sn-e[0].sn]||null;const c=a.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),l&&a.level!==l.level&&l.end<=a.end&&(l=e[2+a.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(l=e[0]);if(l&&((!a||a.level===l.level)&&g0(t,i,l)===0||KA(l,a,Math.min(r,i))))return l;const o=nv.search(e,g0.bind(null,t,i));return o&&(o!==a||!l)?o:l}function KA(a,e,t){if(e&&e.start===0&&e.level<a.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((r,l)=>(l[0]==="INF"&&(r+=parseFloat(l[1])),r),t);return a.start<=i}return!1}function g0(a=0,e=0,t){if(t.start<=a&&t.start+t.duration>a)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=a?1:t.start-i>a&&t.start?-1:0}function zA(a,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>a}function rv(a,e,t){if(a&&a.startCC<=e&&a.endCC>=e){let i=a.fragments;const{fragmentHint:r}=a;r&&(i=i.concat(r));let l;return nv.search(i,o=>o.cc<e?1:o.cc>e?-1:(l=o,o.end<=t?1:o.start>t?-1:0)),l||null}return null}function Fo(a){switch(a.details){case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_TIMEOUT:case K.LEVEL_LOAD_TIMEOUT:case K.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function m0(a,e){const t=Fo(e);return a.default[`${t?"timeout":"error"}Retry`]}function xf(a,e){const t=a.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*a.retryDelayMs,a.maxRetryDelayMs)}function p0(a){return Ge(Ge({},a),{errorRetry:null,timeoutRetry:null})}function $o(a,e,t,i){if(!a)return!1;const r=i?.code,l=e<a.maxNumRetry&&(qA(r)||!!t);return a.shouldRetry?a.shouldRetry(a,e,t,i,l):l}function qA(a){return a===0&&navigator.onLine===!1||!!a&&(a<400||a>499)}var Bt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ri={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class YA extends fs{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===me.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const r=this.hls,l=t.context;switch(t.details){case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case K.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Oa();return}case K.FRAG_GAP:case K.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Bt.SendAlternateToPenaltyBox;return}case K.LEVEL_EMPTY_ERROR:case K.LEVEL_PARSING_ERROR:{var o,c;const f=t.parent===me.MAIN?t.level:r.loadLevel;t.details===K.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(c=o.levelDetails)!=null&&c.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case K.LEVEL_LOAD_ERROR:case K.LEVEL_LOAD_TIMEOUT:typeof l?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l.level));return;case K.AUDIO_TRACK_LOAD_ERROR:case K.AUDIO_TRACK_LOAD_TIMEOUT:case K.SUBTITLE_LOAD_ERROR:case K.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){const f=r.loadLevelObj;if(f&&(l.type===we.AUDIO_TRACK&&f.hasAudioGroup(l.groupId)||l.type===we.SUBTITLE_TRACK&&f.hasSubtitleGroup(l.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Bt.SendAlternateToPenaltyBox,t.errorAction.flags=Ri.MoveAllAlternatesMatchingHost;return}}return;case K.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const f=r.loadLevelObj,g=f?.attrs["HDCP-LEVEL"];g?t.errorAction={action:Bt.SendAlternateToPenaltyBox,flags:Ri.MoveAllAlternatesMatchingHDCP,hdcpLevel:g}:this.keySystemError(t)}return;case K.BUFFER_ADD_CODEC_ERROR:case K.REMUX_ALLOC_ERROR:case K.BUFFER_APPEND_ERROR:if(!t.errorAction){var d;t.errorAction=this.getLevelSwitchAction(t,(d=t.level)!=null?d:r.loadLevel)}return;case K.INTERNAL_EXCEPTION:case K.BUFFER_APPENDING_ERROR:case K.BUFFER_FULL_ERROR:case K.LEVEL_SWITCH_ERROR:case K.BUFFER_STALLED_ERROR:case K.BUFFER_SEEK_OVER_HOLE:case K.BUFFER_NUDGE_ON_STALL:t.errorAction=Oa();return}t.type===ye.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,r=m0(i.config.playlistLoadPolicy,e),l=this.playlistError++;if($o(r,l,Fo(e),e.response))return{action:Bt.RetryRequest,flags:Ri.None,retryConfig:r,retryCount:l};const c=this.getLevelSwitchAction(e,t);return r&&(c.retryConfig=r,c.retryCount=l),c}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:l,keyLoadPolicy:o}=t.config,c=m0(e.details.startsWith("key")?o:l,e),d=t.levels.reduce((g,p)=>g+p.fragmentError,0);if(r&&(e.details!==K.FRAG_GAP&&r.fragmentError++,$o(c,d,Fo(e),e.response)))return{action:Bt.RetryRequest,flags:Ri.None,retryConfig:c,retryCount:d};const f=this.getLevelSwitchAction(e,i);return c&&(f.retryConfig=c,f.retryCount=d),f}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const r=this.hls.levels[t];if(r){var l,o;const f=e.details;r.loadError++,f===K.BUFFER_APPEND_ERROR&&r.fragmentError++;let g=-1;const{levels:p,loadLevel:v,minAutoLevel:T,maxAutoLevel:E}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const A=(l=e.frag)==null?void 0:l.type,L=(A===me.AUDIO&&f===K.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===K.BUFFER_ADD_CODEC_ERROR||f===K.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:$})=>r.audioCodec!==$),D=e.sourceBufferName==="video"&&(f===K.BUFFER_ADD_CODEC_ERROR||f===K.BUFFER_APPEND_ERROR)&&p.some(({codecSet:$,audioCodec:M})=>r.codecSet!==$&&r.audioCodec===M),{type:w,groupId:k}=(o=e.context)!=null?o:{};for(let $=p.length;$--;){const M=($+v)%p.length;if(M!==v&&M>=T&&M<=E&&p[M].loadError===0){var c,d;const B=p[M];if(f===K.FRAG_GAP&&A===me.MAIN&&e.frag){const V=p[M].details;if(V){const U=yn(e.frag,V.fragments,e.frag.start);if(U!=null&&U.gap)continue}}else{if(w===we.AUDIO_TRACK&&B.hasAudioGroup(k)||w===we.SUBTITLE_TRACK&&B.hasSubtitleGroup(k))continue;if(A===me.AUDIO&&(c=r.audioGroups)!=null&&c.some(V=>B.hasAudioGroup(V))||A===me.SUBTITLE&&(d=r.subtitleGroups)!=null&&d.some(V=>B.hasSubtitleGroup(V))||L&&r.audioCodec===B.audioCodec||!L&&r.audioCodec!==B.audioCodec||D&&r.codecSet===B.codecSet)continue}g=M;break}}if(g>-1&&i.loadLevel!==g)return e.levelRetry=!0,this.playlistError=0,{action:Bt.SendAlternateToPenaltyBox,flags:Ri.None,nextAutoLevel:g}}return{action:Bt.SendAlternateToPenaltyBox,flags:Ri.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case Bt.DoNothing:break;case Bt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==K.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:r,hdcpLevel:l,nextAutoLevel:o}=i;switch(r){case Ri.None:this.switchLevel(e,o);break;case Ri.MoveAllAlternatesMatchingHDCP:l&&(t.maxHdcpLevel=ef[ef.indexOf(l)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===K.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=Jy(e.mimeType),r=this.hls.levels;for(let l=r.length;l--;)r[l][`${e.sourceBufferName}Codec`]===i&&this.hls.removeLevel(l)}}}function Oa(a){const e={action:Bt.DoNothing,flags:Ri.None};return a&&(e.resolved=!0),e}var Tt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class jA{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let r=i.length;r--;){const l=i[r];if(!l)break;const o=l.end;if(l.start<=e&&o!==null&&e<=o)return l}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:r}=this,l=Object.keys(r);for(let o=l.length;o--;){const c=r[l[o]];if(c?.body.type===t&&(!i||c.buffered)){const d=c.body;if(d.start<=e&&e<=d.end)return d}}return null}detectEvictedFragments(e,t,i,r,l){this.timeRanges&&(this.timeRanges[e]=t);const o=r?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const d=this.fragments[c];if(!d||o>=d.body.sn)return;if(!d.buffered&&(!d.loaded||l)){d.body.type===i&&this.removeFragment(d.body);return}const f=d.range[e];if(f){if(f.time.length===0){this.removeFragment(d.body);return}f.time.some(g=>{const p=!this.isTimeBuffered(g.startPTS,g.endPTS,t);return p&&this.removeFragment(d.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,r=lr(i),l=this.fragments[r];if(!l||l.buffered&&i.gap)return;const o=!i.relurl;Object.keys(t).forEach(c=>{const d=i.elementaryStreams[c];if(!d)return;const f=t[c],g=o||d.partial===!0;l.range[c]=this.getBufferedTimes(i,e.part,g,f)}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,(l.body.endList=i.endList||l.body.endList)&&(this.endListFragments[l.body.type]=l),ro(l)||this.removeParts(i.sn-1,i.type)):this.removeFragment(l.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=y0(i,r=>r.fragment.sn>=e))}fragBuffered(e,t){const i=lr(e);let r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){const l={time:[],partial:i},o=e.start,c=e.end,d=e.minEndPTS||c,f=e.maxStartPTS||o;for(let g=0;g<r.length;g++){const p=r.start(g)-this.bufferPadding,v=r.end(g)+this.bufferPadding;if(f>=p&&d<=v){l.time.push({startPTS:Math.max(o,r.start(g)),endPTS:Math.min(c,r.end(g))});break}else if(o<v&&c>p){const T=Math.max(o,r.start(g)),E=Math.min(c,r.end(g));E>T&&(l.partial=!0,l.time.push({startPTS:T,endPTS:E}))}else if(c<=p)break}return l}getPartialFragment(e){let t=null,i,r,l,o=0;const{bufferPadding:c,fragments:d}=this;return Object.keys(d).forEach(f=>{const g=d[f];g&&ro(g)&&(r=g.body.start-c,l=g.body.end+c,e>=r&&e<=l&&(i=Math.min(e-r,l-e),o<=i&&(t=g.body,o=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ro(t))}getState(e){const t=lr(e),i=this.fragments[t];return i?i.buffered?ro(i)?Tt.PARTIAL:Tt.OK:Tt.APPENDING:Tt.NOT_LOADED}isTimeBuffered(e,t,i){let r,l;for(let o=0;o<i.length;o++){if(r=i.start(o)-this.bufferPadding,l=i.end(o)+this.bufferPadding,e>=r&&t<=l)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,r=t.part?null:t,l=lr(i);this.fragments[l]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:r,timeRanges:l,type:o}=t;if(i.sn==="initSegment")return;const c=i.type;if(r){let f=this.activePartLists[c];f||(this.activePartLists[c]=f=[]),f.push(r)}this.timeRanges=l;const d=l[o];this.detectEvictedFragments(o,d,c,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=lr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let r=i.length;r--;){const l=t[i[r]];if(l?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,r,l){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const c=this.fragments[o];if(!c)return;const d=c.body;d.type!==i||r&&!d.gap||d.start<t&&d.end>e&&(c.buffered||l)&&this.removeFragment(d)})}removeFragment(e){const t=lr(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const r=e.sn;this.activePartLists[e.type]=y0(i,l=>l.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const i=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;i&&i.forEach(r=>r.clearElementaryStreamInfo())}}function ro(a){var e,t,i;return a.buffered&&(a.body.gap||((e=a.range.video)==null?void 0:e.partial)||((t=a.range.audio)==null?void 0:t.partial)||((i=a.range.audiovideo)==null?void 0:i.partial))}function lr(a){return`${a.type}_${a.level}_${a.sn}`}function y0(a,e){return a.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var Vs={cbc:0,ctr:1};class XA{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case Vs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Vs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function QA(a){const e=a.byteLength,t=e&&new DataView(a.buffer).getUint8(e-1);return t?a.slice(0,e-t):a}class WA{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(r*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],l=i[1],o=i[2],c=i[3],d=this.invSubMix,f=d[0],g=d[1],p=d[2],v=d[3],T=new Uint32Array(256);let E=0,A=0,b=0;for(b=0;b<256;b++)b<128?T[b]=b<<1:T[b]=b<<1^283;for(b=0;b<256;b++){let L=A^A<<1^A<<2^A<<3^A<<4;L=L>>>8^L&255^99,e[E]=L,t[L]=E;const _=T[E],D=T[_],w=T[D];let k=T[L]*257^L*16843008;r[E]=k<<24|k>>>8,l[E]=k<<16|k>>>16,o[E]=k<<8|k>>>24,c[E]=k,k=w*16843009^D*65537^_*257^E*16843008,f[L]=k<<24|k>>>8,g[L]=k<<16|k>>>16,p[L]=k<<8|k>>>24,v[L]=k,E?(E=_^T[T[T[w^_]]],A^=T[T[A]]):E=A=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;const l=this.keySize=t.length;if(l!==4&&l!==6&&l!==8)throw new Error("Invalid aes key size="+l);const o=this.ksRows=(l+6+1)*4;let c,d;const f=this.keySchedule=new Uint32Array(o),g=this.invKeySchedule=new Uint32Array(o),p=this.sBox,v=this.rcon,T=this.invSubMix,E=T[0],A=T[1],b=T[2],L=T[3];let _,D;for(c=0;c<o;c++){if(c<l){_=f[c]=t[c];continue}D=_,c%l===0?(D=D<<8|D>>>24,D=p[D>>>24]<<24|p[D>>>16&255]<<16|p[D>>>8&255]<<8|p[D&255],D^=v[c/l|0]<<24):l>6&&c%l===4&&(D=p[D>>>24]<<24|p[D>>>16&255]<<16|p[D>>>8&255]<<8|p[D&255]),f[c]=_=(f[c-l]^D)>>>0}for(d=0;d<o;d++)c=o-d,d&3?D=f[c]:D=f[c-4],d<4||c<=4?g[d]=D:g[d]=E[p[D>>>24]]^A[p[D>>>16&255]]^b[p[D>>>8&255]]^L[p[D&255]],g[d]=g[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const r=this.keySize+6,l=this.invKeySchedule,o=this.invSBox,c=this.invSubMix,d=c[0],f=c[1],g=c[2],p=c[3],v=this.uint8ArrayToUint32Array_(i);let T=v[0],E=v[1],A=v[2],b=v[3];const L=new Int32Array(e),_=new Int32Array(L.length);let D,w,k,$,M,B,V,U,te,re,de,ue,le,P;const X=this.networkToHostOrderSwap;for(;t<L.length;){for(te=X(L[t]),re=X(L[t+1]),de=X(L[t+2]),ue=X(L[t+3]),M=te^l[0],B=ue^l[1],V=de^l[2],U=re^l[3],le=4,P=1;P<r;P++)D=d[M>>>24]^f[B>>16&255]^g[V>>8&255]^p[U&255]^l[le],w=d[B>>>24]^f[V>>16&255]^g[U>>8&255]^p[M&255]^l[le+1],k=d[V>>>24]^f[U>>16&255]^g[M>>8&255]^p[B&255]^l[le+2],$=d[U>>>24]^f[M>>16&255]^g[B>>8&255]^p[V&255]^l[le+3],M=D,B=w,V=k,U=$,le=le+4;D=o[M>>>24]<<24^o[B>>16&255]<<16^o[V>>8&255]<<8^o[U&255]^l[le],w=o[B>>>24]<<24^o[V>>16&255]<<16^o[U>>8&255]<<8^o[M&255]^l[le+1],k=o[V>>>24]<<24^o[U>>16&255]<<16^o[M>>8&255]<<8^o[B&255]^l[le+2],$=o[U>>>24]<<24^o[M>>16&255]<<16^o[B>>8&255]<<8^o[V&255]^l[le+3],_[t]=X(D^T),_[t+1]=X($^E),_[t+2]=X(k^A),_[t+3]=X(w^b),T=te,E=re,A=de,b=ue,t=t+4}return _.buffer}}class ZA{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=JA(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function JA(a){switch(a){case Vs.cbc:return"AES-CBC";case Vs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${a}`)}}const ex=16;class Lf{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?QA(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,r){return this.useSoftware?new Promise((l,o)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,i,r);const d=this.flush();d?l(d.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,r)}softwareDecrypt(e,t,i,r){const{currentIV:l,currentResult:o,remainderData:c}=this;if(r!==Vs.cbc||t.byteLength!==16)return Fe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=vi(c,e),this.remainderData=null);const d=this.getValidChunk(e);if(!d.length)return null;l&&(i=l);let f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new WA),f.expandKey(t);const g=o;return this.currentResult=f.decrypt(d.buffer,0,i),this.currentIV=d.slice(-16).buffer,g||null}webCryptoDecrypt(e,t,i,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,r));this.key=t,this.fastAesKey=new ZA(this.subtle,t,r)}return this.fastAesKey.expandKey().then(l=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new XA(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,l)):Promise.reject(new Error("web crypto not initialized"))).catch(l=>(Fe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${l.name}: ${l.message}`),this.onWebCryptoError(e,t,i,r)))}onWebCryptoError(e,t,i,r){const l=this.enableSoftwareAES;if(l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,r);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(l?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%ex;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Fe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const v0=Math.pow(2,17);class tx{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new os({type:ye.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,l=r.fLoader,o=r.loader;return new Promise((c,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(E=>E[0]==="GAP")){d(E0(e));return}else e.gap=!1;const f=this.loader=l?new l(r):new o(r),g=T0(e);e.loader=f;const p=p0(r.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:v0};e.stats=f.stats;const T={onSuccess:(E,A,b,L)=>{this.resetLoader(e,f);let _=E.data;b.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),c({frag:e,part:null,payload:_,networkDetails:L})},onError:(E,A,b,L)=>{this.resetLoader(e,f),d(new os({type:ye.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ge({url:i,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:b,stats:L}))},onAbort:(E,A,b)=>{this.resetLoader(e,f),d(new os({type:ye.NETWORK_ERROR,details:K.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:b,stats:E}))},onTimeout:(E,A,b)=>{this.resetLoader(e,f),d(new os({type:ye.NETWORK_ERROR,details:K.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:b,stats:E}))}};t&&(T.onProgress=(E,A,b,L)=>t({frag:e,part:null,payload:b,networkDetails:L})),f.load(g,v,T)})}loadPart(e,t,i){this.abort();const r=this.config,l=r.fLoader,o=r.loader;return new Promise((c,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(E0(e,t));return}const f=this.loader=l?new l(r):new o(r),g=T0(e,t);e.loader=f;const p=p0(r.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:v0};t.stats=f.stats,f.load(g,v,{onSuccess:(T,E,A,b)=>{this.resetLoader(e,f),this.updateStatsFromPart(e,t);const L={frag:e,part:t,payload:T.data,networkDetails:b};i(L),c(L)},onError:(T,E,A,b)=>{this.resetLoader(e,f),d(new os({type:ye.NETWORK_ERROR,details:K.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ge({url:g.url,data:void 0},T),error:new Error(`HTTP Error ${T.code} ${T.text}`),networkDetails:A,stats:b}))},onAbort:(T,E,A)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,f),d(new os({type:ye.NETWORK_ERROR,details:K.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:A,stats:T}))},onTimeout:(T,E,A)=>{this.resetLoader(e,f),d(new os({type:ye.NETWORK_ERROR,details:K.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:A,stats:T}))}})})}updateStatsFromPart(e,t){const i=e.stats,r=t.stats,l=r.total;if(i.loaded+=r.loaded,l){const d=Math.round(e.duration/t.duration),f=Math.min(Math.round(i.loaded/l),d),p=(d-f)*Math.round(i.loaded/f);i.total=i.loaded+p}else i.total=Math.max(i.loaded,i.total);const o=i.loading,c=r.loading;o.start?o.first+=c.first-c.start:(o.start=c.start,o.first=c.first),o.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function T0(a,e=null){const t=e||a,i={frag:a,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,l=t.byteRangeEndOffset;if(he(r)&&he(l)){var o;let c=r,d=l;if(a.sn==="initSegment"&&ix((o=a.decryptdata)==null?void 0:o.method)){const f=l-r;f%16&&(d=l+(16-f%16)),r!==0&&(i.resetIV=!0,c=r-16)}i.rangeStart=c,i.rangeEnd=d}return i}function E0(a,e){const t=new Error(`GAP ${a.gap?"tag":"attribute"} found`),i={type:ye.MEDIA_ERROR,details:K.FRAG_GAP,fatal:!1,frag:a,error:t,networkDetails:null};return e&&(i.part=e),(e||a).stats.aborted=!0,new os(i)}function ix(a){return a==="AES-128"||a==="AES-256"}class os extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class av extends fs{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Rf{constructor(e,t,i,r=0,l=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ao(),this.buffering={audio:ao(),video:ao(),audiovideo:ao()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=l,this.partial=o}}function ao(){return{start:0,executeStart:0,executeEnd:0,end:0}}const S0={length:0,start:()=>0,end:()=>0};class Le{static isBuffered(e,t){if(e){const i=Le.getBuffered(e);for(let r=i.length;r--;)if(t>=i.start(r)&&t<=i.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=Le.getBuffered(e);return Le.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const r=Le.bufferedRanges(e);if(r.length)return Le.bufferedInfo(r,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((g,p)=>g.start-p.start||p.end-g.end);let r=-1,l=[];if(i)for(let g=0;g<e.length;g++){t>=e[g].start&&t<=e[g].end&&(r=g);const p=l.length;if(p){const v=l[p-1].end;e[g].start-v<i?e[g].end>v&&(l[p-1].end=e[g].end):l.push(e[g])}else l.push(e[g])}else l=e;let o=0,c,d=t,f=t;for(let g=0;g<l.length;g++){const p=l[g].start,v=l[g].end;if(r===-1&&t>=p&&t<=v&&(r=g),t+i>=p&&t<v)d=p,f=v,o=f-t;else if(t+i<p){c=p;break}}return{len:o,start:d||0,end:f||0,nextStart:c,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||S0}catch(t){return Fe.log("failed to get media.buffered",t),S0}}}const lv=/\{\$([a-zA-Z0-9-_]+)\}/g;function b0(a){return lv.test(a)}function tf(a,e){if(a.variableList!==null||a.hasVariableRefs){const t=a.variableList;return e.replace(lv,i=>{const r=i.substring(2,i.length-1),l=t?.[r];return l===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):l})}return e}function A0(a,e,t){let i=a.variableList;i||(a.variableList=i={});let r,l;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(r))l=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(o){a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=e.NAME,l=e.VALUE;r in i?a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=l||""}function sx(a,e,t){const i=e.IMPORT;if(t&&i in t){let r=a.variableList;r||(a.variableList=r={}),r[i]=t[i]}else a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const nx=/^(\d+)x(\d+)$/,x0=/(.+?)=(".*?"|.*?)(?:,|$)/g;class at{constructor(e,t){typeof e=="string"&&(e=at.parseAttrList(e,t)),Ye(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(r*2,r*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((r,l)=>(r[l.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=nx.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const r={},l='"';for(x0.lastIndex=0;(i=x0.exec(e))!==null;){const o=i[1].trim();let c=i[2];const d=c.indexOf(l)===0&&c.lastIndexOf(l)===c.length-1;let f=!1;if(d)c=c.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":f=!0}if(t&&(d||f))c=tf(t,c);else if(!f&&!d)switch(o){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Fe.warn(`${e}: attribute ${o} is missing quotes`)}r[o]=c}return r}}const rx="com.apple.hls.interstitial";function ax(a){return a!=="ID"&&a!=="CLASS"&&a!=="CUE"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function lx(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}class ov{constructor(e,t,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(r=t?.tagOrder)!=null?r:i,t){const l=t.attr;for(const o in l)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==l[o]){Fe.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Ye(new at({}),l,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const l=t?.endDate||new Date(this.attr["END-DATE"]);he(l.getTime())&&(this._endDate=l)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Fe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(he(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===rx}get isValid(){return!!this.id&&!this._badValueForSameId&&he(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const ox=10;class ux{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?he(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||ox}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function fr(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function _f(a){switch(a){case"AES-128":case"AES-256":return Vs.cbc;case"AES-256-CTR":return Vs.ctr;default:throw new Error(`invalid full segment method ${a}`)}}function Df(a){return Uint8Array.from(atob(a),e=>e.charCodeAt(0))}function sf(a){return Uint8Array.from(unescape(encodeURIComponent(a)),e=>e.charCodeAt(0))}function cx(a){const e=sf(a).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function hx(a){const e=function(i,r,l){const o=i[r];i[r]=i[l],i[l]=o};e(a,0,3),e(a,1,2),e(a,4,5),e(a,6,7)}function fx(a){const e=a.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){const l=r[0]==="base64",o=r[1];l?(i.splice(-1,1),t=Df(o)):t=cx(o)}}return t}const Go=typeof self<"u"?self:void 0;var Ve={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},jt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Lo(a){switch(a){case jt.FAIRPLAY:return Ve.FAIRPLAY;case jt.PLAYREADY:return Ve.PLAYREADY;case jt.WIDEVINE:return Ve.WIDEVINE;case jt.CLEARKEY:return Ve.CLEARKEY}}var lo={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Lh(a){if(a===lo.WIDEVINE)return Ve.WIDEVINE;if(a===lo.PLAYREADY)return Ve.PLAYREADY;if(a===lo.CENC||a===lo.CLEARKEY)return Ve.CLEARKEY}function oo(a){switch(a){case Ve.FAIRPLAY:return jt.FAIRPLAY;case Ve.PLAYREADY:return jt.PLAYREADY;case Ve.WIDEVINE:return jt.WIDEVINE;case Ve.CLEARKEY:return jt.CLEARKEY}}function ba(a){const{drmSystems:e,widevineLicenseUrl:t}=a,i=e?[Ve.FAIRPLAY,Ve.WIDEVINE,Ve.PLAYREADY,Ve.CLEARKEY].filter(r=>!!e[r]):[];return!i[Ve.WIDEVINE]&&t&&i.push(Ve.WIDEVINE),i}const uv=function(a){return Go!=null&&(a=Go.navigator)!=null&&a.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function dx(a,e,t,i){let r;switch(a){case Ve.FAIRPLAY:r=["cenc","sinf"];break;case Ve.WIDEVINE:case Ve.PLAYREADY:r=["cenc"];break;case Ve.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${a}`)}return gx(r,e,t,i)}function gx(a,e,t,i){return[{initDataTypes:a,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(l=>({contentType:`audio/mp4; codecs=${l}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(l=>({contentType:`video/mp4; codecs=${l}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function mx(a){var e;return a.sessionType==="persistent-license"||!!((e=a.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function cv(a){const e=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){const c=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(c){const d=Df(c).subarray(0,16);return hx(d),d}}return null}let uo={};class Ma{static clearKeyUriToKeyIdMap(){uo={}}constructor(e,t,i,r=[1],l=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=l,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!fr(e)}isSupported(){if(this.method){if(fr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case jt.FAIRPLAY:case jt.WIDEVINE:case jt.PLAYREADY:case jt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(fr(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Fe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=px(e);return new Ma(this.method,this.uri,"identity",this.keyFormatVersions,i)}const t=fx(this.uri);if(t)switch(this.keyFormat){case jt.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case jt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=bA(i,null,t),this.keyId=cv(t);break}default:{let i=t.subarray(0,16);if(i.length!==16){const r=new Uint8Array(16);r.set(i,16-i.length),i=r}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=uo[this.uri];if(!i){const r=Object.keys(uo).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,r),uo[this.uri]=i}this.keyId=i}return this}}function px(a){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=a>>8*(15-t)&255;return e}const L0=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,R0=/#EXT-X-MEDIA:(.*)/g,yx=/^#EXT(?:INF|-X-TARGETDURATION):/m,Rh=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),vx=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Hi{static findGroup(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}}static resolve(e,t){return Sf.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return yx.test(e)}static parseMasterPlaylist(e,t){const i=b0(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},l=[];L0.lastIndex=0;let o;for(;(o=L0.exec(e))!=null;)if(o[1]){var c;const f=new at(o[1],r),g=tf(r,o[2]),p={attrs:f,bitrate:f.decimalInteger("BANDWIDTH")||f.decimalInteger("AVERAGE-BANDWIDTH"),name:f.NAME,url:Hi.resolve(g,t)},v=f.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),I0(f.CODECS,p);const T=f["SUPPLEMENTAL-CODECS"];T&&(p.supplemental={},I0(T,p.supplemental)),(c=p.unknownCodecs)!=null&&c.length||l.push(p),r.levels.push(p)}else if(o[3]){const f=o[3],g=o[4];switch(f){case"SESSION-DATA":{const p=new at(g,r),v=p["DATA-ID"];v&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[v]=p);break}case"SESSION-KEY":{const p=_0(g,t,r);p.encrypted&&p.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(p)):Fe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const p=new at(g,r);A0(r,p,t)}break}case"CONTENT-STEERING":{const p=new at(g,r);r.contentSteering={uri:Hi.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=D0(g);break}}}const d=l.length>0&&l.length<r.levels.length;return r.levels=d?l:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,i){let r;const l={},o=i.levels,c={AUDIO:o.map(f=>({id:f.attrs.AUDIO,audioCodec:f.audioCodec})),SUBTITLES:o.map(f=>({id:f.attrs.SUBTITLES,textCodec:f.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(R0.lastIndex=0;(r=R0.exec(e))!==null;){const f=new at(r[1],i),g=f.TYPE;if(g){const p=c[g],v=l[g]||[];l[g]=v;const T=f.LANGUAGE,E=f["ASSOC-LANGUAGE"],A=f.CHANNELS,b=f.CHARACTERISTICS,L=f["INSTREAM-ID"],_={attrs:f,bitrate:0,id:d++,groupId:f["GROUP-ID"]||"",name:f.NAME||T||"",type:g,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:T,url:f.URI?Hi.resolve(f.URI,t):""};if(E&&(_.assocLang=E),A&&(_.channels=A),b&&(_.characteristics=b),L&&(_.instreamId=L),p!=null&&p.length){const D=Hi.findGroup(p,_.groupId)||p[0];C0(_,D,"audioCodec"),C0(_,D,"textCodec")}v.push(_)}}return l}static parseLevelPlaylist(e,t,i,r,l,o){var c;const d={url:t},f=new ux(t),g=f.fragments,p=[];let v=null,T=0,E=0,A=0,b=0,L=0,_=null,D=new Sh(r,d),w,k,$,M=-1,B=!1,V=null,U;if(Rh.lastIndex=0,f.m3u8=e,f.hasVariableRefs=b0(e),((c=Rh.exec(e))==null?void 0:c[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(w=Rh.exec(e))!==null;){B&&(B=!1,D=new Sh(r,d),D.playlistOffset=A,D.start=A,D.sn=T,D.cc=b,L&&(D.bitrate=L),D.level=i,v&&(D.initSegment=v,v.rawProgramDateTime&&(D.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),V&&(D.setByteRange(V),V=null)));const ue=w[1];if(ue){D.duration=parseFloat(ue);const le=(" "+w[2]).slice(1);D.title=le||null,D.tagList.push(le?["INF",ue,le]:["INF",ue])}else if(w[3]){if(he(D.duration)){D.playlistOffset=A,D.start=A,$&&k0(D,$,f),D.sn=T,D.level=i,D.cc=b,g.push(D);const le=(" "+w[3]).slice(1);D.relurl=tf(f,le),nf(D,_,p),_=D,A+=D.duration,T++,E=0,B=!0}}else{if(w=w[0].match(vx),!w){Fe.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<w.length&&w[k]===void 0;k++);const le=(" "+w[k]).slice(1),P=(" "+w[k+1]).slice(1),X=w[k+2]?(" "+w[k+2]).slice(1):null;switch(le){case"BYTERANGE":_?D.setByteRange(P,_):D.setByteRange(P);break;case"PROGRAM-DATE-TIME":D.rawProgramDateTime=P,D.tagList.push(["PROGRAM-DATE-TIME",P]),M===-1&&(M=g.length);break;case"PLAYLIST-TYPE":f.type&&as(f,le,w),f.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?as(f,le,w):g.length>0&&O0(f,le,w),T=f.startSN=parseInt(P);break;case"SKIP":{f.skippedSegments&&as(f,le,w);const ne=new at(P,f),Q=ne.decimalInteger("SKIPPED-SEGMENTS");if(he(Q)){f.skippedSegments+=Q;for(let Y=Q;Y--;)g.push(null);T+=Q}const I=ne.enumeratedString("RECENTLY-REMOVED-DATERANGES");I&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(I.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&as(f,le,w),f.targetduration=Math.max(parseInt(P),1);break;case"VERSION":f.version!==null&&as(f,le,w),f.version=parseInt(P);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||as(f,le,w),f.live=!1;break;case"#":(P||X)&&D.tagList.push(X?[P,X]:[P]);break;case"DISCONTINUITY":b++,D.tagList.push(["DIS"]);break;case"GAP":D.gap=!0,D.tagList.push([le]);break;case"BITRATE":D.tagList.push([le,P]),L=parseInt(P)*1e3,he(L)?D.bitrate=L:L=0;break;case"DATERANGE":{const ne=new at(P,f),Q=new ov(ne,f.dateRanges[ne.ID],f.dateRangeTagCount);f.dateRangeTagCount++,Q.isValid||f.skippedSegments?f.dateRanges[Q.id]=Q:Fe.warn(`Ignoring invalid DATERANGE tag: "${P}"`),D.tagList.push(["EXT-X-DATERANGE",P]);break}case"DEFINE":{{const ne=new at(P,f);"IMPORT"in ne?sx(f,ne,o):A0(f,ne,t)}break}case"DISCONTINUITY-SEQUENCE":f.startCC!==0?as(f,le,w):g.length>0&&O0(f,le,w),f.startCC=b=parseInt(P);break;case"KEY":{const ne=_0(P,t,f);if(ne.isSupported()){if(ne.method==="NONE"){$=void 0;break}$||($={}),$[ne.keyFormat]&&($=Ye({},$)),$[ne.keyFormat]=ne}else Fe.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${P}"`);break}case"START":f.startTimeOffset=D0(P);break;case"MAP":{const ne=new at(P,f);if(D.duration){const Q=new Sh(r,d);w0(Q,ne,i,$),v=Q,D.initSegment=v,v.rawProgramDateTime&&!D.rawProgramDateTime&&(D.rawProgramDateTime=v.rawProgramDateTime)}else{const Q=D.byteRangeEndOffset;if(Q){const I=D.byteRangeStartOffset;V=`${Q-I}@${I}`}else V=null;w0(D,ne,i,$),v=D,B=!0}v.cc=b;break}case"SERVER-CONTROL":{U&&as(f,le,w),U=new at(P),f.canBlockReload=U.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=U.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&U.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=U.optionalFloat("PART-HOLD-BACK",0),f.holdBack=U.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&as(f,le,w);const ne=new at(P);f.partTarget=ne.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ne=f.partList;ne||(ne=f.partList=[]);const Q=E>0?ne[ne.length-1]:void 0,I=E++,Y=new at(P,f),J=new oA(Y,D,d,I,Q);ne.push(J),D.duration+=J.duration;break}case"PRELOAD-HINT":{const ne=new at(P,f);f.preloadHint=ne;break}case"RENDITION-REPORT":{const ne=new at(P,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(ne);break}default:Fe.warn(`line parsed but not handled: ${w}`);break}}}_&&!_.relurl?(g.pop(),A-=_.duration,f.partList&&(f.fragmentHint=_)):f.partList&&(nf(D,_,p),D.cc=b,f.fragmentHint=D,$&&k0(D,$,f)),f.targetduration||(f.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const te=g.length,re=g[0],de=g[te-1];if(A+=f.skippedSegments*f.targetduration,A>0&&te&&de){f.averagetargetduration=A/te;const ue=de.sn;f.endSN=ue!=="initSegment"?ue:0,f.live||(de.endList=!0),re&&f.startCC===void 0&&(f.startCC=re.cc),M>0&&(Ex(g,M),re&&p.unshift(re))}else f.endSN=0,f.startCC=0;return f.fragmentHint&&(A+=f.fragmentHint.duration),f.totalduration=A,p.length&&f.dateRangeTagCount&&re&&hv(p,f),f.endCC=b,f}}function hv(a,e){const t=a.length;if(!t)return;const i=a[t-1],r=e.live?1/0:e.totalduration,l=Object.keys(e.dateRanges);for(let o=l.length;o--;){const c=e.dateRanges[l[o]],d=c.startDate.getTime();c.tagAnchor=i.ref;for(let f=t;f--;){const g=Tx(e,d,a,f,r);if(g!==-1){c.tagAnchor=e.fragments[g].ref;break}}}}function Tx(a,e,t,i,r){const l=t[i];if(l){const c=l.programDateTime;if(e>=c||i===0){var o;const d=(((o=t[i+1])==null?void 0:o.start)||r)-l.start;if(e<=c+d*1e3){const f=t[i].sn-a.startSN,g=a.fragments;if(g.length>t.length){const v=(t[i+1]||g[g.length-1]).sn-a.startSN;for(let T=v;T>f;T--){const E=g[T].programDateTime;if(e>=E&&e<E+g[T].duration*1e3)return T}}return f}}}return-1}function _0(a,e,t){var i,r;const l=new at(a,t),o=(i=l.METHOD)!=null?i:"",c=l.URI,d=l.hexadecimalInteger("IV"),f=l.KEYFORMATVERSIONS,g=(r=l.KEYFORMAT)!=null?r:"identity";c&&l.IV&&!d&&Fe.error(`Invalid IV: ${l.IV}`);const p=c?Hi.resolve(c,e):"",v=(f||"1").split("/").map(Number).filter(Number.isFinite);return new Ma(o,p,g,v,d)}function D0(a){const t=new at(a).decimalFloatingPoint("TIME-OFFSET");return he(t)?t:null}function I0(a,e){let t=(a||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const r=t.filter(l=>Wy(l,i));r.length&&(e[`${i}Codec`]=r.map(l=>l.split("/")[0]).join(","),t=t.filter(l=>r.indexOf(l)===-1))}),e.unknownCodecs=t}function C0(a,e,t){const i=e[t];i&&(a[t]=i)}function Ex(a,e){let t=a[e];for(let i=e;i--;){const r=a[i];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function nf(a,e,t){a.rawProgramDateTime?t.push(a):e!=null&&e.programDateTime&&(a.programDateTime=e.endProgramDateTime)}function w0(a,e,t,i){a.relurl=e.URI,e.BYTERANGE&&a.setByteRange(e.BYTERANGE),a.level=t,a.sn="initSegment",i&&(a.levelkeys=i),a.initSegment=null}function k0(a,e,t){a.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(a)}function as(a,e,t){a.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function O0(a,e,t){a.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function _h(a,e){const t=e.startPTS;if(he(t)){let i=0,r;e.sn>a.sn?(i=t-a.start,r=a):(i=a.start-t,r=e),r.duration!==i&&r.setDuration(i)}else e.sn>a.sn?a.cc===e.cc&&a.minEndPTS?e.setStart(a.start+(a.minEndPTS-a.start)):e.setStart(a.start+a.duration):e.setStart(Math.max(a.start-e.duration,0))}function fv(a,e,t,i,r,l){i-t<=0&&(Fe.warn("Fragment should have a positive duration",e),i=t+e.duration,l=r+e.duration);let c=t,d=i;const f=e.startPTS,g=e.endPTS;if(he(f)){const b=Math.abs(f-t);he(e.deltaPTS)?e.deltaPTS=Math.max(b,e.deltaPTS):e.deltaPTS=b,c=Math.max(t,f),t=Math.min(t,f),r=Math.min(r,e.startDTS),d=Math.min(i,g),i=Math.max(i,g),l=Math.max(l,e.endDTS)}const p=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=c,e.startDTS=r,e.endPTS=i,e.minEndPTS=d,e.endDTS=l;const v=e.sn;if(!a||v<a.startSN||v>a.endSN)return 0;let T;const E=v-a.startSN,A=a.fragments;for(A[E]=e,T=E;T>0;T--)_h(A[T],A[T-1]);for(T=E;T<A.length-1;T++)_h(A[T],A[T+1]);return a.fragmentHint&&_h(A[A.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,p}function Sx(a,e){if(a===e)return;let t=null;const i=a.fragments;for(let f=i.length-1;f>=0;f--){const g=i[f].initSegment;if(g){t=g;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;let r;xx(a,e,(f,g,p,v)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==f.cc){const T=f.cc-g.cc;for(let E=p;E<v.length;E++)v[E].cc+=T;e.endCC=v[v.length-1].cc}he(f.startPTS)&&he(f.endPTS)&&(g.setStart(g.startPTS=f.startPTS),g.startDTS=f.startDTS,g.maxStartPTS=f.maxStartPTS,g.endPTS=f.endPTS,g.endDTS=f.endDTS,g.minEndPTS=f.minEndPTS,g.setDuration(f.endPTS-f.startPTS),g.duration&&(r=g),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(g.elementaryStreams=f.elementaryStreams),g.loader=f.loader,f.hasStats&&(g.stats=f.stats),f.initSegment&&(g.initSegment=f.initSegment,t=f.initSegment)});const l=e.fragments,o=e.fragmentHint?l.concat(e.fragmentHint):l;if(t&&o.forEach(f=>{var g;f&&(!f.initSegment||f.initSegment.relurl===((g=t)==null?void 0:g.relurl))&&(f.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=l.some(f=>!f),e.deltaUpdateFailed){Fe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)l.shift();e.startSN=l[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=bx(a.dateRanges,e));const f=a.fragments.filter(g=>g.rawProgramDateTime);if(a.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<o.length;g++)o[g].programDateTime===null&&nf(o[g],o[g-1],f);hv(f,e)}e.endCC=l[l.length-1].cc}if(!e.startCC){var c;const f=mv(a,e.startSN-1);e.startCC=(c=f?.cc)!=null?c:l[0].cc}Ax(a.partList,e.partList,(f,g)=>{g.elementaryStreams=f.elementaryStreams,g.stats=f.stats}),r?fv(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):dv(a,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=a.driftStartTime,e.driftStart=a.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const f=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=f),e.driftEndTime=d,e.driftEnd=f}else e.driftEndTime=a.driftEndTime,e.driftEnd=a.driftEnd,e.advancedDateTime=a.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=a.requestScheduled)}function bx(a,e){const{dateRanges:t,recentlyRemovedDateranges:i}=e,r=Ye({},a);i&&i.forEach(c=>{delete r[c]});const o=Object.keys(r).length;return o&&Object.keys(t).forEach(c=>{const d=r[c],f=new ov(t[c].attr,d);f.isValid?(r[c]=f,d||(f.tagOrder+=o)):Fe.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${nt(t[c].attr)}"`)}),r}function Ax(a,e,t){if(a&&e){let i=0;for(let r=0,l=a.length;r<=l;r++){const o=a[r],c=e[r+i];o&&c&&o.index===c.index&&o.fragment.sn===c.fragment.sn?t(o,c):i--}}}function xx(a,e,t){const i=e.skippedSegments,r=Math.max(a.startSN,e.startSN)-e.startSN,l=(a.fragmentHint?1:0)+(i?e.endSN:Math.min(a.endSN,e.endSN))-e.startSN,o=e.startSN-a.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;for(let f=r;f<=l;f++){const g=d[o+f];let p=c[f];if(i&&!p&&g&&(p=e.fragments[f]=g),g&&p){if(t(g,p,f,c),g.url&&g.url!==p.url){e.playlistParsingError=M0(`media sequence mismatch ${p.sn}:`,a,e,g,p);return}else if(g.cc!==p.cc){e.playlistParsingError=M0(`discontinuity sequence mismatch (${g.cc}!=${p.cc})`,a,e,g,p);return}}}}function M0(a,e,t,i,r){return new Error(`${a} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function dv(a,e,t=!0){const i=e.startSN+e.skippedSegments-a.startSN,r=a.fragments,l=i>=0;let o=0;if(l&&i<r.length)o=r[i].start;else if(l&&e.startSN===a.endSN+1)o=a.fragmentEnd;else if(l&&t)o=a.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=a.fragmentStart;else return;rf(e,o)}function rf(a,e){if(e){const t=a.fragments;for(let i=a.skippedSegments;i<t.length;i++)t[i].addStart(e);a.fragmentHint&&a.fragmentHint.addStart(e)}}function gv(a,e=1/0){let t=1e3*a.targetduration;if(a.updated){const i=a.fragments;if(i.length&&t*4>e){const l=i[i.length-1].duration*1e3;l<t&&(t=l)}}else t/=2;return Math.round(t)}function mv(a,e,t){if(!a)return null;let i=a.fragments[e-a.startSN];return i||(i=a.fragmentHint,i&&i.sn===e)?i:e<a.startSN&&t&&t.sn===e?t:null}function P0(a,e,t){return a?pv(a.partList,e,t):null}function pv(a,e,t){if(a)for(let i=a.length;i--;){const r=a[i];if(r.index===t&&r.fragment.sn===e)return r}return null}function yv(a){a.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function La(a,e){for(let i=0,r=a.length;i<r;i++){var t;if(((t=a[i])==null?void 0:t.cc)===e)return a[i]}return null}function Lx(a,e){return!!(a&&e.startCC<a.endCC&&e.endCC>a.startCC)}function N0(a,e){if(a){const t=a.start+e;a.start=a.startPTS=t,a.endPTS=t+a.duration}}function vv(a,e){const t=e.fragments;for(let i=0,r=t.length;i<r;i++)N0(t[i],a);e.fragmentHint&&N0(e.fragmentHint,a),e.alignedSliding=!0}function Rx(a,e){a&&(Tv(e,a),!e.alignedSliding&&a&&Ho(e,a),!e.alignedSliding&&a&&!e.skippedSegments&&dv(a,e,!1))}function Tv(a,e){if(!Lx(e,a))return;const t=Math.min(e.endCC,a.endCC),i=La(e.fragments,t),r=La(a.fragments,t);if(!i||!r)return;Fe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const l=i.start-r.start;vv(l,a)}function Ho(a,e){if(!a.hasProgramDateTime||!e.hasProgramDateTime)return;const t=a.fragments,i=e.fragments;if(!t.length||!i.length)return;let r,l;const o=Math.min(e.endCC,a.endCC);e.startCC<o&&a.startCC<o&&(r=La(i,o),l=La(t,o)),(!r||!l)&&(r=i[Math.floor(i.length/2)],l=La(t,r.cc)||t[Math.floor(t.length/2)]);const c=r.programDateTime,d=l.programDateTime;if(!c||!d)return;const f=(d-c)/1e3-(l.start-r.start);vv(f,a)}const _x={toString:function(a){let e="";const t=a.length;for(let i=0;i<t;i++)e+=`[${a.start(i).toFixed(3)}-${a.end(i).toFixed(3)}]`;return e}},Z={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class If extends av{constructor(e,t,i,r,l){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Z.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:c,media:d,mediaBuffer:f,state:g}=this,p=d?d.currentTime:0,v=Le.bufferInfo(f||d,p,o.maxBufferHole);if(this.log(`media seeking to ${he(p)?p.toFixed(3):p}, state: ${g}`),this.state===Z.ENDED)this.resetLoadingState();else if(c){const T=o.maxFragLookUpTolerance,E=c.start-T,A=c.start+c.duration+T;if(!v.len||A<v.start||E>v.end){const b=p>A;(p<E||b)&&(b&&c.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(d){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const T=this.lastCurrentTime;if(p>T&&(this.lastCurrentTime=p),!this.loadingParts){const E=Math.max(v.end,p),A=this.shouldLoadParts(this.getLevelDetails(),E);A&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=A)}}!this.hls.hasEnoughToStart&&!v.len&&(this.log(`setting startPosition to ${p} because of seek before start`),this.nextLoadPosition=this.startPosition=p),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=l,this.hls=e,this.fragmentLoader=new tx(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Lf(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Z.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Z.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;const l=e.buffered;this.config.maxBufferHole&&l&&l.length>1&&(e=Le.bufferedInfo(l,e.start,0));const o=e.nextStart;if(o&&o>r&&o<t.edge||this.media.currentTime<e.start)return!1;const d=t.partList;if(d!=null&&d.length){const g=d[d.length-1];return Le.isBuffered(this.media,g.start+g.duration/2)}const f=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(f)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===Z.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Z.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const r=l=>{const o=l.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${l.part?" part: "+l.part.index:""} of ${this.fragInfo(o,!1,l.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(l)};this._doFragLoad(e,t,i,r).then(l=>{if(!l)return;const o=this.state,c=l.frag;if(this.fragContextChanged(c)){(o===Z.FRAG_LOADING||!this.fragCurrent&&o===Z.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=Z.IDLE);return}"payload"in l&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(S.FRAG_LOADED,l)),this._handleFragmentLoadComplete(l)}).catch(l=>{this.state===Z.STOPPED||this.state===Z.ERROR||(this.warn(`Frag error: ${l?.message||l}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===Tt.APPENDING){const l=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,l),c=Math.max(e.duration,o?o.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?e.sn-d.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===Tt.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:i};this.hls.trigger(S.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const r=i?.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{frag:l,payload:o}=i,c=l.decryptdata;if(o&&o.byteLength>0&&c!=null&&c.key&&c.iv&&fr(c.method)){const d=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),c.key.buffer,c.iv.buffer,_f(c.method)).catch(f=>{throw r.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:l}),f}).then(f=>{const g=self.performance.now();return r.trigger(S.FRAG_DECRYPTED,{frag:l,payload:f,stats:{tstart:d,tdecrypt:g}}),i.payload=f,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===Z.STOPPED||this.state===Z.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==Z.STOPPED&&(this.state=Z.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?_x.toString(Le.getBuffered(i)):"(detached)"})`),_t(e)){var r;if(e.type!==me.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(c=>!!o[c])){this.state=Z.IDLE;return}}const l=(r=this.levels)==null?void 0:r[e.level];l!=null&&l.fragmentError&&(this.log(`Resetting level fragment error count of ${l.fragmentError} on frag buffered`),l.fragmentError=0)}this.state=Z.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:r,partsLoaded:l}=e,o=!l||l.length===0||l.some(d=>!d),c=new Rf(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!o);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var l;this.fragCurrent=e;const o=t?.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let c=null;e.encrypted&&!((l=e.decryptdata)!=null&&l.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Z.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(S.KEY_LOADED,p),this.state===Z.KEY_LOADING&&(this.state=Z.IDLE),p}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(c=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(c=this.keyLoader.loadClear(e,o.encryptedFragments),c&&this.log("[eme] blocking frag load until media-keys acquired"));const d=this.fragPrevious;if(_t(e)&&(!d||e.sn!==d.sn)){const p=this.shouldLoadParts(t.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${d?.sn}->${e.sn}`),this.loadingParts=p)}if(i=Math.max(e.start,i||0),this.loadingParts&&_t(e)){const p=o.partList;if(p&&r){i>e.end&&o.fragmentHint&&(e=o.fragmentHint);const v=this.getNextPart(p,e,i);if(v>-1){const T=p[v];e=this.fragCurrent=T.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${T.index} (${v}/${p.length-1}) of ${this.fragInfo(e,!1,T)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=T.start+T.duration,this.state=Z.FRAG_LOADING;let E;return c?E=c.then(A=>!A||this.fragContextChanged(A.frag)?null:this.doFragPartsLoad(e,T,t,r)).catch(A=>this.handleFragLoadError(A)):E=this.doFragPartsLoad(e,T,t,r).catch(A=>this.handleFragLoadError(A)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:T,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(p,i))return Promise.resolve(null)}}if(_t(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${o?"["+o.startSN+"-"+o.endSN+"]":""}, target: ${parseFloat(i.toFixed(3))}`),he(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Z.FRAG_LOADING;const f=this.config.progressive;let g;return f&&c?g=c.then(p=>!p||this.fragContextChanged(p?.frag)?null:this.fragmentLoader.load(e,r)).catch(p=>this.handleFragLoadError(p)):g=Promise.all([this.fragmentLoader.load(e,f?r:void 0),c]).then(([p])=>(!f&&p&&r&&r(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,i,r){return new Promise((l,o)=>{var c;const d=[],f=(c=i.details)==null?void 0:c.partList,g=p=>{this.fragmentLoader.loadPart(e,p,r).then(v=>{d[p.index]=v;const T=v.part;this.hls.trigger(S.FRAG_LOADED,v);const E=P0(i.details,e.sn,p.index+1)||pv(f,e.sn,p.index+1);if(E)g(E);else return l({frag:e,part:T,partsLoaded:d})}).catch(o)};g(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===K.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(S.ERROR,t)}else this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Z.PARSING){!this.fragCurrent&&this.state!==Z.STOPPED&&this.state!==Z.ERROR&&(this.state=Z.IDLE);return}const{frag:i,part:r,level:l}=t,o=self.performance.now();i.stats.parsing.end=o,r&&(r.stats.parsing.end=o);const c=this.getLevelDetails(),f=c&&i.sn>c.endSN||this.shouldLoadParts(c,i.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=f),this.updateLevelTiming(i,r,l,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var i;const l=e.partList[0],o=l.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>l.start-l.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:r,sn:l,part:o}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${l} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const c=t[r],d=c.details,f=o>-1?P0(d,l,o):null,g=f?f.fragment:mv(d,l,i);return g?(i&&i!==g&&(g.stats=i.stats),{frag:g,part:f,level:c}):null}bufferFragmentData(e,t,i,r,l){var o;if(!e||this.state!==Z.PARSING)return;const{data1:c,data2:d}=e;let f=c;if(c&&d&&(f=vi(c,d)),!((o=f)!=null&&o.length))return;const g={type:e.type,frag:t,part:i,chunkMeta:r,parent:t.type,data:f};if(this.hls.trigger(S.BUFFER_APPENDING,g),e.dropped&&e.independent&&!i){if(l)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Le.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,r=Le.bufferInfo(t,i,0),l=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),c=Math.max(Math.min(e.start-o,r.end-o),i+o);e.start-c>o&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var i;const r=this.getLoadPosition();if(!he(r))return null;const o=this.lastCurrentTime>r||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,o)}getFwdBufferInfoAtPos(e,t,i,r){const l=Le.bufferInfo(e,t,r);if(l.len===0&&l.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,i);if(o&&(l.nextStart<=o.end||o.gap)){const c=Math.max(Math.min(l.nextStart,o.end)-t,r);return Le.bufferInfo(e,t,c)}}return l}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),l=Math.max(e-t*3,i.maxMaxBufferLength/2,r);return l>=r?(i.maxMaxBufferLength=l,this.warn(`Reduce max buffer length to ${l}s`),!0):!1}getAppendedFrag(e,t=me.MAIN){var i;const r=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(e,t);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const i=t.fragments,r=i.length;if(!r)return null;const{config:l}=this,o=i[0].start,c=l.lowLatencyMode&&!!t.partList;let d=null;if(t.live){const p=l.initialLiveManifestSize;if(r<p)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var f;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t);const v=this.hls.startPosition,T=this.hls.liveSyncPosition,E=d?(v!==-1&&v>=o?v:T)||d.start:e;this.log(`Setting startPosition to ${E} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${T} frag.start: ${(f=d)==null?void 0:f.start}`),this.startPosition=this.nextLoadPosition=E}}else e<=o&&(d=i[0]);if(!d){const p=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,p,t)}let g=this.filterReplacedPrimary(d,t);if(!g&&d){const p=d.sn-t.startSN;g=this.filterReplacedPrimary(i[p+1]||null,t)}return this.mapToInitFragWhenRequired(g)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===Tt.OK||i===Tt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,l){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&i.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(c!==null&&i.len+c.len>=l){const d=o.sn;return this.loopSn!==d&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${d}`),this.loopSn=d),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(U0(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(U0(this.hls.config)&&e.type!==me.SUBTITLE){const i=this.hls.interstitialsManager,r=i?.bufferingItem;if(r){const o=r.event;if(o){if(o.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&t?.live===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const l=i?.playerQueue;if(l)for(let o=l.length;o--;){const c=l[o].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let r=-1,l=!1,o=!0;for(let c=0,d=e.length;c<d;c++){const f=e[c];if(o=o&&!f.independent,r>-1&&i<f.start)break;const g=f.loaded;g?r=-1:(l||f.independent||o)&&f.fragment===t&&(r=c),l=g}return r}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=VA(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const l=i.sn+1;if(l>=e.startSN&&l<=e.endSN){const o=t[l-e.startSN];i.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=rv(e,i.cc,i.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const l=this.hls.liveSyncPosition;l!==null&&(r=this.getFragmentAtPosition(l,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){const{config:r}=this;let{fragPrevious:l}=this,{fragments:o,endSN:c}=i;const{fragmentHint:d}=i,{maxFragLookUpTolerance:f}=r,g=i.partList,p=!!(this.loadingParts&&g!=null&&g.length&&d);p&&d&&!this.bitrateTest&&g[g.length-1].fragment.sn===d.sn&&(o=o.concat(d),c=d.sn);let v;if(e<t){var T;const A=e<this.lastCurrentTime||e>t-f||(T=this.media)!=null&&T.paused||!this.startFragRequested?0:f;v=yn(l,o,e,A)}else v=o[o.length-1];if(v){const E=v.sn-i.startSN,A=this.fragmentTracker.getState(v);if((A===Tt.OK||A===Tt.PARTIAL&&v.gap)&&(l=v),l&&v.sn===l.sn&&(!p||g[0].fragment.sn>v.sn||!i.live&&!p)&&l&&v.level===l.level){const L=o[E+1];v.sn<c&&this.fragmentTracker.getState(L)!==Tt.OK?v=L:v=null}}return v}alignPlaylists(e,t,i){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const l=e.fragmentStart,o=!t,c=e.alignedSliding&&he(l);if(o||!c&&!l){Rx(i,e);const d=e.fragmentStart;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),d}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const r=this.timelineOffset;if(i===-1){const l=this.startTimeOffset!==null,o=l?this.startTimeOffset:e.startTimeOffset;o!==null&&he(o)?(i=t+o,o<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${l?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&_t(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Z.FRAG_LOADING_WAITING_RETRY)&&(this.state=Z.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const E=this.getCurrentContext(t.chunkMeta);E&&(t.frag=E.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const l=t.details===K.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction,{action:c,flags:d,retryCount:f=0,retryConfig:g}=o||{},p=!!o&&!!g,v=p&&c===Bt.RetryRequest,T=p&&!o.resolved&&d===Ri.MoveAllAlternatesMatchingHost;if(!v&&T&&_t(i)&&!i.endList)this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((v||T)&&f<g.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const E=xf(g,f);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${f+1}/${g.maxNumRetry} in ${E}ms`),o.resolved=!0,this.retryDate=self.performance.now()+E,this.state=Z.FRAG_LOADING_WAITING_RETRY}else if(g&&o)if(this.resetFragmentErrors(e),f<g.maxNumRetry)!l&&c!==Bt.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else c===Bt.SendAlternateToPenaltyBox?this.state=Z.WAITING_LEVEL:this.state=Z.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Z.PARSING||this.state===Z.PARSED){const t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),l=r&&r.len>.5;l&&this.reduceMaxBufferLength(r.len,t?.duration||10);const o=!l;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===me.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Z.STOPPED&&(this.state=Z.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const r=Le.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===Z.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Z.STOPPED&&(this.state=Z.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){const l=i.details;if(!l){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((d,f)=>{const g=e.elementaryStreams[f];if(g){const p=g.endPTS-g.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${f} duration reliably (${p})`),d||!1;const v=r?0:fv(l,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:l,level:i,drift:v,type:f,frag:e,start:g.startPTS,end:g.endPTS}),!0}return d},!1)){var c;if(i.fragmentError===0&&this.treatAsGap(e,i),((c=this.transmuxer)==null?void 0:c.error)===null){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Z.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===me.MAIN?"level":"track"}fragInfo(e,t=!0,i){var r,l;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((r=t&&!i?e.startPTS:(i||e).start)!=null?r:NaN).toFixed(3)}-${((l=t&&!i?e.endPTS:(i||e).end)!=null?l:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function U0(a){return!!a.interstitialsController&&a.enableInterstitialPlayback!==!1}class Ev{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=Dx(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Dx(a,e){const t=new Uint8Array(e);let i=0;for(let r=0;r<a.length;r++){const l=a[r];t.set(l,i),i+=l.length}return t}var Dh={exports:{}},B0;function Ix(){return B0||(B0=1,function(a){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(d,f,g){this.fn=d,this.context=f,this.once=g||!1}function l(d,f,g,p,v){if(typeof g!="function")throw new TypeError("The listener must be a function");var T=new r(g,p||d,v),E=t?t+f:f;return d._events[E]?d._events[E].fn?d._events[E]=[d._events[E],T]:d._events[E].push(T):(d._events[E]=T,d._eventsCount++),d}function o(d,f){--d._eventsCount===0?d._events=new i:delete d._events[f]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var f=[],g,p;if(this._eventsCount===0)return f;for(p in g=this._events)e.call(g,p)&&f.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(g)):f},c.prototype.listeners=function(f){var g=t?t+f:f,p=this._events[g];if(!p)return[];if(p.fn)return[p.fn];for(var v=0,T=p.length,E=new Array(T);v<T;v++)E[v]=p[v].fn;return E},c.prototype.listenerCount=function(f){var g=t?t+f:f,p=this._events[g];return p?p.fn?1:p.length:0},c.prototype.emit=function(f,g,p,v,T,E){var A=t?t+f:f;if(!this._events[A])return!1;var b=this._events[A],L=arguments.length,_,D;if(b.fn){switch(b.once&&this.removeListener(f,b.fn,void 0,!0),L){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,g),!0;case 3:return b.fn.call(b.context,g,p),!0;case 4:return b.fn.call(b.context,g,p,v),!0;case 5:return b.fn.call(b.context,g,p,v,T),!0;case 6:return b.fn.call(b.context,g,p,v,T,E),!0}for(D=1,_=new Array(L-1);D<L;D++)_[D-1]=arguments[D];b.fn.apply(b.context,_)}else{var w=b.length,k;for(D=0;D<w;D++)switch(b[D].once&&this.removeListener(f,b[D].fn,void 0,!0),L){case 1:b[D].fn.call(b[D].context);break;case 2:b[D].fn.call(b[D].context,g);break;case 3:b[D].fn.call(b[D].context,g,p);break;case 4:b[D].fn.call(b[D].context,g,p,v);break;default:if(!_)for(k=1,_=new Array(L-1);k<L;k++)_[k-1]=arguments[k];b[D].fn.apply(b[D].context,_)}}return!0},c.prototype.on=function(f,g,p){return l(this,f,g,p,!1)},c.prototype.once=function(f,g,p){return l(this,f,g,p,!0)},c.prototype.removeListener=function(f,g,p,v){var T=t?t+f:f;if(!this._events[T])return this;if(!g)return o(this,T),this;var E=this._events[T];if(E.fn)E.fn===g&&(!v||E.once)&&(!p||E.context===p)&&o(this,T);else{for(var A=0,b=[],L=E.length;A<L;A++)(E[A].fn!==g||v&&!E[A].once||p&&E[A].context!==p)&&b.push(E[A]);b.length?this._events[T]=b.length===1?b[0]:b:o(this,T)}return this},c.prototype.removeAllListeners=function(f){var g;return f?(g=t?t+f:f,this._events[g]&&o(this,g)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,a.exports=c}(Dh)),Dh.exports}var Cx=Ix(),Cf=aA(Cx);const Pa="1.6.5",yr={};function wx(){return typeof __HLS_WORKER_BUNDLE__=="function"}function kx(){const a=yr[Pa];if(a)return a.clientCount++,a;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return yr[Pa]=r,r}function Ox(a){const e=yr[a];if(e)return e.clientCount++,e;const t=new self.URL(a,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return yr[a]=r,r}function Mx(a){const e=yr[a||Pa];if(e&&e.clientCount--===1){const{worker:i,objectURL:r}=e;delete yr[a||Pa],r&&self.URL.revokeObjectURL(r),i.terminate()}}function Sv(a,e){return e+10<=a.length&&a[e]===51&&a[e+1]===68&&a[e+2]===73&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function wf(a,e){return e+10<=a.length&&a[e]===73&&a[e+1]===68&&a[e+2]===51&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function Xo(a,e){let t=0;return t=(a[e]&127)<<21,t|=(a[e+1]&127)<<14,t|=(a[e+2]&127)<<7,t|=a[e+3]&127,t}function Na(a,e){const t=e;let i=0;for(;wf(a,e);){i+=10;const r=Xo(a,e+6);i+=r,Sv(a,e+10)&&(i+=10),e+=i}if(i>0)return a.subarray(t,t+i)}function Px(a,e,t,i){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=e[t+2],o=l>>2&15;if(o>12){const T=new Error(`invalid ADTS sampling index:${o}`);a.emit(S.ERROR,S.ERROR,{type:ye.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!0,error:T,reason:T.message});return}const c=(l>>6&3)+1,d=e[t+3]>>6&3|(l&1)<<2,f="mp4a.40."+c,g=r[o];let p=o;(c===5||c===29)&&(p-=3);const v=[c<<3|(p&14)>>1,(p&1)<<7|d<<3];return Fe.log(`manifest codec:${i}, parsed codec:${f}, channels:${d}, rate:${g} (ADTS object type:${c} sampling index:${o})`),{config:v,samplerate:g,channelCount:d,codec:f,parsedCodec:f,manifestCodec:i}}function bv(a,e){return a[e]===255&&(a[e+1]&246)===240}function Av(a,e){return a[e+1]&1?7:9}function kf(a,e){return(a[e+3]&3)<<11|a[e+4]<<3|(a[e+5]&224)>>>5}function Nx(a,e){return e+5<a.length}function Vo(a,e){return e+1<a.length&&bv(a,e)}function Ux(a,e){return Nx(a,e)&&bv(a,e)&&kf(a,e)<=a.length-e}function Bx(a,e){if(Vo(a,e)){const t=Av(a,e);if(e+t>=a.length)return!1;const i=kf(a,e);if(i<=t)return!1;const r=e+i;return r===a.length||Vo(a,r)}return!1}function xv(a,e,t,i,r){if(!a.samplerate){const l=Px(e,t,i,r);if(!l)return;Ye(a,l)}}function Lv(a){return 1024*9e4/a}function Fx(a,e){const t=Av(a,e);if(e+t<=a.length){const i=kf(a,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function Rv(a,e,t,i,r){const l=Lv(a.samplerate),o=i+r*l,c=Fx(e,t);let d;if(c){const{frameLength:p,headerLength:v}=c,T=v+p,E=Math.max(0,t+T-e.length);E?(d=new Uint8Array(T-v),d.set(e.subarray(t+v,e.length),0)):d=e.subarray(t+v,t+T);const A={unit:d,pts:o};return E||a.samples.push(A),{sample:A,length:T,missing:E}}const f=e.length-t;return d=new Uint8Array(f),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:o},length:f,missing:-1}}function $x(a,e){return wf(a,e)&&Xo(a,e+6)+10<=a.length-e}function Gx(a){return a instanceof ArrayBuffer?a:a.byteOffset==0&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer}function Ih(a,e=0,t=1/0){return Hx(a,e,t,Uint8Array)}function Hx(a,e,t,i){const r=Vx(a);let l=1;"BYTES_PER_ELEMENT"in i&&(l=i.BYTES_PER_ELEMENT);const o=Kx(a)?a.byteOffset:0,c=(o+a.byteLength)/l,d=(o+e)/l,f=Math.floor(Math.max(0,Math.min(d,c))),g=Math.floor(Math.min(f+Math.max(t,0),c));return new i(r,f,g-f)}function Vx(a){return a instanceof ArrayBuffer?a:a.buffer}function Kx(a){return a&&a.buffer instanceof ArrayBuffer&&a.byteLength!==void 0&&a.byteOffset!==void 0}function zx(a){const e={key:a.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(a.size<2)return;if(a.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=a.data.subarray(1).indexOf(0);if(i===-1)return;const r=ri(Ih(a.data,1,i)),l=a.data[2+i],o=a.data.subarray(3+i).indexOf(0);if(o===-1)return;const c=ri(Ih(a.data,3+i,o));let d;return r==="-->"?d=ri(Ih(a.data,4+i+o)):d=Gx(a.data.subarray(4+i+o)),e.mimeType=r,e.pictureType=l,e.description=c,e.data=d,e}function qx(a){if(a.size<2)return;const e=ri(a.data,!0),t=new Uint8Array(a.data.subarray(e.length+1));return{key:a.type,info:e,data:t.buffer}}function Yx(a){if(a.size<2)return;if(a.type==="TXXX"){let t=1;const i=ri(a.data.subarray(t),!0);t+=i.length+1;const r=ri(a.data.subarray(t));return{key:a.type,info:i,data:r}}const e=ri(a.data.subarray(1));return{key:a.type,info:"",data:e}}function jx(a){if(a.type==="WXXX"){if(a.size<2)return;let t=1;const i=ri(a.data.subarray(t),!0);t+=i.length+1;const r=ri(a.data.subarray(t));return{key:a.type,info:i,data:r}}const e=ri(a.data);return{key:a.type,info:"",data:e}}function Xx(a){return a.type==="PRIV"?qx(a):a.type[0]==="W"?jx(a):a.type==="APIC"?zx(a):Yx(a)}function Qx(a){const e=String.fromCharCode(a[0],a[1],a[2],a[3]),t=Xo(a,4),i=10;return{type:e,size:t,data:a.subarray(i,i+t)}}const co=10,Wx=10;function _v(a){let e=0;const t=[];for(;wf(a,e);){const i=Xo(a,e+6);a[e+5]>>6&1&&(e+=co),e+=co;const r=e+i;for(;e+Wx<r;){const l=Qx(a.subarray(e)),o=Xx(l);o&&t.push(o),e+=l.size+co}Sv(a,e)&&(e+=co)}return t}function Dv(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function Zx(a){if(a.data.byteLength===8){const e=new Uint8Array(a.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function Of(a){const e=_v(a);for(let t=0;t<e.length;t++){const i=e[t];if(Dv(i))return Zx(i)}}let ii=function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a}({});function Bi(a="",e=9e4){return{type:a,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Mf{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=vi(this.cachedData,e),this.cachedData=null);let i=Na(e,0),r=i?i.length:0,l;const o=this._audioTrack,c=this._id3Track,d=i?Of(i):void 0,f=e.length;for((this.basePTS===null||this.frameIndex===0&&he(d))&&(this.basePTS=Jx(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ii.audioId3,duration:Number.POSITIVE_INFINITY});r<f;){if(this.canParse(e,r)){const g=this.appendFrame(o,e,r);g?(this.frameIndex++,this.lastPTS=g.sample.pts,r+=g.length,l=r):r=f}else $x(e,r)?(i=Na(e,r),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ii.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,l=r):r++;if(r===f&&l!==f){const g=e.slice(l);this.cachedData?this.cachedData=vi(this.cachedData,g):this.cachedData=g}}return{audioTrack:o,videoTrack:Bi(),id3Track:c,textTrack:Bi()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Bi(),id3Track:this._id3Track,textTrack:Bi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Jx=(a,e,t)=>{if(he(a))return a*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let ho=null;const eL=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],tL=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],iL=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],sL=[0,1,1,4];function Iv(a,e,t,i,r){if(t+24>e.length)return;const l=Cv(e,t);if(l&&t+l.frameLength<=e.length){const o=l.samplesPerFrame*9e4/l.sampleRate,c=i+r*o,d={unit:e.subarray(t,t+l.frameLength),pts:c,dts:c};return a.config=[],a.channelCount=l.channelCount,a.samplerate=l.sampleRate,a.samples.push(d),{sample:d,length:l.frameLength,missing:0}}}function Cv(a,e){const t=a[e+1]>>3&3,i=a[e+1]>>1&3,r=a[e+2]>>4&15,l=a[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&l!==3){const o=a[e+2]>>1&1,c=a[e+3]>>6,d=t===3?3-i:i===3?3:4,f=eL[d*14+r-1]*1e3,p=tL[(t===3?0:t===2?1:2)*3+l],v=c===3?1:2,T=iL[t][i],E=sL[i],A=T*8*E,b=Math.floor(T*f/p+o)*E;if(ho===null){const D=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ho=D?parseInt(D[1]):0}return!!ho&&ho<=87&&i===2&&f>=224e3&&c===0&&(a[e+3]=a[e+3]|128),{sampleRate:p,channelCount:v,frameLength:b,samplesPerFrame:A}}}function Pf(a,e){return a[e]===255&&(a[e+1]&224)===224&&(a[e+1]&6)!==0}function wv(a,e){return e+1<a.length&&Pf(a,e)}function nL(a,e){return Pf(a,e)&&4<=a.length-e}function kv(a,e){if(e+1<a.length&&Pf(a,e)){const i=Cv(a,e);let r=4;i!=null&&i.frameLength&&(r=i.frameLength);const l=e+r;return l===a.length||wv(a,l)}return!1}class rL extends Mf{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=Na(e,0);let r=i?.length||0;if(kv(e,r))return!1;for(let l=e.length;r<l;r++)if(Bx(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Ux(e,t)}appendFrame(e,t,i){xv(e,this.observer,t,i,e.manifestCodec);const r=Rv(e,t,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const Ov=(a,e)=>{let t=0,i=5;e+=i;const r=new Uint32Array(1),l=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=a[e];const c=Math.min(i,8),d=8-c;l[0]=4278190080>>>24+d<<d,r[0]=(o[0]&l[0])>>d,t=t?t<<c|r[0]:r[0],e+=1,i-=c}return t};class aL extends Mf{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const r=Mv(e,t,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Na(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&Of(t)!==void 0&&Ov(e,i)<16}}function Mv(a,e,t,i,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const l=e[t+4]>>6;if(l>=3)return-1;const c=[48e3,44100,32e3][l],d=e[t+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+l]*2;if(t+g>e.length)return-1;const p=e[t+6]>>5;let v=0;p===2?v+=2:(p&1&&p!==1&&(v+=2),p&4&&(v+=2));const T=(e[t+6]<<8|e[t+7])>>12-v&1,A=[2,1,2,3,3,4,4,5][p]+T,b=e[t+5]>>3,L=e[t+5]&7,_=new Uint8Array([l<<6|b<<1|L>>2,(L&3)<<6|p<<3|T<<2|d>>4,d<<4&224]),D=1536/c*9e4,w=i+r*D,k=e.subarray(t,t+g);return a.config=_,a.channelCount=A,a.samplerate=c,a.samples.push({unit:k,pts:w}),g}class lL extends Mf{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Na(e,0);let i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&Of(t)!==void 0&&Ov(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(kv(e,i))return Fe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return nL(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return Iv(e,t,i,this.basePTS,this.frameIndex)}}const oL=/\/emsg[-/]ID3/i;class uL{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){const l=this.videoTrack=Bi("video",1),o=this.audioTrack=Bi("audio",1),c=this.txtTrack=Bi("text",1);if(this.id3Track=Bi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const d=Yy(e);if(d.video){const{id:f,timescale:g,codec:p,supplemental:v}=d.video;l.id=f,l.timescale=c.timescale=g,l.codec=p,l.supplemental=v}if(d.audio){const{id:f,timescale:g,codec:p}=d.audio;o.id=f,o.timescale=g,o.codec=p}c.id=Ky.text,l.sampleDuration=0,l.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return hA(e)}demux(e,t){this.timeOffset=t;let i=e;const r=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=vi(this.remainderData,e));const c=vA(i);this.remainderData=c.remainder,r.samples=c.valid||new Uint8Array}else r.samples=i;const o=this.extractID3Track(r,t);return l.samples=r0(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return i.samples=r0(e,t),{videoTrack:t,audioTrack:Bi(),id3Track:r,textTrack:Bi()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const r=Re(e.samples,["emsg"]);r&&r.forEach(l=>{const o=EA(l);if(oL.test(o.schemeIdUri)){const c=F0(o,t);let d=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const f=o.payload;i.samples.push({data:f,len:f.byteLength,dts:c,pts:c,type:ii.emsg,duration:d})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=F0(o,t);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:c,pts:c,type:ii.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function F0(a,e){return he(a.presentationTime)?a.presentationTime/a.timeScale:e+a.presentationTimeDelta/a.timeScale}class cL{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Lf(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Vs.cbc)}decryptAacSample(e,t,i){const r=e[t].unit;if(r.length<=16)return;const l=r.subarray(16,r.length-r.length%16),o=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(o).then(c=>{const d=new Uint8Array(c);r.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let r=0;for(let l=32;l<e.length-16;l+=160,r+=16)i.set(e.subarray(l,l+16),r);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let r=0;for(let l=32;l<e.length-16;l+=160,r+=16)e.set(i.subarray(r,r+16),l);return e}decryptAvcSample(e,t,i,r,l){const o=Xy(l.data),c=this.getAvcEncryptedData(o);this.decryptBuffer(c.buffer).then(d=>{l.data=this.getAvcDecryptedUnit(o,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)})}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}const l=e[t].units;for(;!(i>=l.length);i++){const o=l[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,i,r,o),!this.decrypter.isSync()))return}}}}class Pv{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const l=i.units;r=l[l.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,r=i.length;if(r){const l=i[r-1];e.pts=l.pts,e.dts=l.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const r=t.byteLength;let l=e.naluState||0;const o=l,c=[];let d=0,f,g,p,v=-1,T=0;for(l===-1&&(v=0,T=this.getNALuType(t,0),l=0,d=1);d<r;){if(f=t[d++],!l){l=f?0:1;continue}if(l===1){l=f?0:2;continue}if(!f)l=3;else if(f===1){if(g=d-l-1,v>=0){const E={data:t.subarray(v,g),type:T};c.push(E)}else{const E=this.getLastNalUnit(e.samples);E&&(o&&d<=4-o&&E.state&&(E.data=E.data.subarray(0,E.data.byteLength-o)),g>0&&(E.data=vi(E.data,t.subarray(0,g)),E.state=0))}d<r?(p=this.getNALuType(t,d),v=d,T=p,l=0):l=-1}else l=0}if(v>=0&&l>=0){const E={data:t.subarray(v,r),type:T,state:l};c.push(E)}if(c.length===0){const E=this.getLastNalUnit(e.samples);E&&(E.data=vi(E.data,t))}return e.naluState=l,c}}class Ra{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),l=Math.min(4,t);if(l===0)throw new Error("no bytes available");r.set(e.subarray(i,i+l)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=l*8,this.bytesAvailable-=l}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&Fe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class $0 extends Pv{parsePES(e,t,i,r){const l=this.parseNALu(e,i.data,r);let o=this.VideoSample,c,d=!1;i.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.forEach(f=>{var g,p;switch(f.type){case 1:{let A=!1;c=!0;const b=f.data;if(d&&b.length>4){const L=this.readSliceType(b);(L===2||L===4||L===7||L===9)&&(A=!0)}if(A){var v;(v=o)!=null&&v.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=A;break}case 5:c=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{c=!0,Af(f.data,1,i.pts,t.samples);break}case 7:{var T,E;c=!0,d=!0;const A=f.data,b=this.readSPS(A);if(!e.sps||e.width!==b.width||e.height!==b.height||((T=e.pixelRatio)==null?void 0:T[0])!==b.pixelRatio[0]||((E=e.pixelRatio)==null?void 0:E[1])!==b.pixelRatio[1]){e.width=b.width,e.height=b.height,e.pixelRatio=b.pixelRatio,e.sps=[A];const L=A.subarray(1,4);let _="avc1.";for(let D=0;D<3;D++){let w=L[D].toString(16);w.length<2&&(w="0"+w),_+=w}e.codec=_}break}case 8:c=!0,e.pps=[f.data];break;case 9:c=!0,e.audFound=!0,(p=o)!=null&&p.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:c=!0;break;default:c=!1;break}o&&c&&o.units.push(f)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Ra(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,r=8,l;for(let o=0;o<e;o++)r!==0&&(l=t.readEG(),r=(i+l+256)%256),i=r===0?i:r}readSPS(e){const t=new Ra(e);let i=0,r=0,l=0,o=0,c,d,f;const g=t.readUByte.bind(t),p=t.readBits.bind(t),v=t.readUEG.bind(t),T=t.readBoolean.bind(t),E=t.skipBits.bind(t),A=t.skipEG.bind(t),b=t.skipUEG.bind(t),L=this.skipScalingList.bind(this);g();const _=g();if(p(5),E(3),g(),b(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){const B=v();if(B===3&&E(1),b(),b(),E(1),T())for(d=B!==3?8:12,f=0;f<d;f++)T()&&(f<6?L(16,t):L(64,t))}b();const D=v();if(D===0)v();else if(D===1)for(E(1),A(),A(),c=v(),f=0;f<c;f++)A();b(),E(1);const w=v(),k=v(),$=p(1);$===0&&E(1),E(1),T()&&(i=v(),r=v(),l=v(),o=v());let M=[1,1];if(T()&&T())switch(g()){case 1:M=[1,1];break;case 2:M=[12,11];break;case 3:M=[10,11];break;case 4:M=[16,11];break;case 5:M=[40,33];break;case 6:M=[24,11];break;case 7:M=[20,11];break;case 8:M=[32,11];break;case 9:M=[80,33];break;case 10:M=[18,11];break;case 11:M=[15,11];break;case 12:M=[64,33];break;case 13:M=[160,99];break;case 14:M=[4,3];break;case 15:M=[3,2];break;case 16:M=[2,1];break;case 255:{M=[g()<<8|g(),g()<<8|g()];break}}return{width:Math.ceil((w+1)*16-i*2-r*2),height:(2-$)*(k+1)*16-($?2:4)*(l+o),pixelRatio:M}}}class G0 extends Pv{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,r){const l=this.parseNALu(e,i.data,r);let o=this.VideoSample,c,d=!1;i.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.forEach(f=>{var g,p;switch(f.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,d){var v;(v=o)!=null&&v.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:c=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:c=!0,Af(f.data,2,i.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ye(e.params,this.readVPS(f.data)),this.initVPS=f.data),e.vps=[f.data];break;case 33:if(c=!0,d=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],f.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const T=this.readSPS(f.data);e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.codec=T.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const E in T.params)e.params[E]=T.params[E]}this.pushParameterSet(e.sps,f.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const T=this.readPPS(f.data);for(const E in T)e.params[E]=T[E]}this.pushParameterSet(e.pps,f.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(p=o)!=null&&p.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:c=!1;break}o&&c&&o.units.push(f)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[i]=e[r],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Ra(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:r}}readSPS(e){const t=new Ra(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const r=t.readBits(2),l=t.readBoolean(),o=t.readBits(5),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),g=t.readUByte(),p=t.readUByte(),v=t.readUByte(),T=t.readUByte(),E=t.readUByte(),A=t.readUByte(),b=t.readUByte(),L=t.readUByte(),_=[],D=[];for(let Me=0;Me<i;Me++)_.push(t.readBoolean()),D.push(t.readBoolean());if(i>0)for(let Me=i;Me<8;Me++)t.readBits(2);for(let Me=0;Me<i;Me++)_[Me]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),D[Me]&&t.readUByte();t.readUEG();const w=t.readUEG();w==3&&t.skipBits(1);const k=t.readUEG(),$=t.readUEG(),M=t.readBoolean();let B=0,V=0,U=0,te=0;M&&(B+=t.readUEG(),V+=t.readUEG(),U+=t.readUEG(),te+=t.readUEG());const re=t.readUEG(),de=t.readUEG(),ue=t.readUEG(),le=t.readBoolean();for(let Me=le?0:i;Me<=i;Me++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Ze=0;Ze<4;Ze++)for(let $t=0;$t<(Ze===3?2:6);$t++)if(!t.readBoolean())t.readUEG();else{const Gt=Math.min(64,1<<4+(Ze<<1));Ze>1&&t.readEG();for(let Ti=0;Ti<Gt;Ti++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const ne=t.readUEG();let Q=0;for(let Me=0;Me<ne;Me++){let Ze=!1;if(Me!==0&&(Ze=t.readBoolean()),Ze){Me===ne&&t.readUEG(),t.readBoolean(),t.readUEG();let $t=0;for(let _i=0;_i<=Q;_i++){const Gt=t.readBoolean();let Ti=!1;Gt||(Ti=t.readBoolean()),(Gt||Ti)&&$t++}Q=$t}else{const $t=t.readUEG(),_i=t.readUEG();Q=$t+_i;for(let Gt=0;Gt<$t;Gt++)t.readUEG(),t.readBoolean();for(let Gt=0;Gt<_i;Gt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Me=t.readUEG();for(let Ze=0;Ze<Me;Ze++){for(let $t=0;$t<ue+4;$t++)t.readBits(1);t.readBits(1)}}let Y=0,J=1,ie=1,ae=!0,pe=1,fe=0;t.readBoolean(),t.readBoolean();let Ke=!1;if(t.readBoolean()){if(t.readBoolean()){const Ki=t.readUByte(),Er=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],En=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ki>0&&Ki<16?(J=Er[Ki-1],ie=En[Ki-1]):Ki===255&&(J=t.readBits(16),ie=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ke=t.readBoolean(),Ke&&(B+=t.readUEG(),V+=t.readUEG(),U+=t.readUEG(),te+=t.readUEG()),t.readBoolean()&&(pe=t.readBits(32),fe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const En=t.readBoolean(),Ha=t.readBoolean();let Ei=!1;(En||Ha)&&(Ei=t.readBoolean(),Ei&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ei&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let kt=0;kt<=i;kt++){ae=t.readBoolean();const Di=ae||t.readBoolean();let Ot=!1;Di?t.readEG():Ot=t.readBoolean();const Va=Ot?1:t.readUEG()+1;if(En)for(let qs=0;qs<Va;qs++)t.readUEG(),t.readUEG(),Ei&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Ha)for(let qs=0;qs<Va;qs++)t.readUEG(),t.readUEG(),Ei&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),Y=t.readUEG())}let Dt=k,vn=$;if(M||Ke){let Me=1,Ze=1;w===1?Me=Ze=2:w==2&&(Me=2),Dt=k-Me*V-Me*B,vn=$-Ze*te-Ze*U}const Tn=r?["A","B","C"][r]:"",Tr=c<<24|d<<16|f<<8|g;let Ks=0;for(let Me=0;Me<32;Me++)Ks=(Ks|(Tr>>Me&1)<<31-Me)>>>0;let zs=Ks.toString(16);return o===1&&zs==="2"&&(zs="6"),{codecString:`hvc1.${Tn}${o}.${zs}.${l?"H":"L"}${L}.B0`,params:{general_tier_flag:l,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[c,d,f,g],general_constraint_indicator_flags:[p,v,T,E,A,b],general_level_idc:L,bit_depth:re+8,bit_depth_luma_minus8:re,bit_depth_chroma_minus8:de,min_spatial_segmentation_idc:Y,chroma_format_idc:w,frame_rate:{fixed:ae,fps:fe/pe}},width:Dt,height:vn,pixelRatio:[J,ie]}}readPPS(e){const t=new Ra(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),l=t.readBoolean();let o=1;return l&&r?o=0:l?o=3:r&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const xt=188;class Fs{constructor(e,t,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(e,t){const i=Fs.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(xt*5,t-xt)+1,r=0;for(;r<i;){let l=!1,o=-1,c=0;for(let d=r;d<t;d+=xt)if(e[d]===71&&(t-d===xt||e[d+xt]===71)){if(c++,o===-1&&(o=d,o!==0&&(i=Math.min(o+xt*99,e.length-xt)+1)),l||(l=af(e,d)===0),l&&c>1&&(o===0&&c>2||d+xt>i))return o}else{if(c)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Ky[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Fs.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Fs.createTrack("audio",r),this._id3Track=Fs.createTrack("id3"),this._txtTrack=Fs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){i||(this.sampleAes=null);let l;const o=this._videoTrack,c=this._audioTrack,d=this._id3Track,f=this._txtTrack;let g=o.pid,p=o.pesData,v=c.pid,T=d.pid,E=c.pesData,A=d.pesData,b=null,L=this.pmtParsed,_=this._pmtId,D=e.length;if(this.remainderData&&(e=vi(this.remainderData,e),D=e.length,this.remainderData=null),D<xt&&!r)return this.remainderData=e,{audioTrack:c,videoTrack:o,id3Track:d,textTrack:f};const w=Math.max(0,Fs.syncOffset(e));D-=(D-w)%xt,D<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,D,e.buffer.byteLength-D));let k=0;for(let M=w;M<D;M+=xt)if(e[M]===71){const B=!!(e[M+1]&64),V=af(e,M),U=(e[M+3]&48)>>4;let te;if(U>1){if(te=M+5+e[M+4],te===M+xt)continue}else te=M+4;switch(V){case g:if(B){if(p&&(l=or(p,this.logger))){if(this.videoParser===null)switch(o.segmentCodec){case"avc":this.videoParser=new $0;break;case"hevc":this.videoParser=new G0;break}this.videoParser!==null&&this.videoParser.parsePES(o,f,l,!1)}p={data:[],size:0}}p&&(p.data.push(e.subarray(te,M+xt)),p.size+=M+xt-te);break;case v:if(B){if(E&&(l=or(E,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,l);break;case"mp3":this.parseMPEGPES(c,l);break;case"ac3":this.parseAC3PES(c,l);break}E={data:[],size:0}}E&&(E.data.push(e.subarray(te,M+xt)),E.size+=M+xt-te);break;case T:B&&(A&&(l=or(A,this.logger))&&this.parseID3PES(d,l),A={data:[],size:0}),A&&(A.data.push(e.subarray(te,M+xt)),A.size+=M+xt-te);break;case 0:B&&(te+=e[te]+1),_=this._pmtId=hL(e,te);break;case _:{B&&(te+=e[te]+1);const re=fL(e,te,this.typeSupported,i,this.observer,this.logger);g=re.videoPid,g>0&&(o.pid=g,o.segmentCodec=re.segmentVideoCodec),v=re.audioPid,v>0&&(c.pid=v,c.segmentCodec=re.segmentAudioCodec),T=re.id3Pid,T>0&&(d.pid=T),b!==null&&!L&&(this.logger.warn(`MPEG-TS PMT found at ${M} after unknown PID '${b}'. Backtracking to sync byte @${w} to parse all TS packets.`),b=null,M=w-188),L=this.pmtParsed=!0;break}case 17:case 8191:break;default:b=V;break}}else k++;k>0&&lf(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=p,c.pesData=E,d.pesData=A;const $={audioTrack:c,videoTrack:o,id3Track:d,textTrack:f};return r&&this.extractRemainingSamples($),$}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:r,textTrack:l}=e,o=i.pesData,c=t.pesData,d=r.pesData;let f;if(o&&(f=or(o,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new $0;break;case"hevc":this.videoParser=new G0;break}this.videoParser!==null&&(this.videoParser.parsePES(i,l,f,!0),i.pesData=null)}else i.pesData=o;if(c&&(f=or(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,f);break;case"mp3":this.parseMPEGPES(t,f);break;case"ac3":this.parseAC3PES(t,f);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;d&&(f=or(d,this.logger))?(this.parseID3PES(r,f),r.pesData=null):r.pesData=d}demuxSampleAes(e,t,i){const r=this.demux(e,i,!0,!this.config.progressive),l=this.sampleAes=new cL(this.observer,this.config,t);return this.decrypt(r,l)}decrypt(e,t){return new Promise(i=>{const{audioTrack:r,videoTrack:l}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{l.samples?t.decryptAvcSamples(l.samples,0,0,()=>{i(e)}):i(e)}):l.samples&&t.decryptAvcSamples(l.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const r=this.aacOverFlow;let l=t.data;if(r){this.aacOverFlow=null;const p=r.missing,v=r.sample.unit.byteLength;if(p===-1)l=vi(r.sample.unit,l);else{const T=v-p;r.sample.unit.set(l.subarray(0,p),T),e.samples.push(r.sample),i=r.missing}}let o,c;for(o=i,c=l.length;o<c-1&&!Vo(l,o);o++);if(o!==i){let p;const v=o<c-1;if(v?p=`AAC PES did not start with ADTS header,offset:${o}`:p="No ADTS header found in AAC PES",lf(this.observer,new Error(p),v,this.logger),!v)return}xv(e,this.observer,l,o,this.audioCodec);let d;if(t.pts!==void 0)d=t.pts;else if(r){const p=Lv(e.samplerate);d=r.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let f=0,g;for(;o<c;)if(g=Rv(e,l,o,d,f),o+=g.length,g.missing){this.aacOverFlow=g;break}else for(f++;o<c-1&&!Vo(l,o);o++);}parseMPEGPES(e,t){const i=t.data,r=i.length;let l=0,o=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(wv(i,o)){const d=Iv(e,i,o,c,l);if(d)o+=d.length,l++;else break}else o++}parseAC3PES(e,t){{const i=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const l=i.length;let o=0,c=0,d;for(;c<l&&(d=Mv(e,i,c,r,o++))>0;)c+=d}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Ye({},t,{type:this._videoTrack?ii.emsg:ii.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function af(a,e){return((a[e+1]&31)<<8)+a[e+2]}function hL(a,e){return(a[e+10]&31)<<8|a[e+11]}function fL(a,e,t,i,r,l){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(a[e+1]&15)<<8|a[e+2],d=e+3+c-4,f=(a[e+10]&15)<<8|a[e+11];for(e+=12+f;e<d;){const g=af(a,e),p=(a[e+3]&15)<<8|a[e+4];switch(a[e]){case 207:if(!i){Ch("ADTS AAC",l);break}case 15:o.audioPid===-1&&(o.audioPid=g);break;case 21:o.id3Pid===-1&&(o.id3Pid=g);break;case 219:if(!i){Ch("H.264",l);break}case 27:o.videoPid===-1&&(o.videoPid=g);break;case 3:case 4:!t.mpeg&&!t.mp3?l.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="mp3");break;case 193:if(!i){Ch("AC-3",l);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="ac3"):l.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&p>0){let v=e+5,T=p;for(;T>2;){switch(a[v]){case 106:t.ac3!==!0?l.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=g,o.segmentAudioCodec="ac3");break}const A=a[v+1]+2;v+=A,T-=A}}break;case 194:case 135:return lf(r,new Error("Unsupported EC-3 in M2TS found"),void 0,l),o;case 36:o.videoPid===-1&&(o.videoPid=g,o.segmentVideoCodec="hevc",l.log("HEVC in M2TS found"));break}e+=p+5}return o}function lf(a,e,t,i){i.warn(`parsing error: ${e.message}`),a.emit(S.ERROR,S.ERROR,{type:ye.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Ch(a,e){e.log(`${a} with AES-128-CBC encryption found in unencrypted stream`)}function or(a,e){let t=0,i,r,l,o,c;const d=a.data;if(!a||a.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=vi(d[0],d[1]),d.splice(1,1);if(i=d[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>a.size-6)return null;const g=i[7];g&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,g&64?(c=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-c>60*9e4&&(e.warn(`${Math.round((o-c)/9e4)}s delta between PTS and DTS, align them`),o=c)):c=o),l=i[8];let p=l+9;if(a.size<=p)return null;a.size-=p;const v=new Uint8Array(a.size);for(let T=0,E=d.length;T<E;T++){i=d[T];let A=i.byteLength;if(p)if(p>A){p-=A;continue}else i=i.subarray(p),A-=p,p=0;v.set(i,t),t+=A}return r&&(r-=l+3),{data:v,pts:o,dts:c,len:r}}return null}class dL{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ns=Math.pow(2,32)-1;class G{static init(){G.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in G.types)G.types.hasOwnProperty(e)&&(G.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);G.HDLR_TYPES={video:t,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);G.STTS=G.STSC=G.STCO=l,G.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),G.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),G.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),G.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);G.FTYP=G.box(G.types.ftyp,o,d,o,c),G.DINF=G.box(G.types.dinf,G.box(G.types.dref,r))}static box(e,...t){let i=8,r=t.length;const l=r;for(;r--;)i+=t[r].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=i&255,o.set(e,4),r=0,i=8;r<l;r++)o.set(t[r],i),i+=t[r].byteLength;return o}static hdlr(e){return G.box(G.types.hdlr,G.HDLR_TYPES[e])}static mdat(e){return G.box(G.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(Ns+1)),r=Math.floor(t%(Ns+1));return G.box(G.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return G.box(G.types.mdia,G.mdhd(e.timescale||0,e.duration||0),G.hdlr(e.type),G.minf(e))}static mfhd(e){return G.box(G.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?G.box(G.types.minf,G.box(G.types.smhd,G.SMHD),G.DINF,G.stbl(e)):G.box(G.types.minf,G.box(G.types.vmhd,G.VMHD),G.DINF,G.stbl(e))}static moof(e,t,i){return G.box(G.types.moof,G.mfhd(e),G.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=G.trak(e[t]);return G.box.apply(null,[G.types.moov,G.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(G.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=G.trex(e[t]);return G.box.apply(null,[G.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(Ns+1)),r=Math.floor(t%(Ns+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return G.box(G.types.mvhd,l)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let r,l;for(r=0;r<t.length;r++)l=t[r].flags,i[r+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return G.box(G.types.sdtp,i)}static stbl(e){return G.box(G.types.stbl,G.stsd(e),G.box(G.types.stts,G.STTS),G.box(G.types.stsc,G.STSC),G.box(G.types.stsz,G.STSZ),G.box(G.types.stco,G.STCO))}static avc1(e){let t=[],i=[],r,l,o;for(r=0;r<e.sps.length;r++)l=e.sps[r],o=l.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(l));for(r=0;r<e.pps.length;r++)l=e.pps[r],o=l.byteLength,i.push(o>>>8&255),i.push(o&255),i=i.concat(Array.prototype.slice.call(l));const c=G.box(G.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),d=e.width,f=e.height,g=e.pixelRatio[0],p=e.pixelRatio[1];return G.box(G.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,G.box(G.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),G.box(G.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return G.box(G.types.mp4a,G.audioStsd(e),G.box(G.types.esds,G.esds(e)))}static mp3(e){return G.box(G.types[".mp3"],G.audioStsd(e))}static ac3(e){return G.box(G.types["ac-3"],G.audioStsd(e),G.box(G.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return G.box(G.types.stsd,G.STSD,G.mp4a(e));if(t==="ac3"&&e.config)return G.box(G.types.stsd,G.STSD,G.ac3(e));if(t==="mp3"&&e.codec==="mp3")return G.box(G.types.stsd,G.STSD,G.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return G.box(G.types.stsd,G.STSD,G.avc1(e));if(t==="hevc"&&e.vps)return G.box(G.types.stsd,G.STSD,G.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),r=e.width||0,l=e.height||0,o=Math.floor(i/(Ns+1)),c=Math.floor(i%(Ns+1));return G.box(G.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,l>>8&255,l&255,0,0]))}static traf(e,t){const i=G.sdtp(e),r=e.id,l=Math.floor(t/(Ns+1)),o=Math.floor(t%(Ns+1));return G.box(G.types.traf,G.box(G.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),G.box(G.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255])),G.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,G.box(G.types.trak,G.tkhd(e),G.mdia(e))}static trex(e){const t=e.id;return G.box(G.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],r=i.length,l=12+16*r,o=new Uint8Array(l);let c,d,f,g,p,v;for(t+=8+l,o.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<r;c++)d=i[c],f=d.duration,g=d.size,p=d.flags,v=d.cts,o.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*c);return G.box(G.types.trun,o)}static initSegment(e){G.types||G.init();const t=G.moov(e);return vi(G.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],r=4,l=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let o=l.length;for(let E=0;E<i.length;E+=1){o+=3;for(let A=0;A<i[E].length;A+=1)o+=2+i[E][A].length}const c=new Uint8Array(o);c.set(l,0),o=l.length;const d=i.length-1;for(let E=0;E<i.length;E+=1){c.set(new Uint8Array([32+E|(E===d?128:0),0,i[E].length]),o),o+=3;for(let A=0;A<i[E].length;A+=1)c.set(new Uint8Array([i[E][A].length>>8,i[E][A].length&255]),o),o+=2,c.set(i[E][A],o),o+=i[E][A].length}const f=G.box(G.types.hvcC,c),g=e.width,p=e.height,v=e.pixelRatio[0],T=e.pixelRatio[1];return G.box(G.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,G.box(G.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),G.box(G.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,T>>24,T>>16&255,T>>8&255,T&255])))}}G.types=void 0;G.HDLR_TYPES=void 0;G.STTS=void 0;G.STSC=void 0;G.STCO=void 0;G.STSZ=void 0;G.VMHD=void 0;G.SMHD=void 0;G.STSD=void 0;G.FTYP=void 0;G.DINF=void 0;const Nv=9e4;function Nf(a,e,t=1,i=!1){const r=a*e*t;return i?Math.round(r):r}function gL(a,e,t=1,i=!1){return Nf(a,e,1/t,i)}function Sa(a,e=!1){return Nf(a,1e3,1/Nv,e)}function mL(a,e=1){return Nf(a,Nv,1/e)}const pL=10*1e3,yL=1024,vL=1152,TL=1536;let ur=null,wh=null;function H0(a,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}class Ro{constructor(e,t,i,r){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.ISGenerated=!1,ur===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ur=o?parseInt(o[1]):0}if(wh===null){const l=navigator.userAgent.match(/Safari\/(\d+)/i);wh=l?parseInt(l[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,r=e.reduce((l,o)=>{let c=o.pts,d=c-l;return d<-4294967296&&(t=!0,c=pi(c,i),d=c-l),d>0?l:c},i);return t&&this.logger.debug("PTS rollover detected"),r}remux(e,t,i,r,l,o,c,d){let f,g,p,v,T,E,A=l,b=l;const L=e.pid>-1,_=t.pid>-1,D=t.samples.length,w=e.samples.length>0,k=c&&D>0||D>1;if((!L||w)&&(!_||k)||this.ISGenerated||c){if(this.ISGenerated){var M,B,V,U;const ue=this.videoTrackConfig;(ue&&(t.width!==ue.width||t.height!==ue.height||((M=t.pixelRatio)==null?void 0:M[0])!==((B=ue.pixelRatio)==null?void 0:B[0])||((V=t.pixelRatio)==null?void 0:V[1])!==((U=ue.pixelRatio)==null?void 0:U[1]))||!ue&&k||this.nextAudioPts===null&&w)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,l,o));const te=this.isVideoContiguous;let re=-1,de;if(k&&(re=EL(t.samples),!te&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,re>0){this.logger.warn(`[mp4-remuxer]: Dropped ${re} out of ${D} video samples due to a missing keyframe`);const ue=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(re),t.dropped+=re,b+=(t.samples[0].pts-ue)/t.inputTimeScale,de=b}else re===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${D} video samples`),E=!1);if(this.ISGenerated){if(w&&k){const ue=this.getVideoStartPts(t.samples),P=(pi(e.samples[0].pts,ue)-ue)/t.inputTimeScale;A+=Math.max(0,P),b+=Math.max(0,-P)}if(w){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),p=this.generateIS(e,t,l,o)),g=this.remuxAudio(e,A,this.isAudioContiguous,o,_||k||d===me.AUDIO?b:void 0),k){const ue=g?g.endPTS-g.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),p=this.generateIS(e,t,l,o)),f=this.remuxVideo(t,b,te,ue)}}else k&&(f=this.remuxVideo(t,b,te,0));f&&(f.firstKeyFrame=re,f.independent=re!==-1,f.firstKeyFramePTS=de)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(T=Uv(i,l,this._initPTS,this._initDTS)),r.samples.length&&(v=Bv(r,l,this._initPTS))),{audio:g,video:f,initSegment:p,independent:E,text:v,id3:T}}generateIS(e,t,i,r){const l=e.samples,o=t.samples,c=this.typeSupported,d={},f=this._initPTS;let g=!f||r,p="audio/mp4",v,T,E,A;if(g&&(v=T=1/0),e.config&&l.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(p="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):G.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(A=e.id,E=e.inputTimeScale,!f||E!==f.timescale?v=T=l[0].pts-Math.round(E*i):g=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:G.initSegment([t]),metadata:{width:t.width,height:t.height}},g)if(A=t.id,E=t.inputTimeScale,!f||E!==f.timescale){const b=this.getVideoStartPts(o),L=Math.round(E*i);T=Math.min(T,pi(o[0].dts,b)-L),v=Math.min(v,b-L)}else g=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,g?(this._initPTS={baseTime:v,timescale:E},this._initDTS={baseTime:T,timescale:E}):v=E=void 0,{tracks:d,initPTS:v,timescale:E,trackId:A}}remuxVideo(e,t,i,r){const l=e.inputTimeScale,o=e.samples,c=[],d=o.length,f=this._initPTS;let g=this.nextAvcDts,p=8,v=this.videoSampleDuration,T,E,A=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,L=!1;if(!i||g===null){const Q=t*l,I=o[0].pts-pi(o[0].dts,o[0].pts);ur&&g!==null&&Math.abs(Q-I-g)<15e3?i=!0:g=Q-I}const _=f.baseTime*l/f.timescale;for(let Q=0;Q<d;Q++){const I=o[Q];I.pts=pi(I.pts-_,g),I.dts=pi(I.dts-_,g),I.dts<o[Q>0?Q-1:Q].dts&&(L=!0)}L&&o.sort(function(Q,I){const Y=Q.dts-I.dts,J=Q.pts-I.pts;return Y||J}),T=o[0].dts,E=o[o.length-1].dts;const D=E-T,w=D?Math.round(D/(d-1)):v||e.inputTimeScale/30;if(i){const Q=T-g,I=Q>w,Y=Q<-1;if((I||Y)&&(I?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Sa(Q,!0)} ms (${Q}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Sa(-Q,!0)} ms (${Q}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Y||g>=o[0].pts||ur)){T=g;const J=o[0].pts-Q;if(I)o[0].dts=T,o[0].pts=J;else{let ie=!0;for(let ae=0;ae<o.length&&!(o[ae].dts>J&&ie);ae++){const pe=o[ae].pts;if(o[ae].dts-=Q,o[ae].pts-=Q,ae<o.length-1){const fe=o[ae+1].pts,Ke=o[ae].pts,De=fe<=Ke,Dt=fe<=pe;ie=De==Dt}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${Sa(J,!0)}/${Sa(T,!0)}, delta: ${Sa(Q,!0)} ms`)}}T=Math.max(0,T);let k=0,$=0,M=T;for(let Q=0;Q<d;Q++){const I=o[Q],Y=I.units,J=Y.length;let ie=0;for(let ae=0;ae<J;ae++)ie+=Y[ae].data.length;$+=ie,k+=J,I.length=ie,I.dts<M?(I.dts=M,M+=w/4|0||1):M=I.dts,A=Math.min(I.pts,A),b=Math.max(I.pts,b)}E=o[d-1].dts;const B=$+4*k+8;let V;try{V=new Uint8Array(B)}catch(Q){this.observer.emit(S.ERROR,S.ERROR,{type:ye.MUX_ERROR,details:K.REMUX_ALLOC_ERROR,fatal:!1,error:Q,bytes:B,reason:`fail allocating video mdat ${B}`});return}const U=new DataView(V.buffer);U.setUint32(0,B),V.set(G.types.mdat,4);let te=!1,re=Number.POSITIVE_INFINITY,de=Number.POSITIVE_INFINITY,ue=Number.NEGATIVE_INFINITY,le=Number.NEGATIVE_INFINITY;for(let Q=0;Q<d;Q++){const I=o[Q],Y=I.units;let J=0;for(let pe=0,fe=Y.length;pe<fe;pe++){const Ke=Y[pe],De=Ke.data,Dt=Ke.data.byteLength;U.setUint32(p,Dt),p+=4,V.set(De,p),p+=Dt,J+=4+Dt}let ie;if(Q<d-1)v=o[Q+1].dts-I.dts,ie=o[Q+1].pts-I.pts;else{const pe=this.config,fe=Q>0?I.dts-o[Q-1].dts:w;if(ie=Q>0?I.pts-o[Q-1].pts:w,pe.stretchShortVideoTrack&&this.nextAudioPts!==null){const Ke=Math.floor(pe.maxBufferHole*l),De=(r?A+r*l:this.nextAudioPts)-I.pts;De>Ke?(v=De-fe,v<0?v=fe:te=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${De/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=fe}else v=fe}const ae=Math.round(I.pts-I.dts);re=Math.min(re,v),ue=Math.max(ue,v),de=Math.min(de,ie),le=Math.max(le,ie),c.push(H0(I.key,v,J,ae))}if(c.length){if(ur){if(ur<70){const Q=c[0].flags;Q.dependsOn=2,Q.isNonSync=0}}else if(wh&&le-de<ue-re&&w/ue<.025&&c[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let Q=T;for(let I=0,Y=c.length;I<Y;I++){const J=Q+c[I].duration,ie=Q+c[I].cts;if(I<Y-1){const ae=J+c[I+1].cts;c[I].duration=ae-ie}else c[I].duration=I?c[I-1].duration:w;c[I].cts=0,Q=J}}}v=te||!v?w:v,this.nextAvcDts=g=E+v,this.videoSampleDuration=v,this.isVideoContiguous=!0;const ne={data1:G.moof(e.sequenceNumber++,T,Ye(e,{samples:c})),data2:V,startPTS:A/l,endPTS:(b+v)/l,startDTS:T/l,endDTS:g/l,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ne}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return vL;case"ac3":return TL;default:return yL}}remuxAudio(e,t,i,r,l){const o=e.inputTimeScale,c=e.samplerate?e.samplerate:o,d=o/c,f=this.getSamplesPerFrame(e),g=f*d,p=this._initPTS,v=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,T=[],E=l!==void 0;let A=e.samples,b=v?0:8,L=this.nextAudioPts||-1;const _=t*o,D=p.baseTime*o/p.timescale;if(this.isAudioContiguous=i=i||A.length&&L>0&&(r&&Math.abs(_-L)<9e3||Math.abs(pi(A[0].pts-D,_)-L)<20*g),A.forEach(function(P){P.pts=pi(P.pts-D,_)}),!i||L<0){if(A=A.filter(P=>P.pts>=0),!A.length)return;l===0?L=0:r&&!E?L=Math.max(0,_):L=A[0].pts}if(e.segmentCodec==="aac"){const P=this.config.maxAudioFramesDrift;for(let X=0,ne=L;X<A.length;X++){const Q=A[X],I=Q.pts,Y=I-ne,J=Math.abs(1e3*Y/o);if(Y<=-P*g&&E)X===0&&(this.logger.warn(`Audio frame @ ${(I/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Y/o)} ms.`),this.nextAudioPts=L=ne=I);else if(Y>=P*g&&J<pL&&E){let ie=Math.round(Y/g);ne=I-ie*g,ne<0&&(ie--,ne+=g),X===0&&(this.nextAudioPts=L=ne),this.logger.warn(`[mp4-remuxer]: Injecting ${ie} audio frame @ ${(ne/o).toFixed(3)}s due to ${Math.round(1e3*Y/o)} ms gap.`);for(let ae=0;ae<ie;ae++){const pe=Math.max(ne,0);let fe=dL.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);fe||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),fe=Q.unit.subarray()),A.splice(X,0,{unit:fe,pts:pe}),ne+=g,X++}}Q.pts=ne,ne+=g}}let w=null,k=null,$,M=0,B=A.length;for(;B--;)M+=A[B].unit.byteLength;for(let P=0,X=A.length;P<X;P++){const ne=A[P],Q=ne.unit;let I=ne.pts;if(k!==null){const J=T[P-1];J.duration=Math.round((I-k)/d)}else if(i&&e.segmentCodec==="aac"&&(I=L),w=I,M>0){M+=b;try{$=new Uint8Array(M)}catch(J){this.observer.emit(S.ERROR,S.ERROR,{type:ye.MUX_ERROR,details:K.REMUX_ALLOC_ERROR,fatal:!1,error:J,bytes:M,reason:`fail allocating audio mdat ${M}`});return}v||(new DataView($.buffer).setUint32(0,M),$.set(G.types.mdat,4))}else return;$.set(Q,b);const Y=Q.byteLength;b+=Y,T.push(H0(!0,f,Y,0)),k=I}const V=T.length;if(!V)return;const U=T[T.length-1];this.nextAudioPts=L=k+d*U.duration;const te=v?new Uint8Array(0):G.moof(e.sequenceNumber++,w/d,Ye({},e,{samples:T}));e.samples=[];const re=w/o,de=L/o,le={data1:te,data2:$,startPTS:re,endPTS:de,startDTS:re,endDTS:de,type:"audio",hasAudio:!0,hasVideo:!1,nb:V};return this.isAudioContiguous=!0,le}}function pi(a,e){let t;if(e===null)return a;for(e<a?t=-8589934592:t=8589934592;Math.abs(a-e)>4294967296;)a+=t;return a}function EL(a){for(let e=0;e<a.length;e++)if(a[e].key)return e;return-1}function Uv(a,e,t,i){const r=a.samples.length;if(!r)return;const l=a.inputTimeScale;for(let c=0;c<r;c++){const d=a.samples[c];d.pts=pi(d.pts-t.baseTime*l/t.timescale,e*l)/l,d.dts=pi(d.dts-i.baseTime*l/i.timescale,e*l)/l}const o=a.samples;return a.samples=[],{samples:o}}function Bv(a,e,t){const i=a.samples.length;if(!i)return;const r=a.inputTimeScale;for(let o=0;o<i;o++){const c=a.samples[o];c.pts=pi(c.pts-t.baseTime*r/t.timescale,e*r)/r}a.samples.sort((o,c)=>o.pts-c.pts);const l=a.samples;return a.samples=[],{samples:l}}class SL{constructor(e,t,i,r){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1,this.logger=r}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(mA(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const r=this.initData=Yy(e);r.audio&&(t=V0(r.audio,et.AUDIO,this.logger)),r.video&&(i=V0(r.video,et.VIDEO,this.logger));const l={};r.audio&&r.video?l.audiovideo={container:"video/mp4",codec:t+","+i,supplemental:r.video.supplemental,initSegment:e,id:"main"}:r.audio?l.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?l.video={container:"video/mp4",codec:i,supplemental:r.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=l}remux(e,t,i,r,l,o){var c,d;let{initPTS:f,lastEndTime:g}=this;const p={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};he(g)||(g=this.lastEndTime=l||0);const v=t.samples;if(!(v!=null&&v.length))return p;const T={initPTS:void 0,timescale:void 0,trackId:void 0};let E=this.initData;if((c=E)!=null&&c.length||(this.generateInitSegment(v),E=this.initData),!((d=E)!=null&&d.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),p;this.emitInitSegment&&(T.tracks=this.initTracks,this.emitInitSegment=!1);const A=pA(v,E,this.logger),b=E.audio?A[E.audio.id]:null,L=E.video?A[E.video.id]:null,_=fo(L,1/0),D=fo(b,1/0),w=fo(L,0,!0),k=fo(b,0,!0);let $,M=l,B=0;if(b&&(!L||!f&&D<_||f&&f.trackId===E.audio.id)?(T.trackId=E.audio.id,$=b,B=k-D):L&&(T.trackId=E.video.id,$=L,B=w-_),$){const P=$.timescale;M=$.start/P,T.timescale=P,f||(T.initPTS=$.start-l*P,this.initPTS=f={baseTime:T.initPTS,timescale:P,trackId:T.trackId})}(o||!f)&&(bL(f,M,l,B)||T.timescale!==f.timescale)&&(T.initPTS=M-l,f&&f.timescale===1&&this.logger.warn(`Adjusting initPTS @${l} from ${f.baseTime/f.timescale} to ${T.initPTS}`),this.initPTS=f={baseTime:T.initPTS,timescale:1});const V=e?M-f.baseTime/f.timescale:g;yA(E,v,f.baseTime/f.timescale);const U=V+B;B>0?this.lastEndTime=U:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const te=!!E.audio,re=!!E.video;let de="";te&&(de+="audio"),re&&(de+="video");const ue={data1:v,startPTS:V,startDTS:V,endPTS:U,endDTS:U,type:de,hasAudio:te,hasVideo:re,nb:1,dropped:0};p.audio=te&&!re?ue:void 0,p.video=re?ue:void 0;const le=L?.sampleCount;if(le){const P=L.keyFrameIndex,X=P!==-1;ue.nb=le,ue.dropped=P===0||this.isVideoContiguous?0:X?P:le,ue.independent=X,ue.firstKeyFrame=P,X&&L.keyFrameStart&&(ue.firstKeyFramePTS=L.keyFrameStart-f.baseTime/f.timescale),this.isVideoContiguous||(p.independent=X),this.isVideoContiguous||(this.isVideoContiguous=X),ue.dropped&&this.logger.warn(`fmp4 does not start with IDR: firstIDR ${P}/${le} dropped: ${ue.dropped} pts: ${ue.firstKeyFramePTS||"NA"}`)}return p.initSegment=T,p.id3=Uv(i,l,f,f),r.samples.length&&(p.text=Bv(r,l,f)),p}}function fo(a,e,t=!1){return a?.start!==void 0?(a.start+(t?a.duration:0))/a.timescale:e}function bL(a,e,t,i){if(a===null)return!0;const r=Math.max(i,1),l=e-a.baseTime/a.timescale;return Math.abs(l-t)>r}function V0(a,e,t){const i=a?.codec;return i&&i.length>4?i:e===et.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?No(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let us;try{us=self.performance.now.bind(self.performance)}catch{us=Date.now}const _o=[{demux:uL,remux:SL},{demux:Fs,remux:Ro},{demux:rL,remux:Ro},{demux:lL,remux:Ro}];_o.splice(2,0,{demux:aL,remux:Ro});class K0{constructor(e,t,i,r,l,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=l,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){const l=i.transmuxing;l.executeStart=us();let o=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:d}=this;r&&(this.currentTransmuxState=r);const{contiguous:f,discontinuity:g,trackSwitch:p,accurateTimeOffset:v,timeOffset:T,initSegmentChange:E}=r||c,{audioCodec:A,videoCodec:b,defaultInitPts:L,duration:_,initSegmentData:D}=d,w=AL(o,t);if(w&&fr(w.method)){const B=this.getDecrypter(),V=_f(w.method);if(B.isSync()){let U=B.softwareDecrypt(o,w.key.buffer,w.iv.buffer,V);if(i.part>-1){const re=B.flush();U=re&&re.buffer}if(!U)return l.executeEnd=us(),kh(i);o=new Uint8Array(U)}else return this.asyncResult=!0,this.decryptionPromise=B.webCryptoDecrypt(o,w.key.buffer,w.iv.buffer,V).then(U=>{const te=this.push(U,null,i);return this.decryptionPromise=null,te}),this.decryptionPromise}const k=this.needsProbing(g,p);if(k){const B=this.configureTransmuxer(o);if(B)return this.logger.warn(`[transmuxer] ${B.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:ye.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,fatal:!1,error:B,reason:B.message}),l.executeEnd=us(),kh(i)}(g||p||E||k)&&this.resetInitSegment(D,A,b,_,t),(g||E||k)&&this.resetInitialTimestamp(L),f||this.resetContiguity();const $=this.transmux(o,w,T,v,i);this.asyncResult=Ua($);const M=this.currentTransmuxState;return M.contiguous=!0,M.discontinuity=!1,M.trackSwitch=!1,l.executeEnd=us(),$}flush(e){const t=e.transmuxing;t.executeStart=us();const{decrypter:i,currentTransmuxState:r,decryptionPromise:l}=this;if(l)return this.asyncResult=!0,l.then(()=>this.flush(e));const o=[],{timeOffset:c}=r;if(i){const p=i.flush();p&&o.push(this.push(p.buffer,null,e))}const{demuxer:d,remuxer:f}=this;if(!d||!f){t.executeEnd=us();const p=[kh(e)];return this.asyncResult?Promise.resolve(p):p}const g=d.flush(c);return Ua(g)?(this.asyncResult=!0,g.then(p=>(this.flushRemux(o,p,e),o))):(this.flushRemux(o,g,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,i){const{audioTrack:r,videoTrack:l,id3Track:o,textTrack:c}=t,{accurateTimeOffset:d,timeOffset:f}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===me.MAIN?"level":"track"} ${i.level}`);const g=this.remuxer.remux(r,l,o,c,f,d,!0,this.id);e.push({remuxResult:g,chunkMeta:i}),i.transmuxing.executeEnd=us()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,l){const{demuxer:o,remuxer:c}=this;!o||!c||(o.resetInitSegment(e,t,i,r),c.resetInitSegment(e,t,i,l))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,l){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,i,r,l):o=this.transmuxUnencrypted(e,i,r,l),o}transmuxUnencrypted(e,t,i,r){const{audioTrack:l,videoTrack:o,id3Track:c,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(l,o,c,d,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,l){return this.demuxer.demuxSampleAes(e,t,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,r,!1,this.id),chunkMeta:l}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:r}=this;let l;for(let p=0,v=_o.length;p<v;p++){var o;if((o=_o[p].demux)!=null&&o.probe(e,this.logger)){l=_o[p];break}}if(!l)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,d=this.remuxer,f=l.remux,g=l.demux;(!d||!(d instanceof f))&&(this.remuxer=new f(i,t,r,this.logger)),(!c||!(c instanceof g))&&(this.demuxer=new g(i,t,r,this.logger),this.probe=g.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Lf(this.config)),e}}function AL(a,e){let t=null;return a.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const kh=a=>({remuxResult:{},chunkMeta:a});function Ua(a){return"then"in a&&a.then instanceof Function}class xL{constructor(e,t,i,r,l){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=l||null}}class LL{constructor(e,t,i,r,l,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=l,this.initSegmentChange=o}}let z0=0;class Fv{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=z0++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=d=>{const f=d.data,g=this.hls;if(!(!g||!(f!=null&&f.event)||f.instanceNo!==this.instanceNo))switch(f.event){case"init":{var p;const v=(p=this.workerContext)==null?void 0:p.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(f.data);break}case"flush":{this.onFlush(f.data);break}case"workerLog":{g.logger[f.data.logType]&&g.logger[f.data.logType](f.data.message);break}default:{f.data=f.data||{},f.data.frag=this.frag,f.data.part=this.part,f.data.id=this.id,g.trigger(f.event,f.data);break}}},this.onWorkerError=d=>{if(!this.hls)return;const f=new Error(`${d.message}  (${d.filename}:${d.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})};const l=e.config;this.hls=e,this.id=t,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const o=(d,f)=>{f=f||{},f.frag=this.frag||void 0,d===S.ERROR&&(f=f,f.parent=this.id,f.part=this.part,this.error=f.error),this.hls.trigger(d,f)};this.observer=new Cf,this.observer.on(S.FRAG_DECRYPTED,o),this.observer.on(S.ERROR,o);const c=l0(l.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const d=this.hls.logger;if(l.workerPath||wx()){try{l.workerPath?(d.log(`loading Web Worker ${l.workerPath} for "${t}"`),this.workerContext=Ox(l.workerPath)):(d.log(`injecting Web Worker for "${t}"`),this.workerContext=kx());const{worker:g}=this.workerContext;g.addEventListener("message",this.onWorkerMessage),g.addEventListener("error",this.onWorkerError),g.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:nt(l)})}catch(g){d.warn(`Error setting up "${t}" Web Worker, fallback to inline`,g),this.terminateWorker(),this.error=null,this.transmuxer=new K0(this.observer,c,l,"",t,e.logger)}return}}this.transmuxer=new K0(this.observer,c,l,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=z0++;const t=this.hls.config,i=l0(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:nt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Mx(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,r,l,o,c,d,f,g){var p,v;f.transmuxing.start=self.performance.now();const{instanceNo:T,transmuxer:E}=this,A=o?o.start:l.start,b=l.decryptdata,L=this.frag,_=!(L&&l.cc===L.cc),D=!(L&&f.level===L.level),w=L?f.sn-L.sn:-1,k=this.part?f.part-this.part.index:-1,$=w===0&&f.id>1&&f.id===L?.stats.chunkCount,M=!D&&(w===1||w===0&&(k===1||$&&k<=0)),B=self.performance.now();(D||w||l.stats.parsing.start===0)&&(l.stats.parsing.start=B),o&&(k||!M)&&(o.stats.parsing.start=B);const V=!(L&&((p=l.initSegment)==null?void 0:p.url)===((v=L.initSegment)==null?void 0:v.url)),U=new LL(_,M,d,D,A,V);if(!M||_||V){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${l.type} sn: ${f.sn}${f.part>-1?" part: "+f.part:""} ${this.id===me.MAIN?"level":"track"}: ${f.level} id: ${f.id}
        discontinuity: ${_}
        trackSwitch: ${D}
        contiguous: ${M}
        accurateTimeOffset: ${d}
        timeOffset: ${A}
        initSegmentChange: ${V}`);const te=new xL(i,r,t,c,g);this.configureTransmuxer(te)}if(this.frag=l,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:T,cmd:"demux",data:e,decryptdata:b,chunkMeta:f,state:U},e instanceof ArrayBuffer?[e]:[]);else if(E){const te=E.push(e,b,f,U);Ua(te)?te.then(re=>{this.handleTransmuxComplete(re)}).catch(re=>{this.transmuxerError(re,f,"transmuxer-interface push error")}):this.handleTransmuxComplete(te)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const r=i.flush(e);Ua(r)?r.then(l=>{this.handleFlushResult(l,e)}).catch(l=>{this.transmuxerError(l,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const q0=100;class RL extends If{constructor(e,t,i){super(e,t,i,"audio-stream-controller",me.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:l}){if(i===me.MAIN){const o=t.cc,c=this.fragCurrent;if(this.initPTS[o]={baseTime:r,timescale:l},this.log(`InitPTS for cc: ${o} found from main: ${r}/${l}`),this.mainAnchor=t,this.state===Z.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==o)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&c&&c.cc!==o?(c.abortRequests(),this.syncWithAnchor(t,c)):this.state===Z.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const r=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&r?.cc===t.cc)return;const l=(r||e).cc,o=this.getLevelDetails(),c=this.getLoadPosition(),d=rv(o,l,c);d&&(this.log(`Waiting fragment cc (${t?.cc}) cancelled because video is at cc ${e.cc}`),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===Z.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=Z.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(q0),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=Z.IDLE):this.state=Z.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Z.IDLE:this.doTickIdle();break;case Z.WAITING_TRACK:{const{levels:t,trackId:i}=this,r=t?.[i],l=r?.details;if(l&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(l))break;this.state=Z.WAITING_INIT_PTS}break}case Z.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:r,trackId:l}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(r?.[l]||null),this.state=Z.IDLE}break}case Z.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:i,part:r,cache:l,complete:o}=t,c=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=Z.FRAG_LOADING;const d=l.flush().buffer,f={frag:i,part:r,payload:d,networkDetails:null};this._handleFragmentLoadProgress(f),o&&super._handleFragmentLoadComplete(f)}else c&&c.cc!==t.frag.cc&&this.syncWithAnchor(c,t.frag)}else this.state=Z.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:r,trackId:l}=this,o=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[l]))return;const c=i[l],d=c.details;if(!d||this.waitForLive(c)||this.waitForCdnTuneIn(d)){this.state=Z.WAITING_TRACK,this.startFragRequested=!1;return}const f=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&f&&(this.bufferFlushed=!1,this.afterBufferFlushed(f,et.AUDIO,me.AUDIO));const g=this.getFwdBufferInfo(f,me.AUDIO);if(g===null)return;if(!this.switchingTrack&&this._streamEnded(g,d)){t.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=Z.ENDED;return}const p=g.len,v=t.maxBufferLength,T=d.fragments,E=T[0].start,A=this.getLoadPosition(),b=this.flushing?A:g.end;if(this.switchingTrack&&r){const D=A;d.PTSKnown&&D<E&&(g.end>E||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=E+.05)}if(p>=v&&!this.switchingTrack&&b<T[T.length-1].start)return;let L=this.getNextFragment(b,d);if(L&&this.isLoopLoading(L,b)&&(L=this.getNextFragmentLoopLoading(L,d,g,me.MAIN,v)),!L){this.bufferFlushed=!0;return}let _=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&_&&_t(L)&&!L.endList&&(!d.live||!this.loadingParts&&b<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(_)===Tt.OK&&(this.mainFragLoading=_=null),_&&_t(_))){if(L.start>_.end){const w=this.fragmentTracker.getFragAtPos(b,me.MAIN);w&&w.end>_.end&&(_=w,this.mainFragLoading={frag:w,targetBufferTime:null})}if(L.start>_.end)return}this.loadFragment(L,c,b)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new ka(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Z.STOPPED&&(this.setInterval(q0),this.state=Z.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:r}=this,{details:l,id:o,groupId:c,track:d}=t;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${d.name}" of "${c}"`);return}const f=this.mainDetails;if(!f||l.endCC>f.endCC||f.expired){this.cachedTrackLoadedData=t,this.state!==Z.STOPPED&&(this.state=Z.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${d.name}" of "${c}" loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`);const g=r[o];let p=0;if(l.live||(i=g.details)!=null&&i.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(g.details){var v;p=this.alignPlaylists(l,g.details,(v=this.levelLastLoaded)==null?void 0:v.details)}l.alignedSliding||(Tv(l,f),l.alignedSliding||Ho(l,f),p=l.fragmentStart)}g.details=l,this.levelLastLoaded=g,this.startFragRequested||this.setStartPosition(f,p),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:l,id:o,groupId:t.groupId}),this.state===Z.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=Z.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:l}=e,{config:o,trackId:c,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const f=d[c];if(!f){this.warn("Audio track is undefined on fragment load progress");return}const g=f.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const p=o.defaultAudioCodec||f.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new Fv(this.hls,me.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const T=this.initPTS[i.cc],E=(t=i.initSegment)==null?void 0:t.data;if(T!==void 0){const b=r?r.index:-1,L=b!==-1,_=new Rf(i.level,i.sn,i.stats.chunkCount,l.byteLength,b,L);v.push(l,E,p,"",i,r,g.totalduration,!1,_,T)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${g.startSN} ,${g.endSN}],track ${c}`);const{cache:A}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new Ev,complete:!1};A.push(new Uint8Array(l)),this.state!==Z.STOPPED&&(this.state=Z.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===me.MAIN&&_t(t.frag)&&(this.mainFragLoading=t,this.state===Z.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i.type!==me.AUDIO){!this.audioOnly&&i.type===me.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(_t(i)){this.fragPrevious=i;const l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,Ge({},l)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=Z.ERROR;return}switch(t.details){case K.FRAG_GAP:case K.FRAG_PARSING_ERROR:case K.FRAG_DECRYPT_ERROR:case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.AUDIO,t);break;case K.AUDIO_TRACK_LOAD_ERROR:case K.AUDIO_TRACK_LOAD_TIMEOUT:case K.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Z.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===we.AUDIO_TRACK&&(this.state=Z.IDLE);break;case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case K.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case K.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==et.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==et.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Z.ENDED&&(this.state=Z.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,me.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:r}=this,{remuxResult:l,chunkMeta:o}=e,c=this.getCurrentContext(o);if(!c){this.resetWhenMissingContext(o);return}const{frag:d,part:f,level:g}=c,{details:p}=g,{audio:v,text:T,id3:E,initSegment:A}=l;if(this.fragContextChanged(d)||!p){this.fragmentTracker.removeFragment(d);return}if(this.state=Z.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){const b=d.initSegment||d;this._bufferInitSegment(g,A.tracks,b,o),r.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:i,tracks:A.tracks})}if(v){const{startPTS:b,endPTS:L,startDTS:_,endDTS:D}=v;f&&(f.elementaryStreams[et.AUDIO]={startPTS:b,endPTS:L,startDTS:_,endDTS:D}),d.setElementaryStreamInfo(et.AUDIO,b,L,_,D),this.bufferFragmentData(v,d,f,o)}if(E!=null&&(t=E.samples)!=null&&t.length){const b=Ye({id:i,frag:d,details:p},E);r.trigger(S.FRAG_PARSING_METADATA,b)}if(T){const b=Ye({id:i,frag:d,details:p},T);r.trigger(S.FRAG_PARSING_USERDATA,b)}}_bufferInitSegment(e,t,i,r){if(this.state!==Z.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const l=t.audio;l.id=me.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${l.container}, codecs[level/parsed]=[${o}/${l.codec}]`),o&&o.split(",").length===1&&(l.levelCodec=o),this.hls.trigger(S.BUFFER_CODECS,t);const c=l.initSegment;if(c!=null&&c.byteLength){const d={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:c};this.hls.trigger(S.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===Tt.NOT_LOADED||r===Tt.PARTIAL){var l;if(!_t(e))this._loadInitSegment(e,t);else if((l=t.details)!=null&&l.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Z.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Ho(t.details,o)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:r,characteristics:l,audioCodec:o,channels:c}=this.bufferedTrack;pn({name:t,lang:i,assocLang:r,characteristics:l,audioCodec:o,channels:c},e,gn)||(Bo(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(S.AUDIO_TRACK_SWITCHED,Ge({},e))}}class Uf extends fs{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const r=t?.renditionReports;if(r){let l=-1;for(let o=0;o<r.length;o++){const c=r[o];let d;try{d=new self.URL(c.URI,t.url).href}catch(f){this.warn(`Could not construct new URL for Rendition Report: ${f}`),d=c.URI||""}if(d===e){l=o;break}else d===e.substring(0,d.length)&&(l=o)}if(l!==-1){const o=r[l],c=parseInt(o["LAST-MSN"])||t?.lastPartSn;let d=parseInt(o["LAST-PART"])||t?.lastPartIndex;if(this.hls.config.lowLatencyMode){const g=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&g>t.partTarget&&(d+=1)}const f=i&&u0(i);return new c0(c,d>=0?d:void 0,f)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:r,stats:l}=t,o=self.performance.now(),c=l.loading.first?Math.max(0,o-l.loading.first):0;r.advancedDateTime=Date.now()-c;const d=this.hls.config.timelineOffset;if(d!==r.appliedTimelineOffset){const g=Math.max(d||0,0);r.appliedTimelineOffset=g,r.fragments.forEach(p=>{p.start=p.playlistOffset+g})}if(r.live||i!=null&&i.live){const g="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(i),i&&r.fragments.length>0){Sx(i,r);const _=r.playlistParsingError;if(_){this.warn(_);const D=this.hls;if(!D.config.ignorePlaylistParsingErrors){var f;const{networkDetails:w}=t;D.trigger(S.ERROR,{type:ye.NETWORK_ERROR,details:K.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:_,reason:_.message,level:t.level||void 0,parent:(f=r.fragments[0])==null?void 0:f.type,networkDetails:w,stats:l});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=l.loading.start);const p=this.hls.mainForwardBufferInfo,v=p?p.end-p.len:0,T=(r.edge-v)*1e3,E=gv(r,T);if(r.requestScheduled+E<o?r.requestScheduled=o:r.requestScheduled+=E,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let A,b,L;if(r.canBlockReload&&r.endSN&&r.advanced){const _=this.hls.config.lowLatencyMode,D=r.lastPartSn,w=r.endSN,k=r.lastPartIndex,$=k!==-1,M=D===w;$?M?(b=w+1,L=_?0:k):(b=D,L=_?k+1:r.maxPartIndex):b=w+1;const B=r.age,V=B+r.ageHeader;let U=Math.min(V-r.partTarget,r.targetduration*1.5);if(U>0){if(V>r.targetduration*3)this.log(`Playlist last advanced ${B.toFixed(2)}s ago. Omitting segment and part directives.`),b=void 0,L=void 0;else if(i!=null&&i.tuneInGoal&&V-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${U} with playlist age: ${r.age}`),U=0;else{const te=Math.floor(U/r.targetduration);if(b+=te,L!==void 0){const re=Math.round(U%r.targetduration/r.partTarget);L+=re}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${B.toFixed(2)}s goal: ${U} skip sn ${te} to part ${L}`)}r.tuneInGoal=U}if(A=this.getDeliveryDirectives(r,t.deliveryDirectives,b,L),_||!M){r.requestScheduled=o,this.loadingPlaylist(g,A);return}}else(r.canBlockReload||r.canSkipUntil)&&(A=this.getDeliveryDirectives(r,t.deliveryDirectives,b,L));A&&b!==void 0&&r.canBlockReload&&(r.requestScheduled=l.loading.first+Math.max(E-c*2,E/2)),this.scheduleLoading(g,A,r)}else this.clearTimer()}scheduleLoading(e,t,i){const r=i||e.details;if(!r){this.loadingPlaylist(e,t);return}const l=self.performance.now(),o=r.requestScheduled;if(l>=o){this.loadingPlaylist(e,t);return}const c=o-l;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,i,r){let l=u0(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,l=xo.No),new c0(i,r,l)}checkRetry(e){const t=e.details,i=Fo(e),r=e.errorAction,{action:l,retryCount:o=0,retryConfig:c}=r||{},d=!!r&&!!c&&(l===Bt.RetryRequest||!r.resolved&&l===Bt.SendAlternateToPenaltyBox);if(d){var f;if(o>=c.maxNumRetry)return!1;if(i&&(f=e.context)!=null&&f.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const g=xf(c,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${o+1}/${c.maxNumRetry} after "${t}" in ${g}ms`)}e.levelRetry=!0,r.resolved=!0}return d}}function $v(a,e){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(!Ba(a[t].attrs,e[t].attrs))return!1;return!0}function Ba(a,e,t){const i=a["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>a[r]!==e[r])}function of(a,e){return e.label.toLowerCase()===a.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(a.lang||"").toLowerCase())}class _L extends Uf{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:r,details:l}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${o?.groupId}`);return}const c=o.details;o.details=t.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${l.startSN}-${l.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,r=this.groupIds;let l=this.currentTrack;if(!i||r?.length!==i?.length||i!=null&&i.some(c=>r?.indexOf(c)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(v=>!i||i.indexOf(v.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(v=>v.default)&&(this.selectDefaultTrack=!1),c.forEach((v,T)=>{v.id=T});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const d=this.hls.config.audioPreference;if(!l&&d){const v=Gi(d,c,gn);if(v>-1)l=c[v];else{const T=Gi(d,this.tracks);l=this.tracks[T]}}let f=this.findTrackId(l);f===-1&&l&&(f=this.findTrackId(null));const g={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,g);const p=this.trackId;if(f!==-1&&p===-1)this.setAudioTrack(f);else if(c.length&&p===-1){var o;const v=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${c.length}`);this.warn(v.message),this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(e,t){t.fatal||!t.context||t.context.type===we.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&pn(e,r,gn))return r;const l=Gi(e,this.tracksInGroup,gn);if(l>-1){const o=this.tracksInGroup[l];return this.setAudioTrack(l),o}else if(r){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const c=GA(e,t.levels,i,o,gn);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const o=Gi(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e],l=r.details&&!r.details.live;if(e===this.trackId&&r===i&&l||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,Ge({},r)),l))return;const o=this.switchParams(r.url,i?.details,r.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||pn(e,r,gn)))return i}if(e){const{name:i,lang:r,assocLang:l,characteristics:o,audioCodec:c,channels:d}=e;for(let f=0;f<t.length;f++){const g=t[f];if(pn({name:i,lang:r,assocLang:l,characteristics:o,audioCodec:c,channels:d},g,gn))return f}for(let f=0;f<t.length;f++){const g=t[f];if(Ba(e.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return f}for(let f=0;f<t.length;f++){const g=t[f];if(Ba(e.attrs,g.attrs,["LANGUAGE"]))return f}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Bo(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,l=this.getUrlWithDirectives(e.url,t),o=e.details,c=o?.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:l,id:i,groupId:r,deliveryDirectives:t||null,track:e})}}class DL{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(l){var i;if(r.onError(l),this.queues===null||this.tracks===null)return;const o=(i=this.tracks[e])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],r=i?.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const Y0=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Gv="HlsJsTrackRemovedError";class IL extends Error{constructor(e){super(e),this.name=Gv}}class CL extends fs{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:r,mediaSource:l}=this;i&&this.log("Media source opened"),!(!r||!l)&&(l.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:r,mediaSource:l}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=rA(Hs(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const l=this.isUpdating();l||this.operationQueue.removeBlockers();const o=this.isQueued();(l||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${l?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?Ye(i,r.tracks):this.sourceBuffers.forEach(l=>{const[o]=l;o&&(i[o]=Ye({},this.tracks[o]),this.removeBuffer(o)),l[0]=l[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media,r=Hs(this.appendSource);if(this.transferData=this.overrides=void 0,i&&r){const l=!!t.mediaSource;(l||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(o),l)this._objectUrl=i.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const d=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||d&&o instanceof d,j0(i),wL(i,c),i.load()}catch{i.src=c}else i.src=c}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,r=t.tracks,l=r?Object.keys(r):null,o=l?l.length:0,c=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(r&&l&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${nt(i,(d,f)=>d==="initSegment"?void 0:f)};
transfer tracks: ${nt(r,(d,f)=>d==="initSegment"?void 0:f)}}`),!Gy(r,i)){t.mediaSource=null,t.tracks=void 0;const d=e.currentTime,f=this.details,g=Math.max(d,f?.fragments[0].start||0);if(g-d>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${d} -> ${g}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${g} currentTime: ${d}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,t),e.currentTime=g;return}this.transferData=void 0,l.forEach(d=>{const f=d,g=r[f];if(g){const p=g.buffer;if(p){const v=this.fragmentTracker,T=g.id;if(v.hasFragments(T)||v.hasParts(T)){const b=Le.getBuffered(p);v.detectEvictedFragments(f,b,T,null,!0)}const E=Oh(f),A=[f,p];this.sourceBuffers[E]=A,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(f),this.trackSourceBuffer(f,g)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:l,_objectUrl:o}=this;if(l){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=l.readyState==="open";try{const d=l.sourceBuffers;for(let f=d.length;f--;)c&&d[f].abort(),l.removeSourceBuffer(d[f]);c&&l.endOfStream()}catch(d){this.warn(`onMediaDetaching: ${d.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.removeEventListener("startstreaming",this._onStartStreaming),l.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&j0(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(l){this.warn(`onBufferReset ${e}`,l)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Oh(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new DL(this.tracks)}onBufferCodecs(e,t){const i=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),o=!l&&this.sourceBufferCount&&this.media&&r.some(c=>!i[c]);if(l||o){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${r}" SourceBuffers`);return}r.forEach(c=>{var d,f,g;const p=t[c],{id:v,codec:T,levelCodec:E,container:A,metadata:b,supplemental:L}=p;let _=i[c];const D=(d=this.transferData)==null||(f=d.tracks)==null?void 0:f[c],w=D!=null&&D.buffer?D:_,k=w?.pendingCodec||w?.codec,$=w?.levelCodec;_||(_=i[c]={buffer:void 0,listeners:[],codec:T,supplemental:L,container:A,levelCodec:E,metadata:b,id:v});const M=Ao(k,$),B=M?.replace(Y0,"$1");let V=Ao(T,E);const U=(g=V)==null?void 0:g.replace(Y0,"$1");V&&M&&B!==U&&(c.slice(0,5)==="audio"&&(V=No(V,this.appendSource)),this.log(`switching codec ${k} to ${V}`),V!==(_.pendingCodec||_.codec)&&(_.pendingCodec=V),_.container=A,this.appendChangeType(c,A,V))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const r=`${t};codecs=${i}`,l={label:`change-type=${r}`,execute:()=>{const o=this.tracks[e];if(o){const c=o.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),c.changeType(r),o.codec=i,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(l,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,r=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,me.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var c;const d=this.tracks.video;(this.lastVideoAppendEnd>r||d!=null&&d.buffer&&Le.isBuffered(d.buffer,r)||((c=this.fragmentTracker.getAppendedFrag(r,me.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:r,type:l,parent:o,frag:c,part:d,chunkMeta:f}=t,g=f.buffering[l],p=c.sn,v=self.performance.now();g.start=v;const T=c.stats.buffering,E=d?d.stats.buffering:null;T.start===0&&(T.start=v),E&&E.start===0&&(E.start=v);const A=i.audio;let b=!1;l==="audio"&&A?.container==="audio/mpeg"&&(b=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);const L=this.tracks.video,_=L?.buffer;if(_&&p!=="initSegment"){const k=d||c,$=this.blockedAudioAppend;if(l==="audio"&&o!=="main"&&!this.blockedAudioAppend){const B=k.start+k.duration*.05,V=_.buffered,U=this.currentOp("video");!V.length&&!U?this.blockAudio(k):!U&&!Le.isBuffered(_,B)&&this.lastVideoAppendEnd<B&&this.blockAudio(k)}else if(l==="video"){const M=k.end;if($){const B=$.frag.start;(M>B||M<this.lastVideoAppendEnd||Le.isBuffered(_,B))&&this.unblockAudio()}this.lastVideoAppendEnd=M}}const D=(d||c).start,w={label:`append-${l}`,execute:()=>{if(g.executeStart=self.performance.now(),b){const k=this.tracks[l];if(k){const $=k.buffer;if($){const M=D-$.timestampOffset;Math.abs(M)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${D} (delta: ${M}) sn: ${p})`),$.timestampOffset=D)}}}this.appendExecutor(r,l)},onStart:()=>{},onComplete:()=>{const k=self.performance.now();g.executeEnd=g.end=k,T.first===0&&(T.first=k),E&&E.first===0&&(E.first=k);const $={};this.sourceBuffers.forEach(([M,B])=>{M&&($[M]=Le.getBuffered(B))}),this.appendErrors[l]=0,l==="audio"||l==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:l,frag:c,part:d,chunkMeta:f,parent:c.type,timeRanges:$})},onError:k=>{var $;const M={type:ye.MEDIA_ERROR,parent:c.type,details:K.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:c,part:d,chunkMeta:f,error:k,err:k,fatal:!1},B=($=this.media)==null?void 0:$.error;if(k.code===DOMException.QUOTA_EXCEEDED_ERR)M.details=K.BUFFER_FULL_ERROR;else if(k.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!B)M.errorAction=Oa(!0);else if(k.name===Gv&&this.sourceBufferCount===0)M.errorAction=Oa(!0);else{const V=++this.appendErrors[l];this.warn(`Failed ${V}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${l}" sourceBuffer (${B||"no media error"})`),(V>=this.hls.config.appendErrorMaxRetry||B)&&(M.fatal=!0)}this.hls.trigger(S.ERROR,M)}};this.append(w,l,this.isPending(this.tracks[l]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:i,startOffset:r,endOffset:l}=t;i?this.append(this.getFlushOp(i,r,l),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,l),o)})}onFragParsed(e,t){const{frag:i,part:r}=t,l=[],o=r?r.elementaryStreams:i.elementaryStreams;o[et.AUDIOVIDEO]?l.push("audiovideo"):(o[et.AUDIO]&&l.push("audio"),o[et.VIDEO]&&l.push("video"));const c=()=>{const d=self.performance.now();i.stats.buffering.end=d,r&&(r.stats.buffering.end=d);const f=r?r.stats:i.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:i,part:r,stats:f,id:i.type})};l.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(c,l).catch(d=>{this.warn(`Fragment buffered callback ${d}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,i;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((i=this.tracks[e])==null?void 0:i.ending))})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([o])=>{if(o){const c=this.tracks[o];(!t.type||t.type===o)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${o} buffer reached EOS`)))}});const r=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var c;return o&&!((c=this.tracks[o])!=null&&c.ended)})&&(r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===K.BUFFER_APPEND_ERROR&&t.frag){var i;const r=(i=t.errorAction)==null?void 0:i.nextAutoLevel;he(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const r=e.config,l=i.currentTime,o=t.levelTargetDuration,c=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(he(c)&&c>=0){const d=Math.max(c,o),f=Math.floor(l/o)*o-d;this.flushBackBuffer(l,o,f)}if(he(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){const d=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),f=Math.max(d,o),g=Math.floor(l/o)*o+f;this.flushFrontBuffer(l,o,g)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([r,l])=>{if(l){const c=Le.getBuffered(l);if(c.length>0&&i>c.start(0)){var o;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:i});const d=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(d!=null&&d.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([r,l])=>{if(l){const o=Le.getBuffered(l),c=o.length;if(c<2)return;const d=o.start(c-1),f=o.end(c-1);if(i>d||e>=d&&e<=f)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||i?.readyState!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&i.setLiveSeekableRange){const f=Math.max(0,t.fragmentStart),g=Math.max(f,r);return{duration:1/0,start:f,end:g}}return{duration:1/0}}const l=(e=this.overrides)==null?void 0:e.duration;if(l)return he(l)?{duration:l}:null;const o=this.media.duration,c=he(i.duration)?i.duration:0;return r>c&&r>o||!he(o)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:i}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(he(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${i}.`),r.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${nt(i)}`),this.tracksReady){var r;const l=(r=this.transferData)==null?void 0:r.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const r=this.tracks[t];e[t]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const l in e){const o=l,c=e[o];if(this.isPending(c)){const d=this.getTrackCodec(c,o),f=`${c.container};codecs=${d}`;c.codec=d,this.log(`creating sourceBuffer(${f})${this.currentOp(o)?" Queued":""} ${nt(c)}`);try{const g=i.addSourceBuffer(f),p=Oh(o),v=[o,g];t[p]=v,c.buffer=g}catch(g){var r;this.error(`error while trying to add sourceBuffer: ${g.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:g,sourceBufferName:o,mimeType:f,parent:c.id});return}this.trackSourceBuffer(o,c)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let r=e.codec;i&&(t==="video"||t==="audiovideo")&&Jh(i,"video")&&(r=_A(r,i));const l=Ao(r,e.levelCodec);return l?t.slice(0,5)==="audio"?No(l,this.appendSource):l:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(l,o)=>{const c=o.removedRanges;c!=null&&c.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:l})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const l=this.currentOp(e);l&&l.onError(r)}removeExecutor(e,t,i){const{media:r,mediaSource:l}=this,o=this.tracks[e],c=o?.buffer;if(!r||!l||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const d=he(r.duration)?r.duration:1/0,f=he(l.duration)?l.duration:1/0,g=Math.max(0,t),p=Math.min(i,d,f);p>g&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${g},${p}] from the ${e} SourceBuffer`),c.remove(g,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],r=i?.buffer;if(!r)throw new IL(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,r=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const r=(i=this.tracks[t])==null?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const r=this.tracks[e];if(!r)return;const l=r.buffer;if(!l)return;const o=i.bind(this,e);r.listeners.push({event:t,listener:o}),l.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function j0(a){const e=a.querySelectorAll("source");[].slice.call(e).forEach(t=>{a.removeChild(t)})}function wL(a,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,a.appendChild(t)}function Oh(a){return a==="audio"?1:0}class Bf{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&he(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((r,l)=>this.isLevelAllowed(r)&&l<=e);return this.clientRect=null,Bf.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const r=(c,d)=>d?c.width!==d.width||c.height!==d.height:!0;let l=e.length-1;const o=Math.max(t,i);for(let c=0;c<e.length;c+=1){const d=e[c];if((d.width>=o||d.height>=o)&&r(d,e[c+1])){l=c;break}}return l}}const kL={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Yt=kL,OL={HLS:"h"},ML=OL,PL="CMCD-Object",NL="CMCD-Request",UL="CMCD-Session",BL="CMCD-Status",Aa={OBJECT:PL,REQUEST:NL,SESSION:UL,STATUS:BL},FL={[Aa.OBJECT]:["br","d","ot","tb"],[Aa.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Aa.SESSION]:["cid","pr","sf","sid","st","v"],[Aa.STATUS]:["bs","rtp"]};class vr{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof vr?i:new vr(i))),this.value=e,this.params=t}}const $L="Dict";function GL(a){return Array.isArray(a)?JSON.stringify(a):a instanceof Map?"Map{}":a instanceof Set?"Set{}":typeof a=="object"?JSON.stringify(a):String(a)}function HL(a,e,t,i){return new Error(`failed to ${a} "${GL(e)}" as ${t}`,{cause:i})}function Vi(a,e,t){return HL("serialize",a,e,t)}class Hv{constructor(e){this.description=e}}const X0="Bare Item",VL="Boolean";function KL(a){if(typeof a!="boolean")throw Vi(a,VL);return a?"?1":"?0"}function zL(a){return btoa(String.fromCharCode(...a))}const qL="Byte Sequence";function YL(a){if(ArrayBuffer.isView(a)===!1)throw Vi(a,qL);return`:${zL(a)}:`}const jL="Integer";function XL(a){return a<-999999999999999||999999999999999<a}function Vv(a){if(XL(a))throw Vi(a,jL);return a.toString()}function QL(a){return`@${Vv(a.getTime()/1e3)}`}function Kv(a,e){if(a<0)return-Kv(-a,e);const t=Math.pow(10,e);if(Math.abs(a*t%1-.5)<Number.EPSILON){const r=Math.floor(a*t);return(r%2===0?r:r+1)/t}else return Math.round(a*t)/t}const WL="Decimal";function ZL(a){const e=Kv(a,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Vi(a,WL);const t=e.toString();return t.includes(".")?t:`${t}.0`}const JL="String",eR=/[\x00-\x1f\x7f]+/;function tR(a){if(eR.test(a))throw Vi(a,JL);return`"${a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function iR(a){return a.description||a.toString().slice(7,-1)}const sR="Token";function Q0(a){const e=iR(a);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Vi(e,sR);return e}function uf(a){switch(typeof a){case"number":if(!he(a))throw Vi(a,X0);return Number.isInteger(a)?Vv(a):ZL(a);case"string":return tR(a);case"symbol":return Q0(a);case"boolean":return KL(a);case"object":if(a instanceof Date)return QL(a);if(a instanceof Uint8Array)return YL(a);if(a instanceof Hv)return Q0(a);default:throw Vi(a,X0)}}const nR="Key";function cf(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw Vi(a,nR);return a}function Ff(a){return a==null?"":Object.entries(a).map(([e,t])=>t===!0?`;${cf(e)}`:`;${cf(e)}=${uf(t)}`).join("")}function zv(a){return a instanceof vr?`${uf(a.value)}${Ff(a.params)}`:uf(a)}function rR(a){return`(${a.value.map(zv).join(" ")})${Ff(a.params)}`}function aR(a,e={whitespace:!0}){if(typeof a!="object")throw Vi(a,$L);const t=a instanceof Map?a.entries():Object.entries(a),i=e?.whitespace?" ":"";return Array.from(t).map(([r,l])=>{l instanceof vr||(l=new vr(l));let o=cf(r);return l.value===!0?o+=Ff(l.params):(o+="=",Array.isArray(l.value)?o+=rR(l):o+=zv(l)),o}).join(`,${i}`)}function lR(a,e){return aR(a,e)}function oR(a){return a==="ot"||a==="sf"||a==="st"}function uR(a){return typeof a=="number"?he(a):a!=null&&a!==""&&a!==!1}function cR(a,e){const t=new URL(a),i=new URL(e);if(t.origin!==i.origin)return a;const r=t.pathname.split("/").slice(1),l=i.pathname.split("/").slice(1,-1);for(;r[0]===l[0];)r.shift(),l.shift();for(;l.length;)l.shift(),r.unshift("..");return r.join("/")}const Do=a=>Math.round(a),hR=(a,e)=>(e?.baseUrl&&(a=cR(a,e.baseUrl)),encodeURIComponent(a)),go=a=>Do(a/100)*100,fR={br:Do,d:Do,bl:go,dl:go,mtp:go,nor:hR,rtp:go,tb:Do};function dR(a,e){const t={};if(a==null||typeof a!="object")return t;const i=Object.keys(a).sort(),r=Ye({},fR,e?.formatters),l=e?.filter;return i.forEach(o=>{if(l?.(o))return;let c=a[o];const d=r[o];d&&(c=d(c,e)),!(o==="v"&&c===1)&&(o=="pr"&&c===1||uR(c)&&(oR(o)&&typeof c=="string"&&(c=new Hv(c)),t[o]=c))}),t}function qv(a,e={}){return a?lR(dR(a,e),Ye({whitespace:!1},e)):""}function gR(a,e={}){const t={};if(!a)return t;const i=Object.entries(a),r=Object.entries(FL).concat(Object.entries(e?.customHeaderMap||{})),l=i.reduce((o,c)=>{var d,f;const[g,p]=c,v=((d=r.find(T=>T[1].includes(g)))===null||d===void 0?void 0:d[0])||Aa.REQUEST;return(f=o[v])!==null&&f!==void 0||(o[v]={}),o[v][g]=p,o},{});return Object.entries(l).reduce((o,[c,d])=>(o[c]=qv(d,e),o),t)}function mR(a,e,t){return Ye(a,gR(e,t))}const pR="CMCD";function yR(a,e={}){if(!a)return"";const t=qv(a,e);return`${pR}=${encodeURIComponent(t)}`}const W0=/CMCD=[^&#]+/;function vR(a,e,t){const i=yR(e,t);if(!i)return a;if(W0.test(a))return a.replace(W0,i);const r=a.includes("?")?"&":"?";return`${a}${r}${i}`}class TR{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Yt.MANIFEST,su:!this.initialized})}catch(l){this.hls.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=r=>{try{const{frag:l,part:o}=r,c=this.hls.levels[l.level],d=this.getObjectType(l),f={d:(o||l).duration*1e3,ot:d};(d===Yt.VIDEO||d===Yt.AUDIO||d==Yt.MUXED)&&(f.br=c.bitrate/1e3,f.tb=this.getTopBandwidth(d)/1e3,f.bl=this.getBufferLength(d));const g=o?this.getNextPart(o):this.getNextFrag(l);g!=null&&g.url&&g.url!==l.url&&(f.nor=g.url),this.apply(r,f)}catch(l){this.hls.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:ML.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ye(t,this.createData());const i=t.ot===Yt.INIT||t.ot===Yt.VIDEO||t.ot===Yt.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((o,c)=>(r.includes(c)&&(o[c]=t[c]),o),{}));const l={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),mR(e.headers,t,l)):e.url=vR(e.url,t,l)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const r=e.sn-i.startSN;return i.fragments[r+1]}}getNextPart(e){var t,i;const{index:r,fragment:l}=e,o=(t=this.hls.levels[l.level])==null||(i=t.details)==null?void 0:i.partList;if(o){const{sn:c}=l;for(let d=o.length-1;d>=0;d--){const f=o[d];if(f.index===r&&f.fragment.sn===c)return o[d+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Yt.TIMED_TEXT;if(e.sn==="initSegment")return Yt.INIT;if(t==="audio")return Yt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Yt.VIDEO:Yt.MUXED}getTopBandwidth(e){let t=0,i;const r=this.hls;if(e===Yt.AUDIO)i=r.audioTracks;else{const l=r.maxAutoLevel,o=l>-1?l+1:r.levels.length;i=r.levels.slice(0,o)}return i.forEach(l=>{l.bitrate>t&&(t=l.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===Yt.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:Le.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new i(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,c){t(l),this.loader.load(l,o,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new i(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,c){t(l),this.loader.load(l,o,c)}}}}const ER=3e5;class SR extends fs{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if(i?.action===Bt.SendAlternateToPenaltyBox&&i.flags===Ri.MoveAllAlternatesMatchingHost){const r=this.levels;let l=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:c,pathwayId:d,type:f}=t.context;c&&r?o=this.getPathwayForGroupId(c,f,o):d&&(o=d)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!l&&r&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),i.resolved=this.pathwayId!==o),i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${nt(l)} penalized: ${nt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(l=>{r-i[l]>ER&&delete i[l]});for(let l=0;l<e.length;l++){const o=e[l];if(o in i)continue;if(o===this.pathwayId)return;const c=this.hls.nextLoadLevel,d=this.hls.levels[c];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,yv(t),this.hls.trigger(S.LEVELS_UPDATED,{levels:t});const f=this.hls.levels[c];d&&f&&this.levels&&(f.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&f.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${f.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,i){const r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let l=0;l<r.length;l++)if(t===we.AUDIO_TRACK&&r[l].hasAudioGroup(e)||t===we.SUBTITLE_TRACK&&r[l].hasSubtitleGroup(e))return r[l].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},r={};e.forEach(l=>{const{ID:o,"BASE-ID":c,"URI-REPLACEMENT":d}=l;if(t.some(g=>g.pathwayId===o))return;const f=this.getLevelsForPathway(c).map(g=>{const p=new at(g.attrs);p["PATHWAY-ID"]=o;const v=p.AUDIO&&`${p.AUDIO}_clone_${o}`,T=p.SUBTITLES&&`${p.SUBTITLES}_clone_${o}`;v&&(i[p.AUDIO]=v,p.AUDIO=v),T&&(r[p.SUBTITLES]=T,p.SUBTITLES=T);const E=Yv(g.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),A=new ka({attrs:p,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:E,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let b=1;b<g.audioGroups.length;b++)A.addGroupId("audio",`${g.audioGroups[b]}_clone_${o}`);if(g.subtitleGroups)for(let b=1;b<g.subtitleGroups.length;b++)A.addGroupId("text",`${g.subtitleGroups[b]}_clone_${o}`);return A});t.push(...f),Z0(this.audioTracks,i,d,o),Z0(this.subtitleTracks,r,d,o)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+g)}const l={responseType:"json",url:r.href},o=t.steeringManifestLoadPolicy.default,c=o.errorRetry||o.timeoutRetry||{},d={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},f={onSuccess:(g,p,v,T)=>{this.log(`Loaded steering manifest: "${r}"`);const E=g.data;if(E?.VERSION!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;const{"RELOAD-URI":A,"PATHWAY-CLONES":b,"PATHWAY-PRIORITY":L}=E;if(A)try{this.uri=new self.URL(A,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${A}`);return}this.scheduleRefresh(this.uri||v.url),b&&this.clonePathways(b);const _={steeringManifest:E,url:r.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,_),L&&this.updatePathwayPriority(L)},onError:(g,p,v,T)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${p.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let E=this.timeToLoad*1e3;if(g.code===429){const A=this.loader;if(typeof A?.getResponseHeader=="function"){const b=A.getResponseHeader("Retry-After");b&&(E=parseFloat(b)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,E)},onTimeout:(g,p,v)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(l,d,f)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Z0(a,e,t,i){a&&Object.keys(e).forEach(r=>{const l=a.filter(o=>o.groupId===r).map(o=>{const c=Ye({},o);return c.details=void 0,c.attrs=new at(c.attrs),c.url=c.attrs.URI=Yv(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[r],c.attrs["PATHWAY-ID"]=i,c});a.push(...l)})}function Yv(a,e,t,i){const{HOST:r,PARAMS:l,[t]:o}=i;let c;e&&(c=o?.[e],c&&(a=c));const d=new self.URL(a);return r&&!c&&(d.host=r),l&&Object.keys(l).sort().forEach(f=>{f&&d.searchParams.set(f,l[f])}),d.href}function ni(a,e,t){yi(a,e,t),a.addEventListener(e,t)}function yi(a,e,t){a.removeEventListener(e,t)}class dr extends fs{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=dr.CDMCleanupPromise?[dr.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:i,initData:r}=t,l=`"${t.type}" event: init data type: "${i}"`;if(this.debug(l),r!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=ba(this.config));const c=o.map(oo).filter(d=>!!d);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(o=>{const c=Lo(o);let d,f;if(i==="sinf"){if(c!==Ve.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${i}" for selected key-system ${c}`);return}const E=vt(new Uint8Array(r));try{const A=Df(JSON.parse(E).sinf),b=jy(A);if(!b)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=new Uint8Array(b.subarray(8,24)),f=Ve.FAIRPLAY}catch(A){this.warn(`${l} Failed to parse sinf: ${A}`);return}}else{if(c!==Ve.WIDEVINE&&c!==Ve.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${i}" for selected key-system ${c}`);return}const E=AA(r),A=E.filter(L=>!!L.systemId&&Lh(L.systemId)===c);A.length>1&&this.warn(`${l} Using first of ${A.length} pssh found for selected key-system ${c}`);const b=A[0];if(!b){E.length===0||E.some(L=>!L.systemId)?this.warn(`${l} contains incomplete or invalid pssh data`):this.log(`ignoring ${l} for ${E.map(L=>Lh(L.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(f=Lh(b.systemId),b.version===0&&b.data)if(f===Ve.WIDEVINE){const L=b.data.length-22;d=new Uint8Array(b.data.subarray(L,L+16))}else f===Ve.PLAYREADY&&(d=cv(b.data))}if(!f||!d)return;const g=Ui.hexDump(d),{keyIdToKeySessionPromise:p,mediaKeySessions:v}=this;let T=p[g];for(let E=0;E<v.length;E++){const A=v[E],b=A.decryptdata;if(!b.keyId)continue;const L=Ui.hexDump(b.keyId);if(g===L||b.uri.replace(/-/g,"").indexOf(g)!==-1){if(T=p[L],b.pssh)break;delete p[L],b.pssh=new Uint8Array(r),b.keyId=d,T=p[g]=T.then(()=>this.generateRequestWithPreferredKeySession(A,i,r,"encrypted-event-key-match")),T.catch(_=>this.handleError(_));break}}if(!T){if(f!==c){this.log(`Ignoring "${t.type}" event with ${f} init data for selected key-system ${c}`);return}T=p[g]=this.getKeySystemSelectionPromise([f]).then(({keySystem:E,mediaKeys:A})=>{var b;this.throwIfDestroyed();const L=new Ma("ISO-23001-7",g,(b=oo(E))!=null?b:"");return L.pssh=new Uint8Array(r),L.keyId=d,this.attemptSetMediaKeys(E,A).then(()=>{this.throwIfDestroyed();const _=this.createMediaKeySessionContext({decryptdata:L,keySystem:E,mediaKeys:A});return this.generateRequestWithPreferredKeySession(_,i,r,"encrypted-event-no-match")})}),T.catch(E=>this.handleError(E))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===Ve.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(o,c,d)=>!!o&&d.indexOf(o)===c,r=t.map(o=>o.audioCodec).filter(i),l=t.map(o=>o.videoCodec).filter(i);return r.length+l.length===0&&l.push("avc1.42e01e"),new Promise((o,c)=>{const d=f=>{const g=f.shift();this.getMediaKeysPromise(g,r,l).then(p=>o({keySystem:g,mediaKeys:p})).catch(p=>{f.length?d(f):p instanceof mi?c(p):c(new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};d(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${i}`;return uv===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return i(e,t)}getMediaKeysPromise(e,t,i){const r=dx(e,t,i,this.config.drmSystemOptions),l=this.keySystemAccessPromises[e];let o=l?.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${nt(r)}`),o=this.requestMediaKeySystemAccess(e,r);const c=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),o.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const f=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),c.mediaKeys=d.createMediaKeys().then(g=>(this.log(`Media-keys created for "${e}"`),c.hasMediaKeys=!0,f.then(p=>p?this.setMediaKeysServerCertificate(g,e,p):g))),c.mediaKeys.catch(g=>{this.error(`Failed to create media-keys for "${e}"}: ${g}`)}),c.mediaKeys})}return o.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${Ui.hexDump(e.keyId||[])}`);const r=i.createSession(),l={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),l="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,l,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Ui.hexDump(e.keyId)}updateKeySession(e,t){var i;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${Ui.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>oo(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const l=oo(r);l?t(l):i(new Error(`Unable to find format for key-system "${r}"`))}).catch(i))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=ba(this.config),i=e.map(Lo).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(i)}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let l=this.keyIdToKeySessionPromise[i];return l||(l=this.getKeySystemForKeyPromise(t).then(({keySystem:c,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(c,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:d,decryptdata:t}))))),(this.keyIdToKeySessionPromise[i]=l.then(c=>{const d="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(c,d,f,"playlist-key")})).catch(c=>this.handleError(c))),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof mi?this.hls.trigger(S.ERROR,e.data):this.hls.trigger(S.ERROR,{type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const r=Lo(e.keyFormat),l=r?[r]:ba(this.config);return this.attemptKeySystemAccess(l)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=ba(this.config)),e.length===0)throw new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${nt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(l=>i.indexOf(l)===-1)})}generateRequestWithPreferredKeySession(e,t,i,r){var l,o;const c=(l=this.config.drmSystems)==null||(o=l[e.keySystem])==null?void 0:o.generateRequest;if(c)try{const E=c.call(this.hls,t,i,e);if(!E)throw new Error("Invalid response from configured generateRequest filter");t=E.initDataType,i=E.initData?E.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(E){var d;if(this.warn(E.message),(d=this.hls)!=null&&d.config.debug)throw E}if(i===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const f=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${f} (init data type: ${t} length: ${i?i.byteLength:null})`);const g=new Cf,p=e._onmessage=E=>{const A=e.mediaKeysSession;if(!A){g.emit("error",new Error("invalid state"));return}const{messageType:b,message:L}=E;this.log(`"${b}" message event for session "${A.sessionId}" message size: ${L.byteLength}`),b==="license-request"||b==="license-renewal"?this.renewLicense(e,L).catch(_=>{g.eventNames().length?g.emit("error",_):this.handleError(_)}):b==="license-release"?e.keySystem===Ve.FAIRPLAY&&(this.updateKeySession(e,sf("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${b}"`)},v=e._onkeystatuseschange=E=>{if(!e.mediaKeysSession){g.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const b=e.keyStatus;g.emit("keyStatus",b),b==="expired"&&(this.warn(`${e.keySystem} expired for key ${f}`),this.renewKeySession(e))};ni(e.mediaKeysSession,"message",p),ni(e.mediaKeysSession,"keystatuseschange",v);const T=new Promise((E,A)=>{g.on("error",A),g.on("keyStatus",b=>{b.startsWith("usable")?E():b==="output-restricted"?A(new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):b==="internal-error"?A(new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${b}"`)):b==="expired"?A(new Error("key expired while generating request")):this.warn(`unhandled key status change "${b}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var E;this.log(`Request generated for key-session "${(E=e.mediaKeysSession)==null?void 0:E.sessionId}" keyId: ${f}`)}).catch(E=>{throw new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_NO_SESSION,error:E,fatal:!1},`Error generating key-session request: ${E}`)}).then(()=>T).catch(E=>{throw g.removeAllListeners(),this.removeSession(e),E}).then(()=>(g.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{if(typeof i=="string"&&typeof t=="object"){const r=i;i=t,t=r}this.log(`key status change "${t}" for keyStatuses keyId: ${Ui.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${Ui.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,r=new i(t),l=this.getServerCertificateUrl(e);return l?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,c)=>{const d={responseType:"arraybuffer",url:l},f=t.certLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,T,E,A)=>{o(v.data)},onError:(v,T,E,A)=>{c(new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:Ge({url:d.url,data:void 0},v)},`"${e}" certificate request failed (${l}). Status: ${v.code} (${v.text})`))},onTimeout:(v,T,E)=>{c(new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:d.url,data:void 0}},`"${e}" certificate request timed out (${l})`))},onAbort:(v,T,E)=>{c(new Error("aborted"))}};r.load(d,g,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,l)=>{e.setServerCertificate(i).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${i?.byteLength}) on "${t}"`),r(e)}).catch(o=>{l(new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(r=>{throw new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:r,fatal:!0},r.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(i,"application/xml"),l=r.querySelectorAll("HttpHeader");if(l.length>0){let g;for(let p=0,v=l.length;p<v;p++){var o,c;g=l[p];const T=(o=g.querySelector("name"))==null?void 0:o.textContent,E=(c=g.querySelector("value"))==null?void 0:c.textContent;T&&E&&e.setRequestHeader(T,E)}}const d=r.querySelector("Challenge"),f=d?.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return sf(atob(f))}setupLicenseXHR(e,t,i,r){const l=this.config.licenseXhrSetup;return l?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return l.call(this.hls,e,t,i,r)}).catch(o=>{if(!i.decryptdata)throw o;return e.open("POST",t,!0),l.call(this.hls,e,t,i,r)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((r,l)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return l(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let d=c.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const f=this.config.licenseResponseCallback;if(f)try{d=f.call(this.hls,c,o,e)}catch(g){this.error(g)}r(d)}else{const d=i.errorRetry,f=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>f||c.status>=400&&c.status<500)l(new mi({type:ye.KEY_SYSTEM_ERROR,details:K.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:o,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${o}). Status: ${c.status} (${c.statusText})`));else{const g=f-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(e,t).then(r,l)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,o,e,t).then(({xhr:d,licenseChallenge:f})=>{e.keySystem==Ve.PLAYREADY&&(f=this.unpackPlayReadyKeyMessage(d,f)),d.send(f)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,ni(i,"encrypted",this.onMediaEncrypted),ni(i,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(yi(e,"encrypted",this.onMediaEncrypted),yi(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ma.clearKeyUriToKeyIdMap();const r=i.length;dr.CDMCleanupPromise=Promise.all(i.map(l=>this.removeSession(l)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(l=>{var o;this.log(`Could not clear media keys: ${l}`),(o=this.hls)==null||o.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))).catch(l=>{var o;this.log(`Could not close sessions and clear media keys: ${l}`),(o=this.hls)==null||o.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((r,l)=>(r.indexOf(l.keyFormat)===-1&&r.push(l.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{drmSystemOptions:l}=this.config;return(mx(l)?new Promise((c,d)=>{self.setTimeout(()=>d(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c)}):Promise.resolve()).catch(c=>{var d;this.log(`Could not remove session: ${c}`),(d=this.hls)==null||d.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{var d;this.log(`Could not close session: ${c}`),(d=this.hls)==null||d.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:K.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}}}dr.CDMCleanupPromise=void 0;class mi extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class bR{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const r=performance.now();if(t){if(this.lastTime){const l=r-this.lastTime,o=i-this.lastDroppedFrames,c=t-this.lastDecodedFrames,d=1e3*o/l,f=this.hls;if(f.trigger(S.FPS_DROP,{currentDropped:o,currentDecoded:c,totalDroppedFrames:i}),d>0&&o>f.config.fpsDroppedMonitoringThreshold*c){let g=f.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=g)&&(g=g-1,f.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:f.currentLevel}),f.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function jv(a,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=a,e.dispatchEvent(t)}function Xv(a,e){const t=a.mode;if(t==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(e.id))try{if(a.addCue(e),!a.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Fe.debug(`[texttrack-utils]: ${i}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,a.addCue(r)}catch(r){Fe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(a.mode=t)}function hr(a,e){const t=a.mode;if(t==="disabled"&&(a.mode="hidden"),a.cues)for(let i=a.cues.length;i--;)e&&a.cues[i].removeEventListener("enter",e),a.removeCue(a.cues[i]);t==="disabled"&&(a.mode=t)}function hf(a,e,t,i){const r=a.mode;if(r==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0){const l=xR(a.cues,e,t);for(let o=0;o<l.length;o++)(!i||i(l[o]))&&a.removeCue(l[o])}r==="disabled"&&(a.mode=r)}function AR(a,e){if(e<=a[0].startTime)return 0;const t=a.length-1;if(e>a[t].endTime)return-1;let i=0,r=t,l;for(;i<=r;)if(l=Math.floor((r+i)/2),e<a[l].startTime)r=l-1;else if(e>a[l].startTime&&i<t)i=l+1;else return l;return a[i].startTime-e<e-a[r].startTime?i:r}function xR(a,e,t){const i=[],r=AR(a,e);if(r>-1)for(let l=r,o=a.length;l<o;l++){const c=a[l];if(c.startTime>=e&&c.endTime<=t)i.push(c);else if(c.startTime>t)return i}return i}function Io(a){const e=[];for(let t=0;t<a.length;t++){const i=a[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(a[t])}return e}class LR extends Uf{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=Io(this.media.textTracks);for(let l=0;l<i.length;l++)if(i[l].mode==="hidden")t=i[l];else if(i[l].mode==="showing"){t=i[l];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;Io(i.textTracks).forEach(o=>{hr(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:r,details:l}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${o?.groupId}`);return}const c=o.details;o.details=t.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${l.startSN}-${l.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,r=this.groupIds;let l=this.currentTrack;if(!i||r?.length!==i?.length||i!=null&&i.some(o=>r?.indexOf(o)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(g=>!i||i.indexOf(g.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(g=>g.default)&&(this.selectDefaultTrack=!1),o.forEach((g,p)=>{g.id=p});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const c=this.hls.config.subtitlePreference;if(!l&&c){this.selectDefaultTrack=!1;const g=Gi(c,o);if(g>-1)l=o[g];else{const p=Gi(c,this.tracks);l=this.tracks[p]}}let d=this.findTrackId(l);d===-1&&l&&(d=this.findTrackId(null));const f={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,f),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const l=t[r];if(!(i&&!l.default||!i&&!e)&&(!e||pn(l,e)))return r}if(e){for(let r=0;r<t.length;r++){const l=t[r];if(Ba(e.attrs,l.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const l=t[r];if(Ba(e.attrs,l.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(of(r,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===we.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&pn(e,i))return i;const r=Gi(e,this.tracksInGroup);if(r>-1){const l=this.tracksInGroup[r];return this.setSubtitleTrack(r),l}else{if(i)return null;{const l=Gi(e,t);if(l>-1)return t[l]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,l=this.getUrlWithDirectives(e.url,t),o=e.details,c=o?.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:l,id:i,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Io(e.textTracks),i=this.currentTrack;let r;if(i&&(r=t.filter(l=>of(i,l))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(l=>{l.mode!=="disabled"&&l!==r&&(l.mode="disabled")}),r){const l=this.subtitleDisplay?"showing":"hidden";r.mode!==l&&(r.mode=l)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!he(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const l=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&l)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:c="",name:d,type:f,url:g}=r;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:o,groupId:c,name:d,type:f,url:g});const p=this.switchParams(r.url,i?.details,r.details);this.loadPlaylist(p)}}function RR(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const l=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?l:l&3|8).toString(16)})}}}function _a(a){let e=5381,t=a.length;for(;t;)e=e*33^a.charCodeAt(--t);return(e>>>0).toString()}const gr=.025;let Ko=function(a){return a[a.Point=0]="Point",a[a.Range=1]="Range",a}({});function _R(a,e,t){return`${a.identifier}-${t+1}-${_a(e)}`}class DR{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Mh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Mh(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=he(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Mh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<gr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Ko.Range:Ko.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return IR(this)}}function Mh(a,e){return a-e.start<e.duration/2&&!(Math.abs(a-(e.start+e.duration))<gr)?e.start:e.start+e.duration}function Qv(a,e,t){const i=new self.URL(a,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function Ph(a,e){for(;(t=a.assetList[++e])!=null&&t.error;)var t;return e}function IR(a){return`["${a.identifier}" ${a.cue.pre?"<pre>":a.cue.post?"<post>":""}${a.timelineStart.toFixed(2)}-${a.resumeTime.toFixed(2)}]`}function cr(a){const e=a.timelineStart,t=a.duration||0;return`["${a.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class CR{constructor(e,t,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const l=this.hls=new e(t);this.interstitial=i,this.assetItem=r;let o=r.uri;try{o=Qv(o,t.primarySessionId).href}catch{}l.loadSource(o);const c=()=>{this.hasDetails=!0};l.once(S.LEVEL_LOADED,c),l.once(S.AUDIO_TRACK_LOADED,c),l.once(S.SUBTITLE_TRACK_LOADED,c),l.on(S.MEDIA_ATTACHING,(d,{media:f})=>{this.removeMediaListeners(),this.mediaAttached=f,this.interstitial.playoutLimit&&(f.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&l.on(S.BUFFER_APPENDED,()=>{const p=this.bufferedEnd;this.reachedPlayout(p)&&(this._bufferedEosTime=p,l.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var e;return((e=this.interstitial)==null?void 0:e.appendInPlace)||!1}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const i=this.timelineOffset,r=Le.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=this._bufferedEosTime-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Le.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){const e=this.hls;if(this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){this.hls.on(e,t)}once(e,t,i){this.hls.once(e,t)}off(e,t,i){this.hls.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${cr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const J0=.033;class wR extends fs{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(l=r[i])!=null&&l.event;){var l;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let r=0;r<i.length;r++){let l=i[r];if(t&&t!=="primary"&&(l=l[t]),e===l.start||e>l.start&&e<l.end)return r}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let r=e;r<=t&&i[r];r++){const l=i[r].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var i;if(((i=t[r].event)==null?void 0:i.identifier)===e)return r}return-1}findAssetIndex(e,t){const i=e.assetList,r=i.length;if(r>1)for(let l=0;l<r;l++){const o=i[l];if(!o.error){const c=o.timelineStart;if(t===c||t>c&&t<c+(o.duration||0))return l}}return 0}get assetIdAtEnd(){var e,t;const i=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(i){const r=i.assetList,l=r[r.length-1];if(l)return l.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:r}=i,l=this.events,o=this.parseDateRanges(r,{url:i.url},t),c=Object.keys(r),d=l?l.filter(f=>!c.includes(f.identifier)):[];o.length&&o.sort((f,g)=>{const p=f.cue.pre,v=f.cue.post,T=g.cue.pre,E=g.cue.post;if(p&&!T)return-1;if(T&&!p||v&&!E)return 1;if(E&&!v)return-1;if(!p&&!T&&!v&&!E){const A=f.startTime,b=g.startTime;if(A!==b)return A-b}return f.dateRange.tagOrder-g.dateRange.tagOrder}),this.events=o,d.forEach(f=>{this.removeEvent(f)}),this.updateSchedule(e,d)}updateSchedule(e,t=[]){const i=this.events||[];if(i.length||t.length||this.length<2){const r=this.items,l=this.parseSchedule(i,e);(t.length||r?.length!==l.length||l.some((c,d)=>Math.abs(c.playout.start-r[d].playout.start)>.005||Math.abs(c.playout.end-r[d].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,i){const r=[],l=Object.keys(e);for(let o=0;o<l.length;o++){const c=l[o],d=e[c];if(d.isInterstitial){let f=this.eventMap[c];f?f.setDateRange(d):(f=new DR(d,t),this.eventMap[c]=f,i===!1&&(f.appendInPlace=i)),r.push(f)}}return r}parseSchedule(e,t){const i=[],r=t.main.details,l=r.live?1/0:r.edge;let o=0;if(e=e.filter(d=>!d.error&&!(d.cue.once&&d.hasPlayed)),e.length){this.resolveOffsets(e,t);let d=0,f=0;if(e.forEach((g,p)=>{const v=g.cue.pre,T=g.cue.post,E=e[p-1]||null,A=g.appendInPlace,b=T?l:g.startOffset,L=g.duration,_=g.timelineOccupancy===Ko.Range?L:0,D=g.resumptionOffset,w=E?.startTime===b,k=b+g.cumulativeDuration;let $=A?k+L:b+D;if(v||!T&&b<=0){const B=f;f+=_,g.timelineStart=k;const V=o;o+=L,i.push({event:g,start:k,end:$,playout:{start:V,end:o},integrated:{start:B,end:f}})}else if(b<=l){if(!w){const U=b-d;if(U>J0){const te=d,re=f;f+=U;const de=o;o+=U;const ue={previousEvent:e[p-1]||null,nextEvent:g,start:te,end:te+U,playout:{start:de,end:o},integrated:{start:re,end:f}};i.push(ue)}else U>0&&E&&(E.cumulativeDuration+=U,i[i.length-1].end=b)}T&&($=k),g.timelineStart=k;const B=f;f+=_;const V=o;o+=L,i.push({event:g,start:k,end:$,playout:{start:V,end:o},integrated:{start:B,end:f}})}else return;const M=g.resumeTime;T||M>l?d=l:d=M}),d<l){var c;const g=d,p=f,v=l-d;f+=v;const T=o;o+=v,i.push({previousEvent:((c=i[i.length-1])==null?void 0:c.event)||null,nextEvent:null,start:d,end:g+v,playout:{start:T,end:o},integrated:{start:p,end:f}})}this.setDurations(l,o,f)}else i.push({previousEvent:null,nextEvent:null,start:0,end:l,playout:{start:0,end:l},integrated:{start:0,end:l}}),this.setDurations(l,l,l);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,r=i.live?1/0:i.edge;let l=0,o=-1;e.forEach((c,d)=>{const f=c.cue.pre,g=c.cue.post,p=f?0:g?r:c.startTime;this.updateAssetDurations(c),o===p?c.cumulativeDuration=l:(l=0,o=p),!g&&c.snapOptions.in&&(c.resumeAnchor=yn(null,i.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&d+1<e.length&&e[d+1].startTime-e[d].resumeTime<J0&&(e[d+1].appendInPlace=!1,e[d+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const T=he(c.resumeOffset)?c.resumeOffset:c.duration;l+=T})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>gr?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):t?!Object.keys(t).some(o=>{const c=t[o].details,d=c.edge;if(i>=d)return this.log(`"${e.identifier}" resumption ${i} past ${o} playlist end ${d}`),!1;const f=yn(null,c.fragments,i);if(!f)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const g=o==="audio"?.175:0;return Math.abs(f.start-i)<gr+g||Math.abs(f.end-i)<gr+g?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${f.start}-${f.end} sn: ${f.sn} cc: ${f.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${i} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,r=!1,l=!1;e.assetList.forEach((o,c)=>{const d=t+i;o.startOffset=i,o.timelineStart=d,r||(r=o.duration===null),l||(l=!!o.error);const f=o.error?0:o.duration||0;i+=f}),r&&!l?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Us(a){return`[${a.event?'"'+a.event.identifier+'"':"primary"}: ${a.start.toFixed(2)}-${a.end.toFixed(2)}]`}class kR{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let r;try{r=Qv(i,this.hls.sessionId,e.baseUrl)}catch(v){const T=this.assignAssetListError(e,K.ASSET_LIST_LOAD_ERROR,v,i);this.hls.trigger(S.ERROR,T);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const l=this.hls.config,o=l.loader,c=new o(l),d={responseType:"json",url:r.href},f=l.interstitialAssetListLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,T,E,A)=>{const b=v.data,L=b?.ASSETS;if(!Array.isArray(L)){const _=this.assignAssetListError(e,K.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),E.url,T,A);this.hls.trigger(S.ERROR,_);return}e.assetListResponse=b,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:b,networkDetails:A})},onError:(v,T,E,A)=>{const b=this.assignAssetListError(e,K.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${T.url})`),T.url,A,E);this.hls.trigger(S.ERROR,b)},onTimeout:(v,T,E)=>{const A=this.assignAssetListError(e,K.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${T.url})`),T.url,v,E);this.hls.trigger(S.ERROR,A)}};return c.load(d,g,p),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,i,r,l,o){return e.error=i,{type:ye.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:i,networkDetails:o,stats:l}}}function ey(a){a?.play().catch(()=>{})}class OR extends fs{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;const r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const o=r<=-.01;this.timelinePos=i,this.bufferedPos=i;const c=this.playingItem;if(!c){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(),this.checkBuffer(),o&&i<c.start||i>=c.end){var d;const v=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(c)&&(d=this.media)!=null&&d.paused&&(this.shouldPlay=!1),!o){const T=this.findItemIndex(c);if(v>T){const E=this.schedule.findJumpRestrictedIndex(T+1,v);if(E>T){this.setSchedulePosition(E);return}}}this.setSchedulePosition(v);return}const f=this.playingAsset;if(!f){if(this.playingLastItem&&this.isInterstitial(c)){const v=c.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,v))}return}const g=f.timelineStart,p=f.duration||0;(o&&i<g||i>=g+p)&&this.setScheduleToAssetAtTime(i,f)},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;const c=this.findItemIndex(r);this.setSchedulePosition(c+1)}const l=this.playingAsset;if(!l)return;const o=l.timelineStart+(l.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,l)},this.onScheduleUpdate=(i,r)=>{const l=this.schedule,o=this.playingItem,c=l.events||[],d=l.items||[],f=l.durations,g=i.map(E=>E.identifier),p=!!(c.length||g.length);(p||r)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${d.map(E=>Us(E))} pos: ${this.timelinePos}`),g.length&&this.log(`Removed events ${g}`),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const A=E.assetItem.timelineStart,b=E.timelineOffset-A;if(b)try{E.timelineOffset=A}catch(L){Math.abs(b)>gr&&this.warn(`${L} ("${E.assetId}" ${E.timelineOffset}->${A})`)}}});let v=null;if(o){const E=this.updateItem(o,this.timelinePos);this.itemsMatch(o,E)&&(this.playingItem=E,this.waitingItem=this.endedItem=null,v=()=>this.trimInPlace(E,o))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const T=this.bufferingItem;if(T){const E=this.updateItem(T,this.bufferedPos);this.itemsMatch(T,E)?(this.bufferingItem=E,v||(v=()=>this.trimInPlace(E,T))):T.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(T.event,null))}if(i.forEach(E=>{E.assetList.forEach(A=>{this.clearAssetPlayer(A.identifier,null)})}),p||r){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:d.slice(0),durations:f,removedIds:g}),this.isInterstitial(o)&&g.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}v&&v(),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new kR(e),this.schedule=new wR(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){yi(e,"play",this.onPlay),yi(e,"pause",this.onPause),yi(e,"seeking",this.onSeeking),yi(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;ni(i,"seeking",this.onSeeking),ni(i,"timeupdate",this.onTimeupdate),ni(i,"play",this.onPlay),ni(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!r){this.clearScheduleState();const l=this.findItemIndex(i);this.setSchedulePosition(l)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){const l=this.getBufferingPlayer();l&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=p=>p&&e.getAssetPlayer(p.identifier),r=(p,v,T,E,A)=>{if(p){let b=p[v].start;const L=p.event;if(L){if(v==="playout"||L.timelineOccupancy!==Ko.Point){const _=i(T);_?.interstitial===L&&(b+=_.assetItem.startOffset+_[A])}}else{const _=E==="bufferedPos"?o():e[E];b+=_-p.start}return b}return 0},l=(p,v)=>{if(p!==0&&v!=="primary"&&e.schedule.length){var T;const E=e.schedule.findItemIndexAtTime(p),A=(T=e.schedule.items)==null?void 0:T[E];if(A){const b=A[v].start-A.start;return p+b}}return p},o=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?c("primary"):Math.max(p,0)},c=p=>{var v;return(v=e.primaryDetails)!=null&&v.live?e.primaryDetails.edge:e.schedule.durations[p]},d=(p,v)=>{var T,E;const A=e.effectivePlayingItem;if(A!=null&&(T=A.event)!=null&&T.restrictions.skip)return;e.log(`seek to ${p} "${v}"`);const b=e.effectivePlayingItem,L=e.schedule.findItemIndexAtTime(p,v),_=(E=e.schedule.items)==null?void 0:E[L],D=e.getBufferingPlayer(),w=D?.interstitial,k=w?.appendInPlace,$=b&&e.itemsMatch(b,_);if(b&&(k||$)){const B=i(e.playingAsset),V=B?.media||e.primaryMedia;if(V){const U=v==="primary"?V.currentTime:r(b,v,e.playingAsset,"timelinePos","currentTime"),te=p-U,re=(k?U:V.currentTime)+te;if(re>=0&&(!B||k||re<=B.duration)){V.currentTime=re;return}}}if(_){let B=p;if(v!=="primary"){const U=_[v].start,te=p-U;B=_.start+te}const V=!e.isInterstitial(_);if((!e.isInterstitial(b)||b.event.appendInPlace)&&(V||_.event.appendInPlace)){const U=e.media||(k?D?.media:null);U&&(U.currentTime=B)}else if(b){const U=e.findItemIndex(b);if(L>U){const re=e.schedule.findJumpRestrictedIndex(U+1,L);if(re>U){e.setSchedulePosition(re);return}}let te=0;if(V)e.timelinePos=B,e.checkBuffer();else{var M;const re=_==null||(M=_.event)==null?void 0:M.assetList;if(re){const de=p-(_[v]||_).start;for(let ue=re.length;ue--;){const le=re[ue];if(le.duration&&de>=le.startOffset&&de<le.startOffset+le.duration){te=ue;break}}}}e.setSchedulePosition(L,te)}}},f=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const v=t();return e.isInterstitial(v)?v:null},g={get currentTime(){const p=f(),v=e.effectivePlayingItem;return v&&v===p?r(v,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(p){const v=f(),T=e.effectivePlayingItem;T&&T===v&&d(p+T.playout.start,"playout")},get duration(){const p=f();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const v=(p=f())==null?void 0:p.event.assetList;return v?v.map(T=>e.getAssetPlayer(T.identifier)):[]},get playingIndex(){var p;const v=(p=f())==null?void 0:p.event;return v&&e.effectivePlayingAsset?v.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return f()}};this.manager={get events(){var p,v;return((p=e.schedule)==null||(v=p.events)==null?void 0:v.slice(0))||[]},get schedule(){var p,v;return((p=e.schedule)==null||(v=p.items)==null?void 0:v.slice(0))||[]},get interstitialPlayer(){return f()?g:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return o()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){d(p,"primary")},get duration(){return c("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){d(p,"integrated")},get duration(){return c("integrated")},get seekableStart(){var p;return l(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,v=p?.event;if(v&&!v.restrictions.skip){const T=e.findItemIndex(p);if(v.appendInPlace){const E=p.playout.start+p.event.duration;d(E+.001,"playout")}else e.advanceAfterAssetEnded(v,T,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,i;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let l=this.media;!l&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(l=this.primaryMedia);const o=(i=l)==null?void 0:i.currentTime;if(!(o===void 0||!he(o)))return o}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const l=e.transferMedia();this.log(`transfer MediaSource from ${e} ${nt(l)}`),this.detachedData=l}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var i,r;if(e.media===t)return;let l=null;const o=this.hls,c=e!==o,d=c&&e.interstitial.appendInPlace,f=(i=this.detachedData)==null?void 0:i.mediaSource;let g;if(o.media)d&&(l=o.transferMedia(),this.detachedData=l),g="Primary";else if(f){const T=this.getBufferingPlayer();T?(l=T.transferMedia(),g=`${T}`):g="detached MediaSource"}else g="detached media";if(!l){if(f)l=this.detachedData,this.log(`using detachedData: MediaSource ${nt(l)}`);else if(!this.detachedData||o.media===t){const T=this.playerQueue;T.length>1&&T.forEach(E=>{if(c&&E.interstitial.appendInPlace!==d){const A=E.interstitial;this.clearInterstitial(E.interstitial,null),A.appendInPlace=!1,A.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${A}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=l&&"mediaSource"in l&&((r=l.mediaSource)==null?void 0:r.readyState)!=="closed",v=p&&l?l:t;if(this.log(`${p?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${g}`),v===l){const T=c&&e.assetId===this.schedule.assetIdAtEnd;v.overrides={duration:this.schedule.duration,endOfStream:!c||T,cueRemoval:!c}}e.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,r=this.effectivePlayingItem;if(i===-1){const l=this.hls.startPosition;if(this.timelinePos=l,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(l>=0||!this.primaryLive){const o=this.timelinePos=l>0?l:0,c=e.findItemIndexAtTime(o);this.setSchedulePosition(c)}}else if(r&&!this.playingItem){const l=e.findItemIndex(r);this.setSchedulePosition(l)}}advanceAfterAssetEnded(e,t,i){const r=Ph(e,i);if(!e.isAssetPastPlayoutLimit(r))this.setSchedulePosition(t,r);else{const l=this.schedule.items;if(l){const o=t+1,c=l.length;if(o>=c){this.setSchedulePosition(-1);return}const d=e.resumeTime;this.timelinePos<d&&(this.timelinePos=d,this.checkBuffer()),this.setSchedulePosition(o)}}}setScheduleToAssetAtTime(e,t){const i=this.schedule,r=t.parentIdentifier,l=i.getEvent(r);if(l){const o=i.findEventIndex(r),c=i.findAssetIndex(l,e);this.advanceAfterAssetEnded(l,o,c-1)}}setSchedulePosition(e,t){const i=this.schedule.items;if(!i||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const r=e>=0?i[e]:null,l=this.playingItem,o=this.playingLastItem;if(this.isInterstitial(l)){var c;const f=l.event,g=this.playingAsset,p=g?.identifier,v=p?this.getAssetPlayer(p):null;if(v&&p&&(!this.eventItemsMatch(l,r)||t!==void 0&&p!==((c=f.assetList)==null?void 0:c[t].identifier))){var d;const T=f.findAssetIndex(g);this.log(`INTERSTITIAL_ASSET_ENDED ${T+1}/${f.assetList.length} ${cr(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:T,event:f,schedule:i.slice(0),scheduleIndex:e,player:v}),this.retreiveMediaSource(p,r),v.media&&!((d=this.detachedData)!=null&&d.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(l,r)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${Us(l)}`),f.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:f,schedule:i.slice(0),scheduleIndex:e}),f.cue.once)){this.updateSchedule();const T=this.schedule.items;if(r&&T){const E=this.schedule.findItemIndex(r);this.advanceSchedule(E,T,t,l,o)}return}}this.advanceSchedule(e,i,t,l,o)}advanceSchedule(e,t,i,r,l){const o=e>=0?t[e]:null,c=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(f=>{const g=f.interstitial,p=this.schedule.findEventIndex(g.identifier);(p<e||p>e+1)&&this.clearInterstitial(g,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const f=o.event;if(i===void 0){i=this.schedule.findAssetIndex(f,this.timelinePos);const T=Ph(f,i-1);if(f.isAssetPastPlayoutLimit(T)){this.advanceAfterAssetEnded(f,e,i);return}i=T}const g=this.waitingItem;this.assetsBuffered(o,c)||this.setBufferingItem(o);let p=this.preloadAssets(f,i);if(this.eventItemsMatch(o,g||r)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${Us(o)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!c){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const v=f.assetList[i];if(!v){const T=t[e+1],E=this.media;T&&E&&!this.isInterstitial(T)&&E.currentTime<T.start&&(E.currentTime=this.timelinePos=T.start),this.advanceAfterAssetEnded(f,e,i||0);return}if(p||(p=this.getAssetPlayer(v.identifier)),p===null||p.destroyed){const T=f.assetList.length;this.warn(`asset ${i+1}/${T} player destroyed ${f}`),p=this.createAssetPlayer(f,v,i)}if(!this.eventItemsMatch(o,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(p,i,t,e,c),this.shouldPlay&&ey(p.media)}else o!==null?(this.resumePrimary(o,e,r),this.shouldPlay&&ey(this.hls.media)):l&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Us(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.timelinePos=o),this.attachPrimary(o,e)}if(!i)return;const l=this.schedule.items;l&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Us(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Le.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((i=r.mainForwardBufferInfo)==null?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const i=this.hls.levels[t.level],r=Ge(Ge({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Ge(Ge({},this.altSelection),{},{audio:i});return}const l=Ge(Ge({},r),{},{audio:i});this.mediaSelection=l}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Ge(Ge({},this.altSelection),{},{subtitles:i});return}const l=Ge(Ge({},r),{},{subtitles:i});this.mediaSelection=l}onAudioTrackSwitching(e,t){const i=f0(t);this.playerQueue.forEach(r=>r.hls.setAudioOption(t)||r.hls.setAudioOption(i))}onSubtitleTrackSwitch(e,t){const i=f0(t);this.playerQueue.forEach(r=>r.hls.setSubtitleOption(t)||t.id!==-1&&r.hls.setSubtitleOption(i))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const l=t[r];if(l.cue.post){var i;const o=this.schedule.findEventIndex(l.identifier),c=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){const i=this.schedule.items;if(e&&i){const r=this.findItemIndex(e,t);return i[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((l,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(l.identifier,null)});const i=e.end+.25,r=Le.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.attachPrimary(i,null),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const i=Le.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,t,e)}updateBufferedPos(e,t,i){const r=this.schedule,l=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],l)){this.bufferedPos=e;return}const o=this.playingItem,c=this.findItemIndex(o);let d=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var f,g;const p=this.findItemIndex(l),v=Math.min(p+1,t.length-1),T=t[v];if((d===-1&&l&&e>=l.end||(f=T.event)!=null&&f.appendInPlace&&e+.01>=T.start)&&(d=v),v-c>1&&(l==null||(g=l.event)==null?void 0:g.appendInPlace)===!1)return;if(this.bufferedPos=e,d>p&&d>c)this.bufferedToItem(T);else{const E=this.primaryDetails;this.primaryLive&&E&&e>E.edge-E.targetduration&&T.start<E.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(T)&&this.preloadAssets(T.event,0)}}else i&&o&&!this.itemsMatch(o,l)&&(d===c?this.bufferedToItem(o):d===c+1&&this.bufferedToItem(t[d]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const l=this.getAssetPlayer(r.identifier);return!(l!=null&&l.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:r,events:l}=i;if(!r||!l)return t;const o=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const d=c?c.remaining:t?t.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Us(e)}`+(t?` (${d.toFixed(2)} remaining)`:"")),this.playbackDisabled||(o?e.event.assetList.forEach(f=>{const g=this.getAssetPlayer(f.identifier);g&&g.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(f=>f.pauseBuffering()))),this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:l.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,r=i.assetList.length===0&&!i.assetListLoader,l=i.cue.once;if(r||!l){const o=this.preloadAssets(i,t);if(o!=null&&o.interstitial.appendInPlace){const c=i.assetList[t],d=this.primaryMedia;c&&d&&this.bufferAssetPlayer(o,d)}}}preloadAssets(e,t){const i=e.assetUrl,r=e.assetList.length,l=r===0&&!e.assetListLoader,o=e.cue.once;if(l){const d=e.timelineStart;if(e.appendInPlace){var c;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(c=v.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(d+.25)}let f,g=0;if(!this.playingItem&&this.primaryLive&&(g=this.hls.startPosition,g===-1&&(g=this.hls.liveSyncPosition||0)),g&&!(e.cue.pre||e.cue.post)){const v=g-d;v>0&&(f=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:r} ${e}${f?` live-start: ${g} start-offset: ${f}`:""}`),i)return this.createAsset(e,0,0,d,e.duration,i);const p=this.assetListLoader.loadAssetList(e,f);p&&(e.assetListLoader=p)}else if(!o&&r){for(let d=t;d<r;d++){const f=e.assetList[d],g=this.getAssetPlayerQueueIndex(f.identifier);(g===-1||this.playerQueue[g].destroyed)&&!f.error&&this.createAssetPlayer(e,f,d)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,r,l,o){const c={parentIdentifier:e.identifier,identifier:_R(e,o,t),duration:l,startOffset:i,timelineStart:r,uri:o};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,i){const r=this.hls,l=r.userConfig;let o=l.videoPreference;const c=r.loadLevelObj||r.levels[r.currentLevel];(o||c)&&(o=Ye({},o),c.videoCodec&&(o.videoCodec=c.videoCodec),c.videoRange&&(o.allowedVideoRanges=[c.videoRange]));const d=r.audioTracks[r.audioTrack],f=r.subtitleTracks[r.subtitleTrack];let g=0;if(this.primaryLive||e.appendInPlace){const D=this.timelinePos-t.timelineStart;if(D>1){const w=t.duration;w&&D<w&&(g=D)}}const p=t.identifier,v=Ge(Ge({},l),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:g,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:d||l.audioPreference,subtitlePreference:f||l.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(v.timelineOffset=t.timelineStart));const T=v.cmcd;T!=null&&T.sessionId&&T.contentId&&(v.cmcd=Ye({},T,{contentId:_a(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const E=new CR(this.HlsPlayerClass,v,e,t);this.playerQueue.push(E),e.assetList[i]=t;const A=D=>{if(D.live){const $=new Error(`Interstitials MUST be VOD assets ${e}`),M={fatal:!0,type:ye.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:$};this.handleAssetItemError(M,e,this.schedule.findEventIndex(e.identifier),i,$.message);return}const w=D.edge-D.fragmentStart,k=t.duration;(k===null||w>k)&&(this.log(`Interstitial asset "${p}" duration change ${k} > ${w}`),t.duration=w,this.updateSchedule())};E.on(S.LEVEL_UPDATED,(D,{details:w})=>A(w)),E.on(S.LEVEL_PTS_UPDATED,(D,{details:w})=>A(w));const b=(D,w)=>{const k=this.getAssetPlayer(p);if(k&&w.tracks){k.off(S.BUFFER_CODECS,b),k.tracks=w.tracks;const $=this.primaryMedia;this.bufferingAsset===k.assetItem&&$&&!k.media&&this.bufferAssetPlayer(k,$)}};E.on(S.BUFFER_CODECS,b);const L=()=>{var D;const w=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${w}`),!w)return;const k=this.schedule.findEventIndex(e.identifier),$=(D=this.schedule.items)==null?void 0:D[k];if(this.isInterstitial($)){const B=e.findAssetIndex(t),V=Ph(e,B);if(!e.isAssetPastPlayoutLimit(V))this.bufferedToItem($,V);else{var M;const U=(M=this.schedule.items)==null?void 0:M[k+1];U&&this.bufferedToItem(U)}}};E.on(S.BUFFERED_TO_END,L);const _=D=>()=>{if(!this.getAssetPlayer(p))return;this.shouldPlay=!0;const k=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,k,D)};return E.once(S.MEDIA_ENDED,_(i)),E.once(S.PLAYOUT_LIMIT_REACHED,_(1/0)),E.on(S.ERROR,(D,w)=>{const k=this.getAssetPlayer(p);if(w.details===K.BUFFER_STALLED_ERROR){if(k!=null&&k.media){const $=k.currentTime,M=k.duration-$;$&&e.appendInPlace&&M/k.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${p} ${e} at ${k.media.currentTime}`),L()):(this.warn(`Stalled at ${$} of ${$+M} in asset ${p} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${w.error} ${e}`)}),E.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(p))return;const w=new Error(`Asset player destroyed unexpectedly ${p}`),k={fatal:!0,type:ye.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:w};this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),i,w.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${cr(t)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:E}),E}clearInterstitial(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&Us(t)}`);const r=this.playerQueue[i];this.transferMediaFromPlayer(r,t),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,r,l){const{interstitial:o,assetItem:c,assetId:d}=e,f=o.assetList.length,g=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!g||g.identifier!==d)&&(g&&(this.clearAssetPlayer(g.identifier,i[r]),delete g.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${f} ${cr(c)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:o,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,l)}bufferAssetPlayer(e,t){var i,r;const{interstitial:l,assetItem:o}=e,c=this.schedule.findEventIndex(l.identifier),d=(i=this.schedule.items)==null?void 0:i[c];if(!d)return;this.setBufferingItem(d),this.bufferingAsset=o;const f=this.getBufferingPlayer();if(f===e)return;const g=l.appendInPlace;if(g&&f?.interstitial.appendInPlace===!1)return;const p=f?.tracks||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(g&&o!==this.playingAsset){if(!e.tracks)return;if(p&&!Gy(p,e.tracks)){const v=new Error(`Asset ${cr(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),T={fatal:!0,type:ye.OTHER_ERROR,details:K.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},E=l.findAssetIndex(o);this.handleAssetItemError(T,l,c,E,v.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,i,r,l){if(e.details===K.BUFFER_STALLED_ERROR)return;const o=t.assetList[r];this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&cr(o)} ${e.error}`);const c=o?.identifier,d=this.getAssetPlayerQueueIndex(c),f=this.playerQueue[d]||null,g=this.schedule.items,p=Ye({},e,{fatal:!1,errorAction:Oa(!0),asset:o,assetListIndex:r,event:t,schedule:g,scheduleIndex:i,player:f});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const v=this.playingAsset,T=new Error(l);if(o&&(this.clearAssetPlayer(c,null),o.error=T),!t.assetList.some(E=>!E.error))t.error=T;else if(t.appendInPlace){for(let E=r;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):v&&v.identifier===c&&this.advanceAfterAssetEnded(t,i,r)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${i?Us(i):"<none>"} error: ${e.error}`);let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const l=this.updateItem(i,r);this.itemsMatch(i,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));const o=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(o)}else this.checkStart()}onAssetListLoaded(e,t){var i;const r=t.event,l=r.identifier,o=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(l))return;const c=r.timelineStart,d=r.duration;let f=0;o.forEach((E,A)=>{const b=parseFloat(E.DURATION);this.createAsset(r,A,f,c+f,b,E.URI),f+=b}),r.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${d}) ${r}`);const g=this.waitingItem,p=g?.event.identifier===l;this.updateSchedule();const v=(i=this.bufferingItem)==null?void 0:i.event;if(p){var T;const E=this.schedule.findEventIndex(l),A=(T=this.schedule.items)==null?void 0:T[E];if(A){if(!this.playingItem&&this.timelinePos>A.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.primaryFallback(r);return}this.setBufferingItem(A)}this.setSchedulePosition(E)}else if(v?.identifier===l&&v.appendInPlace){const E=r.assetList[0],A=this.getAssetPlayer(E.identifier),b=this.primaryMedia;E&&A&&b&&this.bufferAssetPlayer(A,b)}}onError(e,t){switch(t.details){case K.ASSET_LIST_PARSING_ERROR:case K.ASSET_LIST_LOAD_ERROR:case K.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&this.primaryFallback(i);break}case K.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const ty=500;class MR extends If{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",me.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Z.IDLE,this.setInterval(ty),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:r}=t;if(_t(i)&&(this.fragPrevious=i),this.state=Z.IDLE,!r)return;const l=this.tracksBuffered[this.currentTrackId];if(!l)return;let o;const c=i.start;for(let f=0;f<l.length;f++)if(c>=l[f].start&&c<=l[f].end){o=l[f];break}const d=i.start+i.duration;o?o.end=d:(o={start:c,end:d},l.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:r}=t;if(i===0&&r!==Number.POSITIVE_INFINITY){const l=r-1;if(l<=0)return;t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(o=>{for(let c=0;c<o.length;){if(o[c].end<=l){o.shift();continue}else if(o[c].start<l)o[c].start=l;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(i,l,me.SUBTITLE)}}onError(e,t){const i=t.frag;i?.type===me.SUBTITLE&&(t.details===K.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Z.STOPPED&&(this.state=Z.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&$v(this.levels,t)){this.levels=t.map(i=>new ka(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const r=new ka(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,me.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==Z.STOPPED&&this.setInterval(ty)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:r,levels:l}=this,{details:o,id:c}=t;if(!l){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const d=l[c];if(c>=l.length||!d)return;this.log(`Subtitle track ${c} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let f=0;if(o.live||(i=d.details)!=null&&i.live){const p=this.mainDetails;if(o.deltaUpdateFailed||!p)return;const v=p.fragments[0];if(!d.details)o.hasProgramDateTime&&p.hasProgramDateTime?(Ho(o,p),f=o.fragmentStart):v&&(f=v.start,rf(o,f));else{var g;f=this.alignPlaylists(o,d.details,(g=this.levelLastLoaded)==null?void 0:g.details),f===0&&v&&(f=v.start,rf(o,f))}}d.details=o,this.levelLastLoaded=d,c===r&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:o,id:c,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===Z.IDLE&&(yn(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,r=t.decryptdata,l=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&fr(r.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,_f(r.method)).catch(c=>{throw l.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const d=performance.now();l.trigger(S.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:o,tdecrypt:d}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=Z.IDLE})}}doTick(){if(!this.media){this.state=Z.IDLE;return}if(this.state===Z.IDLE){const{currentTrackId:e,levels:t}=this,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:r}=this,l=this.getLoadPosition(),o=Le.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,r.maxBufferHole),{end:c,len:d}=o,f=i.details,g=this.hls.maxBufferLength+f.levelTargetDuration;if(d>g)return;const p=f.fragments,v=p.length,T=f.edge;let E=null;const A=this.fragPrevious;if(c<T){const _=r.maxFragLookUpTolerance,D=c>T-_?0:_;E=yn(A,p,Math.max(p[0].start,c),D),!E&&A&&A.start<p[0].start&&(E=p[0])}else E=p[v-1];if(E=this.filterReplacedPrimary(E,i.details),!E)return;const b=E.sn-f.startSN,L=p[b-1];if(L&&L.cc===E.cc&&this.fragmentTracker.getState(L)===Tt.NOT_LOADED&&(E=L),this.fragmentTracker.getState(E)===Tt.NOT_LOADED){const _=this.mapToInitFragWhenRequired(E);_&&this.loadFragment(_,i,c)}}}loadFragment(e,t,i){_t(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new PR(this.tracksBuffered[this.currentTrackId]||[])}}class PR{constructor(e){this.buffered=void 0;const t=(i,r,l)=>{if(r=r>>>0,r>l-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${l})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const NR={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Wv=a=>String.fromCharCode(NR[a]||a),Li=15,ls=100,UR={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},BR={17:2,18:4,21:6,22:8,23:10,19:13,20:15},FR={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},$R={25:2,26:4,29:6,30:8,31:10,27:13,28:15},GR=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class HR{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;Fe.log(`${this.time} [${e}] ${i}`)}}}const dn=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class Zv{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class VR{constructor(){this.uchar=" ",this.penState=new Zv}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class KR{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Zv,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ls;t++)this.chars.push(new VR);this.logger=e}equals(e){for(let t=0;t<ls;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ls;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ls;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ls&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ls)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Wv(e);if(this.pos>=ls){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ls;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<ls;i++){const r=this.chars[i].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Nh{constructor(e){this.rows=[],this.currRow=Li-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Li;t++)this.rows.push(new KR(e));this.logger=e}reset(){for(let e=0;e<Li;e++)this.rows[e].clear();this.currRow=Li-1}equals(e){let t=!0;for(let i=0;i<Li;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Li;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Li;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+nt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Li;c++)this.rows[c].clear();const l=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const c=o.rows[l].cueStartTime,d=this.logger.time;if(c!==null&&d!==null&&c<d)for(let f=0;f<this.nrRollUpRows;f++)this.rows[t-this.nrRollUpRows+f+1].copy(o.rows[l+f])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const l=e.indent,o=Math.max(l-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+nt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",r=-1;for(let l=0;l<Li;l++){const o=this.rows[l].getTextString();o&&(r=l+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class iy{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Nh(i),this.nonDisplayedMemory=new Nh(i),this.lastOutputScreen=new Nh(i),this.currRollUpRow=this.displayedMemory.rows[Li-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Li-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+nt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class sy{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=qR(),this.logger=void 0;const r=this.logger=new HR;this.channels=[null,new iy(e,t,r),new iy(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const r=t[i]&127,l=t[i+1]&127;let o=!1,c=null;if(r===0&&l===0)continue;this.logger.log(3,()=>"["+dn([t[i],t[i+1]])+"] -> ("+dn([r,l])+")");const d=this.cmdHistory;if(r>=16&&r<=31){if(zR(r,l,d)){mo(null,null,d),this.logger.log(3,()=>"Repeated command ("+dn([r,l])+") is dropped");continue}mo(r,l,this.cmdHistory),o=this.parseCmd(r,l),o||(o=this.parseMidrow(r,l)),o||(o=this.parsePAC(r,l)),o||(o=this.parseBackgroundAttributes(r,l))}else mo(null,null,d);if(!o&&(c=this.parseChars(r,l),c)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+dn([r,l])+" orig: "+dn([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(i||r))return!1;const l=e===20||e===21||e===23?1:2,o=this.channels[l];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=l,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+dn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,l=(e===16||e===24)&&t>=64&&t<=95;if(!(r||l))return!1;const o=e<=23?1:2;t>=64&&t<=95?i=o===1?UR[e]:FR[e]:i=o===1?BR[e]:$R[e];const c=this.channels[o];return c?(c.setPAC(this.interpretPAC(i,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,t){let i,r=null,l=null;if(e>=25?(i=2,l=e-8):(i=1,l=e),l>=17&&l<=19){let o;l===17?o=t+80:l===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+Wv(o)+"' in channel "+i),r=[o]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+dn(r).join(",")),r}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(i||r))return!1;let l;const o={};e===16||e===24?(l=Math.floor((t-32)/2),o.background=GR[l],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}mo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function mo(a,e,t){t.a=a,t.b=e}function zR(a,e,t){return t.a===a&&t.b===e}function qR(){return{a:null,b:null}}var $f=function(){if(Go!=null&&Go.VTTCue)return self.VTTCue;const a=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,d){if(typeof d!="string"||!Array.isArray(c))return!1;const f=d.toLowerCase();return~c.indexOf(f)?f:!1}function i(c){return t(a,c)}function r(c){return t(e,c)}function l(c,...d){let f=1;for(;f<arguments.length;f++){const g=arguments[f];for(const p in g)c[p]=g[p]}return c}function o(c,d,f){const g=this,p={enumerable:!0};g.hasBeenReset=!1;let v="",T=!1,E=c,A=d,b=f,L=null,_="",D=!0,w="auto",k="start",$=50,M="middle",B=50,V="middle";Object.defineProperty(g,"id",l({},p,{get:function(){return v},set:function(U){v=""+U}})),Object.defineProperty(g,"pauseOnExit",l({},p,{get:function(){return T},set:function(U){T=!!U}})),Object.defineProperty(g,"startTime",l({},p,{get:function(){return E},set:function(U){if(typeof U!="number")throw new TypeError("Start time must be set to a number.");E=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",l({},p,{get:function(){return A},set:function(U){if(typeof U!="number")throw new TypeError("End time must be set to a number.");A=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",l({},p,{get:function(){return b},set:function(U){b=""+U,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",l({},p,{get:function(){return L},set:function(U){L=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",l({},p,{get:function(){return _},set:function(U){const te=i(U);if(te===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=te,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",l({},p,{get:function(){return D},set:function(U){D=!!U,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",l({},p,{get:function(){return w},set:function(U){if(typeof U!="number"&&U!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");w=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",l({},p,{get:function(){return k},set:function(U){const te=r(U);if(!te)throw new SyntaxError("An invalid or illegal string was specified.");k=te,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",l({},p,{get:function(){return $},set:function(U){if(U<0||U>100)throw new Error("Position must be between 0 and 100.");$=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",l({},p,{get:function(){return M},set:function(U){const te=r(U);if(!te)throw new SyntaxError("An invalid or illegal string was specified.");M=te,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",l({},p,{get:function(){return B},set:function(U){if(U<0||U>100)throw new Error("Size must be between 0 and 100.");B=U,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",l({},p,{get:function(){return V},set:function(U){const te=r(U);if(!te)throw new SyntaxError("An invalid or illegal string was specified.");V=te,this.hasBeenReset=!0}})),g.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class YR{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Jv(a){function e(i,r,l,o){return(i|0)*3600+(r|0)*60+(l|0)+parseFloat(o||0)}const t=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class jR{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function eT(a,e,t,i){const r=i?a.split(i):[a];for(const l in r){if(typeof r[l]!="string")continue;const o=r[l].split(t);if(o.length!==2)continue;const c=o[0],d=o[1];e(c,d)}}const ff=new $f(0,0,""),po=ff.align==="middle"?"middle":"center";function XR(a,e,t){const i=a;function r(){const c=Jv(a);if(c===null)throw new Error("Malformed timestamp: "+i);return a=a.replace(/^[^\sa-zA-Z-]+/,""),c}function l(c,d){const f=new jR;eT(c,function(v,T){let E;switch(v){case"region":for(let A=t.length-1;A>=0;A--)if(t[A].id===T){f.set(v,t[A].region);break}break;case"vertical":f.alt(v,T,["rl","lr"]);break;case"line":E=T.split(","),f.integer(v,E[0]),f.percent(v,E[0])&&f.set("snapToLines",!1),f.alt(v,E[0],["auto"]),E.length===2&&f.alt("lineAlign",E[1],["start",po,"end"]);break;case"position":E=T.split(","),f.percent(v,E[0]),E.length===2&&f.alt("positionAlign",E[1],["start",po,"end","line-left","line-right","auto"]);break;case"size":f.percent(v,T);break;case"align":f.alt(v,T,["start",po,"end","left","right"]);break}},/:/,/\s/),d.region=f.get("region",null),d.vertical=f.get("vertical","");let g=f.get("line","auto");g==="auto"&&ff.line===-1&&(g=-1),d.line=g,d.lineAlign=f.get("lineAlign","start"),d.snapToLines=f.get("snapToLines",!0),d.size=f.get("size",100),d.align=f.get("align",po);let p=f.get("position","auto");p==="auto"&&ff.position===50&&(p=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=p}function o(){a=a.replace(/^\s+/,"")}if(o(),e.startTime=r(),o(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);a=a.slice(3),o(),e.endTime=r(),o(),l(a,e)}function tT(a){return a.replace(/<br(?: \/)?>/gi,`
`)}class QR{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new YR,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let l=t.buffer,o=0;for(l=tT(l);o<l.length&&l[o]!=="\r"&&l[o]!==`
`;)++o;const c=l.slice(0,o);return l[o]==="\r"&&++o,l[o]===`
`&&++o,t.buffer=l.slice(o),c}function r(l){eT(l,function(o,c){},/:/)}try{let l="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;l=i();const c=l.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:l=i(),t.state){case"HEADER":/:/.test(l)?r(l):l||(t.state="ID");continue;case"NOTE":l||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){t.state="NOTE";break}if(!l)continue;if(t.cue=new $f(0,0,""),t.state="CUE",l.indexOf("-->")===-1){t.cue.id=l;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{XR(l,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=l.indexOf("-->")!==-1;if(!l||c&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=l}continue;case"BADCUE":l||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const WR=/\r\n|\n\r|\n|\r/g,Uh=function(e,t,i=0){return e.slice(i,i+t.length)===t},ZR=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),l=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!he(t)||!he(i)||!he(r)||!he(l))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*r,t+=60*60*1e3*l,t};function Gf(a,e,t){return _a(a.toString())+_a(e.toString())+_a(t)}const JR=function(e,t,i){let r=e[t],l=e[r.prevCC];if(!l||!l.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(o=l)!=null&&o.new;){var o;e.ccOffset+=r.start-l.start,r.new=!1,r=l,l=e[r.prevCC]}e.presentationOffset=i};function e1(a,e,t,i,r,l,o){const c=new QR,d=ri(new Uint8Array(a)).trim().replace(WR,`
`).split(`
`),f=[],g=e?mL(e.baseTime,e.timescale):0;let p="00:00.000",v=0,T=0,E,A=!0;c.oncue=function(b){const L=t[i];let _=t.ccOffset;const D=(v-g)/9e4;if(L!=null&&L.new&&(T!==void 0?_=t.ccOffset=L.start:JR(t,i,D)),D){if(!e){E=new Error("Missing initPTS for VTT MPEGTS");return}_=D-t.presentationOffset}const w=b.endTime-b.startTime,k=pi((b.startTime+_-T)*9e4,r*9e4)/9e4;b.startTime=Math.max(k,0),b.endTime=Math.max(k+w,0);const $=b.text.trim();b.text=decodeURIComponent(encodeURIComponent($)),b.id||(b.id=Gf(b.startTime,b.endTime,$)),b.endTime>0&&f.push(b)},c.onparsingerror=function(b){E=b},c.onflush=function(){if(E){o(E);return}l(f)},d.forEach(b=>{if(A)if(Uh(b,"X-TIMESTAMP-MAP=")){A=!1,b.slice(16).split(",").forEach(L=>{Uh(L,"LOCAL:")?p=L.slice(6):Uh(L,"MPEGTS:")&&(v=parseInt(L.slice(7)))});try{T=ZR(p)/1e3}catch(L){E=L}return}else b===""&&(A=!1);c.parse(b+`
`)}),c.flush()}const Bh="stpp.ttml.im1t",iT=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,sT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,t1={left:"start",center:"center",right:"end",start:"start",end:"end"};function ny(a,e,t,i){const r=Re(new Uint8Array(a),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const l=r.map(c=>ri(c)),o=gL(e.baseTime,1,e.timescale);try{l.forEach(c=>t(i1(c,o)))}catch(c){i(c)}}function i1(a,e){const r=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const l={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(l).reduce((p,v)=>(p[v]=r.getAttribute(`ttp:${v}`)||l[v],p),{}),c=r.getAttribute("xml:space")!=="preserve",d=ry(Fh(r,"styling","style")),f=ry(Fh(r,"layout","region")),g=Fh(r,"body","[begin]");return[].map.call(g,p=>{const v=nT(p,c);if(!v||!p.hasAttribute("begin"))return null;const T=Gh(p.getAttribute("begin"),o),E=Gh(p.getAttribute("dur"),o);let A=Gh(p.getAttribute("end"),o);if(T===null)throw ay(p);if(A===null){if(E===null)throw ay(p);A=T+E}const b=new $f(T-e,A-e,v);b.id=Gf(b.startTime,b.endTime,b.text);const L=f[p.getAttribute("region")],_=d[p.getAttribute("style")],D=s1(L,_,d),{textAlign:w}=D;if(w){const k=t1[w];k&&(b.lineAlign=k),b.align=w}return Ye(b,D),b}).filter(p=>p!==null)}function Fh(a,e,t){const i=a.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function ry(a){return a.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function nT(a,e){return[].slice.call(a.childNodes).reduce((t,i,r)=>{var l;return i.nodeName==="br"&&r?t+`
`:(l=i.childNodes)!=null&&l.length?nT(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function s1(a,e,t){const i="http://www.w3.org/ns/ttml#styling";let r=null;const l=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(r=t[o]),l.reduce((c,d)=>{const f=$h(e,i,d)||$h(a,i,d)||$h(r,i,d);return f&&(c[d]=f),c},{})}function $h(a,e,t){return a&&a.hasAttributeNS(e,t)?a.getAttributeNS(e,t):null}function ay(a){return new Error(`Could not parse ttml timestamp ${a}`)}function Gh(a,e){if(!a)return null;let t=Jv(a);return t===null&&(iT.test(a)?t=n1(a,e):sT.test(a)&&(t=r1(a,e))),t}function n1(a,e){const t=iT.exec(a),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function r1(a,e){const t=sT.exec(a),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class yo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class a1{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=oy(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new yo(this,"textTrack1"),t=new yo(this,"textTrack2"),i=new yo(this,"textTrack3"),r=new yo(this,"textTrack4");this.cea608Parser1=new sy(1,e,t),this.cea608Parser2=new sy(3,i,r)}addCues(e,t,i,r,l){let o=!1;for(let c=l.length;c--;){const d=l[c],f=l1(d[0],d[1],t,i);if(f>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],i),o=!0,f/(i-t)>.5))return}if(o||l.push([t,i]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,i,r)}else{const c=this.Cues.newCue(null,t,i,r);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:l}){const{unparsedVttFrags:o}=this;i===me.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:l}),o.length&&(this.unparsedVttFrags=[],o.forEach(c=>{this.onFragLoaded(S.FRAG_LOADED,c)}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){const l=i.textTracks[r];if(ly(l,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return l}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:r}=this,{label:l,languageCode:o}=t[e],c=this.getExistingTrack(l,o);if(c)i[e]=c,hr(i[e]),jv(i[e],r);else{const d=this.createTextTrack("captions",l,o);d&&(d[e]=!0,i[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,r={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){const r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:r}=this;Object.keys(r).forEach(l=>{hr(r[l]),delete r[l]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=oy(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)hr(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],r=i.some(l=>l.textCodec===Bh);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if($v(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,c=o?Io(o.textTracks):null;if(this.tracks.forEach((d,f)=>{let g;if(c){let p=null;for(let v=0;v<c.length;v++)if(c[v]&&ly(c[v],d)){p=c[v],c[v]=null;break}p&&(g=p)}if(g)hr(g);else{const p=rT(d);g=this.createTextTrack(p,d.name,d.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),c!=null&&c.length){const d=c.filter(f=>f!==null).map(f=>f.label);d.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const l=`textTrack${r[1]}`,o=this.captionsProperties[l];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===me.MAIN){var i,r;const{cea608Parser1:l,cea608Parser2:o,lastSn:c}=this,{cc:d,sn:f}=t.frag,g=(i=(r=t.part)==null?void 0:r.index)!=null?i:-1;l&&o&&(f!==c+1||f===c&&g!==this.lastPartIndex+1||d!==this.lastCc)&&(l.reset(),o.reset()),this.lastCc=d,this.lastSn=f,this.lastPartIndex=g}}onFragLoaded(e,t){const{frag:i,payload:r}=t;if(i.type===me.SUBTITLE)if(r.byteLength){const l=i.decryptdata,o="stats"in t;if(l==null||!l.encrypted||o){const c=this.tracks[i.level],d=this.vttCCs;d[i.cc]||(d[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),c&&c.textCodec===Bh?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;ny(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:i,payload:r}=e,{initPTS:l,unparsedVttFrags:o}=this,c=l.length-1;if(!l[i.cc]&&c===-1){o.push(e);return}const d=this.hls,f=(t=i.initSegment)!=null&&t.data?vi(i.initSegment.data,new Uint8Array(r)).buffer:r;e1(f,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,g=>{this._appendCues(g,i.level),d.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},g=>{const p=g.message==="Missing initPTS for VTT MPEGTS";p?o.push(e):this._fallbackToIMSC1(i,r),d.logger.log(`Failed to parse VTT cue: ${g}`),!(p&&c>i.cc)&&d.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:g})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||ny(t,this.initPTS[e.cc],()=>{i.textCodec=Bh,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(l=>Xv(r,l))}else{const r=this.tracks[t];if(!r)return;const l=r.default?"default":"subtitles"+t;i.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:l})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===me.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:r}=t;if(!(i.type===me.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let l=0;l<r.length;l++){const o=r[l].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(o);this.cea608Parser1.addData(r[l].pts,c[0]),this.cea608Parser2.addData(r[l].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:l}){const{media:o}=this;if(!(!o||o.currentTime<i)){if(!l||l==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(d=>hf(c[d],t,i))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(d=>hf(c[d],t,r))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let r=2;for(let l=0;l<i;l++){const o=e[r++],c=127&e[r++],d=127&e[r++];if(c===0&&d===0)continue;if((4&o)!==0){const g=3&o;(g===0||g===1)&&(t[g].push(c),t[g].push(d))}}return t}}function rT(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function ly(a,e){return!!a&&a.kind===rT(e)&&of(e,a)}function l1(a,e,t,i){return Math.min(e,i)-Math.max(a,t)}function oy(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const o1=/\s/,u1={newCue(a,e,t,i){const r=[];let l,o,c,d,f;const g=self.VTTCue||self.TextTrackCue;for(let v=0;v<i.rows.length;v++)if(l=i.rows[v],c=!0,d=0,f="",!l.isEmpty()){var p;for(let A=0;A<l.chars.length;A++)o1.test(l.chars[A].uchar)&&c?d++:(f+=l.chars[A].uchar,c=!1);l.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const T=tT(f.trim()),E=Gf(e,t,T);a!=null&&(p=a.cues)!=null&&p.getCueById(E)||(o=new g(e,t,T),o.id=E,o.line=v+1,o.align="left",o.position=10+Math.min(80,Math.floor(d*8/32)*10),r.push(o))}return a&&r.length&&(r.sort((v,T)=>v.line==="auto"||T.line==="auto"?0:v.line>8&&T.line>8?T.line-v.line:v.line-T.line),r.forEach(v=>Xv(a,v))),r}};function c1(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const h1=/(\d+)-(\d+)\/(\d+)/;class uy{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||m1,this.controller=new self.AbortController,this.stats=new bf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const l=f1(e,this.controller.signal),o=e.responseType==="arraybuffer",c=o?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:f}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,l),self.clearTimeout(this.requestTimeout),t.timeout=d&&he(d)?d:f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Ua(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var v;this.response=this.loader=p;const T=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},f-(T-r.loading.start)),!p.ok){const{status:A,statusText:b}=p;throw new p1(b||"fetch, bad network response",A,p)}r.loading.first=T,r.total=g1(p.headers)||r.total;const E=(v=this.callbacks)==null?void 0:v.onProgress;return E&&he(t.highWaterMark)?this.loadProgressively(p,r,e,t.highWaterMark,E):o?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var v,T;const E=this.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const A=p[c];A&&(r.loaded=r.total=A);const b={url:E.url,data:p,code:E.status},L=(v=this.callbacks)==null?void 0:v.onProgress;L&&!he(t.highWaterMark)&&L(r,e,p,E),(T=this.callbacks)==null||T.onSuccess(b,r,e,E)}).catch(p=>{var v;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const T=p&&p.code||0,E=p?p.message:null;(v=this.callbacks)==null||v.onError({code:T,text:E},e,p?p.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,l){const o=new Ev,c=e.body.getReader(),d=()=>c.read().then(f=>{if(f.done)return o.dataLength&&l(t,i,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const g=f.value,p=g.length;return t.loaded+=p,p<r||o.dataLength?(o.push(g),o.dataLength>=r&&l(t,i,o.flush().buffer,e)):l(t,i,g.buffer,e),d()}).catch(()=>Promise.reject());return d()}}function f1(a,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ye({},a.headers))};return a.rangeEnd&&t.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),t}function d1(a){const e=h1.exec(a);if(e)return parseInt(e[2])-parseInt(e[1])+1}function g1(a){const e=a.get("Content-Range");if(e){const i=d1(e);if(he(i))return i}const t=a.get("Content-Length");if(t)return parseInt(t)}function m1(a,e){return new self.Request(a.url,e)}class p1 extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const y1=/^age:\s*[\d.]+\s*$/im;class aT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new bf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const l=this.xhrSetup;l?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return l(i,t.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),l(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(o=>{var c;(c=this.callbacks)==null||c.onError({code:i.status,text:o.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:l,maxLoadTimeMs:o}=i.loadPolicy;if(r)for(const c in r)e.setRequestHeader(c,r[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=l&&he(l)?l:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const r=t.readyState,l=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),l.timeout!==l.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),l.timeout=l.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),l.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const f=t.status,g=t.responseType==="text"?t.responseText:null;if(f>=200&&f<300){const E=g??t.response;if(E!=null){var o,c;i.loading.end=Math.max(self.performance.now(),i.loading.first);const A=t.responseType==="arraybuffer"?E.byteLength:E.length;i.loaded=i.total=A,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const b=(o=this.callbacks)==null?void 0:o.onProgress;b&&b(i,e,E,t);const L={url:t.responseURL,data:E,code:f};(c=this.callbacks)==null||c.onSuccess(L,i,e,t);return}}const p=l.loadPolicy.errorRetry,v=i.retry,T={url:e.url,data:void 0,code:f};if($o(p,v,!1,T))this.retry(p);else{var d;Fe.error(`${f} while loading ${e.url}`),(d=this.callbacks)==null||d.onError({code:f,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if($o(e,t,!0))this.retry(e);else{var i;Fe.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=xf(e,i.retry),i.retry++,Fe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&y1.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const v1={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},T1=Ge(Ge({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:aT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:HA,bufferController:CL,capLevelController:Bf,errorController:YA,fpsController:bR,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:uv,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:v1},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},E1()),{},{subtitleStreamController:MR,subtitleTrackController:LR,timelineController:a1,audioStreamController:RL,audioTrackController:_L,emeController:dr,cmcdController:TR,contentSteeringController:SR,interstitialsController:OR});function E1(){return{cueHandler:u1,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function S1(a,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=df(a),r=["manifest","level","frag"],l=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const c=`${o==="level"?"playlist":o}LoadPolicy`,d=e[c]===void 0,f=[];l.forEach(g=>{const p=`${o}Loading${g}`,v=e[p];if(v!==void 0&&d){f.push(p);const T=i[c].default;switch(e[c]={default:T},g){case"TimeOut":T.maxLoadTimeMs=v,T.maxTimeToFirstByteMs=v;break;case"MaxRetry":T.errorRetry.maxNumRetry=v,T.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":T.errorRetry.retryDelayMs=v,T.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":T.errorRetry.maxRetryDelayMs=v,T.timeoutRetry.maxRetryDelayMs=v;break}}}),f.length&&t.warn(`hls.js config: "${f.join('", "')}" setting(s) are deprecated, use "${c}": ${nt(e[c])}`)}),Ge(Ge({},i),e)}function df(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(df):Object.keys(a).reduce((e,t)=>(e[t]=df(a[t]),e),{}):a}function b1(a,e){const t=a.loader;t!==uy&&t!==aT?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):c1()&&(a.loader=uy,a.progressive=!0,a.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Co=2,A1=.1,x1=.05,L1=100;class R1 extends av{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(L1),this.mediaSource=t.mediaSource;const i=this.media=t.media;ni(i,"playing",this.onMediaPlaying),ni(i,"waiting",this.onMediaWaiting),ni(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(yi(i,"playing",this.onMediaPlaying),yi(i,"waiting",this.onMediaWaiting),yi(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,r;const l=(i=this.hls)==null?void 0:i.config;if(!l)return;const o=this.media;if(!o)return;const{seeking:c}=o,d=this.seeking&&!c,f=!this.seeking&&c,g=o.paused&&!c||o.ended||o.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!g&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(f||d){d&&this.stallResolved(e);return}if(g){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!Le.getBuffered(o).length){this.nudgeRetry=0;return}const p=Le.bufferInfo(o,e,0),v=p.nextStart||0,T=this.fragmentTracker;if(c&&T&&this.hls){const $=cy(this.hls.inFlightFragments,e),M=p.len>Co,B=!v||$||v-e>Co&&!T.getPartialFragment(e);if(M||B)return;this.moved=!1}const E=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&T){if(!(p.len>0)&&!v)return;const M=Math.max(v,p.start||0)-e,V=!!(E!=null&&E.live)?E.targetduration*2:Co,U=T.getPartialFragment(e);if(M>0&&(M<=V||U)){o.paused||this._trySkipBufferHole(U);return}}const A=l.detectStallWithCurrentTimeMs,b=self.performance.now(),L=this.waiting;let _=this.stalled;if(_===null)if(L>0&&b-L<A)_=this.stalled=L;else{this.stalled=b;return}const D=b-_;if(!c&&(D>=A||L)&&this.hls){var w;if(((w=this.mediaSource)==null?void 0:w.readyState)==="ended"&&!(E!=null&&E.live)&&Math.abs(e-(E?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const k=Le.bufferInfo(o,e,l.maxBufferHole);this._tryFixBufferStall(k,D,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&r&&r.length>1&&e>r.end(0)){const l=Le.bufferedInfo(Le.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&t>=l.start){const o=Le.timeRangesToArray(r),c=Le.bufferedInfo(o,t,0).bufferedIndex;if(c>-1&&c<o.length-1){const d=Le.bufferedInfo(o,e,0).bufferedIndex,f=o[c].end,g=o[c+1].start;if((d===-1||d>c)&&g-f<1&&e-f<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${f} -> ${g} buffered index: ${d}`);this.warn(p.message),this.media.currentTime+=1e-6;const v=this.fragmentTracker.getPartialFragment(e)||void 0,T=Le.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:v,buffer:T.len,bufferInfo:T})}}}}}_tryFixBufferStall(e,t,i){var r,l;const{fragmentTracker:o,media:c}=this,d=(r=this.hls)==null?void 0:r.config;if(!c||!o||!d)return;const f=(l=this.hls)==null?void 0:l.latestLevelDetails,g=o.getPartialFragment(i);if((g||f!=null&&f.live&&i<f.fragmentStart)&&(this._trySkipBufferHole(g)||!this.media))return;const p=e.buffered,v=this.adjacentTraversal(e,i);(p&&p.length>1&&e.len>d.maxBufferHole||e.nextStart&&(e.nextStart-i<d.maxBufferHole||v))&&(t>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,r=e.nextStart;if(i&&r){const l=i.getFragAtPos(t,me.MAIN),o=i.getFragAtPos(r,me.MAIN);if(l&&o)return o.sn-l.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:r,stalled:l}=this;if(!r&&l!==null&&i&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${nt(e)})`);this.warn(o.message),t.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:l}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:r}=this,l=(t=this.hls)==null?void 0:t.config;if(!r||!i||!l)return 0;const o=r.currentTime,c=Le.bufferInfo(r,o,0),d=o<c.start?c.start:c.nextStart;if(d&&this.hls){const g=c.len<=l.maxBufferHole,p=c.len>0&&c.len<1&&r.readyState<3,v=d-o;if(v>0&&(g||p)){if(v>l.maxBufferHole){let E=!1;if(o===0){const A=i.getAppendedFrag(0,me.MAIN);A&&d<A.end&&(E=!0)}if(!E){const A=e||i.getAppendedFrag(o,me.MAIN);if(A){var f;if(!((f=this.hls.loadLevelObj)!=null&&f.details)||cy(this.hls.inFlightFragments,d))return 0;let L=!1,_=A.end;for(;_<d;){const D=i.getPartialFragment(_);if(D)_+=D.duration;else{L=!0;break}}if(L)return 0}}}const T=Math.max(d+x1,o+A1);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${T}`),this.moved=!0,r.currentTime=T,!(e!=null&&e.gap)){const E=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${T}`);this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:E,reason:E.message,frag:e||void 0,buffer:c.len,bufferInfo:c})}return T}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:r}=this,l=t?.config;if(!i||!l)return 0;const o=i.currentTime;if(this.nudgeRetry++,r<l.nudgeMaxRetry){const c=o+(r+1)*l.nudgeOffset,d=new Error(`Nudging 'currentTime' from ${o} to ${c}`);this.warn(d.message),i.currentTime=c,t.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${o} after ${l.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function cy(a,e){const t=hy(a.main);if(t&&t.start<=e)return t;const i=hy(a.audio);return i&&i.start<=e?i:null}function hy(a){if(!a)return null;switch(a.state){case Z.IDLE:case Z.STOPPED:case Z.ENDED:case Z.ERROR:return null}return a.frag}const _1=.25;function gf(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function fy(a,e,t,i,r){let l=new a(e,t,"");try{l.value=i,r&&(l.type=r)}catch{l=new a(e,t,nt(r?Ge({type:r},i):i))}return l}const vo=(()=>{const a=gf();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function D1(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class I1{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&hr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return jv(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}}=this;if(!i&&!r)return;const{samples:l}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=gf();if(o)for(let c=0;c<l.length;c++){const d=l[c].type;if(d===ii.emsg&&!i||!r)continue;const f=_v(l[c].data);if(f){const g=l[c].pts;let p=g+l[c].duration;p>vo&&(p=vo),p-g<=0&&(p=g+_1);for(let T=0;T<f.length;T++){const E=f[T];if(!Dv(E)){this.updateId3CueEnds(g,d);const A=fy(o,g,p,E,d);A&&this.id3Track.addCue(A)}}}}}updateId3CueEnds(e,t){var i;const r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let l=r.length;l--;){const o=r[l];o.type===t&&o.startTime<e&&o.endTime===vo&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){const{id3Track:l,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:d}}=o;if(l&&(c||d)){let f;r==="audio"?f=g=>g.type===ii.audioId3&&d:r==="video"?f=g=>g.type===ii.emsg&&c:f=g=>g.type===ii.audioId3&&d||g.type===ii.emsg&&c,hf(l,t,i,f)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:i}=this,{dateRanges:r}=e,l=Object.keys(r);let o=this.dateRangeCuesAppended;if(i&&t){var c;if((c=i.cues)!=null&&c.length){const g=Object.keys(o).filter(p=>!l.includes(p));for(let p=g.length;p--;){const v=g[p],T=o[v].cues;delete o[v],Object.keys(T).forEach(E=>{try{const A=T[E];A.removeEventListener("enter",this.onEventCueEnter),i.removeCue(A)}catch{}})}}else o=this.dateRangeCuesAppended={}}const d=e.fragments[e.fragments.length-1];if(l.length===0||!he(d?.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const f=gf();for(let g=0;g<l.length;g++){const p=l[g],v=r[p],T=v.startTime,E=o[p],A=E?.cues||{};let b=E?.durationKnown||!1,L=vo;const{duration:_,endDate:D}=v;if(D&&_!==null)L=T+_,b=!0;else if(v.endOnNext&&!b){const k=l.reduce(($,M)=>{if(M!==v.id){const B=r[M];if(B.class===v.class&&B.startDate>v.startDate&&(!$||v.startDate<$.startDate))return B}return $},null);k&&(L=k.startTime,b=!0)}const w=Object.keys(v.attr);for(let k=0;k<w.length;k++){const $=w[k];if(!ax($))continue;const M=A[$];if(M)b&&!E.durationKnown?M.endTime=L:Math.abs(M.startTime-T)>.01&&(M.startTime=T,M.endTime=L);else if(f){let B=v.attr[$];lx($)&&(B=D1(B));const U=fy(f,T,L,{key:$,data:B},ii.dateRange);U&&(U.id=p,this.id3Track.addCue(U),A[$]=U,this.hls.config.interstitialsController&&($==="X-ASSET-LIST"||$==="X-ASSET-URL")&&U.addEventListener("enter",this.onEventCueEnter))}}o[p]={cues:A,dateRange:v,durationKnown:b}}}}class C1{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:l,maxLiveSyncPlaybackRate:o}=this.config;if(!l||o===1||!i.live)return;const c=this.targetLatency;if(c===null)return;const d=r-c,f=Math.min(this.maxLatency,c+i.targetduration);if(d<f&&d>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,o)),v=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20,T=Math.min(p,Math.max(1,v));this.changeMediaPlaybackRate(t,T)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:l,liveSyncDurationCount:o,lowLatencyMode:c}=this.config,d=this.hls.userConfig;let f=c&&i||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||f===0)&&(f=l!==void 0?l:o*r);const g=r;return f+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,g)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const r=i.edge,l=e-t-this.edgeStalled,o=r-i.totalduration,c=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,l),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===K.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,r;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class w1 extends Uf{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,r=[],l={},o={};let c=!1,d=!1,f=!1;t.levels.forEach(g=>{const p=g.attrs;let{audioCodec:v,videoCodec:T}=g;v&&(g.audioCodec=v=No(v,i)||void 0),T&&(T=g.videoCodec=DA(T));const{width:E,height:A,unknownCodecs:b}=g;let L=b?b.length:0;if(b)for(let U=L;U--;){const te=b[U];this.isAudioSupported(te)?(g.audioCodec=v=v?`${v},${te}`:te,L--,pr.audio[v.substring(0,4)]=2):this.isVideoSupported(te)&&(g.videoCodec=T=T?`${T},${te}`:te,L--,pr.video[T.substring(0,4)]=2)}if(c||(c=!!(E&&A)),d||(d=!!T),f||(f=!!v),L||v&&!this.isAudioSupported(v)||T&&!this.isVideoSupported(T)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":D,"HDCP-LEVEL":w,"PATHWAY-ID":k,RESOLUTION:$,"VIDEO-RANGE":M}=p,V=`${`${k||"."}-`}${g.bitrate}-${$}-${D}-${_}-${M}-${w}`;if(l[V])if(l[V].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const U=o[V]+=1;g.attrs["PATHWAY-ID"]=new Array(U+1).join(".");const te=this.createLevel(g);l[V]=te,r.push(te)}else l[V].addGroupId("audio",p.AUDIO),l[V].addGroupId("text",p.SUBTITLES);else{const U=this.createLevel(g);l[V]=U,o[V]=1,r.push(U)}}),this.filterAndSortMediaOptions(r,t,c,d,f)}createLevel(e){const t=new ka(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),t.supportedResult=tv(r,[])}return t}isAudioSupported(e){return Jh(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Jh(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,r,l){let o=[],c=[],d=e;if((i||r)&&l&&(d=d.filter(({videoCodec:b,videoRange:L,width:_,height:D})=>(!!b||!!(_&&D))&&OA(L))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let b="no level with compatible codecs found in manifest",L=b;t.levels.length&&(L=`one or more CODECS in variant not supported: ${nt(t.levels.map(D=>D.attrs.CODECS).filter((D,w,k)=>k.indexOf(D)===w))}`,this.warn(L),b+=` (${L})`);const _=new Error(b);this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:K.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:_,reason:L})}});return}t.audioTracks&&(o=t.audioTracks.filter(b=>!b.audioCodec||this.isAudioSupported(b.audioCodec)),dy(o)),t.subtitles&&(c=t.subtitles,dy(c));const f=d.slice(0);d.sort((b,L)=>{if(b.attrs["HDCP-LEVEL"]!==L.attrs["HDCP-LEVEL"])return(b.attrs["HDCP-LEVEL"]||"")>(L.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&b.height!==L.height)return b.height-L.height;if(b.frameRate!==L.frameRate)return b.frameRate-L.frameRate;if(b.videoRange!==L.videoRange)return Uo.indexOf(b.videoRange)-Uo.indexOf(L.videoRange);if(b.videoCodec!==L.videoCodec){const _=a0(b.videoCodec),D=a0(L.videoCodec);if(_!==D)return D-_}if(b.uri===L.uri&&b.codecSet!==L.codecSet){const _=Po(b.codecSet),D=Po(L.codecSet);if(_!==D)return D-_}return b.averageBitrate!==L.averageBitrate?b.averageBitrate-L.averageBitrate:0});let g=f[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==f.length)){for(let b=0;b<f.length;b++)if(f[b].pathwayId===d[0].pathwayId){g=f[b];break}}this._levels=d;for(let b=0;b<d.length;b++)if(d[b]===g){var p;this._firstLevel=b;const L=g.bitrate,_=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${L}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){const D=Math.min(L,this.hls.config.abrEwmaDefaultEstimateMax);D>_&&_===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=D)}break}const v=l&&!r,T=this.hls.config,E=!!(T.audioStreamController&&T.audioTrackController),A={levels:d,audioTracks:o,subtitleTracks:c,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:r,altAudio:E&&!v&&o.some(b=>!!b.url)};this.hls.trigger(S.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const g=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:K.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:g,reason:g.message}),p)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,l=r?r.attrs["PATHWAY-ID"]:void 0,o=t[e],c=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&r&&l===c)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${c?" with Pathway "+c:""} from level ${i}${l?" with Pathway "+l:""}`);const d={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,d);const f=o.details;if(!f||f.live){const g=this.switchParams(o.uri,r?.details,f);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===we.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===me.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(l=>!!i[l]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var i;const{level:r,details:l}=t,o=t.levelInfo;if(!o){var c;this.warn(`Invalid level index ${r}`),(c=t.deliveryDirectives)!=null&&c.skip&&(l.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let d=o.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(r,t,d)}else(i=t.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],o=e.details,c=o?.age;this.log(`Loading level index ${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${l?" Pathway "+l:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(S.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((l,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(l),l===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,l.details&&l.details.fragments.forEach(c=>c.level=-1)),!1));yv(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(S.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function dy(a){const e={};a.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function lT(){return self.SourceBuffer||self.WebKitSourceBuffer}function oT(){if(!Hs())return!1;const e=lT();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function k1(){if(!oT())return!1;const a=Hs();return typeof a?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>a.isTypeSupported(wa(e,"video")))||["mp4a.40.2","fLaC"].some(e=>a.isTypeSupported(wa(e,"audio"))))}function O1(){var a;const e=lT();return typeof(e==null||(a=e.prototype)==null?void 0:a.changeType)=="function"}const M1=100;class P1 extends If{constructor(e,t,i){super(e,t,i,"stream-controller",me.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,l=r?r.currentTime:null;if(l===null||!he(l)||(this.log(`Media seeked to ${l.toFixed(3)}`),!this.getBufferedFrag(l)))return;const o=this.getFwdBufferInfoAtPos(r,l,me.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${l} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(M1),this.level=-1,!this.startFragRequested){let l=r.startLevel;l===-1&&(r.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=r.firstAutoLevel),r.nextLoadLevel=l,this.level=r.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=Z.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Z.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Z.WAITING_LEVEL:{const{levels:t,level:i}=this,r=t?.[i],l=r?.details;if(l&&(!l.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(l))break;this.state=Z.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Z.IDLE;break}break}case Z.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:r,level:l}=this,o=r?.[l];this.resetStartWhenNotLoaded(o||null),this.state=Z.IDLE}}break}this.state===Z.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const l=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[l]))return;const o=i[l],c=this.getMainFwdBufferInfo();if(c===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(c,d)){const A={};this.altAudio===2&&(A.type="video"),this.hls.trigger(S.BUFFER_EOS,A),this.state=Z.ENDED;return}if(!this.buffering)return;e.loadLevel!==l&&e.manualLevel===-1&&this.log(`Adapting to level ${l} from level ${this.level}`),this.level=e.nextLoadLevel=l;const f=o.details;if(!f||this.state===Z.WAITING_LEVEL||this.waitForLive(o)){this.level=l,this.state=Z.WAITING_LEVEL,this.startFragRequested=!1;return}const g=c.len,p=this.getMaxBufferLength(o.maxBitrate);if(g>=p)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:c.end;let T=this.getNextFragment(v,f);if(this.couldBacktrack&&!this.fragPrevious&&T&&_t(T)&&this.fragmentTracker.getState(T)!==Tt.OK){var E;const b=((E=this.backtrackFragment)!=null?E:T).sn-f.startSN,L=f.fragments[b-1];L&&T.cc===L.cc&&(T=L,this.fragmentTracker.removeFragment(L))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(T&&this.isLoopLoading(T,v)){if(!T.gap){const b=this.audioOnly&&!this.altAudio?et.AUDIO:et.VIDEO,L=(b===et.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;L&&this.afterBufferFlushed(L,b,me.MAIN)}T=this.getNextFragmentLoopLoading(T,f,c,me.MAIN,p)}T&&(T.initSegment&&!T.initSegment.data&&!this.bitrateTest&&(T=T.initSegment),this.loadFragment(T,o,v))}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);r===Tt.NOT_LOADED||r===Tt.PARTIAL?_t(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,me.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const l=this.getLevelDetails();if(l!=null&&l.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<l.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,d=e[c],f=this.fragLastKbps;f&&this.fragCurrent?i=this.fragCurrent.duration*d.maxBitrate/(1e3*f)+1:i=0}else i=0;const o=this.getBufferedFrag(t.currentTime+i);if(o){const c=this.followingBufferedFrag(o);if(c){this.abortCurrentFrag();const d=c.maxStartPTS?c.maxStartPTS:c.start,f=c.duration,g=Math.max(o.end,d+Math.min(Math.max(f-this.config.maxFragLookUpTolerance,f*(this.couldBacktrack?.5:.125)),f*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Z.KEY_LOADING:case Z.FRAG_LOADING:case Z.FRAG_LOADING_WAITING_RETRY:case Z.PARSING:case Z.PARSED:this.state=Z.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;ni(i,"playing",this.onMediaPlaying),ni(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(yi(i,"playing",this.onMediaPlaying),yi(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,r=!1;t.levels.forEach(l=>{const o=l.audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&r&&!O1(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==Z.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=Z.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:r,startFragRequested:l}=this,o=t.level,c=t.details,d=c.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${d}`);const f=t.levelInfo,g=this.fragCurrent;g&&(this.state===Z.FRAG_LOADING||this.state===Z.FRAG_LOADING_WAITING_RETRY)&&g.level!==t.level&&g.loader&&this.abortCurrentFrag();let p=0;if(c.live||(i=f.details)!=null&&i.live){var v;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;p=this.alignPlaylists(c,f.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(f.details=c,this.levelLastLoaded=f,l||this.setStartPosition(c,p),this.hls.trigger(S.LEVEL_UPDATED,{details:c,level:o}),this.state===Z.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=Z.IDLE}l&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,l=this.getLoadPosition(),o=e.fragmentStart,c=e.edge,d=l>=o-t.maxFragLookUpTolerance&&l<=c;if(r!==null&&i.duration>r&&(l<r||!d)){const g=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!d&&i.readyState<4||l<c-g)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn(`Playback: ${l.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var f;const p=Le.bufferInfo(i,r,0);if(!(p!=null&&(f=p.buffered)!=null&&f.length)){i.currentTime=r;return}if(p.start<=l){i.currentTime=r;return}const{nextStart:T}=Le.bufferedInfo(p.buffered,l,0);T&&(i.currentTime=T)}else i.currentTime=r}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:l}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=o[i.level];if(!c){this.warn(`Level ${i.level} not found on progress`);return}const d=c.details;if(!d){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const f=c.videoCodec,g=d.PTSKnown||!d.live,p=(t=i.initSegment)==null?void 0:t.data,v=this._getAudioCodec(c),T=this.transmuxer=this.transmuxer||new Fv(this.hls,me.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=r?r.index:-1,A=E!==-1,b=new Rf(i.level,i.sn,i.stats.chunkCount,l.byteLength,E,A),L=this.initPTS[i.cc];T.push(l,p,v,f,i,r,d.totalduration,g,b,L)}onAudioTrackSwitching(e,t){const i=this.hls,r=this.altAudio===2;if(Bo(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),i.once(S.BUFFER_FLUSHED,()=>{var o;(o=this.hls)==null||o.trigger(S.AUDIO_TRACK_SWITCHED,t)}),i.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(S.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=Bo(t.url,this.hls);if(i){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let r,l,o=!1;for(const c in i){const d=i[c];if(d.id==="main"){if(l=c,r=d,c==="video"){const f=i[c];f&&(this.videoBuffer=f.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${l}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:r}=t,l=i.type===me.MAIN;if(l){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Z.PARSED&&(this.state=Z.IDLE);return}const c=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),_t(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}const o=this.media;o&&(!this._hasEnoughToStart&&Le.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=Z.ERROR;return}switch(t.details){case K.FRAG_GAP:case K.FRAG_PARSING_ERROR:case K.FRAG_DECRYPT_ERROR:case K.FRAG_LOAD_ERROR:case K.FRAG_LOAD_TIMEOUT:case K.KEY_LOAD_ERROR:case K.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.MAIN,t);break;case K.LEVEL_LOAD_ERROR:case K.LEVEL_LOAD_TIMEOUT:case K.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Z.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===we.LEVEL&&(this.state=Z.IDLE);break;case K.BUFFER_ADD_CODEC_ERROR:case K.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case K.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case K.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=Z.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==et.AUDIO||!this.altAudio){const i=(t===et.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,me.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&i&&(i+=r);const l=this.getLevelDetails(),o=Le.getBuffered(e),c=o.length?o.start(0):0,d=c-i,f=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<f||this.loadingParts&&d<2*(l?.partTarget||0)))&&(this.log(`adjusting start position by ${d} to match buffer start`),i+=d,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${c}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:r}=this,l=i?.frag;if(!l||this.fragContextChanged(l))return;t.fragmentError=0,this.state=Z.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=l.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(S.FRAG_LOADED,i),l.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const i=this.playlistType,{hls:r}=this,{remuxResult:l,chunkMeta:o}=e,c=this.getCurrentContext(o);if(!c){this.resetWhenMissingContext(o);return}const{frag:d,part:f,level:g}=c,{video:p,text:v,id3:T,initSegment:E}=l,{details:A}=g,b=this.altAudio?void 0:l.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=Z.PARSING,E){if(E!=null&&E.tracks){const D=d.initSegment||d;this._bufferInitSegment(g,E.tracks,D,o),r.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:i,tracks:E.tracks})}const L=E.initPTS,_=E.timescale;he(L)&&(this.initPTS[d.cc]={baseTime:L,timescale:_},r.trigger(S.INIT_PTS_FOUND,{frag:d,id:i,initPTS:L,timescale:_}))}if(p&&A){b&&p.type==="audiovideo"&&this.logMuxedErr(d);const L=A.fragments[d.sn-1-A.startSN],_=d.sn===A.startSN,D=!L||d.cc>L.cc;if(l.independent!==!1){const{startPTS:w,endPTS:k,startDTS:$,endDTS:M}=p;if(f)f.elementaryStreams[p.type]={startPTS:w,endPTS:k,startDTS:$,endDTS:M};else if(p.firstKeyFrame&&p.independent&&o.id===1&&!D&&(this.couldBacktrack=!0),p.dropped&&p.independent){const B=this.getMainFwdBufferInfo(),V=(B?B.end:this.getLoadPosition())+this.config.maxBufferHole,U=p.firstKeyFramePTS?p.firstKeyFramePTS:w;if(!_&&V<U-this.config.maxBufferHole&&!D){this.backtrack(d);return}else D&&(d.gap=!0);d.setElementaryStreamInfo(p.type,d.start,k,d.start,M,!0)}else _&&w-(A.appliedTimelineOffset||0)>Co&&(d.gap=!0);d.setElementaryStreamInfo(p.type,w,k,$,M),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(p,d,f,o,_||D)}else if(_||D)d.gap=!0;else{this.backtrack(d);return}}if(b){const{startPTS:L,endPTS:_,startDTS:D,endDTS:w}=b;f&&(f.elementaryStreams[et.AUDIO]={startPTS:L,endPTS:_,startDTS:D,endDTS:w}),d.setElementaryStreamInfo(et.AUDIO,L,_,D,w),this.bufferFragmentData(b,d,f,o)}if(A&&T!=null&&(t=T.samples)!=null&&t.length){const L={id:i,frag:d,details:A,samples:T.samples};r.trigger(S.FRAG_PARSING_METADATA,L)}if(A&&v){const L={id:i,frag:d,details:A,samples:v.samples};r.trigger(S.FRAG_PARSING_USERDATA,L)}}logMuxedErr(e){this.warn(`${_t(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,r){if(this.state!==Z.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:l,video:o,audiovideo:c}=t;if(l){let f=Ao(l.codec,e.audioCodec);f==="mp4a"&&(f="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const p=l.metadata;p&&"channelCount"in p&&(p.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),e.audioCodec&&e.audioCodec!==f&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${f}"`),l.levelCodec=f,l.id=me.MAIN,this.log(`Init audio buffer, container:${l.container}, codecs[selected/level/parsed]=[${f||""}/${e.audioCodec||""}/${l.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=me.MAIN;const f=o.codec;if(f?.length===4)switch(f){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${f}]${o.codec!==f?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const d=Object.keys(t);if(d.length){if(this.hls.trigger(S.BUFFER_CODECS,t),!this.hls)return;d.forEach(f=>{const p=t[f].initSegment;p!=null&&p.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:f,data:p,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,me.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Z.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Le.isBuffered(e,i)?t=this.getAppendedFrag(i):Le.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,l=t.level;(!r||t.sn!==r.sn||r.level!==l)&&(this.fragPlaying=t,this.hls.trigger(S.FRAG_CHANGED,{frag:t}),(!r||r.level!==l)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:l}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return he(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(he(t)){const i=this.getLevelDetails(),r=this.currentFrag||(i?yn(null,i.fragments,t):null);if(r){const l=r.programDateTime;if(l!==null){const o=l+(t-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class N1{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[i].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=K.KEY_LOAD_ERROR,i,r,l){return new os({type:ye.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:l,error:i,networkDetails:r})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length){const{sn:i,cc:r}=e;for(let l=0;l<t.length;l++){const o=t[l];if(r<=o.cc&&(i==="initSegment"||o.sn==="initSegment"||i<o.sn))return this.emeController.selectKeySystemFormat(o).then(c=>{if(o.setKeyFormat(c),this.emeController&&this.config.requireKeySystemAccessOnStart){const d=Lo(c);if(d)return this.emeController.getKeySystemAccess([d])}})}}else if(this.config.requireKeySystemAccessOnStart){const i=ba(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);const l=e.decryptdata;if(!l){const f=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,f))}const o=l.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let c=this.keyUriToKeyInfo[o];if((i=c)!=null&&i.decryptdata.key)return l.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if((r=c)!=null&&r.keyLoadPromise){var d;switch((d=c.mediaKeySessionContext)==null?void 0:d.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then(f=>(l.key=f.keyInfo.decryptdata.key,{frag:e,keyInfo:c}))}}switch(c=this.keyUriToKeyInfo[o]={decryptdata:l,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},l.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return l.keyFormat==="identity"?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,K.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${l.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(i);if(r)return(e.keyLoadPromise=r.then(l=>(e.mediaKeySessionContext=l,i))).catch(l=>{throw e.keyLoadPromise=null,l})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,r=i.loader,l=new r(i);return t.keyLoader=e.loader=l,e.keyLoadPromise=new Promise((o,c)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},f=i.keyLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,T,E,A)=>{const{frag:b,keyInfo:L,url:_}=E;if(!b.decryptdata||L!==this.keyUriToKeyInfo[_])return c(this.createKeyLoadError(b,K.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));L.decryptdata.key=b.decryptdata.key=new Uint8Array(v.data),b.keyLoader=null,L.loader=null,o({frag:b,keyInfo:L})},onError:(v,T,E,A)=>{this.resetLoader(T),c(this.createKeyLoadError(t,K.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),E,Ge({url:d.url,data:void 0},v)))},onTimeout:(v,T,E)=>{this.resetLoader(T),c(this.createKeyLoadError(t,K.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(v,T,E)=>{this.resetLoader(T),c(this.createKeyLoadError(t,K.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};l.load(d,g,p)})}resetLoader(e){const{frag:t,keyInfo:i,url:r}=e,l=i.loader;t.keyLoader===l&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],l&&l.destroy()}}function gy(a){const{type:e}=a;switch(e){case we.AUDIO_TRACK:return me.AUDIO;case we.SUBTITLE_TRACK:return me.SUBTITLE;default:return me.MAIN}}function Hh(a,e){let t=a.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class U1{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,r=t.loader,l=i||r,o=new l(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:we.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:r,pathwayId:l,url:o,deliveryDirectives:c,levelInfo:d}=t;this.load({id:i,level:r,pathwayId:l,responseType:"text",type:we.LEVEL,url:o,deliveryDirectives:c,levelOrTrack:d})}onAudioTrackLoading(e,t){const{id:i,groupId:r,url:l,deliveryDirectives:o,track:c}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:we.AUDIO_TRACK,url:l,deliveryDirectives:o,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:i,groupId:r,url:l,deliveryDirectives:o,track:c}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:we.SUBTITLE_TRACK,url:l,deliveryDirectives:o,levelOrTrack:c})}onLevelsUpdated(e,t){const i=this.loaders[we.LEVEL];if(i){const r=i.context;r&&!t.levels.some(l=>l===r.levelOrTrack)&&(i.abort(),delete this.loaders[we.LEVEL])}}load(e){var t;const i=this.hls.config;let r=this.getInternalLoader(e);if(r){const f=this.hls.logger,g=r.context;if(g&&g.levelOrTrack===e.levelOrTrack&&(g.url===e.url||g.deliveryDirectives&&!e.deliveryDirectives)){g.url===e.url?f.log(`[playlist-loader]: ignore ${e.url} ongoing request`):f.log(`[playlist-loader]: ignore ${e.url} in favor of ${g.url}`);return}f.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let l;if(e.type===we.MANIFEST?l=i.manifestLoadPolicy.default:l=Ye({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),he((t=e.deliveryDirectives)==null?void 0:t.part)){let f;if(e.type===we.LEVEL&&e.level!==null?f=this.hls.levels[e.level].details:e.type===we.AUDIO_TRACK&&e.id!==null?f=this.hls.audioTracks[e.id].details:e.type===we.SUBTITLE_TRACK&&e.id!==null&&(f=this.hls.subtitleTracks[e.id].details),f){const g=f.partTarget,p=f.targetduration;if(g&&p){const v=Math.max(g*3,p*.8)*1e3;l=Ye({},l,{maxTimeToFirstByteMs:Math.min(v,l.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,l.maxTimeToFirstByteMs)})}}}const o=l.errorRetry||l.timeoutRetry||{},c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},d={onSuccess:(f,g,p,v)=>{const T=this.getInternalLoader(p);this.resetInternalLoader(p.type);const E=f.data;if(E.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(f,p,new Error("no EXTM3U delimiter"),v||null,g);return}g.parsing.start=performance.now(),Hi.isMediaPlaylist(E)||p.type!==we.MANIFEST?this.handleTrackOrLevelPlaylist(f,g,p,v||null,T):this.handleMasterPlaylist(f,g,p,v)},onError:(f,g,p,v)=>{this.handleNetworkError(g,p,!1,f,v)},onTimeout:(f,g,p)=>{this.handleNetworkError(g,p,!0,void 0,f)}};r.load(e,c,d)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,r){const l=this.hls,o=e.data,c=Hh(e,i),d=Hi.parseMasterPlaylist(o,c);if(d.playlistParsingError){this.handleManifestParsingError(e,i,d.playlistParsingError,r,t);return}const{contentSteering:f,levels:g,sessionData:p,sessionKeys:v,startTimeOffset:T,variableList:E}=d;this.variableList=E;const{AUDIO:A=[],SUBTITLES:b,"CLOSED-CAPTIONS":L}=Hi.parseMasterPlaylistMedia(o,c,d);A.length&&!A.some(D=>!D.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new at({}),bitrate:0,url:""})),l.trigger(S.MANIFEST_LOADED,{levels:g,audioTracks:A,subtitles:b,captions:L,contentSteering:f,url:c,stats:t,networkDetails:r,sessionData:p,sessionKeys:v,startTimeOffset:T,variableList:E})}handleTrackOrLevelPlaylist(e,t,i,r,l){const o=this.hls,{id:c,level:d,type:f}=i,g=Hh(e,i),p=he(d)?d:he(c)?c:0,v=gy(i),T=Hi.parseLevelPlaylist(e.data,g,p,v,0,this.variableList);if(f===we.MANIFEST){const E={attrs:new at({}),bitrate:0,details:T,name:"",url:g};T.requestScheduled=t.loading.start+gv(T,0),o.trigger(S.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:g,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=T,this.handlePlaylistLoaded(T,e,t,i,r,l)}handleManifestParsingError(e,t,i,r,l){this.hls.trigger(S.ERROR,{type:ye.NETWORK_ERROR,details:K.MANIFEST_PARSING_ERROR,fatal:t.type===we.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:l})}handleNetworkError(e,t,i=!1,r,l){let o=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===we.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===we.AUDIO_TRACK||e.type===we.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let d=K.UNKNOWN,f=!1;const g=this.getInternalLoader(e);switch(e.type){case we.MANIFEST:d=i?K.MANIFEST_LOAD_TIMEOUT:K.MANIFEST_LOAD_ERROR,f=!0;break;case we.LEVEL:d=i?K.LEVEL_LOAD_TIMEOUT:K.LEVEL_LOAD_ERROR,f=!1;break;case we.AUDIO_TRACK:d=i?K.AUDIO_TRACK_LOAD_TIMEOUT:K.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case we.SUBTITLE_TRACK:d=i?K.SUBTITLE_TRACK_LOAD_TIMEOUT:K.SUBTITLE_LOAD_ERROR,f=!1;break}g&&this.resetInternalLoader(e.type);const p={type:ye.NETWORK_ERROR,details:d,fatal:f,url:e.url,loader:g,context:e,error:c,networkDetails:t,stats:l};if(r){const v=t?.url||e.url;p.response=Ge({url:v,data:void 0},r)}this.hls.trigger(S.ERROR,p)}handlePlaylistLoaded(e,t,i,r,l,o){const c=this.hls,{type:d,level:f,id:g,groupId:p,deliveryDirectives:v}=r,T=Hh(t,r),E=gy(r),A=typeof r.level=="number"&&E===me.MAIN?f:void 0;if(!e.fragments.length){const L=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(S.ERROR,{type:ye.NETWORK_ERROR,details:K.LEVEL_EMPTY_ERROR,fatal:!1,url:T,error:L,reason:L.message,response:t,context:r,level:A,parent:E,networkDetails:l,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const b=e.playlistParsingError;if(b){if(this.hls.logger.warn(b),!c.config.ignorePlaylistParsingErrors){c.trigger(S.ERROR,{type:ye.NETWORK_ERROR,details:K.LEVEL_PARSING_ERROR,fatal:!1,url:T,error:b,reason:b.message,response:t,context:r,level:A,parent:E,networkDetails:l,stats:i});return}e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case we.MANIFEST:case we.LEVEL:c.trigger(S.LEVEL_LOADED,{details:e,levelInfo:r.levelOrTrack||c.levels[0],level:A||0,id:g||0,stats:i,networkDetails:l,deliveryDirectives:v,withoutMultiVariant:d===we.MANIFEST});break;case we.AUDIO_TRACK:c.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:g||0,groupId:p||"",stats:i,networkDetails:l,deliveryDirectives:v});break;case we.SUBTITLE_TRACK:c.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:g||0,groupId:p||"",stats:i,networkDetails:l,deliveryDirectives:v});break}}}class $i{static get version(){return Pa}static isMSESupported(){return oT()}static isSupported(){return k1()}static getMediaSource(){return Hs()}static get Events(){return S}static get MetadataSchema(){return ii}static get ErrorTypes(){return ye}static get ErrorDetails(){return K}static get DefaultConfig(){return $i.defaultConfig?$i.defaultConfig:T1}static set DefaultConfig(e){$i.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Cf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=nA(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=S1($i.DefaultConfig,e,t);this.userConfig=e,i.progressive&&b1(i,t);const{abrController:r,bufferController:l,capLevelController:o,errorController:c,fpsController:d}=i,f=new c(this),g=this.abrController=new r(this),p=new jA(this),v=i.interstitialsController,T=v?this.interstitialsController=new v(this,$i):null,E=this.bufferController=new l(this,p),A=this.capLevelController=new o(this),b=new d(this),L=new U1(this),_=i.contentSteeringController,D=_?new _(this):null,w=this.levelController=new w1(this,D),k=new I1(this),$=new N1(this.config),M=this.streamController=new P1(this,p,$),B=this.gapController=new R1(this,p);A.setStreamController(M),b.setStreamController(M);const V=[L,w,M];T&&V.splice(1,0,T),D&&V.splice(1,0,D),this.networkControllers=V;const U=[g,E,B,A,b,k,p];this.audioTrackController=this.createController(i.audioTrackController,V);const te=i.audioStreamController;te&&V.push(this.audioStreamController=new te(this,p,$)),this.subtitleTrackController=this.createController(i.subtitleTrackController,V);const re=i.subtitleStreamController;re&&V.push(this.subtititleStreamController=new re(this,p,$)),this.createController(i.timelineController,U),$.emeController=this.emeController=this.createController(i.emeController,U),this.cmcdController=this.createController(i.cmcdController,U),this.latencyController=this.createController(C1,U),this.coreComponents=U,V.push(f);const de=f.onErrorOut;typeof de=="function"&&this.on(S.ERROR,de,f),this.on(S.MANIFEST_LOADED,L.onManifestLoaded,L)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const r=e===S.ERROR;this.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:K.INTERNAL_EXCEPTION,fatal:r,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const l=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:K.ATTACH_MEDIA_ERROR,fatal:!0,error:l});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,r=t?e:{media:i};this._media=i,this.trigger(S.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,r=this._url=Sf.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[me.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[me.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[me.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=RR()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){kA(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,i)for(let l=r;l--;){const o=e[l].attrs["HDCP-LEVEL"];if(o&&o<=i)return l}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=sv(t);return iv(e,i,navigator.mediaCapabilities)}}$i.defaultConfig=void 0;const B1=({src:a})=>{const e=si.useRef(null),t=a.endsWith(".m3u8"),i=si.useRef(null);si.useEffect(()=>{i.current?.destroy(),!(!t||!e.current)&&$i.isSupported()&&(async()=>{const c=document.getElementById("plyr");var d=new $i;i.current=d;const f=a.replace("https://akuma-trstin.mushroomtrack.com/hls","/proxy/hls");d.loadSource(f),console.log(`HLS source loaded: ${c}`),d.attachMedia(c),e.current.plyr.media=c,d.on($i.Events.MANIFEST_PARSED,function(){e.current.plyr.play()})})()},[a,t]);const r=["play","progress","current-time","mute","volume","fullscreen"],l=t?{type:"video",sources:[]}:{type:"video",title:"MP4 ",sources:[{src:a,type:"video/mp4"}]};return it.jsx(bo,{ref:e,id:"plyr",source:l,options:{controls:r}})},F1=({setVideoSrc:a})=>{const[e,t]=si.useState(""),[i,r]=si.useState([]),l=c=>{t(c.target.value)},o=async()=>{try{const d=await(await fetch(e)).text();console.log(d);const g=new DOMParser().parseFromString(d,"text/html"),v=Array.from(g.querySelectorAll("iframe")).map(A=>A.src).filter(A=>A),T=Array.from(g.querySelectorAll("script"));let E="";for(const A of T)if(A.textContent&&A.textContent.includes("var hlsUrl")){const b=A.textContent.match(/var hlsUrl\s*=\s*['"]([^'"]+)['"]/);if(b){E=b[1];break}}E&&v.push(E),v.length>0?r(v):alert(" iframe ")}catch(c){console.error(":",c),alert(" URL")}};return it.jsxs("div",{children:[it.jsx("label",{className:"block mb-1 font-medium text-gray-700",children:""}),it.jsxs("div",{className:"flex space-x-2",children:[it.jsx("input",{type:"text",value:e,onChange:l,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),it.jsx("button",{onClick:o,className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600",children:""})]}),i.length>0&&it.jsxs("div",{className:"mt-4",children:[it.jsx("label",{className:"block mb-1 font-medium text-gray-700",children:""}),it.jsx("ul",{className:"space-y-2",children:i.map((c,d)=>it.jsx("li",{className:"flex items-center space-x-2",children:it.jsx("span",{className:"text-blue-500 underline cursor-pointer",onClick:()=>a(c),children:c})},d))})]})]})};function $1(){const[a,e]=si.useState("https://cdn.plyr.io/static/demo/View_From_A_Blue_Moon_Trailer-720p.mp4"),t=r=>{const l=r.target.files?.[0];if(l){const o=URL.createObjectURL(l);e(o)}},i=r=>{e(r.target.value)};return it.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col items-center justify-center px-4 py-8 space-y-6",children:[it.jsx("h2",{className:"text-3xl font-bold text-blue-600",children:" Plyr  Demo"}),it.jsx(F1,{setVideoSrc:e}),it.jsxs("div",{className:"w-full max-w-xl space-y-4",children:[it.jsxs("div",{children:[it.jsx("label",{className:"block mb-1 font-medium text-gray-700",children:""}),it.jsx("input",{type:"text",value:a,onChange:i,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),it.jsxs("div",{children:[it.jsx("label",{className:"block mb-1 font-medium text-gray-700",children:""}),it.jsx("input",{type:"file",accept:"video/*",onChange:t,className:"block"})]})]}),it.jsx("div",{className:"w-full max-w-3xl",children:it.jsx(B1,{src:a})})]})}OS.createRoot(document.getElementById("root")).render(it.jsx(si.StrictMode,{children:it.jsx($1,{})}));
